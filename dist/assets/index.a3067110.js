(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))s(f);new MutationObserver(f=>{for(const d of f)if(d.type==="childList")for(const m of d.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function o(f){const d={};return f.integrity&&(d.integrity=f.integrity),f.referrerpolicy&&(d.referrerPolicy=f.referrerpolicy),f.crossorigin==="use-credentials"?d.credentials="include":f.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(f){if(f.ep)return;f.ep=!0;const d=o(f);fetch(f.href,d)}})();function makeMap(i,e){const o=Object.create(null),s=i.split(",");for(let f=0;f<s.length;f++)o[s[f]]=!0;return e?f=>!!o[f.toLowerCase()]:f=>!!o[f]}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(i){return!!i||i===""}function normalizeStyle(i){if(isArray$1(i)){const e={};for(let o=0;o<i.length;o++){const s=i[o],f=isString$1(s)?parseStringStyle(s):normalizeStyle(s);if(f)for(const d in f)e[d]=f[d]}return e}else{if(isString$1(i))return i;if(isObject$1(i))return i}}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:(.+)/;function parseStringStyle(i){const e={};return i.split(listDelimiterRE).forEach(o=>{if(o){const s=o.split(propertyDelimiterRE);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function normalizeClass(i){let e="";if(isString$1(i))e=i;else if(isArray$1(i))for(let o=0;o<i.length;o++){const s=normalizeClass(i[o]);s&&(e+=s+" ")}else if(isObject$1(i))for(const o in i)i[o]&&(e+=o+" ");return e.trim()}function looseCompareArrays(i,e){if(i.length!==e.length)return!1;let o=!0;for(let s=0;o&&s<i.length;s++)o=looseEqual(i[s],e[s]);return o}function looseEqual(i,e){if(i===e)return!0;let o=isDate(i),s=isDate(e);if(o||s)return o&&s?i.getTime()===e.getTime():!1;if(o=isSymbol(i),s=isSymbol(e),o||s)return i===e;if(o=isArray$1(i),s=isArray$1(e),o||s)return o&&s?looseCompareArrays(i,e):!1;if(o=isObject$1(i),s=isObject$1(e),o||s){if(!o||!s)return!1;const f=Object.keys(i).length,d=Object.keys(e).length;if(f!==d)return!1;for(const m in i){const _=i.hasOwnProperty(m),$=e.hasOwnProperty(m);if(_&&!$||!_&&$||!looseEqual(i[m],e[m]))return!1}}return String(i)===String(e)}function looseIndexOf(i,e){return i.findIndex(o=>looseEqual(o,e))}const toDisplayString=i=>isString$1(i)?i:i==null?"":isArray$1(i)||isObject$1(i)&&(i.toString===objectToString||!isFunction$1(i.toString))?JSON.stringify(i,replacer,2):String(i),replacer=(i,e)=>e&&e.__v_isRef?replacer(i,e.value):isMap(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((o,[s,f])=>(o[`${s} =>`]=f,o),{})}:isSet(e)?{[`Set(${e.size})`]:[...e.values()]}:isObject$1(e)&&!isArray$1(e)&&!isPlainObject$1(e)?String(e):e,EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,onRE=/^on[^a-z]/,isOn=i=>onRE.test(i),isModelListener=i=>i.startsWith("onUpdate:"),extend=Object.assign,remove$1=(i,e)=>{const o=i.indexOf(e);o>-1&&i.splice(o,1)},hasOwnProperty=Object.prototype.hasOwnProperty,hasOwn=(i,e)=>hasOwnProperty.call(i,e),isArray$1=Array.isArray,isMap=i=>toTypeString(i)==="[object Map]",isSet=i=>toTypeString(i)==="[object Set]",isDate=i=>toTypeString(i)==="[object Date]",isFunction$1=i=>typeof i=="function",isString$1=i=>typeof i=="string",isSymbol=i=>typeof i=="symbol",isObject$1=i=>i!==null&&typeof i=="object",isPromise=i=>isObject$1(i)&&isFunction$1(i.then)&&isFunction$1(i.catch),objectToString=Object.prototype.toString,toTypeString=i=>objectToString.call(i),toRawType=i=>toTypeString(i).slice(8,-1),isPlainObject$1=i=>toTypeString(i)==="[object Object]",isIntegerKey=i=>isString$1(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=i=>{const e=Object.create(null);return o=>e[o]||(e[o]=i(o))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(i=>i.replace(camelizeRE,(e,o)=>o?o.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(i=>i.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(i=>i.charAt(0).toUpperCase()+i.slice(1)),toHandlerKey=cacheStringFunction(i=>i?`on${capitalize(i)}`:""),hasChanged=(i,e)=>!Object.is(i,e),invokeArrayFns=(i,e)=>{for(let o=0;o<i.length;o++)i[o](e)},def=(i,e,o)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value:o})},toNumber=i=>{const e=parseFloat(i);return isNaN(e)?i:e};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let activeEffectScope;class EffectScope{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=activeEffectScope,!e&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}run(e){if(this.active){const o=activeEffectScope;try{return activeEffectScope=this,e()}finally{activeEffectScope=o}}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(e){if(this.active){let o,s;for(o=0,s=this.effects.length;o<s;o++)this.effects[o].stop();for(o=0,s=this.cleanups.length;o<s;o++)this.cleanups[o]();if(this.scopes)for(o=0,s=this.scopes.length;o<s;o++)this.scopes[o].stop(!0);if(!this.detached&&this.parent&&!e){const f=this.parent.scopes.pop();f&&f!==this&&(this.parent.scopes[this.index]=f,f.index=this.index)}this.parent=void 0,this.active=!1}}}function recordEffectScope(i,e=activeEffectScope){e&&e.active&&e.effects.push(i)}const createDep=i=>{const e=new Set(i);return e.w=0,e.n=0,e},wasTracked=i=>(i.w&trackOpBit)>0,newTracked=i=>(i.n&trackOpBit)>0,initDepMarkers=({deps:i})=>{if(i.length)for(let e=0;e<i.length;e++)i[e].w|=trackOpBit},finalizeDepMarkers=i=>{const{deps:e}=i;if(e.length){let o=0;for(let s=0;s<e.length;s++){const f=e[s];wasTracked(f)&&!newTracked(f)?f.delete(i):e[o++]=f,f.w&=~trackOpBit,f.n&=~trackOpBit}e.length=o}},targetMap=new WeakMap;let effectTrackDepth=0,trackOpBit=1;const maxMarkerBits=30;let activeEffect;const ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol("");class ReactiveEffect{constructor(e,o=null,s){this.fn=e,this.scheduler=o,this.active=!0,this.deps=[],this.parent=void 0,recordEffectScope(this,s)}run(){if(!this.active)return this.fn();let e=activeEffect,o=shouldTrack;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=activeEffect,activeEffect=this,shouldTrack=!0,trackOpBit=1<<++effectTrackDepth,effectTrackDepth<=maxMarkerBits?initDepMarkers(this):cleanupEffect(this),this.fn()}finally{effectTrackDepth<=maxMarkerBits&&finalizeDepMarkers(this),trackOpBit=1<<--effectTrackDepth,activeEffect=this.parent,shouldTrack=o,this.parent=void 0,this.deferStop&&this.stop()}}stop(){activeEffect===this?this.deferStop=!0:this.active&&(cleanupEffect(this),this.onStop&&this.onStop(),this.active=!1)}}function cleanupEffect(i){const{deps:e}=i;if(e.length){for(let o=0;o<e.length;o++)e[o].delete(i);e.length=0}}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const i=trackStack.pop();shouldTrack=i===void 0?!0:i}function track(i,e,o){if(shouldTrack&&activeEffect){let s=targetMap.get(i);s||targetMap.set(i,s=new Map);let f=s.get(o);f||s.set(o,f=createDep()),trackEffects(f)}}function trackEffects(i,e){let o=!1;effectTrackDepth<=maxMarkerBits?newTracked(i)||(i.n|=trackOpBit,o=!wasTracked(i)):o=!i.has(activeEffect),o&&(i.add(activeEffect),activeEffect.deps.push(i))}function trigger(i,e,o,s,f,d){const m=targetMap.get(i);if(!m)return;let _=[];if(e==="clear")_=[...m.values()];else if(o==="length"&&isArray$1(i))m.forEach(($,G)=>{(G==="length"||G>=s)&&_.push($)});else switch(o!==void 0&&_.push(m.get(o)),e){case"add":isArray$1(i)?isIntegerKey(o)&&_.push(m.get("length")):(_.push(m.get(ITERATE_KEY)),isMap(i)&&_.push(m.get(MAP_KEY_ITERATE_KEY)));break;case"delete":isArray$1(i)||(_.push(m.get(ITERATE_KEY)),isMap(i)&&_.push(m.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(i)&&_.push(m.get(ITERATE_KEY));break}if(_.length===1)_[0]&&triggerEffects(_[0]);else{const $=[];for(const G of _)G&&$.push(...G);triggerEffects(createDep($))}}function triggerEffects(i,e){const o=isArray$1(i)?i:[...i];for(const s of o)s.computed&&triggerEffect(s);for(const s of o)s.computed||triggerEffect(s)}function triggerEffect(i,e){(i!==activeEffect||i.allowRecurse)&&(i.scheduler?i.scheduler():i.run())}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(isSymbol)),get=createGetter(),shallowGet=createGetter(!1,!0),readonlyGet=createGetter(!0),arrayInstrumentations=createArrayInstrumentations();function createArrayInstrumentations(){const i={};return["includes","indexOf","lastIndexOf"].forEach(e=>{i[e]=function(...o){const s=toRaw(this);for(let d=0,m=this.length;d<m;d++)track(s,"get",d+"");const f=s[e](...o);return f===-1||f===!1?s[e](...o.map(toRaw)):f}}),["push","pop","shift","unshift","splice"].forEach(e=>{i[e]=function(...o){pauseTracking();const s=toRaw(this)[e].apply(this,o);return resetTracking(),s}}),i}function createGetter(i=!1,e=!1){return function(s,f,d){if(f==="__v_isReactive")return!i;if(f==="__v_isReadonly")return i;if(f==="__v_isShallow")return e;if(f==="__v_raw"&&d===(i?e?shallowReadonlyMap:readonlyMap:e?shallowReactiveMap:reactiveMap).get(s))return s;const m=isArray$1(s);if(!i&&m&&hasOwn(arrayInstrumentations,f))return Reflect.get(arrayInstrumentations,f,d);const _=Reflect.get(s,f,d);return(isSymbol(f)?builtInSymbols.has(f):isNonTrackableKeys(f))||(i||track(s,"get",f),e)?_:isRef(_)?m&&isIntegerKey(f)?_:_.value:isObject$1(_)?i?readonly(_):reactive(_):_}}const set=createSetter(),shallowSet=createSetter(!0);function createSetter(i=!1){return function(o,s,f,d){let m=o[s];if(isReadonly(m)&&isRef(m)&&!isRef(f))return!1;if(!i&&(!isShallow(f)&&!isReadonly(f)&&(m=toRaw(m),f=toRaw(f)),!isArray$1(o)&&isRef(m)&&!isRef(f)))return m.value=f,!0;const _=isArray$1(o)&&isIntegerKey(s)?Number(s)<o.length:hasOwn(o,s),$=Reflect.set(o,s,f,d);return o===toRaw(d)&&(_?hasChanged(f,m)&&trigger(o,"set",s,f):trigger(o,"add",s,f)),$}}function deleteProperty(i,e){const o=hasOwn(i,e);i[e];const s=Reflect.deleteProperty(i,e);return s&&o&&trigger(i,"delete",e,void 0),s}function has(i,e){const o=Reflect.has(i,e);return(!isSymbol(e)||!builtInSymbols.has(e))&&track(i,"has",e),o}function ownKeys(i){return track(i,"iterate",isArray$1(i)?"length":ITERATE_KEY),Reflect.ownKeys(i)}const mutableHandlers={get,set,deleteProperty,has,ownKeys},readonlyHandlers={get:readonlyGet,set(i,e){return!0},deleteProperty(i,e){return!0}},shallowReactiveHandlers=extend({},mutableHandlers,{get:shallowGet,set:shallowSet}),toShallow=i=>i,getProto=i=>Reflect.getPrototypeOf(i);function get$1(i,e,o=!1,s=!1){i=i.__v_raw;const f=toRaw(i),d=toRaw(e);o||(e!==d&&track(f,"get",e),track(f,"get",d));const{has:m}=getProto(f),_=s?toShallow:o?toReadonly:toReactive;if(m.call(f,e))return _(i.get(e));if(m.call(f,d))return _(i.get(d));i!==f&&i.get(e)}function has$1(i,e=!1){const o=this.__v_raw,s=toRaw(o),f=toRaw(i);return e||(i!==f&&track(s,"has",i),track(s,"has",f)),i===f?o.has(i):o.has(i)||o.has(f)}function size(i,e=!1){return i=i.__v_raw,!e&&track(toRaw(i),"iterate",ITERATE_KEY),Reflect.get(i,"size",i)}function add(i){i=toRaw(i);const e=toRaw(this);return getProto(e).has.call(e,i)||(e.add(i),trigger(e,"add",i,i)),this}function set$1(i,e){e=toRaw(e);const o=toRaw(this),{has:s,get:f}=getProto(o);let d=s.call(o,i);d||(i=toRaw(i),d=s.call(o,i));const m=f.call(o,i);return o.set(i,e),d?hasChanged(e,m)&&trigger(o,"set",i,e):trigger(o,"add",i,e),this}function deleteEntry(i){const e=toRaw(this),{has:o,get:s}=getProto(e);let f=o.call(e,i);f||(i=toRaw(i),f=o.call(e,i)),s&&s.call(e,i);const d=e.delete(i);return f&&trigger(e,"delete",i,void 0),d}function clear(){const i=toRaw(this),e=i.size!==0,o=i.clear();return e&&trigger(i,"clear",void 0,void 0),o}function createForEach(i,e){return function(s,f){const d=this,m=d.__v_raw,_=toRaw(m),$=e?toShallow:i?toReadonly:toReactive;return!i&&track(_,"iterate",ITERATE_KEY),m.forEach((G,Z)=>s.call(f,$(G),$(Z),d))}}function createIterableMethod(i,e,o){return function(...s){const f=this.__v_raw,d=toRaw(f),m=isMap(d),_=i==="entries"||i===Symbol.iterator&&m,$=i==="keys"&&m,G=f[i](...s),Z=o?toShallow:e?toReadonly:toReactive;return!e&&track(d,"iterate",$?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:et,done:tt}=G.next();return tt?{value:et,done:tt}:{value:_?[Z(et[0]),Z(et[1])]:Z(et),done:tt}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(i){return function(...e){return i==="delete"?!1:this}}function createInstrumentations(){const i={get(d){return get$1(this,d)},get size(){return size(this)},has:has$1,add,set:set$1,delete:deleteEntry,clear,forEach:createForEach(!1,!1)},e={get(d){return get$1(this,d,!1,!0)},get size(){return size(this)},has:has$1,add,set:set$1,delete:deleteEntry,clear,forEach:createForEach(!1,!0)},o={get(d){return get$1(this,d,!0)},get size(){return size(this,!0)},has(d){return has$1.call(this,d,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},s={get(d){return get$1(this,d,!0,!0)},get size(){return size(this,!0)},has(d){return has$1.call(this,d,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(d=>{i[d]=createIterableMethod(d,!1,!1),o[d]=createIterableMethod(d,!0,!1),e[d]=createIterableMethod(d,!1,!0),s[d]=createIterableMethod(d,!0,!0)}),[i,o,e,s]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(i,e){const o=e?i?shallowReadonlyInstrumentations:shallowInstrumentations:i?readonlyInstrumentations:mutableInstrumentations;return(s,f,d)=>f==="__v_isReactive"?!i:f==="__v_isReadonly"?i:f==="__v_raw"?s:Reflect.get(hasOwn(o,f)&&f in s?o:s,f,d)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(i){return i.__v_skip||!Object.isExtensible(i)?0:targetTypeMap(toRawType(i))}function reactive(i){return isReadonly(i)?i:createReactiveObject(i,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(i){return createReactiveObject(i,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(i){return createReactiveObject(i,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function createReactiveObject(i,e,o,s,f){if(!isObject$1(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const d=f.get(i);if(d)return d;const m=getTargetType(i);if(m===0)return i;const _=new Proxy(i,m===2?s:o);return f.set(i,_),_}function isReactive(i){return isReadonly(i)?isReactive(i.__v_raw):!!(i&&i.__v_isReactive)}function isReadonly(i){return!!(i&&i.__v_isReadonly)}function isShallow(i){return!!(i&&i.__v_isShallow)}function isProxy(i){return isReactive(i)||isReadonly(i)}function toRaw(i){const e=i&&i.__v_raw;return e?toRaw(e):i}function markRaw(i){return def(i,"__v_skip",!0),i}const toReactive=i=>isObject$1(i)?reactive(i):i,toReadonly=i=>isObject$1(i)?readonly(i):i;function trackRefValue(i){shouldTrack&&activeEffect&&(i=toRaw(i),trackEffects(i.dep||(i.dep=createDep())))}function triggerRefValue(i,e){i=toRaw(i),i.dep&&triggerEffects(i.dep)}function isRef(i){return!!(i&&i.__v_isRef===!0)}function ref(i){return createRef(i,!1)}function shallowRef(i){return createRef(i,!0)}function createRef(i,e){return isRef(i)?i:new RefImpl(i,e)}class RefImpl{constructor(e,o){this.__v_isShallow=o,this.dep=void 0,this.__v_isRef=!0,this._rawValue=o?e:toRaw(e),this._value=o?e:toReactive(e)}get value(){return trackRefValue(this),this._value}set value(e){const o=this.__v_isShallow||isShallow(e)||isReadonly(e);e=o?e:toRaw(e),hasChanged(e,this._rawValue)&&(this._rawValue=e,this._value=o?e:toReactive(e),triggerRefValue(this))}}function unref(i){return isRef(i)?i.value:i}const shallowUnwrapHandlers={get:(i,e,o)=>unref(Reflect.get(i,e,o)),set:(i,e,o,s)=>{const f=i[e];return isRef(f)&&!isRef(o)?(f.value=o,!0):Reflect.set(i,e,o,s)}};function proxyRefs(i){return isReactive(i)?i:new Proxy(i,shallowUnwrapHandlers)}var _a$1;class ComputedRefImpl{constructor(e,o,s,f){this._setter=o,this.dep=void 0,this.__v_isRef=!0,this[_a$1]=!1,this._dirty=!0,this.effect=new ReactiveEffect(e,()=>{this._dirty||(this._dirty=!0,triggerRefValue(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!f,this.__v_isReadonly=s}get value(){const e=toRaw(this);return trackRefValue(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}_a$1="__v_isReadonly";function computed$1(i,e,o=!1){let s,f;const d=isFunction$1(i);return d?(s=i,f=NOOP):(s=i.get,f=i.set),new ComputedRefImpl(s,f,d||!f,o)}const stack=[];function warn(i,...e){pauseTracking();const o=stack.length?stack[stack.length-1].component:null,s=o&&o.appContext.config.warnHandler,f=getComponentTrace();if(s)callWithErrorHandling(s,o,11,[i+e.join(""),o&&o.proxy,f.map(({vnode:d})=>`at <${formatComponentName(o,d.type)}>`).join(`
`),f]);else{const d=[`[Vue warn]: ${i}`,...e];f.length&&d.push(`
`,...formatTrace(f)),console.warn(...d)}resetTracking()}function getComponentTrace(){let i=stack[stack.length-1];if(!i)return[];const e=[];for(;i;){const o=e[0];o&&o.vnode===i?o.recurseCount++:e.push({vnode:i,recurseCount:0});const s=i.component&&i.component.parent;i=s&&s.vnode}return e}function formatTrace(i){const e=[];return i.forEach((o,s)=>{e.push(...s===0?[]:[`
`],...formatTraceEntry(o))}),e}function formatTraceEntry({vnode:i,recurseCount:e}){const o=e>0?`... (${e} recursive calls)`:"",s=i.component?i.component.parent==null:!1,f=` at <${formatComponentName(i.component,i.type,s)}`,d=">"+o;return i.props?[f,...formatProps(i.props),d]:[f+d]}function formatProps(i){const e=[],o=Object.keys(i);return o.slice(0,3).forEach(s=>{e.push(...formatProp(s,i[s]))}),o.length>3&&e.push(" ..."),e}function formatProp(i,e,o){return isString$1(e)?(e=JSON.stringify(e),o?e:[`${i}=${e}`]):typeof e=="number"||typeof e=="boolean"||e==null?o?e:[`${i}=${e}`]:isRef(e)?(e=formatProp(i,toRaw(e.value),!0),o?e:[`${i}=Ref<`,e,">"]):isFunction$1(e)?[`${i}=fn${e.name?`<${e.name}>`:""}`]:(e=toRaw(e),o?e:[`${i}=`,e])}function callWithErrorHandling(i,e,o,s){let f;try{f=s?i(...s):i()}catch(d){handleError(d,e,o)}return f}function callWithAsyncErrorHandling(i,e,o,s){if(isFunction$1(i)){const d=callWithErrorHandling(i,e,o,s);return d&&isPromise(d)&&d.catch(m=>{handleError(m,e,o)}),d}const f=[];for(let d=0;d<i.length;d++)f.push(callWithAsyncErrorHandling(i[d],e,o,s));return f}function handleError(i,e,o,s=!0){const f=e?e.vnode:null;if(e){let d=e.parent;const m=e.proxy,_=o;for(;d;){const G=d.ec;if(G){for(let Z=0;Z<G.length;Z++)if(G[Z](i,m,_)===!1)return}d=d.parent}const $=e.appContext.config.errorHandler;if($){callWithErrorHandling($,null,10,[i,m,_]);return}}logError(i,o,f,s)}function logError(i,e,o,s=!0){console.error(i)}let isFlushing=!1,isFlushPending=!1;const queue=[];let flushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick(i){const e=currentFlushPromise||resolvedPromise;return i?e.then(this?i.bind(this):i):e}function findInsertionIndex(i){let e=flushIndex+1,o=queue.length;for(;e<o;){const s=e+o>>>1;getId(queue[s])<i?e=s+1:o=s}return e}function queueJob(i){(!queue.length||!queue.includes(i,isFlushing&&i.allowRecurse?flushIndex+1:flushIndex))&&(i.id==null?queue.push(i):queue.splice(findInsertionIndex(i.id),0,i),queueFlush())}function queueFlush(){!isFlushing&&!isFlushPending&&(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function invalidateJob(i){const e=queue.indexOf(i);e>flushIndex&&queue.splice(e,1)}function queuePostFlushCb(i){isArray$1(i)?pendingPostFlushCbs.push(...i):(!activePostFlushCbs||!activePostFlushCbs.includes(i,i.allowRecurse?postFlushIndex+1:postFlushIndex))&&pendingPostFlushCbs.push(i),queueFlush()}function flushPreFlushCbs(i,e=isFlushing?flushIndex+1:0){for(;e<queue.length;e++){const o=queue[e];o&&o.pre&&(queue.splice(e,1),e--,o())}}function flushPostFlushCbs(i){if(pendingPostFlushCbs.length){const e=[...new Set(pendingPostFlushCbs)];if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...e);return}for(activePostFlushCbs=e,activePostFlushCbs.sort((o,s)=>getId(o)-getId(s)),postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++)activePostFlushCbs[postFlushIndex]();activePostFlushCbs=null,postFlushIndex=0}}const getId=i=>i.id==null?1/0:i.id,comparator=(i,e)=>{const o=getId(i)-getId(e);if(o===0){if(i.pre&&!e.pre)return-1;if(e.pre&&!i.pre)return 1}return o};function flushJobs(i){isFlushPending=!1,isFlushing=!0,queue.sort(comparator);const e=NOOP;try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const o=queue[flushIndex];o&&o.active!==!1&&callWithErrorHandling(o,null,14)}}finally{flushIndex=0,queue.length=0,flushPostFlushCbs(),isFlushing=!1,currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs()}}function emit$1(i,e,...o){if(i.isUnmounted)return;const s=i.vnode.props||EMPTY_OBJ;let f=o;const d=e.startsWith("update:"),m=d&&e.slice(7);if(m&&m in s){const Z=`${m==="modelValue"?"model":m}Modifiers`,{number:et,trim:tt}=s[Z]||EMPTY_OBJ;tt&&(f=o.map(nt=>nt.trim())),et&&(f=o.map(toNumber))}let _,$=s[_=toHandlerKey(e)]||s[_=toHandlerKey(camelize(e))];!$&&d&&($=s[_=toHandlerKey(hyphenate(e))]),$&&callWithAsyncErrorHandling($,i,6,f);const G=s[_+"Once"];if(G){if(!i.emitted)i.emitted={};else if(i.emitted[_])return;i.emitted[_]=!0,callWithAsyncErrorHandling(G,i,6,f)}}function normalizeEmitsOptions(i,e,o=!1){const s=e.emitsCache,f=s.get(i);if(f!==void 0)return f;const d=i.emits;let m={},_=!1;if(!isFunction$1(i)){const $=G=>{const Z=normalizeEmitsOptions(G,e,!0);Z&&(_=!0,extend(m,Z))};!o&&e.mixins.length&&e.mixins.forEach($),i.extends&&$(i.extends),i.mixins&&i.mixins.forEach($)}return!d&&!_?(isObject$1(i)&&s.set(i,null),null):(isArray$1(d)?d.forEach($=>m[$]=null):extend(m,d),isObject$1(i)&&s.set(i,m),m)}function isEmitListener(i,e){return!i||!isOn(e)?!1:(e=e.slice(2).replace(/Once$/,""),hasOwn(i,e[0].toLowerCase()+e.slice(1))||hasOwn(i,hyphenate(e))||hasOwn(i,e))}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(i){const e=currentRenderingInstance;return currentRenderingInstance=i,currentScopeId=i&&i.type.__scopeId||null,e}function withCtx(i,e=currentRenderingInstance,o){if(!e||i._n)return i;const s=(...f)=>{s._d&&setBlockTracking(-1);const d=setCurrentRenderingInstance(e);let m;try{m=i(...f)}finally{setCurrentRenderingInstance(d),s._d&&setBlockTracking(1)}return m};return s._n=!0,s._c=!0,s._d=!0,s}function markAttrsAccessed(){}function renderComponentRoot(i){const{type:e,vnode:o,proxy:s,withProxy:f,props:d,propsOptions:[m],slots:_,attrs:$,emit:G,render:Z,renderCache:et,data:tt,setupState:nt,ctx:st,inheritAttrs:rt}=i;let it,ot;const lt=setCurrentRenderingInstance(i);try{if(o.shapeFlag&4){const ct=f||s;it=normalizeVNode(Z.call(ct,ct,et,d,nt,tt,st)),ot=$}else{const ct=e;it=normalizeVNode(ct.length>1?ct(d,{attrs:$,slots:_,emit:G}):ct(d,null)),ot=e.props?$:getFunctionalFallthrough($)}}catch(ct){blockStack.length=0,handleError(ct,i,1),it=createVNode(Comment)}let ft=it;if(ot&&rt!==!1){const ct=Object.keys(ot),{shapeFlag:pt}=ft;ct.length&&pt&7&&(m&&ct.some(isModelListener)&&(ot=filterModelListeners(ot,m)),ft=cloneVNode(ft,ot))}return o.dirs&&(ft=cloneVNode(ft),ft.dirs=ft.dirs?ft.dirs.concat(o.dirs):o.dirs),o.transition&&(ft.transition=o.transition),it=ft,setCurrentRenderingInstance(lt),it}const getFunctionalFallthrough=i=>{let e;for(const o in i)(o==="class"||o==="style"||isOn(o))&&((e||(e={}))[o]=i[o]);return e},filterModelListeners=(i,e)=>{const o={};for(const s in i)(!isModelListener(s)||!(s.slice(9)in e))&&(o[s]=i[s]);return o};function shouldUpdateComponent(i,e,o){const{props:s,children:f,component:d}=i,{props:m,children:_,patchFlag:$}=e,G=d.emitsOptions;if(e.dirs||e.transition)return!0;if(o&&$>=0){if($&1024)return!0;if($&16)return s?hasPropsChanged(s,m,G):!!m;if($&8){const Z=e.dynamicProps;for(let et=0;et<Z.length;et++){const tt=Z[et];if(m[tt]!==s[tt]&&!isEmitListener(G,tt))return!0}}}else return(f||_)&&(!_||!_.$stable)?!0:s===m?!1:s?m?hasPropsChanged(s,m,G):!0:!!m;return!1}function hasPropsChanged(i,e,o){const s=Object.keys(e);if(s.length!==Object.keys(i).length)return!0;for(let f=0;f<s.length;f++){const d=s[f];if(e[d]!==i[d]&&!isEmitListener(o,d))return!0}return!1}function updateHOCHostEl({vnode:i,parent:e},o){for(;e&&e.subTree===i;)(i=e.vnode).el=o,e=e.parent}const isSuspense=i=>i.__isSuspense;function queueEffectWithSuspense(i,e){e&&e.pendingBranch?isArray$1(i)?e.effects.push(...i):e.effects.push(i):queuePostFlushCb(i)}function provide(i,e){if(currentInstance){let o=currentInstance.provides;const s=currentInstance.parent&&currentInstance.parent.provides;s===o&&(o=currentInstance.provides=Object.create(s)),o[i]=e}}function inject(i,e,o=!1){const s=currentInstance||currentRenderingInstance;if(s){const f=s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides;if(f&&i in f)return f[i];if(arguments.length>1)return o&&isFunction$1(e)?e.call(s.proxy):e}}const INITIAL_WATCHER_VALUE={};function watch(i,e,o){return doWatch(i,e,o)}function doWatch(i,e,{immediate:o,deep:s,flush:f,onTrack:d,onTrigger:m}=EMPTY_OBJ){const _=currentInstance;let $,G=!1,Z=!1;if(isRef(i)?($=()=>i.value,G=isShallow(i)):isReactive(i)?($=()=>i,s=!0):isArray$1(i)?(Z=!0,G=i.some(ot=>isReactive(ot)||isShallow(ot)),$=()=>i.map(ot=>{if(isRef(ot))return ot.value;if(isReactive(ot))return traverse(ot);if(isFunction$1(ot))return callWithErrorHandling(ot,_,2)})):isFunction$1(i)?e?$=()=>callWithErrorHandling(i,_,2):$=()=>{if(!(_&&_.isUnmounted))return et&&et(),callWithAsyncErrorHandling(i,_,3,[tt])}:$=NOOP,e&&s){const ot=$;$=()=>traverse(ot())}let et,tt=ot=>{et=it.onStop=()=>{callWithErrorHandling(ot,_,4)}};if(isInSSRComponentSetup)return tt=NOOP,e?o&&callWithAsyncErrorHandling(e,_,3,[$(),Z?[]:void 0,tt]):$(),NOOP;let nt=Z?[]:INITIAL_WATCHER_VALUE;const st=()=>{if(!!it.active)if(e){const ot=it.run();(s||G||(Z?ot.some((lt,ft)=>hasChanged(lt,nt[ft])):hasChanged(ot,nt)))&&(et&&et(),callWithAsyncErrorHandling(e,_,3,[ot,nt===INITIAL_WATCHER_VALUE?void 0:nt,tt]),nt=ot)}else it.run()};st.allowRecurse=!!e;let rt;f==="sync"?rt=st:f==="post"?rt=()=>queuePostRenderEffect(st,_&&_.suspense):(st.pre=!0,_&&(st.id=_.uid),rt=()=>queueJob(st));const it=new ReactiveEffect($,rt);return e?o?st():nt=it.run():f==="post"?queuePostRenderEffect(it.run.bind(it),_&&_.suspense):it.run(),()=>{it.stop(),_&&_.scope&&remove$1(_.scope.effects,it)}}function instanceWatch(i,e,o){const s=this.proxy,f=isString$1(i)?i.includes(".")?createPathGetter(s,i):()=>s[i]:i.bind(s,s);let d;isFunction$1(e)?d=e:(d=e.handler,o=e);const m=currentInstance;setCurrentInstance(this);const _=doWatch(f,d.bind(s),o);return m?setCurrentInstance(m):unsetCurrentInstance(),_}function createPathGetter(i,e){const o=e.split(".");return()=>{let s=i;for(let f=0;f<o.length&&s;f++)s=s[o[f]];return s}}function traverse(i,e){if(!isObject$1(i)||i.__v_skip||(e=e||new Set,e.has(i)))return i;if(e.add(i),isRef(i))traverse(i.value,e);else if(isArray$1(i))for(let o=0;o<i.length;o++)traverse(i[o],e);else if(isSet(i)||isMap(i))i.forEach(o=>{traverse(o,e)});else if(isPlainObject$1(i))for(const o in i)traverse(i[o],e);return i}function useTransitionState(){const i={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return onMounted(()=>{i.isMounted=!0}),onBeforeUnmount(()=>{i.isUnmounting=!0}),i}const TransitionHookValidator=[Function,Array],BaseTransitionImpl={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:TransitionHookValidator,onEnter:TransitionHookValidator,onAfterEnter:TransitionHookValidator,onEnterCancelled:TransitionHookValidator,onBeforeLeave:TransitionHookValidator,onLeave:TransitionHookValidator,onAfterLeave:TransitionHookValidator,onLeaveCancelled:TransitionHookValidator,onBeforeAppear:TransitionHookValidator,onAppear:TransitionHookValidator,onAfterAppear:TransitionHookValidator,onAppearCancelled:TransitionHookValidator},setup(i,{slots:e}){const o=getCurrentInstance(),s=useTransitionState();let f;return()=>{const d=e.default&&getTransitionRawChildren(e.default(),!0);if(!d||!d.length)return;let m=d[0];if(d.length>1){for(const rt of d)if(rt.type!==Comment){m=rt;break}}const _=toRaw(i),{mode:$}=_;if(s.isLeaving)return emptyPlaceholder(m);const G=getKeepAliveChild(m);if(!G)return emptyPlaceholder(m);const Z=resolveTransitionHooks(G,_,s,o);setTransitionHooks(G,Z);const et=o.subTree,tt=et&&getKeepAliveChild(et);let nt=!1;const{getTransitionKey:st}=G.type;if(st){const rt=st();f===void 0?f=rt:rt!==f&&(f=rt,nt=!0)}if(tt&&tt.type!==Comment&&(!isSameVNodeType(G,tt)||nt)){const rt=resolveTransitionHooks(tt,_,s,o);if(setTransitionHooks(tt,rt),$==="out-in")return s.isLeaving=!0,rt.afterLeave=()=>{s.isLeaving=!1,o.update()},emptyPlaceholder(m);$==="in-out"&&G.type!==Comment&&(rt.delayLeave=(it,ot,lt)=>{const ft=getLeavingNodesForType(s,tt);ft[String(tt.key)]=tt,it._leaveCb=()=>{ot(),it._leaveCb=void 0,delete Z.delayedLeave},Z.delayedLeave=lt})}return m}}},BaseTransition=BaseTransitionImpl;function getLeavingNodesForType(i,e){const{leavingVNodes:o}=i;let s=o.get(e.type);return s||(s=Object.create(null),o.set(e.type,s)),s}function resolveTransitionHooks(i,e,o,s){const{appear:f,mode:d,persisted:m=!1,onBeforeEnter:_,onEnter:$,onAfterEnter:G,onEnterCancelled:Z,onBeforeLeave:et,onLeave:tt,onAfterLeave:nt,onLeaveCancelled:st,onBeforeAppear:rt,onAppear:it,onAfterAppear:ot,onAppearCancelled:lt}=e,ft=String(i.key),ct=getLeavingNodesForType(o,i),pt=(Et,Mt)=>{Et&&callWithAsyncErrorHandling(Et,s,9,Mt)},gt=(Et,Mt)=>{const vt=Mt[1];pt(Et,Mt),isArray$1(Et)?Et.every(yt=>yt.length<=1)&&vt():Et.length<=1&&vt()},Tt={mode:d,persisted:m,beforeEnter(Et){let Mt=_;if(!o.isMounted)if(f)Mt=rt||_;else return;Et._leaveCb&&Et._leaveCb(!0);const vt=ct[ft];vt&&isSameVNodeType(i,vt)&&vt.el._leaveCb&&vt.el._leaveCb(),pt(Mt,[Et])},enter(Et){let Mt=$,vt=G,yt=Z;if(!o.isMounted)if(f)Mt=it||$,vt=ot||G,yt=lt||Z;else return;let bt=!1;const Pt=Et._enterCb=wt=>{bt||(bt=!0,wt?pt(yt,[Et]):pt(vt,[Et]),Tt.delayedLeave&&Tt.delayedLeave(),Et._enterCb=void 0)};Mt?gt(Mt,[Et,Pt]):Pt()},leave(Et,Mt){const vt=String(i.key);if(Et._enterCb&&Et._enterCb(!0),o.isUnmounting)return Mt();pt(et,[Et]);let yt=!1;const bt=Et._leaveCb=Pt=>{yt||(yt=!0,Mt(),Pt?pt(st,[Et]):pt(nt,[Et]),Et._leaveCb=void 0,ct[vt]===i&&delete ct[vt])};ct[vt]=i,tt?gt(tt,[Et,bt]):bt()},clone(Et){return resolveTransitionHooks(Et,e,o,s)}};return Tt}function emptyPlaceholder(i){if(isKeepAlive(i))return i=cloneVNode(i),i.children=null,i}function getKeepAliveChild(i){return isKeepAlive(i)?i.children?i.children[0]:void 0:i}function setTransitionHooks(i,e){i.shapeFlag&6&&i.component?setTransitionHooks(i.component.subTree,e):i.shapeFlag&128?(i.ssContent.transition=e.clone(i.ssContent),i.ssFallback.transition=e.clone(i.ssFallback)):i.transition=e}function getTransitionRawChildren(i,e=!1,o){let s=[],f=0;for(let d=0;d<i.length;d++){let m=i[d];const _=o==null?m.key:String(o)+String(m.key!=null?m.key:d);m.type===Fragment?(m.patchFlag&128&&f++,s=s.concat(getTransitionRawChildren(m.children,e,_))):(e||m.type!==Comment)&&s.push(_!=null?cloneVNode(m,{key:_}):m)}if(f>1)for(let d=0;d<s.length;d++)s[d].patchFlag=-2;return s}function defineComponent(i){return isFunction$1(i)?{setup:i,name:i.name}:i}const isAsyncWrapper=i=>!!i.type.__asyncLoader,isKeepAlive=i=>i.type.__isKeepAlive;function onActivated(i,e){registerKeepAliveHook(i,"a",e)}function onDeactivated(i,e){registerKeepAliveHook(i,"da",e)}function registerKeepAliveHook(i,e,o=currentInstance){const s=i.__wdc||(i.__wdc=()=>{let f=o;for(;f;){if(f.isDeactivated)return;f=f.parent}return i()});if(injectHook(e,s,o),o){let f=o.parent;for(;f&&f.parent;)isKeepAlive(f.parent.vnode)&&injectToKeepAliveRoot(s,e,o,f),f=f.parent}}function injectToKeepAliveRoot(i,e,o,s){const f=injectHook(e,i,s,!0);onUnmounted(()=>{remove$1(s[e],f)},o)}function injectHook(i,e,o=currentInstance,s=!1){if(o){const f=o[i]||(o[i]=[]),d=e.__weh||(e.__weh=(...m)=>{if(o.isUnmounted)return;pauseTracking(),setCurrentInstance(o);const _=callWithAsyncErrorHandling(e,o,i,m);return unsetCurrentInstance(),resetTracking(),_});return s?f.unshift(d):f.push(d),d}}const createHook=i=>(e,o=currentInstance)=>(!isInSSRComponentSetup||i==="sp")&&injectHook(i,(...s)=>e(...s),o),onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(i,e=currentInstance){injectHook("ec",i,e)}function withDirectives(i,e){const o=currentRenderingInstance;if(o===null)return i;const s=getExposeProxy(o)||o.proxy,f=i.dirs||(i.dirs=[]);for(let d=0;d<e.length;d++){let[m,_,$,G=EMPTY_OBJ]=e[d];isFunction$1(m)&&(m={mounted:m,updated:m}),m.deep&&traverse(_),f.push({dir:m,instance:s,value:_,oldValue:void 0,arg:$,modifiers:G})}return i}function invokeDirectiveHook(i,e,o,s){const f=i.dirs,d=e&&e.dirs;for(let m=0;m<f.length;m++){const _=f[m];d&&(_.oldValue=d[m].value);let $=_.dir[s];$&&(pauseTracking(),callWithAsyncErrorHandling($,o,8,[i.el,_,i,e]),resetTracking())}}const COMPONENTS="components";function resolveComponent(i,e){return resolveAsset(COMPONENTS,i,!0,e)||i}const NULL_DYNAMIC_COMPONENT=Symbol();function resolveAsset(i,e,o=!0,s=!1){const f=currentRenderingInstance||currentInstance;if(f){const d=f.type;if(i===COMPONENTS){const _=getComponentName(d,!1);if(_&&(_===e||_===camelize(e)||_===capitalize(camelize(e))))return d}const m=resolve$2(f[i]||d[i],e)||resolve$2(f.appContext[i],e);return!m&&s?d:m}}function resolve$2(i,e){return i&&(i[e]||i[camelize(e)]||i[capitalize(camelize(e))])}function renderList(i,e,o,s){let f;const d=o&&o[s];if(isArray$1(i)||isString$1(i)){f=new Array(i.length);for(let m=0,_=i.length;m<_;m++)f[m]=e(i[m],m,void 0,d&&d[m])}else if(typeof i=="number"){f=new Array(i);for(let m=0;m<i;m++)f[m]=e(m+1,m,void 0,d&&d[m])}else if(isObject$1(i))if(i[Symbol.iterator])f=Array.from(i,(m,_)=>e(m,_,void 0,d&&d[_]));else{const m=Object.keys(i);f=new Array(m.length);for(let _=0,$=m.length;_<$;_++){const G=m[_];f[_]=e(i[G],G,_,d&&d[_])}}else f=[];return o&&(o[s]=f),f}const getPublicInstance=i=>i?isStatefulComponent(i)?getExposeProxy(i)||i.proxy:getPublicInstance(i.parent):null,publicPropertiesMap=extend(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>getPublicInstance(i.parent),$root:i=>getPublicInstance(i.root),$emit:i=>i.emit,$options:i=>resolveMergedOptions(i),$forceUpdate:i=>i.f||(i.f=()=>queueJob(i.update)),$nextTick:i=>i.n||(i.n=nextTick.bind(i.proxy)),$watch:i=>instanceWatch.bind(i)}),PublicInstanceProxyHandlers={get({_:i},e){const{ctx:o,setupState:s,data:f,props:d,accessCache:m,type:_,appContext:$}=i;let G;if(e[0]!=="$"){const nt=m[e];if(nt!==void 0)switch(nt){case 1:return s[e];case 2:return f[e];case 4:return o[e];case 3:return d[e]}else{if(s!==EMPTY_OBJ&&hasOwn(s,e))return m[e]=1,s[e];if(f!==EMPTY_OBJ&&hasOwn(f,e))return m[e]=2,f[e];if((G=i.propsOptions[0])&&hasOwn(G,e))return m[e]=3,d[e];if(o!==EMPTY_OBJ&&hasOwn(o,e))return m[e]=4,o[e];shouldCacheAccess&&(m[e]=0)}}const Z=publicPropertiesMap[e];let et,tt;if(Z)return e==="$attrs"&&track(i,"get",e),Z(i);if((et=_.__cssModules)&&(et=et[e]))return et;if(o!==EMPTY_OBJ&&hasOwn(o,e))return m[e]=4,o[e];if(tt=$.config.globalProperties,hasOwn(tt,e))return tt[e]},set({_:i},e,o){const{data:s,setupState:f,ctx:d}=i;return f!==EMPTY_OBJ&&hasOwn(f,e)?(f[e]=o,!0):s!==EMPTY_OBJ&&hasOwn(s,e)?(s[e]=o,!0):hasOwn(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(d[e]=o,!0)},has({_:{data:i,setupState:e,accessCache:o,ctx:s,appContext:f,propsOptions:d}},m){let _;return!!o[m]||i!==EMPTY_OBJ&&hasOwn(i,m)||e!==EMPTY_OBJ&&hasOwn(e,m)||(_=d[0])&&hasOwn(_,m)||hasOwn(s,m)||hasOwn(publicPropertiesMap,m)||hasOwn(f.config.globalProperties,m)},defineProperty(i,e,o){return o.get!=null?i._.accessCache[e]=0:hasOwn(o,"value")&&this.set(i,e,o.value,null),Reflect.defineProperty(i,e,o)}};let shouldCacheAccess=!0;function applyOptions(i){const e=resolveMergedOptions(i),o=i.proxy,s=i.ctx;shouldCacheAccess=!1,e.beforeCreate&&callHook(e.beforeCreate,i,"bc");const{data:f,computed:d,methods:m,watch:_,provide:$,inject:G,created:Z,beforeMount:et,mounted:tt,beforeUpdate:nt,updated:st,activated:rt,deactivated:it,beforeDestroy:ot,beforeUnmount:lt,destroyed:ft,unmounted:ct,render:pt,renderTracked:gt,renderTriggered:Tt,errorCaptured:Et,serverPrefetch:Mt,expose:vt,inheritAttrs:yt,components:bt,directives:Pt,filters:wt}=e;if(G&&resolveInjections(G,s,null,i.appContext.config.unwrapInjectedRef),m)for(const Bt in m){const zt=m[Bt];isFunction$1(zt)&&(s[Bt]=zt.bind(o))}if(f){const Bt=f.call(o,o);isObject$1(Bt)&&(i.data=reactive(Bt))}if(shouldCacheAccess=!0,d)for(const Bt in d){const zt=d[Bt],Ht=isFunction$1(zt)?zt.bind(o,o):isFunction$1(zt.get)?zt.get.bind(o,o):NOOP,ln=!isFunction$1(zt)&&isFunction$1(zt.set)?zt.set.bind(o):NOOP,gn=computed({get:Ht,set:ln});Object.defineProperty(s,Bt,{enumerable:!0,configurable:!0,get:()=>gn.value,set:Zt=>gn.value=Zt})}if(_)for(const Bt in _)createWatcher(_[Bt],s,o,Bt);if($){const Bt=isFunction$1($)?$.call(o):$;Reflect.ownKeys(Bt).forEach(zt=>{provide(zt,Bt[zt])})}Z&&callHook(Z,i,"c");function Ft(Bt,zt){isArray$1(zt)?zt.forEach(Ht=>Bt(Ht.bind(o))):zt&&Bt(zt.bind(o))}if(Ft(onBeforeMount,et),Ft(onMounted,tt),Ft(onBeforeUpdate,nt),Ft(onUpdated,st),Ft(onActivated,rt),Ft(onDeactivated,it),Ft(onErrorCaptured,Et),Ft(onRenderTracked,gt),Ft(onRenderTriggered,Tt),Ft(onBeforeUnmount,lt),Ft(onUnmounted,ct),Ft(onServerPrefetch,Mt),isArray$1(vt))if(vt.length){const Bt=i.exposed||(i.exposed={});vt.forEach(zt=>{Object.defineProperty(Bt,zt,{get:()=>o[zt],set:Ht=>o[zt]=Ht})})}else i.exposed||(i.exposed={});pt&&i.render===NOOP&&(i.render=pt),yt!=null&&(i.inheritAttrs=yt),bt&&(i.components=bt),Pt&&(i.directives=Pt)}function resolveInjections(i,e,o=NOOP,s=!1){isArray$1(i)&&(i=normalizeInject(i));for(const f in i){const d=i[f];let m;isObject$1(d)?"default"in d?m=inject(d.from||f,d.default,!0):m=inject(d.from||f):m=inject(d),isRef(m)&&s?Object.defineProperty(e,f,{enumerable:!0,configurable:!0,get:()=>m.value,set:_=>m.value=_}):e[f]=m}}function callHook(i,e,o){callWithAsyncErrorHandling(isArray$1(i)?i.map(s=>s.bind(e.proxy)):i.bind(e.proxy),e,o)}function createWatcher(i,e,o,s){const f=s.includes(".")?createPathGetter(o,s):()=>o[s];if(isString$1(i)){const d=e[i];isFunction$1(d)&&watch(f,d)}else if(isFunction$1(i))watch(f,i.bind(o));else if(isObject$1(i))if(isArray$1(i))i.forEach(d=>createWatcher(d,e,o,s));else{const d=isFunction$1(i.handler)?i.handler.bind(o):e[i.handler];isFunction$1(d)&&watch(f,d,i)}}function resolveMergedOptions(i){const e=i.type,{mixins:o,extends:s}=e,{mixins:f,optionsCache:d,config:{optionMergeStrategies:m}}=i.appContext,_=d.get(e);let $;return _?$=_:!f.length&&!o&&!s?$=e:($={},f.length&&f.forEach(G=>mergeOptions$1($,G,m,!0)),mergeOptions$1($,e,m)),isObject$1(e)&&d.set(e,$),$}function mergeOptions$1(i,e,o,s=!1){const{mixins:f,extends:d}=e;d&&mergeOptions$1(i,d,o,!0),f&&f.forEach(m=>mergeOptions$1(i,m,o,!0));for(const m in e)if(!(s&&m==="expose")){const _=internalOptionMergeStrats[m]||o&&o[m];i[m]=_?_(i[m],e[m]):e[m]}return i}const internalOptionMergeStrats={data:mergeDataFn,props:mergeObjectOptions,emits:mergeObjectOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(i,e){return e?i?function(){return extend(isFunction$1(i)?i.call(this,this):i,isFunction$1(e)?e.call(this,this):e)}:e:i}function mergeInject(i,e){return mergeObjectOptions(normalizeInject(i),normalizeInject(e))}function normalizeInject(i){if(isArray$1(i)){const e={};for(let o=0;o<i.length;o++)e[i[o]]=i[o];return e}return i}function mergeAsArray(i,e){return i?[...new Set([].concat(i,e))]:e}function mergeObjectOptions(i,e){return i?extend(extend(Object.create(null),i),e):e}function mergeWatchOptions(i,e){if(!i)return e;if(!e)return i;const o=extend(Object.create(null),i);for(const s in e)o[s]=mergeAsArray(i[s],e[s]);return o}function initProps(i,e,o,s=!1){const f={},d={};def(d,InternalObjectKey,1),i.propsDefaults=Object.create(null),setFullProps(i,e,f,d);for(const m in i.propsOptions[0])m in f||(f[m]=void 0);o?i.props=s?f:shallowReactive(f):i.type.props?i.props=f:i.props=d,i.attrs=d}function updateProps(i,e,o,s){const{props:f,attrs:d,vnode:{patchFlag:m}}=i,_=toRaw(f),[$]=i.propsOptions;let G=!1;if((s||m>0)&&!(m&16)){if(m&8){const Z=i.vnode.dynamicProps;for(let et=0;et<Z.length;et++){let tt=Z[et];if(isEmitListener(i.emitsOptions,tt))continue;const nt=e[tt];if($)if(hasOwn(d,tt))nt!==d[tt]&&(d[tt]=nt,G=!0);else{const st=camelize(tt);f[st]=resolvePropValue($,_,st,nt,i,!1)}else nt!==d[tt]&&(d[tt]=nt,G=!0)}}}else{setFullProps(i,e,f,d)&&(G=!0);let Z;for(const et in _)(!e||!hasOwn(e,et)&&((Z=hyphenate(et))===et||!hasOwn(e,Z)))&&($?o&&(o[et]!==void 0||o[Z]!==void 0)&&(f[et]=resolvePropValue($,_,et,void 0,i,!0)):delete f[et]);if(d!==_)for(const et in d)(!e||!hasOwn(e,et)&&!0)&&(delete d[et],G=!0)}G&&trigger(i,"set","$attrs")}function setFullProps(i,e,o,s){const[f,d]=i.propsOptions;let m=!1,_;if(e)for(let $ in e){if(isReservedProp($))continue;const G=e[$];let Z;f&&hasOwn(f,Z=camelize($))?!d||!d.includes(Z)?o[Z]=G:(_||(_={}))[Z]=G:isEmitListener(i.emitsOptions,$)||(!($ in s)||G!==s[$])&&(s[$]=G,m=!0)}if(d){const $=toRaw(o),G=_||EMPTY_OBJ;for(let Z=0;Z<d.length;Z++){const et=d[Z];o[et]=resolvePropValue(f,$,et,G[et],i,!hasOwn(G,et))}}return m}function resolvePropValue(i,e,o,s,f,d){const m=i[o];if(m!=null){const _=hasOwn(m,"default");if(_&&s===void 0){const $=m.default;if(m.type!==Function&&isFunction$1($)){const{propsDefaults:G}=f;o in G?s=G[o]:(setCurrentInstance(f),s=G[o]=$.call(null,e),unsetCurrentInstance())}else s=$}m[0]&&(d&&!_?s=!1:m[1]&&(s===""||s===hyphenate(o))&&(s=!0))}return s}function normalizePropsOptions(i,e,o=!1){const s=e.propsCache,f=s.get(i);if(f)return f;const d=i.props,m={},_=[];let $=!1;if(!isFunction$1(i)){const Z=et=>{$=!0;const[tt,nt]=normalizePropsOptions(et,e,!0);extend(m,tt),nt&&_.push(...nt)};!o&&e.mixins.length&&e.mixins.forEach(Z),i.extends&&Z(i.extends),i.mixins&&i.mixins.forEach(Z)}if(!d&&!$)return isObject$1(i)&&s.set(i,EMPTY_ARR),EMPTY_ARR;if(isArray$1(d))for(let Z=0;Z<d.length;Z++){const et=camelize(d[Z]);validatePropName(et)&&(m[et]=EMPTY_OBJ)}else if(d)for(const Z in d){const et=camelize(Z);if(validatePropName(et)){const tt=d[Z],nt=m[et]=isArray$1(tt)||isFunction$1(tt)?{type:tt}:tt;if(nt){const st=getTypeIndex(Boolean,nt.type),rt=getTypeIndex(String,nt.type);nt[0]=st>-1,nt[1]=rt<0||st<rt,(st>-1||hasOwn(nt,"default"))&&_.push(et)}}}const G=[m,_];return isObject$1(i)&&s.set(i,G),G}function validatePropName(i){return i[0]!=="$"}function getType(i){const e=i&&i.toString().match(/^\s*function (\w+)/);return e?e[1]:i===null?"null":""}function isSameType(i,e){return getType(i)===getType(e)}function getTypeIndex(i,e){return isArray$1(e)?e.findIndex(o=>isSameType(o,i)):isFunction$1(e)&&isSameType(e,i)?0:-1}const isInternalKey=i=>i[0]==="_"||i==="$stable",normalizeSlotValue=i=>isArray$1(i)?i.map(normalizeVNode):[normalizeVNode(i)],normalizeSlot$1=(i,e,o)=>{if(e._n)return e;const s=withCtx((...f)=>normalizeSlotValue(e(...f)),o);return s._c=!1,s},normalizeObjectSlots=(i,e,o)=>{const s=i._ctx;for(const f in i){if(isInternalKey(f))continue;const d=i[f];if(isFunction$1(d))e[f]=normalizeSlot$1(f,d,s);else if(d!=null){const m=normalizeSlotValue(d);e[f]=()=>m}}},normalizeVNodeSlots=(i,e)=>{const o=normalizeSlotValue(e);i.slots.default=()=>o},initSlots=(i,e)=>{if(i.vnode.shapeFlag&32){const o=e._;o?(i.slots=toRaw(e),def(e,"_",o)):normalizeObjectSlots(e,i.slots={})}else i.slots={},e&&normalizeVNodeSlots(i,e);def(i.slots,InternalObjectKey,1)},updateSlots=(i,e,o)=>{const{vnode:s,slots:f}=i;let d=!0,m=EMPTY_OBJ;if(s.shapeFlag&32){const _=e._;_?o&&_===1?d=!1:(extend(f,e),!o&&_===1&&delete f._):(d=!e.$stable,normalizeObjectSlots(e,f)),m=e}else e&&(normalizeVNodeSlots(i,e),m={default:1});if(d)for(const _ in f)!isInternalKey(_)&&!(_ in m)&&delete f[_]};function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid=0;function createAppAPI(i,e){return function(s,f=null){isFunction$1(s)||(s=Object.assign({},s)),f!=null&&!isObject$1(f)&&(f=null);const d=createAppContext(),m=new Set;let _=!1;const $=d.app={_uid:uid++,_component:s,_props:f,_container:null,_context:d,_instance:null,version,get config(){return d.config},set config(G){},use(G,...Z){return m.has(G)||(G&&isFunction$1(G.install)?(m.add(G),G.install($,...Z)):isFunction$1(G)&&(m.add(G),G($,...Z))),$},mixin(G){return d.mixins.includes(G)||d.mixins.push(G),$},component(G,Z){return Z?(d.components[G]=Z,$):d.components[G]},directive(G,Z){return Z?(d.directives[G]=Z,$):d.directives[G]},mount(G,Z,et){if(!_){const tt=createVNode(s,f);return tt.appContext=d,Z&&e?e(tt,G):i(tt,G,et),_=!0,$._container=G,G.__vue_app__=$,getExposeProxy(tt.component)||tt.component.proxy}},unmount(){_&&(i(null,$._container),delete $._container.__vue_app__)},provide(G,Z){return d.provides[G]=Z,$}};return $}}function setRef(i,e,o,s,f=!1){if(isArray$1(i)){i.forEach((tt,nt)=>setRef(tt,e&&(isArray$1(e)?e[nt]:e),o,s,f));return}if(isAsyncWrapper(s)&&!f)return;const d=s.shapeFlag&4?getExposeProxy(s.component)||s.component.proxy:s.el,m=f?null:d,{i:_,r:$}=i,G=e&&e.r,Z=_.refs===EMPTY_OBJ?_.refs={}:_.refs,et=_.setupState;if(G!=null&&G!==$&&(isString$1(G)?(Z[G]=null,hasOwn(et,G)&&(et[G]=null)):isRef(G)&&(G.value=null)),isFunction$1($))callWithErrorHandling($,_,12,[m,Z]);else{const tt=isString$1($),nt=isRef($);if(tt||nt){const st=()=>{if(i.f){const rt=tt?hasOwn(et,$)?et[$]:Z[$]:$.value;f?isArray$1(rt)&&remove$1(rt,d):isArray$1(rt)?rt.includes(d)||rt.push(d):tt?(Z[$]=[d],hasOwn(et,$)&&(et[$]=Z[$])):($.value=[d],i.k&&(Z[i.k]=$.value))}else tt?(Z[$]=m,hasOwn(et,$)&&(et[$]=m)):nt&&($.value=m,i.k&&(Z[i.k]=m))};m?(st.id=-1,queuePostRenderEffect(st,o)):st()}}}const queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(i){return baseCreateRenderer(i)}function baseCreateRenderer(i,e){const o=getGlobalThis();o.__VUE__=!0;const{insert:s,remove:f,patchProp:d,createElement:m,createText:_,createComment:$,setText:G,setElementText:Z,parentNode:et,nextSibling:tt,setScopeId:nt=NOOP,insertStaticContent:st}=i,rt=(ht,dt,St,Ct=null,Rt=null,Nt=null,Ut=!1,kt=null,Lt=!!dt.dynamicChildren)=>{if(ht===dt)return;ht&&!isSameVNodeType(ht,dt)&&(Ct=xt(ht),Zt(ht,Rt,Nt,!0),ht=null),dt.patchFlag===-2&&(Lt=!1,dt.dynamicChildren=null);const{type:Ot,ref:Vt,shapeFlag:Wt}=dt;switch(Ot){case Text:it(ht,dt,St,Ct);break;case Comment:ot(ht,dt,St,Ct);break;case Static:ht==null&&lt(dt,St,Ct,Ut);break;case Fragment:bt(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt);break;default:Wt&1?pt(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt):Wt&6?Pt(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt):(Wt&64||Wt&128)&&Ot.process(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt,nn)}Vt!=null&&Rt&&setRef(Vt,ht&&ht.ref,Nt,dt||ht,!dt)},it=(ht,dt,St,Ct)=>{if(ht==null)s(dt.el=_(dt.children),St,Ct);else{const Rt=dt.el=ht.el;dt.children!==ht.children&&G(Rt,dt.children)}},ot=(ht,dt,St,Ct)=>{ht==null?s(dt.el=$(dt.children||""),St,Ct):dt.el=ht.el},lt=(ht,dt,St,Ct)=>{[ht.el,ht.anchor]=st(ht.children,dt,St,Ct,ht.el,ht.anchor)},ft=({el:ht,anchor:dt},St,Ct)=>{let Rt;for(;ht&&ht!==dt;)Rt=tt(ht),s(ht,St,Ct),ht=Rt;s(dt,St,Ct)},ct=({el:ht,anchor:dt})=>{let St;for(;ht&&ht!==dt;)St=tt(ht),f(ht),ht=St;f(dt)},pt=(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt)=>{Ut=Ut||dt.type==="svg",ht==null?gt(dt,St,Ct,Rt,Nt,Ut,kt,Lt):Mt(ht,dt,Rt,Nt,Ut,kt,Lt)},gt=(ht,dt,St,Ct,Rt,Nt,Ut,kt)=>{let Lt,Ot;const{type:Vt,props:Wt,shapeFlag:qt,transition:Qt,dirs:en}=ht;if(Lt=ht.el=m(ht.type,Nt,Wt&&Wt.is,Wt),qt&8?Z(Lt,ht.children):qt&16&&Et(ht.children,Lt,null,Ct,Rt,Nt&&Vt!=="foreignObject",Ut,kt),en&&invokeDirectiveHook(ht,null,Ct,"created"),Wt){for(const sn in Wt)sn!=="value"&&!isReservedProp(sn)&&d(Lt,sn,null,Wt[sn],Nt,ht.children,Ct,Rt,$t);"value"in Wt&&d(Lt,"value",null,Wt.value),(Ot=Wt.onVnodeBeforeMount)&&invokeVNodeHook(Ot,Ct,ht)}Tt(Lt,ht,ht.scopeId,Ut,Ct),en&&invokeDirectiveHook(ht,null,Ct,"beforeMount");const on=(!Rt||Rt&&!Rt.pendingBranch)&&Qt&&!Qt.persisted;on&&Qt.beforeEnter(Lt),s(Lt,dt,St),((Ot=Wt&&Wt.onVnodeMounted)||on||en)&&queuePostRenderEffect(()=>{Ot&&invokeVNodeHook(Ot,Ct,ht),on&&Qt.enter(Lt),en&&invokeDirectiveHook(ht,null,Ct,"mounted")},Rt)},Tt=(ht,dt,St,Ct,Rt)=>{if(St&&nt(ht,St),Ct)for(let Nt=0;Nt<Ct.length;Nt++)nt(ht,Ct[Nt]);if(Rt){let Nt=Rt.subTree;if(dt===Nt){const Ut=Rt.vnode;Tt(ht,Ut,Ut.scopeId,Ut.slotScopeIds,Rt.parent)}}},Et=(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt=0)=>{for(let Ot=Lt;Ot<ht.length;Ot++){const Vt=ht[Ot]=kt?cloneIfMounted(ht[Ot]):normalizeVNode(ht[Ot]);rt(null,Vt,dt,St,Ct,Rt,Nt,Ut,kt)}},Mt=(ht,dt,St,Ct,Rt,Nt,Ut)=>{const kt=dt.el=ht.el;let{patchFlag:Lt,dynamicChildren:Ot,dirs:Vt}=dt;Lt|=ht.patchFlag&16;const Wt=ht.props||EMPTY_OBJ,qt=dt.props||EMPTY_OBJ;let Qt;St&&toggleRecurse(St,!1),(Qt=qt.onVnodeBeforeUpdate)&&invokeVNodeHook(Qt,St,dt,ht),Vt&&invokeDirectiveHook(dt,ht,St,"beforeUpdate"),St&&toggleRecurse(St,!0);const en=Rt&&dt.type!=="foreignObject";if(Ot?vt(ht.dynamicChildren,Ot,kt,St,Ct,en,Nt):Ut||zt(ht,dt,kt,null,St,Ct,en,Nt,!1),Lt>0){if(Lt&16)yt(kt,dt,Wt,qt,St,Ct,Rt);else if(Lt&2&&Wt.class!==qt.class&&d(kt,"class",null,qt.class,Rt),Lt&4&&d(kt,"style",Wt.style,qt.style,Rt),Lt&8){const on=dt.dynamicProps;for(let sn=0;sn<on.length;sn++){const hn=on[sn],An=Wt[hn],Fn=qt[hn];(Fn!==An||hn==="value")&&d(kt,hn,An,Fn,Rt,ht.children,St,Ct,$t)}}Lt&1&&ht.children!==dt.children&&Z(kt,dt.children)}else!Ut&&Ot==null&&yt(kt,dt,Wt,qt,St,Ct,Rt);((Qt=qt.onVnodeUpdated)||Vt)&&queuePostRenderEffect(()=>{Qt&&invokeVNodeHook(Qt,St,dt,ht),Vt&&invokeDirectiveHook(dt,ht,St,"updated")},Ct)},vt=(ht,dt,St,Ct,Rt,Nt,Ut)=>{for(let kt=0;kt<dt.length;kt++){const Lt=ht[kt],Ot=dt[kt],Vt=Lt.el&&(Lt.type===Fragment||!isSameVNodeType(Lt,Ot)||Lt.shapeFlag&70)?et(Lt.el):St;rt(Lt,Ot,Vt,null,Ct,Rt,Nt,Ut,!0)}},yt=(ht,dt,St,Ct,Rt,Nt,Ut)=>{if(St!==Ct){if(St!==EMPTY_OBJ)for(const kt in St)!isReservedProp(kt)&&!(kt in Ct)&&d(ht,kt,St[kt],null,Ut,dt.children,Rt,Nt,$t);for(const kt in Ct){if(isReservedProp(kt))continue;const Lt=Ct[kt],Ot=St[kt];Lt!==Ot&&kt!=="value"&&d(ht,kt,Ot,Lt,Ut,dt.children,Rt,Nt,$t)}"value"in Ct&&d(ht,"value",St.value,Ct.value)}},bt=(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt)=>{const Ot=dt.el=ht?ht.el:_(""),Vt=dt.anchor=ht?ht.anchor:_("");let{patchFlag:Wt,dynamicChildren:qt,slotScopeIds:Qt}=dt;Qt&&(kt=kt?kt.concat(Qt):Qt),ht==null?(s(Ot,St,Ct),s(Vt,St,Ct),Et(dt.children,St,Vt,Rt,Nt,Ut,kt,Lt)):Wt>0&&Wt&64&&qt&&ht.dynamicChildren?(vt(ht.dynamicChildren,qt,St,Rt,Nt,Ut,kt),(dt.key!=null||Rt&&dt===Rt.subTree)&&traverseStaticChildren(ht,dt,!0)):zt(ht,dt,St,Vt,Rt,Nt,Ut,kt,Lt)},Pt=(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt)=>{dt.slotScopeIds=kt,ht==null?dt.shapeFlag&512?Rt.ctx.activate(dt,St,Ct,Ut,Lt):wt(dt,St,Ct,Rt,Nt,Ut,Lt):At(ht,dt,Lt)},wt=(ht,dt,St,Ct,Rt,Nt,Ut)=>{const kt=ht.component=createComponentInstance(ht,Ct,Rt);if(isKeepAlive(ht)&&(kt.ctx.renderer=nn),setupComponent(kt),kt.asyncDep){if(Rt&&Rt.registerDep(kt,Ft),!ht.el){const Lt=kt.subTree=createVNode(Comment);ot(null,Lt,dt,St)}return}Ft(kt,ht,dt,St,Rt,Nt,Ut)},At=(ht,dt,St)=>{const Ct=dt.component=ht.component;if(shouldUpdateComponent(ht,dt,St))if(Ct.asyncDep&&!Ct.asyncResolved){Bt(Ct,dt,St);return}else Ct.next=dt,invalidateJob(Ct.update),Ct.update();else dt.el=ht.el,Ct.vnode=dt},Ft=(ht,dt,St,Ct,Rt,Nt,Ut)=>{const kt=()=>{if(ht.isMounted){let{next:Vt,bu:Wt,u:qt,parent:Qt,vnode:en}=ht,on=Vt,sn;toggleRecurse(ht,!1),Vt?(Vt.el=en.el,Bt(ht,Vt,Ut)):Vt=en,Wt&&invokeArrayFns(Wt),(sn=Vt.props&&Vt.props.onVnodeBeforeUpdate)&&invokeVNodeHook(sn,Qt,Vt,en),toggleRecurse(ht,!0);const hn=renderComponentRoot(ht),An=ht.subTree;ht.subTree=hn,rt(An,hn,et(An.el),xt(An),ht,Rt,Nt),Vt.el=hn.el,on===null&&updateHOCHostEl(ht,hn.el),qt&&queuePostRenderEffect(qt,Rt),(sn=Vt.props&&Vt.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(sn,Qt,Vt,en),Rt)}else{let Vt;const{el:Wt,props:qt}=dt,{bm:Qt,m:en,parent:on}=ht,sn=isAsyncWrapper(dt);if(toggleRecurse(ht,!1),Qt&&invokeArrayFns(Qt),!sn&&(Vt=qt&&qt.onVnodeBeforeMount)&&invokeVNodeHook(Vt,on,dt),toggleRecurse(ht,!0),Wt&&Jt){const hn=()=>{ht.subTree=renderComponentRoot(ht),Jt(Wt,ht.subTree,ht,Rt,null)};sn?dt.type.__asyncLoader().then(()=>!ht.isUnmounted&&hn()):hn()}else{const hn=ht.subTree=renderComponentRoot(ht);rt(null,hn,St,Ct,ht,Rt,Nt),dt.el=hn.el}if(en&&queuePostRenderEffect(en,Rt),!sn&&(Vt=qt&&qt.onVnodeMounted)){const hn=dt;queuePostRenderEffect(()=>invokeVNodeHook(Vt,on,hn),Rt)}(dt.shapeFlag&256||on&&isAsyncWrapper(on.vnode)&&on.vnode.shapeFlag&256)&&ht.a&&queuePostRenderEffect(ht.a,Rt),ht.isMounted=!0,dt=St=Ct=null}},Lt=ht.effect=new ReactiveEffect(kt,()=>queueJob(Ot),ht.scope),Ot=ht.update=()=>Lt.run();Ot.id=ht.uid,toggleRecurse(ht,!0),Ot()},Bt=(ht,dt,St)=>{dt.component=ht;const Ct=ht.vnode.props;ht.vnode=dt,ht.next=null,updateProps(ht,dt.props,Ct,St),updateSlots(ht,dt.children,St),pauseTracking(),flushPreFlushCbs(),resetTracking()},zt=(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt=!1)=>{const Ot=ht&&ht.children,Vt=ht?ht.shapeFlag:0,Wt=dt.children,{patchFlag:qt,shapeFlag:Qt}=dt;if(qt>0){if(qt&128){ln(Ot,Wt,St,Ct,Rt,Nt,Ut,kt,Lt);return}else if(qt&256){Ht(Ot,Wt,St,Ct,Rt,Nt,Ut,kt,Lt);return}}Qt&8?(Vt&16&&$t(Ot,Rt,Nt),Wt!==Ot&&Z(St,Wt)):Vt&16?Qt&16?ln(Ot,Wt,St,Ct,Rt,Nt,Ut,kt,Lt):$t(Ot,Rt,Nt,!0):(Vt&8&&Z(St,""),Qt&16&&Et(Wt,St,Ct,Rt,Nt,Ut,kt,Lt))},Ht=(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt)=>{ht=ht||EMPTY_ARR,dt=dt||EMPTY_ARR;const Ot=ht.length,Vt=dt.length,Wt=Math.min(Ot,Vt);let qt;for(qt=0;qt<Wt;qt++){const Qt=dt[qt]=Lt?cloneIfMounted(dt[qt]):normalizeVNode(dt[qt]);rt(ht[qt],Qt,St,null,Rt,Nt,Ut,kt,Lt)}Ot>Vt?$t(ht,Rt,Nt,!0,!1,Wt):Et(dt,St,Ct,Rt,Nt,Ut,kt,Lt,Wt)},ln=(ht,dt,St,Ct,Rt,Nt,Ut,kt,Lt)=>{let Ot=0;const Vt=dt.length;let Wt=ht.length-1,qt=Vt-1;for(;Ot<=Wt&&Ot<=qt;){const Qt=ht[Ot],en=dt[Ot]=Lt?cloneIfMounted(dt[Ot]):normalizeVNode(dt[Ot]);if(isSameVNodeType(Qt,en))rt(Qt,en,St,null,Rt,Nt,Ut,kt,Lt);else break;Ot++}for(;Ot<=Wt&&Ot<=qt;){const Qt=ht[Wt],en=dt[qt]=Lt?cloneIfMounted(dt[qt]):normalizeVNode(dt[qt]);if(isSameVNodeType(Qt,en))rt(Qt,en,St,null,Rt,Nt,Ut,kt,Lt);else break;Wt--,qt--}if(Ot>Wt){if(Ot<=qt){const Qt=qt+1,en=Qt<Vt?dt[Qt].el:Ct;for(;Ot<=qt;)rt(null,dt[Ot]=Lt?cloneIfMounted(dt[Ot]):normalizeVNode(dt[Ot]),St,en,Rt,Nt,Ut,kt,Lt),Ot++}}else if(Ot>qt)for(;Ot<=Wt;)Zt(ht[Ot],Rt,Nt,!0),Ot++;else{const Qt=Ot,en=Ot,on=new Map;for(Ot=en;Ot<=qt;Ot++){const Tn=dt[Ot]=Lt?cloneIfMounted(dt[Ot]):normalizeVNode(dt[Ot]);Tn.key!=null&&on.set(Tn.key,Ot)}let sn,hn=0;const An=qt-en+1;let Fn=!1,lr=0;const cr=new Array(An);for(Ot=0;Ot<An;Ot++)cr[Ot]=0;for(Ot=Qt;Ot<=Wt;Ot++){const Tn=ht[Ot];if(hn>=An){Zt(Tn,Rt,Nt,!0);continue}let On;if(Tn.key!=null)On=on.get(Tn.key);else for(sn=en;sn<=qt;sn++)if(cr[sn-en]===0&&isSameVNodeType(Tn,dt[sn])){On=sn;break}On===void 0?Zt(Tn,Rt,Nt,!0):(cr[On-en]=Ot+1,On>=lr?lr=On:Fn=!0,rt(Tn,dt[On],St,null,Rt,Nt,Ut,kt,Lt),hn++)}const Or=Fn?getSequence(cr):EMPTY_ARR;for(sn=Or.length-1,Ot=An-1;Ot>=0;Ot--){const Tn=en+Ot,On=dt[Tn],rn=Tn+1<Vt?dt[Tn+1].el:Ct;cr[Ot]===0?rt(null,On,St,rn,Rt,Nt,Ut,kt,Lt):Fn&&(sn<0||Ot!==Or[sn]?gn(On,St,rn,2):sn--)}}},gn=(ht,dt,St,Ct,Rt=null)=>{const{el:Nt,type:Ut,transition:kt,children:Lt,shapeFlag:Ot}=ht;if(Ot&6){gn(ht.component.subTree,dt,St,Ct);return}if(Ot&128){ht.suspense.move(dt,St,Ct);return}if(Ot&64){Ut.move(ht,dt,St,nn);return}if(Ut===Fragment){s(Nt,dt,St);for(let Wt=0;Wt<Lt.length;Wt++)gn(Lt[Wt],dt,St,Ct);s(ht.anchor,dt,St);return}if(Ut===Static){ft(ht,dt,St);return}if(Ct!==2&&Ot&1&&kt)if(Ct===0)kt.beforeEnter(Nt),s(Nt,dt,St),queuePostRenderEffect(()=>kt.enter(Nt),Rt);else{const{leave:Wt,delayLeave:qt,afterLeave:Qt}=kt,en=()=>s(Nt,dt,St),on=()=>{Wt(Nt,()=>{en(),Qt&&Qt()})};qt?qt(Nt,en,on):on()}else s(Nt,dt,St)},Zt=(ht,dt,St,Ct=!1,Rt=!1)=>{const{type:Nt,props:Ut,ref:kt,children:Lt,dynamicChildren:Ot,shapeFlag:Vt,patchFlag:Wt,dirs:qt}=ht;if(kt!=null&&setRef(kt,null,St,ht,!0),Vt&256){dt.ctx.deactivate(ht);return}const Qt=Vt&1&&qt,en=!isAsyncWrapper(ht);let on;if(en&&(on=Ut&&Ut.onVnodeBeforeUnmount)&&invokeVNodeHook(on,dt,ht),Vt&6)It(ht.component,St,Ct);else{if(Vt&128){ht.suspense.unmount(St,Ct);return}Qt&&invokeDirectiveHook(ht,null,dt,"beforeUnmount"),Vt&64?ht.type.remove(ht,dt,St,Rt,nn,Ct):Ot&&(Nt!==Fragment||Wt>0&&Wt&64)?$t(Ot,dt,St,!1,!0):(Nt===Fragment&&Wt&384||!Rt&&Vt&16)&&$t(Lt,dt,St),Ct&&En(ht)}(en&&(on=Ut&&Ut.onVnodeUnmounted)||Qt)&&queuePostRenderEffect(()=>{on&&invokeVNodeHook(on,dt,ht),Qt&&invokeDirectiveHook(ht,null,dt,"unmounted")},St)},En=ht=>{const{type:dt,el:St,anchor:Ct,transition:Rt}=ht;if(dt===Fragment){_n(St,Ct);return}if(dt===Static){ct(ht);return}const Nt=()=>{f(St),Rt&&!Rt.persisted&&Rt.afterLeave&&Rt.afterLeave()};if(ht.shapeFlag&1&&Rt&&!Rt.persisted){const{leave:Ut,delayLeave:kt}=Rt,Lt=()=>Ut(St,Nt);kt?kt(ht.el,Nt,Lt):Lt()}else Nt()},_n=(ht,dt)=>{let St;for(;ht!==dt;)St=tt(ht),f(ht),ht=St;f(dt)},It=(ht,dt,St)=>{const{bum:Ct,scope:Rt,update:Nt,subTree:Ut,um:kt}=ht;Ct&&invokeArrayFns(Ct),Rt.stop(),Nt&&(Nt.active=!1,Zt(Ut,ht,dt,St)),kt&&queuePostRenderEffect(kt,dt),queuePostRenderEffect(()=>{ht.isUnmounted=!0},dt),dt&&dt.pendingBranch&&!dt.isUnmounted&&ht.asyncDep&&!ht.asyncResolved&&ht.suspenseId===dt.pendingId&&(dt.deps--,dt.deps===0&&dt.resolve())},$t=(ht,dt,St,Ct=!1,Rt=!1,Nt=0)=>{for(let Ut=Nt;Ut<ht.length;Ut++)Zt(ht[Ut],dt,St,Ct,Rt)},xt=ht=>ht.shapeFlag&6?xt(ht.component.subTree):ht.shapeFlag&128?ht.suspense.next():tt(ht.anchor||ht.el),Kt=(ht,dt,St)=>{ht==null?dt._vnode&&Zt(dt._vnode,null,null,!0):rt(dt._vnode||null,ht,dt,null,null,null,St),flushPreFlushCbs(),flushPostFlushCbs(),dt._vnode=ht},nn={p:rt,um:Zt,m:gn,r:En,mt:wt,mc:Et,pc:zt,pbc:vt,n:xt,o:i};let cn,Jt;return e&&([cn,Jt]=e(nn)),{render:Kt,hydrate:cn,createApp:createAppAPI(Kt,cn)}}function toggleRecurse({effect:i,update:e},o){i.allowRecurse=e.allowRecurse=o}function traverseStaticChildren(i,e,o=!1){const s=i.children,f=e.children;if(isArray$1(s)&&isArray$1(f))for(let d=0;d<s.length;d++){const m=s[d];let _=f[d];_.shapeFlag&1&&!_.dynamicChildren&&((_.patchFlag<=0||_.patchFlag===32)&&(_=f[d]=cloneIfMounted(f[d]),_.el=m.el),o||traverseStaticChildren(m,_))}}function getSequence(i){const e=i.slice(),o=[0];let s,f,d,m,_;const $=i.length;for(s=0;s<$;s++){const G=i[s];if(G!==0){if(f=o[o.length-1],i[f]<G){e[s]=f,o.push(s);continue}for(d=0,m=o.length-1;d<m;)_=d+m>>1,i[o[_]]<G?d=_+1:m=_;G<i[o[d]]&&(d>0&&(e[s]=o[d-1]),o[d]=s)}}for(d=o.length,m=o[d-1];d-- >0;)o[d]=m,m=e[m];return o}const isTeleport=i=>i.__isTeleport,Fragment=Symbol(void 0),Text=Symbol(void 0),Comment=Symbol(void 0),Static=Symbol(void 0),blockStack=[];let currentBlock=null;function openBlock(i=!1){blockStack.push(currentBlock=i?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(i){isBlockTreeEnabled+=i}function setupBlock(i){return i.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(i),i}function createElementBlock(i,e,o,s,f,d){return setupBlock(createBaseVNode(i,e,o,s,f,d,!0))}function createBlock(i,e,o,s,f){return setupBlock(createVNode(i,e,o,s,f,!0))}function isVNode(i){return i?i.__v_isVNode===!0:!1}function isSameVNodeType(i,e){return i.type===e.type&&i.key===e.key}const InternalObjectKey="__vInternal",normalizeKey=({key:i})=>i!=null?i:null,normalizeRef=({ref:i,ref_key:e,ref_for:o})=>i!=null?isString$1(i)||isRef(i)||isFunction$1(i)?{i:currentRenderingInstance,r:i,k:e,f:!!o}:i:null;function createBaseVNode(i,e=null,o=null,s=0,f=null,d=i===Fragment?0:1,m=!1,_=!1){const $={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&normalizeKey(e),ref:e&&normalizeRef(e),scopeId:currentScopeId,slotScopeIds:null,children:o,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:d,patchFlag:s,dynamicProps:f,dynamicChildren:null,appContext:null};return _?(normalizeChildren($,o),d&128&&i.normalize($)):o&&($.shapeFlag|=isString$1(o)?8:16),isBlockTreeEnabled>0&&!m&&currentBlock&&($.patchFlag>0||d&6)&&$.patchFlag!==32&&currentBlock.push($),$}const createVNode=_createVNode;function _createVNode(i,e=null,o=null,s=0,f=null,d=!1){if((!i||i===NULL_DYNAMIC_COMPONENT)&&(i=Comment),isVNode(i)){const _=cloneVNode(i,e,!0);return o&&normalizeChildren(_,o),isBlockTreeEnabled>0&&!d&&currentBlock&&(_.shapeFlag&6?currentBlock[currentBlock.indexOf(i)]=_:currentBlock.push(_)),_.patchFlag|=-2,_}if(isClassComponent(i)&&(i=i.__vccOpts),e){e=guardReactiveProps(e);let{class:_,style:$}=e;_&&!isString$1(_)&&(e.class=normalizeClass(_)),isObject$1($)&&(isProxy($)&&!isArray$1($)&&($=extend({},$)),e.style=normalizeStyle($))}const m=isString$1(i)?1:isSuspense(i)?128:isTeleport(i)?64:isObject$1(i)?4:isFunction$1(i)?2:0;return createBaseVNode(i,e,o,s,f,m,d,!0)}function guardReactiveProps(i){return i?isProxy(i)||InternalObjectKey in i?extend({},i):i:null}function cloneVNode(i,e,o=!1){const{props:s,ref:f,patchFlag:d,children:m}=i,_=e?mergeProps(s||{},e):s;return{__v_isVNode:!0,__v_skip:!0,type:i.type,props:_,key:_&&normalizeKey(_),ref:e&&e.ref?o&&f?isArray$1(f)?f.concat(normalizeRef(e)):[f,normalizeRef(e)]:normalizeRef(e):f,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:m,target:i.target,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==Fragment?d===-1?16:d|16:d,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:i.transition,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&cloneVNode(i.ssContent),ssFallback:i.ssFallback&&cloneVNode(i.ssFallback),el:i.el,anchor:i.anchor}}function createTextVNode(i=" ",e=0){return createVNode(Text,null,i,e)}function createStaticVNode(i,e){const o=createVNode(Static,null,i);return o.staticCount=e,o}function createCommentVNode(i="",e=!1){return e?(openBlock(),createBlock(Comment,null,i)):createVNode(Comment,null,i)}function normalizeVNode(i){return i==null||typeof i=="boolean"?createVNode(Comment):isArray$1(i)?createVNode(Fragment,null,i.slice()):typeof i=="object"?cloneIfMounted(i):createVNode(Text,null,String(i))}function cloneIfMounted(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:cloneVNode(i)}function normalizeChildren(i,e){let o=0;const{shapeFlag:s}=i;if(e==null)e=null;else if(isArray$1(e))o=16;else if(typeof e=="object")if(s&65){const f=e.default;f&&(f._c&&(f._d=!1),normalizeChildren(i,f()),f._c&&(f._d=!0));return}else{o=32;const f=e._;!f&&!(InternalObjectKey in e)?e._ctx=currentRenderingInstance:f===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else isFunction$1(e)?(e={default:e,_ctx:currentRenderingInstance},o=32):(e=String(e),s&64?(o=16,e=[createTextVNode(e)]):o=8);i.children=e,i.shapeFlag|=o}function mergeProps(...i){const e={};for(let o=0;o<i.length;o++){const s=i[o];for(const f in s)if(f==="class")e.class!==s.class&&(e.class=normalizeClass([e.class,s.class]));else if(f==="style")e.style=normalizeStyle([e.style,s.style]);else if(isOn(f)){const d=e[f],m=s[f];m&&d!==m&&!(isArray$1(d)&&d.includes(m))&&(e[f]=d?[].concat(d,m):m)}else f!==""&&(e[f]=s[f])}return e}function invokeVNodeHook(i,e,o,s=null){callWithAsyncErrorHandling(i,e,7,[o,s])}const emptyAppContext=createAppContext();let uid$1=0;function createComponentInstance(i,e,o){const s=i.type,f=(e?e.appContext:i.appContext)||emptyAppContext,d={uid:uid$1++,vnode:i,type:s,parent:e,appContext:f,root:null,next:null,subTree:null,effect:null,update:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(f.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(s,f),emitsOptions:normalizeEmitsOptions(s,f),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:s.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,suspense:o,suspenseId:o?o.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return d.ctx={_:d},d.root=e?e.root:d,d.emit=emit$1.bind(null,d),i.ce&&i.ce(d),d}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance,setCurrentInstance=i=>{currentInstance=i,i.scope.on()},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),currentInstance=null};function isStatefulComponent(i){return i.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(i,e=!1){isInSSRComponentSetup=e;const{props:o,children:s}=i.vnode,f=isStatefulComponent(i);initProps(i,o,f,e),initSlots(i,s);const d=f?setupStatefulComponent(i,e):void 0;return isInSSRComponentSetup=!1,d}function setupStatefulComponent(i,e){const o=i.type;i.accessCache=Object.create(null),i.proxy=markRaw(new Proxy(i.ctx,PublicInstanceProxyHandlers));const{setup:s}=o;if(s){const f=i.setupContext=s.length>1?createSetupContext(i):null;setCurrentInstance(i),pauseTracking();const d=callWithErrorHandling(s,i,0,[i.props,f]);if(resetTracking(),unsetCurrentInstance(),isPromise(d)){if(d.then(unsetCurrentInstance,unsetCurrentInstance),e)return d.then(m=>{handleSetupResult(i,m,e)}).catch(m=>{handleError(m,i,0)});i.asyncDep=d}else handleSetupResult(i,d,e)}else finishComponentSetup(i,e)}function handleSetupResult(i,e,o){isFunction$1(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:isObject$1(e)&&(i.setupState=proxyRefs(e)),finishComponentSetup(i,o)}let compile;function finishComponentSetup(i,e,o){const s=i.type;if(!i.render){if(!e&&compile&&!s.render){const f=s.template||resolveMergedOptions(i).template;if(f){const{isCustomElement:d,compilerOptions:m}=i.appContext.config,{delimiters:_,compilerOptions:$}=s,G=extend(extend({isCustomElement:d,delimiters:_},m),$);s.render=compile(f,G)}}i.render=s.render||NOOP}setCurrentInstance(i),pauseTracking(),applyOptions(i),resetTracking(),unsetCurrentInstance()}function createAttrsProxy(i){return new Proxy(i.attrs,{get(e,o){return track(i,"get","$attrs"),e[o]}})}function createSetupContext(i){const e=s=>{i.exposed=s||{}};let o;return{get attrs(){return o||(o=createAttrsProxy(i))},slots:i.slots,emit:i.emit,expose:e}}function getExposeProxy(i){if(i.exposed)return i.exposeProxy||(i.exposeProxy=new Proxy(proxyRefs(markRaw(i.exposed)),{get(e,o){if(o in e)return e[o];if(o in publicPropertiesMap)return publicPropertiesMap[o](i)}}))}const classifyRE=/(?:^|[-_])(\w)/g,classify=i=>i.replace(classifyRE,e=>e.toUpperCase()).replace(/[-_]/g,"");function getComponentName(i,e=!0){return isFunction$1(i)?i.displayName||i.name:i.name||e&&i.__name}function formatComponentName(i,e,o=!1){let s=getComponentName(e);if(!s&&e.__file){const f=e.__file.match(/([^/\\]+)\.\w+$/);f&&(s=f[1])}if(!s&&i&&i.parent){const f=d=>{for(const m in d)if(d[m]===e)return m};s=f(i.components||i.parent.type.components)||f(i.appContext.components)}return s?classify(s):o?"App":"Anonymous"}function isClassComponent(i){return isFunction$1(i)&&"__vccOpts"in i}const computed=(i,e)=>computed$1(i,e,isInSSRComponentSetup);function h(i,e,o){const s=arguments.length;return s===2?isObject$1(e)&&!isArray$1(e)?isVNode(e)?createVNode(i,null,[e]):createVNode(i,e):createVNode(i,null,e):(s>3?o=Array.prototype.slice.call(arguments,2):s===3&&isVNode(o)&&(o=[o]),createVNode(i,e,o))}const version="3.2.41",svgNS="http://www.w3.org/2000/svg",doc=typeof document<"u"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(i,e,o)=>{e.insertBefore(i,o||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,o,s)=>{const f=e?doc.createElementNS(svgNS,i):doc.createElement(i,o?{is:o}:void 0);return i==="select"&&s&&s.multiple!=null&&f.setAttribute("multiple",s.multiple),f},createText:i=>doc.createTextNode(i),createComment:i=>doc.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>doc.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,o,s,f,d){const m=o?o.previousSibling:e.lastChild;if(f&&(f===d||f.nextSibling))for(;e.insertBefore(f.cloneNode(!0),o),!(f===d||!(f=f.nextSibling)););else{templateContainer.innerHTML=s?`<svg>${i}</svg>`:i;const _=templateContainer.content;if(s){const $=_.firstChild;for(;$.firstChild;)_.appendChild($.firstChild);_.removeChild($)}e.insertBefore(_,o)}return[m?m.nextSibling:e.firstChild,o?o.previousSibling:e.lastChild]}};function patchClass(i,e,o){const s=i._vtc;s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?i.removeAttribute("class"):o?i.setAttribute("class",e):i.className=e}function patchStyle(i,e,o){const s=i.style,f=isString$1(o);if(o&&!f){for(const d in o)setStyle(s,d,o[d]);if(e&&!isString$1(e))for(const d in e)o[d]==null&&setStyle(s,d,"")}else{const d=s.display;f?e!==o&&(s.cssText=o):e&&i.removeAttribute("style"),"_vod"in i&&(s.display=d)}}const importantRE=/\s*!important$/;function setStyle(i,e,o){if(isArray$1(o))o.forEach(s=>setStyle(i,e,s));else if(o==null&&(o=""),e.startsWith("--"))i.setProperty(e,o);else{const s=autoPrefix(i,e);importantRE.test(o)?i.setProperty(hyphenate(s),o.replace(importantRE,""),"important"):i[s]=o}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(i,e){const o=prefixCache[e];if(o)return o;let s=camelize(e);if(s!=="filter"&&s in i)return prefixCache[e]=s;s=capitalize(s);for(let f=0;f<prefixes.length;f++){const d=prefixes[f]+s;if(d in i)return prefixCache[e]=d}return e}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(i,e,o,s,f){if(s&&e.startsWith("xlink:"))o==null?i.removeAttributeNS(xlinkNS,e.slice(6,e.length)):i.setAttributeNS(xlinkNS,e,o);else{const d=isSpecialBooleanAttr(e);o==null||d&&!includeBooleanAttr(o)?i.removeAttribute(e):i.setAttribute(e,d?"":o)}}function patchDOMProp(i,e,o,s,f,d,m){if(e==="innerHTML"||e==="textContent"){s&&m(s,f,d),i[e]=o==null?"":o;return}if(e==="value"&&i.tagName!=="PROGRESS"&&!i.tagName.includes("-")){i._value=o;const $=o==null?"":o;(i.value!==$||i.tagName==="OPTION")&&(i.value=$),o==null&&i.removeAttribute(e);return}let _=!1;if(o===""||o==null){const $=typeof i[e];$==="boolean"?o=includeBooleanAttr(o):o==null&&$==="string"?(o="",_=!0):$==="number"&&(o=0,_=!0)}try{i[e]=o}catch{}_&&i.removeAttribute(e)}function addEventListener(i,e,o,s){i.addEventListener(e,o,s)}function removeEventListener(i,e,o,s){i.removeEventListener(e,o,s)}function patchEvent(i,e,o,s,f=null){const d=i._vei||(i._vei={}),m=d[e];if(s&&m)m.value=s;else{const[_,$]=parseName(e);if(s){const G=d[e]=createInvoker(s,f);addEventListener(i,_,G,$)}else m&&(removeEventListener(i,_,m,$),d[e]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(i){let e;if(optionsModifierRE.test(i)){e={};let s;for(;s=i.match(optionsModifierRE);)i=i.slice(0,i.length-s[0].length),e[s[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):hyphenate(i.slice(2)),e]}let cachedNow=0;const p=Promise.resolve(),getNow=()=>cachedNow||(p.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(i,e){const o=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=o.attached)return;callWithAsyncErrorHandling(patchStopImmediatePropagation(s,o.value),e,5,[s])};return o.value=i,o.attached=getNow(),o}function patchStopImmediatePropagation(i,e){if(isArray$1(e)){const o=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{o.call(i),i._stopped=!0},e.map(s=>f=>!f._stopped&&s&&s(f))}else return e}const nativeOnRE=/^on[a-z]/,patchProp=(i,e,o,s,f=!1,d,m,_,$)=>{e==="class"?patchClass(i,s,f):e==="style"?patchStyle(i,o,s):isOn(e)?isModelListener(e)||patchEvent(i,e,o,s,m):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):shouldSetAsProp(i,e,s,f))?patchDOMProp(i,e,s,d,m,_,$):(e==="true-value"?i._trueValue=s:e==="false-value"&&(i._falseValue=s),patchAttr(i,e,s,f))};function shouldSetAsProp(i,e,o,s){return s?!!(e==="innerHTML"||e==="textContent"||e in i&&nativeOnRE.test(e)&&isFunction$1(o)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA"||nativeOnRE.test(e)&&isString$1(o)?!1:e in i}const DOMTransitionPropsValidators={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};BaseTransition.props;const getModelAssigner=i=>{const e=i.props["onUpdate:modelValue"]||!1;return isArray$1(e)?o=>invokeArrayFns(e,o):e};function onCompositionStart(i){i.target.composing=!0}function onCompositionEnd(i){const e=i.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const vModelText={created(i,{modifiers:{lazy:e,trim:o,number:s}},f){i._assign=getModelAssigner(f);const d=s||f.props&&f.props.type==="number";addEventListener(i,e?"change":"input",m=>{if(m.target.composing)return;let _=i.value;o&&(_=_.trim()),d&&(_=toNumber(_)),i._assign(_)}),o&&addEventListener(i,"change",()=>{i.value=i.value.trim()}),e||(addEventListener(i,"compositionstart",onCompositionStart),addEventListener(i,"compositionend",onCompositionEnd),addEventListener(i,"change",onCompositionEnd))},mounted(i,{value:e}){i.value=e==null?"":e},beforeUpdate(i,{value:e,modifiers:{lazy:o,trim:s,number:f}},d){if(i._assign=getModelAssigner(d),i.composing||document.activeElement===i&&i.type!=="range"&&(o||s&&i.value.trim()===e||(f||i.type==="number")&&toNumber(i.value)===e))return;const m=e==null?"":e;i.value!==m&&(i.value=m)}},vModelSelect={deep:!0,created(i,{value:e,modifiers:{number:o}},s){const f=isSet(e);addEventListener(i,"change",()=>{const d=Array.prototype.filter.call(i.options,m=>m.selected).map(m=>o?toNumber(getValue(m)):getValue(m));i._assign(i.multiple?f?new Set(d):d:d[0])}),i._assign=getModelAssigner(s)},mounted(i,{value:e}){setSelected(i,e)},beforeUpdate(i,e,o){i._assign=getModelAssigner(o)},updated(i,{value:e}){setSelected(i,e)}};function setSelected(i,e){const o=i.multiple;if(!(o&&!isArray$1(e)&&!isSet(e))){for(let s=0,f=i.options.length;s<f;s++){const d=i.options[s],m=getValue(d);if(o)isArray$1(e)?d.selected=looseIndexOf(e,m)>-1:d.selected=e.has(m);else if(looseEqual(getValue(d),e)){i.selectedIndex!==s&&(i.selectedIndex=s);return}}!o&&i.selectedIndex!==-1&&(i.selectedIndex=-1)}}function getValue(i){return"_value"in i?i._value:i.value}const vShow={beforeMount(i,{value:e},{transition:o}){i._vod=i.style.display==="none"?"":i.style.display,o&&e?o.beforeEnter(i):setDisplay(i,e)},mounted(i,{value:e},{transition:o}){o&&e&&o.enter(i)},updated(i,{value:e,oldValue:o},{transition:s}){!e!=!o&&(s?e?(s.beforeEnter(i),setDisplay(i,!0),s.enter(i)):s.leave(i,()=>{setDisplay(i,!1)}):setDisplay(i,e))},beforeUnmount(i,{value:e}){setDisplay(i,e)}};function setDisplay(i,e){i.style.display=e?i._vod:"none"}const rendererOptions=extend({patchProp},nodeOps);let renderer;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}const createApp=(...i)=>{const e=ensureRenderer().createApp(...i),{mount:o}=e;return e.mount=s=>{const f=normalizeContainer(s);if(!f)return;const d=e._component;!isFunction$1(d)&&!d.render&&!d.template&&(d.template=f.innerHTML),f.innerHTML="";const m=o(f,!1,f instanceof SVGElement);return f instanceof Element&&(f.removeAttribute("v-cloak"),f.setAttribute("data-v-app","")),m},e};function normalizeContainer(i){return isString$1(i)?document.querySelector(i):i}/*!
  * vue-router v4.1.5
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const isBrowser=typeof window<"u";function isESModule(i){return i.__esModule||i[Symbol.toStringTag]==="Module"}const assign=Object.assign;function applyToParams(i,e){const o={};for(const s in e){const f=e[s];o[s]=isArray(f)?f.map(i):i(f)}return o}const noop$2=()=>{},isArray=Array.isArray,TRAILING_SLASH_RE=/\/$/,removeTrailingSlash=i=>i.replace(TRAILING_SLASH_RE,"");function parseURL(i,e,o="/"){let s,f={},d="",m="";const _=e.indexOf("#");let $=e.indexOf("?");return _<$&&_>=0&&($=-1),$>-1&&(s=e.slice(0,$),d=e.slice($+1,_>-1?_:e.length),f=i(d)),_>-1&&(s=s||e.slice(0,_),m=e.slice(_,e.length)),s=resolveRelativePath(s!=null?s:e,o),{fullPath:s+(d&&"?")+d+m,path:s,query:f,hash:m}}function stringifyURL(i,e){const o=e.query?i(e.query):"";return e.path+(o&&"?")+o+(e.hash||"")}function stripBase(i,e){return!e||!i.toLowerCase().startsWith(e.toLowerCase())?i:i.slice(e.length)||"/"}function isSameRouteLocation(i,e,o){const s=e.matched.length-1,f=o.matched.length-1;return s>-1&&s===f&&isSameRouteRecord(e.matched[s],o.matched[f])&&isSameRouteLocationParams(e.params,o.params)&&i(e.query)===i(o.query)&&e.hash===o.hash}function isSameRouteRecord(i,e){return(i.aliasOf||i)===(e.aliasOf||e)}function isSameRouteLocationParams(i,e){if(Object.keys(i).length!==Object.keys(e).length)return!1;for(const o in i)if(!isSameRouteLocationParamsValue(i[o],e[o]))return!1;return!0}function isSameRouteLocationParamsValue(i,e){return isArray(i)?isEquivalentArray(i,e):isArray(e)?isEquivalentArray(e,i):i===e}function isEquivalentArray(i,e){return isArray(e)?i.length===e.length&&i.every((o,s)=>o===e[s]):i.length===1&&i[0]===e}function resolveRelativePath(i,e){if(i.startsWith("/"))return i;if(!i)return e;const o=e.split("/"),s=i.split("/");let f=o.length-1,d,m;for(d=0;d<s.length;d++)if(m=s[d],m!==".")if(m==="..")f>1&&f--;else break;return o.slice(0,f).join("/")+"/"+s.slice(d-(d===s.length?1:0)).join("/")}var NavigationType;(function(i){i.pop="pop",i.push="push"})(NavigationType||(NavigationType={}));var NavigationDirection;(function(i){i.back="back",i.forward="forward",i.unknown=""})(NavigationDirection||(NavigationDirection={}));function normalizeBase(i){if(!i)if(isBrowser){const e=document.querySelector("base");i=e&&e.getAttribute("href")||"/",i=i.replace(/^\w+:\/\/[^\/]+/,"")}else i="/";return i[0]!=="/"&&i[0]!=="#"&&(i="/"+i),removeTrailingSlash(i)}const BEFORE_HASH_RE=/^[^#]+#/;function createHref(i,e){return i.replace(BEFORE_HASH_RE,"#")+e}function getElementPosition(i,e){const o=document.documentElement.getBoundingClientRect(),s=i.getBoundingClientRect();return{behavior:e.behavior,left:s.left-o.left-(e.left||0),top:s.top-o.top-(e.top||0)}}const computeScrollPosition=()=>({left:window.pageXOffset,top:window.pageYOffset});function scrollToPosition(i){let e;if("el"in i){const o=i.el,s=typeof o=="string"&&o.startsWith("#"),f=typeof o=="string"?s?document.getElementById(o.slice(1)):document.querySelector(o):o;if(!f)return;e=getElementPosition(f,i)}else e=i;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}function getScrollKey(i,e){return(history.state?history.state.position-e:-1)+i}const scrollPositions=new Map;function saveScrollPosition(i,e){scrollPositions.set(i,e)}function getSavedScrollPosition(i){const e=scrollPositions.get(i);return scrollPositions.delete(i),e}let createBaseLocation=()=>location.protocol+"//"+location.host;function createCurrentLocation(i,e){const{pathname:o,search:s,hash:f}=e,d=i.indexOf("#");if(d>-1){let _=f.includes(i.slice(d))?i.slice(d).length:1,$=f.slice(_);return $[0]!=="/"&&($="/"+$),stripBase($,"")}return stripBase(o,i)+s+f}function useHistoryListeners(i,e,o,s){let f=[],d=[],m=null;const _=({state:tt})=>{const nt=createCurrentLocation(i,location),st=o.value,rt=e.value;let it=0;if(tt){if(o.value=nt,e.value=tt,m&&m===st){m=null;return}it=rt?tt.position-rt.position:0}else s(nt);f.forEach(ot=>{ot(o.value,st,{delta:it,type:NavigationType.pop,direction:it?it>0?NavigationDirection.forward:NavigationDirection.back:NavigationDirection.unknown})})};function $(){m=o.value}function G(tt){f.push(tt);const nt=()=>{const st=f.indexOf(tt);st>-1&&f.splice(st,1)};return d.push(nt),nt}function Z(){const{history:tt}=window;!tt.state||tt.replaceState(assign({},tt.state,{scroll:computeScrollPosition()}),"")}function et(){for(const tt of d)tt();d=[],window.removeEventListener("popstate",_),window.removeEventListener("beforeunload",Z)}return window.addEventListener("popstate",_),window.addEventListener("beforeunload",Z),{pauseListeners:$,listen:G,destroy:et}}function buildState(i,e,o,s=!1,f=!1){return{back:i,current:e,forward:o,replaced:s,position:window.history.length,scroll:f?computeScrollPosition():null}}function useHistoryStateNavigation(i){const{history:e,location:o}=window,s={value:createCurrentLocation(i,o)},f={value:e.state};f.value||d(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function d($,G,Z){const et=i.indexOf("#"),tt=et>-1?(o.host&&document.querySelector("base")?i:i.slice(et))+$:createBaseLocation()+i+$;try{e[Z?"replaceState":"pushState"](G,"",tt),f.value=G}catch(nt){console.error(nt),o[Z?"replace":"assign"](tt)}}function m($,G){const Z=assign({},e.state,buildState(f.value.back,$,f.value.forward,!0),G,{position:f.value.position});d($,Z,!0),s.value=$}function _($,G){const Z=assign({},f.value,e.state,{forward:$,scroll:computeScrollPosition()});d(Z.current,Z,!0);const et=assign({},buildState(s.value,$,null),{position:Z.position+1},G);d($,et,!1),s.value=$}return{location:s,state:f,push:_,replace:m}}function createWebHistory(i){i=normalizeBase(i);const e=useHistoryStateNavigation(i),o=useHistoryListeners(i,e.state,e.location,e.replace);function s(d,m=!0){m||o.pauseListeners(),history.go(d)}const f=assign({location:"",base:i,go:s,createHref:createHref.bind(null,i)},e,o);return Object.defineProperty(f,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(f,"state",{enumerable:!0,get:()=>e.state.value}),f}function isRouteLocation(i){return typeof i=="string"||i&&typeof i=="object"}function isRouteName(i){return typeof i=="string"||typeof i=="symbol"}const START_LOCATION_NORMALIZED={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},NavigationFailureSymbol=Symbol("");var NavigationFailureType;(function(i){i[i.aborted=4]="aborted",i[i.cancelled=8]="cancelled",i[i.duplicated=16]="duplicated"})(NavigationFailureType||(NavigationFailureType={}));function createRouterError(i,e){return assign(new Error,{type:i,[NavigationFailureSymbol]:!0},e)}function isNavigationFailure(i,e){return i instanceof Error&&NavigationFailureSymbol in i&&(e==null||!!(i.type&e))}const BASE_PARAM_PATTERN="[^/]+?",BASE_PATH_PARSER_OPTIONS={sensitive:!1,strict:!1,start:!0,end:!0},REGEX_CHARS_RE=/[.+*?^${}()[\]/\\]/g;function tokensToParser(i,e){const o=assign({},BASE_PATH_PARSER_OPTIONS,e),s=[];let f=o.start?"^":"";const d=[];for(const G of i){const Z=G.length?[]:[90];o.strict&&!G.length&&(f+="/");for(let et=0;et<G.length;et++){const tt=G[et];let nt=40+(o.sensitive?.25:0);if(tt.type===0)et||(f+="/"),f+=tt.value.replace(REGEX_CHARS_RE,"\\$&"),nt+=40;else if(tt.type===1){const{value:st,repeatable:rt,optional:it,regexp:ot}=tt;d.push({name:st,repeatable:rt,optional:it});const lt=ot||BASE_PARAM_PATTERN;if(lt!==BASE_PARAM_PATTERN){nt+=10;try{new RegExp(`(${lt})`)}catch(ct){throw new Error(`Invalid custom RegExp for param "${st}" (${lt}): `+ct.message)}}let ft=rt?`((?:${lt})(?:/(?:${lt}))*)`:`(${lt})`;et||(ft=it&&G.length<2?`(?:/${ft})`:"/"+ft),it&&(ft+="?"),f+=ft,nt+=20,it&&(nt+=-8),rt&&(nt+=-20),lt===".*"&&(nt+=-50)}Z.push(nt)}s.push(Z)}if(o.strict&&o.end){const G=s.length-1;s[G][s[G].length-1]+=.7000000000000001}o.strict||(f+="/?"),o.end?f+="$":o.strict&&(f+="(?:/|$)");const m=new RegExp(f,o.sensitive?"":"i");function _(G){const Z=G.match(m),et={};if(!Z)return null;for(let tt=1;tt<Z.length;tt++){const nt=Z[tt]||"",st=d[tt-1];et[st.name]=nt&&st.repeatable?nt.split("/"):nt}return et}function $(G){let Z="",et=!1;for(const tt of i){(!et||!Z.endsWith("/"))&&(Z+="/"),et=!1;for(const nt of tt)if(nt.type===0)Z+=nt.value;else if(nt.type===1){const{value:st,repeatable:rt,optional:it}=nt,ot=st in G?G[st]:"";if(isArray(ot)&&!rt)throw new Error(`Provided param "${st}" is an array but it is not repeatable (* or + modifiers)`);const lt=isArray(ot)?ot.join("/"):ot;if(!lt)if(it)tt.length<2&&(Z.endsWith("/")?Z=Z.slice(0,-1):et=!0);else throw new Error(`Missing required param "${st}"`);Z+=lt}}return Z||"/"}return{re:m,score:s,keys:d,parse:_,stringify:$}}function compareScoreArray(i,e){let o=0;for(;o<i.length&&o<e.length;){const s=e[o]-i[o];if(s)return s;o++}return i.length<e.length?i.length===1&&i[0]===40+40?-1:1:i.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function comparePathParserScore(i,e){let o=0;const s=i.score,f=e.score;for(;o<s.length&&o<f.length;){const d=compareScoreArray(s[o],f[o]);if(d)return d;o++}if(Math.abs(f.length-s.length)===1){if(isLastScoreNegative(s))return 1;if(isLastScoreNegative(f))return-1}return f.length-s.length}function isLastScoreNegative(i){const e=i[i.length-1];return i.length>0&&e[e.length-1]<0}const ROOT_TOKEN={type:0,value:""},VALID_PARAM_RE=/[a-zA-Z0-9_]/;function tokenizePath(i){if(!i)return[[]];if(i==="/")return[[ROOT_TOKEN]];if(!i.startsWith("/"))throw new Error(`Invalid path "${i}"`);function e(nt){throw new Error(`ERR (${o})/"${G}": ${nt}`)}let o=0,s=o;const f=[];let d;function m(){d&&f.push(d),d=[]}let _=0,$,G="",Z="";function et(){!G||(o===0?d.push({type:0,value:G}):o===1||o===2||o===3?(d.length>1&&($==="*"||$==="+")&&e(`A repeatable param (${G}) must be alone in its segment. eg: '/:ids+.`),d.push({type:1,value:G,regexp:Z,repeatable:$==="*"||$==="+",optional:$==="*"||$==="?"})):e("Invalid state to consume buffer"),G="")}function tt(){G+=$}for(;_<i.length;){if($=i[_++],$==="\\"&&o!==2){s=o,o=4;continue}switch(o){case 0:$==="/"?(G&&et(),m()):$===":"?(et(),o=1):tt();break;case 4:tt(),o=s;break;case 1:$==="("?o=2:VALID_PARAM_RE.test($)?tt():(et(),o=0,$!=="*"&&$!=="?"&&$!=="+"&&_--);break;case 2:$===")"?Z[Z.length-1]=="\\"?Z=Z.slice(0,-1)+$:o=3:Z+=$;break;case 3:et(),o=0,$!=="*"&&$!=="?"&&$!=="+"&&_--,Z="";break;default:e("Unknown state");break}}return o===2&&e(`Unfinished custom RegExp for param "${G}"`),et(),m(),f}function createRouteRecordMatcher(i,e,o){const s=tokensToParser(tokenizePath(i.path),o),f=assign(s,{record:i,parent:e,children:[],alias:[]});return e&&!f.record.aliasOf==!e.record.aliasOf&&e.children.push(f),f}function createRouterMatcher(i,e){const o=[],s=new Map;e=mergeOptions({strict:!1,end:!0,sensitive:!1},e);function f(Z){return s.get(Z)}function d(Z,et,tt){const nt=!tt,st=normalizeRouteRecord(Z);st.aliasOf=tt&&tt.record;const rt=mergeOptions(e,Z),it=[st];if("alias"in Z){const ft=typeof Z.alias=="string"?[Z.alias]:Z.alias;for(const ct of ft)it.push(assign({},st,{components:tt?tt.record.components:st.components,path:ct,aliasOf:tt?tt.record:st}))}let ot,lt;for(const ft of it){const{path:ct}=ft;if(et&&ct[0]!=="/"){const pt=et.record.path,gt=pt[pt.length-1]==="/"?"":"/";ft.path=et.record.path+(ct&&gt+ct)}if(ot=createRouteRecordMatcher(ft,et,rt),tt?tt.alias.push(ot):(lt=lt||ot,lt!==ot&&lt.alias.push(ot),nt&&Z.name&&!isAliasRecord(ot)&&m(Z.name)),st.children){const pt=st.children;for(let gt=0;gt<pt.length;gt++)d(pt[gt],ot,tt&&tt.children[gt])}tt=tt||ot,$(ot)}return lt?()=>{m(lt)}:noop$2}function m(Z){if(isRouteName(Z)){const et=s.get(Z);et&&(s.delete(Z),o.splice(o.indexOf(et),1),et.children.forEach(m),et.alias.forEach(m))}else{const et=o.indexOf(Z);et>-1&&(o.splice(et,1),Z.record.name&&s.delete(Z.record.name),Z.children.forEach(m),Z.alias.forEach(m))}}function _(){return o}function $(Z){let et=0;for(;et<o.length&&comparePathParserScore(Z,o[et])>=0&&(Z.record.path!==o[et].record.path||!isRecordChildOf(Z,o[et]));)et++;o.splice(et,0,Z),Z.record.name&&!isAliasRecord(Z)&&s.set(Z.record.name,Z)}function G(Z,et){let tt,nt={},st,rt;if("name"in Z&&Z.name){if(tt=s.get(Z.name),!tt)throw createRouterError(1,{location:Z});rt=tt.record.name,nt=assign(paramsFromLocation(et.params,tt.keys.filter(lt=>!lt.optional).map(lt=>lt.name)),Z.params&&paramsFromLocation(Z.params,tt.keys.map(lt=>lt.name))),st=tt.stringify(nt)}else if("path"in Z)st=Z.path,tt=o.find(lt=>lt.re.test(st)),tt&&(nt=tt.parse(st),rt=tt.record.name);else{if(tt=et.name?s.get(et.name):o.find(lt=>lt.re.test(et.path)),!tt)throw createRouterError(1,{location:Z,currentLocation:et});rt=tt.record.name,nt=assign({},et.params,Z.params),st=tt.stringify(nt)}const it=[];let ot=tt;for(;ot;)it.unshift(ot.record),ot=ot.parent;return{name:rt,path:st,params:nt,matched:it,meta:mergeMetaFields(it)}}return i.forEach(Z=>d(Z)),{addRoute:d,resolve:G,removeRoute:m,getRoutes:_,getRecordMatcher:f}}function paramsFromLocation(i,e){const o={};for(const s of e)s in i&&(o[s]=i[s]);return o}function normalizeRouteRecord(i){return{path:i.path,redirect:i.redirect,name:i.name,meta:i.meta||{},aliasOf:void 0,beforeEnter:i.beforeEnter,props:normalizeRecordProps(i),children:i.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in i?i.components||null:i.component&&{default:i.component}}}function normalizeRecordProps(i){const e={},o=i.props||!1;if("component"in i)e.default=o;else for(const s in i.components)e[s]=typeof o=="boolean"?o:o[s];return e}function isAliasRecord(i){for(;i;){if(i.record.aliasOf)return!0;i=i.parent}return!1}function mergeMetaFields(i){return i.reduce((e,o)=>assign(e,o.meta),{})}function mergeOptions(i,e){const o={};for(const s in i)o[s]=s in e?e[s]:i[s];return o}function isRecordChildOf(i,e){return e.children.some(o=>o===i||isRecordChildOf(i,o))}const HASH_RE=/#/g,AMPERSAND_RE=/&/g,SLASH_RE=/\//g,EQUAL_RE=/=/g,IM_RE=/\?/g,PLUS_RE=/\+/g,ENC_BRACKET_OPEN_RE=/%5B/g,ENC_BRACKET_CLOSE_RE=/%5D/g,ENC_CARET_RE=/%5E/g,ENC_BACKTICK_RE=/%60/g,ENC_CURLY_OPEN_RE=/%7B/g,ENC_PIPE_RE=/%7C/g,ENC_CURLY_CLOSE_RE=/%7D/g,ENC_SPACE_RE=/%20/g;function commonEncode(i){return encodeURI(""+i).replace(ENC_PIPE_RE,"|").replace(ENC_BRACKET_OPEN_RE,"[").replace(ENC_BRACKET_CLOSE_RE,"]")}function encodeHash(i){return commonEncode(i).replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryValue(i){return commonEncode(i).replace(PLUS_RE,"%2B").replace(ENC_SPACE_RE,"+").replace(HASH_RE,"%23").replace(AMPERSAND_RE,"%26").replace(ENC_BACKTICK_RE,"`").replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryKey(i){return encodeQueryValue(i).replace(EQUAL_RE,"%3D")}function encodePath(i){return commonEncode(i).replace(HASH_RE,"%23").replace(IM_RE,"%3F")}function encodeParam(i){return i==null?"":encodePath(i).replace(SLASH_RE,"%2F")}function decode$1(i){try{return decodeURIComponent(""+i)}catch{}return""+i}function parseQuery(i){const e={};if(i===""||i==="?")return e;const s=(i[0]==="?"?i.slice(1):i).split("&");for(let f=0;f<s.length;++f){const d=s[f].replace(PLUS_RE," "),m=d.indexOf("="),_=decode$1(m<0?d:d.slice(0,m)),$=m<0?null:decode$1(d.slice(m+1));if(_ in e){let G=e[_];isArray(G)||(G=e[_]=[G]),G.push($)}else e[_]=$}return e}function stringifyQuery(i){let e="";for(let o in i){const s=i[o];if(o=encodeQueryKey(o),s==null){s!==void 0&&(e+=(e.length?"&":"")+o);continue}(isArray(s)?s.map(d=>d&&encodeQueryValue(d)):[s&&encodeQueryValue(s)]).forEach(d=>{d!==void 0&&(e+=(e.length?"&":"")+o,d!=null&&(e+="="+d))})}return e}function normalizeQuery(i){const e={};for(const o in i){const s=i[o];s!==void 0&&(e[o]=isArray(s)?s.map(f=>f==null?null:""+f):s==null?s:""+s)}return e}const matchedRouteKey=Symbol(""),viewDepthKey=Symbol(""),routerKey=Symbol(""),routeLocationKey=Symbol(""),routerViewLocationKey=Symbol("");function useCallbacks(){let i=[];function e(s){return i.push(s),()=>{const f=i.indexOf(s);f>-1&&i.splice(f,1)}}function o(){i=[]}return{add:e,list:()=>i,reset:o}}function guardToPromiseFn(i,e,o,s,f){const d=s&&(s.enterCallbacks[f]=s.enterCallbacks[f]||[]);return()=>new Promise((m,_)=>{const $=et=>{et===!1?_(createRouterError(4,{from:o,to:e})):et instanceof Error?_(et):isRouteLocation(et)?_(createRouterError(2,{from:e,to:et})):(d&&s.enterCallbacks[f]===d&&typeof et=="function"&&d.push(et),m())},G=i.call(s&&s.instances[f],e,o,$);let Z=Promise.resolve(G);i.length<3&&(Z=Z.then($)),Z.catch(et=>_(et))})}function extractComponentsGuards(i,e,o,s){const f=[];for(const d of i)for(const m in d.components){let _=d.components[m];if(!(e!=="beforeRouteEnter"&&!d.instances[m]))if(isRouteComponent(_)){const G=(_.__vccOpts||_)[e];G&&f.push(guardToPromiseFn(G,o,s,d,m))}else{let $=_();f.push(()=>$.then(G=>{if(!G)return Promise.reject(new Error(`Couldn't resolve component "${m}" at "${d.path}"`));const Z=isESModule(G)?G.default:G;d.components[m]=Z;const tt=(Z.__vccOpts||Z)[e];return tt&&guardToPromiseFn(tt,o,s,d,m)()}))}}return f}function isRouteComponent(i){return typeof i=="object"||"displayName"in i||"props"in i||"__vccOpts"in i}function useLink(i){const e=inject(routerKey),o=inject(routeLocationKey),s=computed(()=>e.resolve(unref(i.to))),f=computed(()=>{const{matched:$}=s.value,{length:G}=$,Z=$[G-1],et=o.matched;if(!Z||!et.length)return-1;const tt=et.findIndex(isSameRouteRecord.bind(null,Z));if(tt>-1)return tt;const nt=getOriginalPath($[G-2]);return G>1&&getOriginalPath(Z)===nt&&et[et.length-1].path!==nt?et.findIndex(isSameRouteRecord.bind(null,$[G-2])):tt}),d=computed(()=>f.value>-1&&includesParams(o.params,s.value.params)),m=computed(()=>f.value>-1&&f.value===o.matched.length-1&&isSameRouteLocationParams(o.params,s.value.params));function _($={}){return guardEvent($)?e[unref(i.replace)?"replace":"push"](unref(i.to)).catch(noop$2):Promise.resolve()}return{route:s,href:computed(()=>s.value.href),isActive:d,isExactActive:m,navigate:_}}const RouterLinkImpl=defineComponent({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink,setup(i,{slots:e}){const o=reactive(useLink(i)),{options:s}=inject(routerKey),f=computed(()=>({[getLinkClass(i.activeClass,s.linkActiveClass,"router-link-active")]:o.isActive,[getLinkClass(i.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:o.isExactActive}));return()=>{const d=e.default&&e.default(o);return i.custom?d:h("a",{"aria-current":o.isExactActive?i.ariaCurrentValue:null,href:o.href,onClick:o.navigate,class:f.value},d)}}}),RouterLink=RouterLinkImpl;function guardEvent(i){if(!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&!i.defaultPrevented&&!(i.button!==void 0&&i.button!==0)){if(i.currentTarget&&i.currentTarget.getAttribute){const e=i.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return i.preventDefault&&i.preventDefault(),!0}}function includesParams(i,e){for(const o in e){const s=e[o],f=i[o];if(typeof s=="string"){if(s!==f)return!1}else if(!isArray(f)||f.length!==s.length||s.some((d,m)=>d!==f[m]))return!1}return!0}function getOriginalPath(i){return i?i.aliasOf?i.aliasOf.path:i.path:""}const getLinkClass=(i,e,o)=>i!=null?i:e!=null?e:o,RouterViewImpl=defineComponent({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(i,{attrs:e,slots:o}){const s=inject(routerViewLocationKey),f=computed(()=>i.route||s.value),d=inject(viewDepthKey,0),m=computed(()=>{let G=unref(d);const{matched:Z}=f.value;let et;for(;(et=Z[G])&&!et.components;)G++;return G}),_=computed(()=>f.value.matched[m.value]);provide(viewDepthKey,computed(()=>m.value+1)),provide(matchedRouteKey,_),provide(routerViewLocationKey,f);const $=ref();return watch(()=>[$.value,_.value,i.name],([G,Z,et],[tt,nt,st])=>{Z&&(Z.instances[et]=G,nt&&nt!==Z&&G&&G===tt&&(Z.leaveGuards.size||(Z.leaveGuards=nt.leaveGuards),Z.updateGuards.size||(Z.updateGuards=nt.updateGuards))),G&&Z&&(!nt||!isSameRouteRecord(Z,nt)||!tt)&&(Z.enterCallbacks[et]||[]).forEach(rt=>rt(G))},{flush:"post"}),()=>{const G=f.value,Z=i.name,et=_.value,tt=et&&et.components[Z];if(!tt)return normalizeSlot(o.default,{Component:tt,route:G});const nt=et.props[Z],st=nt?nt===!0?G.params:typeof nt=="function"?nt(G):nt:null,it=h(tt,assign({},st,e,{onVnodeUnmounted:ot=>{ot.component.isUnmounted&&(et.instances[Z]=null)},ref:$}));return normalizeSlot(o.default,{Component:it,route:G})||it}}});function normalizeSlot(i,e){if(!i)return null;const o=i(e);return o.length===1?o[0]:o}const RouterView=RouterViewImpl;function createRouter(i){const e=createRouterMatcher(i.routes,i),o=i.parseQuery||parseQuery,s=i.stringifyQuery||stringifyQuery,f=i.history,d=useCallbacks(),m=useCallbacks(),_=useCallbacks(),$=shallowRef(START_LOCATION_NORMALIZED);let G=START_LOCATION_NORMALIZED;isBrowser&&i.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const Z=applyToParams.bind(null,It=>""+It),et=applyToParams.bind(null,encodeParam),tt=applyToParams.bind(null,decode$1);function nt(It,$t){let xt,Kt;return isRouteName(It)?(xt=e.getRecordMatcher(It),Kt=$t):Kt=It,e.addRoute(Kt,xt)}function st(It){const $t=e.getRecordMatcher(It);$t&&e.removeRoute($t)}function rt(){return e.getRoutes().map(It=>It.record)}function it(It){return!!e.getRecordMatcher(It)}function ot(It,$t){if($t=assign({},$t||$.value),typeof It=="string"){const ht=parseURL(o,It,$t.path),dt=e.resolve({path:ht.path},$t),St=f.createHref(ht.fullPath);return assign(ht,dt,{params:tt(dt.params),hash:decode$1(ht.hash),redirectedFrom:void 0,href:St})}let xt;if("path"in It)xt=assign({},It,{path:parseURL(o,It.path,$t.path).path});else{const ht=assign({},It.params);for(const dt in ht)ht[dt]==null&&delete ht[dt];xt=assign({},It,{params:et(It.params)}),$t.params=et($t.params)}const Kt=e.resolve(xt,$t),nn=It.hash||"";Kt.params=Z(tt(Kt.params));const cn=stringifyURL(s,assign({},It,{hash:encodeHash(nn),path:Kt.path})),Jt=f.createHref(cn);return assign({fullPath:cn,hash:nn,query:s===stringifyQuery?normalizeQuery(It.query):It.query||{}},Kt,{redirectedFrom:void 0,href:Jt})}function lt(It){return typeof It=="string"?parseURL(o,It,$.value.path):assign({},It)}function ft(It,$t){if(G!==It)return createRouterError(8,{from:$t,to:It})}function ct(It){return Tt(It)}function pt(It){return ct(assign(lt(It),{replace:!0}))}function gt(It){const $t=It.matched[It.matched.length-1];if($t&&$t.redirect){const{redirect:xt}=$t;let Kt=typeof xt=="function"?xt(It):xt;return typeof Kt=="string"&&(Kt=Kt.includes("?")||Kt.includes("#")?Kt=lt(Kt):{path:Kt},Kt.params={}),assign({query:It.query,hash:It.hash,params:"path"in Kt?{}:It.params},Kt)}}function Tt(It,$t){const xt=G=ot(It),Kt=$.value,nn=It.state,cn=It.force,Jt=It.replace===!0,ht=gt(xt);if(ht)return Tt(assign(lt(ht),{state:typeof ht=="object"?assign({},nn,ht.state):nn,force:cn,replace:Jt}),$t||xt);const dt=xt;dt.redirectedFrom=$t;let St;return!cn&&isSameRouteLocation(s,Kt,xt)&&(St=createRouterError(16,{to:dt,from:Kt}),ln(Kt,Kt,!0,!1)),(St?Promise.resolve(St):Mt(dt,Kt)).catch(Ct=>isNavigationFailure(Ct)?isNavigationFailure(Ct,2)?Ct:Ht(Ct):Bt(Ct,dt,Kt)).then(Ct=>{if(Ct){if(isNavigationFailure(Ct,2))return Tt(assign({replace:Jt},lt(Ct.to),{state:typeof Ct.to=="object"?assign({},nn,Ct.to.state):nn,force:cn}),$t||dt)}else Ct=yt(dt,Kt,!0,Jt,nn);return vt(dt,Kt,Ct),Ct})}function Et(It,$t){const xt=ft(It,$t);return xt?Promise.reject(xt):Promise.resolve()}function Mt(It,$t){let xt;const[Kt,nn,cn]=extractChangingRecords(It,$t);xt=extractComponentsGuards(Kt.reverse(),"beforeRouteLeave",It,$t);for(const ht of Kt)ht.leaveGuards.forEach(dt=>{xt.push(guardToPromiseFn(dt,It,$t))});const Jt=Et.bind(null,It,$t);return xt.push(Jt),runGuardQueue(xt).then(()=>{xt=[];for(const ht of d.list())xt.push(guardToPromiseFn(ht,It,$t));return xt.push(Jt),runGuardQueue(xt)}).then(()=>{xt=extractComponentsGuards(nn,"beforeRouteUpdate",It,$t);for(const ht of nn)ht.updateGuards.forEach(dt=>{xt.push(guardToPromiseFn(dt,It,$t))});return xt.push(Jt),runGuardQueue(xt)}).then(()=>{xt=[];for(const ht of It.matched)if(ht.beforeEnter&&!$t.matched.includes(ht))if(isArray(ht.beforeEnter))for(const dt of ht.beforeEnter)xt.push(guardToPromiseFn(dt,It,$t));else xt.push(guardToPromiseFn(ht.beforeEnter,It,$t));return xt.push(Jt),runGuardQueue(xt)}).then(()=>(It.matched.forEach(ht=>ht.enterCallbacks={}),xt=extractComponentsGuards(cn,"beforeRouteEnter",It,$t),xt.push(Jt),runGuardQueue(xt))).then(()=>{xt=[];for(const ht of m.list())xt.push(guardToPromiseFn(ht,It,$t));return xt.push(Jt),runGuardQueue(xt)}).catch(ht=>isNavigationFailure(ht,8)?ht:Promise.reject(ht))}function vt(It,$t,xt){for(const Kt of _.list())Kt(It,$t,xt)}function yt(It,$t,xt,Kt,nn){const cn=ft(It,$t);if(cn)return cn;const Jt=$t===START_LOCATION_NORMALIZED,ht=isBrowser?history.state:{};xt&&(Kt||Jt?f.replace(It.fullPath,assign({scroll:Jt&&ht&&ht.scroll},nn)):f.push(It.fullPath,nn)),$.value=It,ln(It,$t,xt,Jt),Ht()}let bt;function Pt(){bt||(bt=f.listen((It,$t,xt)=>{if(!_n.listening)return;const Kt=ot(It),nn=gt(Kt);if(nn){Tt(assign(nn,{replace:!0}),Kt).catch(noop$2);return}G=Kt;const cn=$.value;isBrowser&&saveScrollPosition(getScrollKey(cn.fullPath,xt.delta),computeScrollPosition()),Mt(Kt,cn).catch(Jt=>isNavigationFailure(Jt,12)?Jt:isNavigationFailure(Jt,2)?(Tt(Jt.to,Kt).then(ht=>{isNavigationFailure(ht,20)&&!xt.delta&&xt.type===NavigationType.pop&&f.go(-1,!1)}).catch(noop$2),Promise.reject()):(xt.delta&&f.go(-xt.delta,!1),Bt(Jt,Kt,cn))).then(Jt=>{Jt=Jt||yt(Kt,cn,!1),Jt&&(xt.delta&&!isNavigationFailure(Jt,8)?f.go(-xt.delta,!1):xt.type===NavigationType.pop&&isNavigationFailure(Jt,20)&&f.go(-1,!1)),vt(Kt,cn,Jt)}).catch(noop$2)}))}let wt=useCallbacks(),At=useCallbacks(),Ft;function Bt(It,$t,xt){Ht(It);const Kt=At.list();return Kt.length?Kt.forEach(nn=>nn(It,$t,xt)):console.error(It),Promise.reject(It)}function zt(){return Ft&&$.value!==START_LOCATION_NORMALIZED?Promise.resolve():new Promise((It,$t)=>{wt.add([It,$t])})}function Ht(It){return Ft||(Ft=!It,Pt(),wt.list().forEach(([$t,xt])=>It?xt(It):$t()),wt.reset()),It}function ln(It,$t,xt,Kt){const{scrollBehavior:nn}=i;if(!isBrowser||!nn)return Promise.resolve();const cn=!xt&&getSavedScrollPosition(getScrollKey(It.fullPath,0))||(Kt||!xt)&&history.state&&history.state.scroll||null;return nextTick().then(()=>nn(It,$t,cn)).then(Jt=>Jt&&scrollToPosition(Jt)).catch(Jt=>Bt(Jt,It,$t))}const gn=It=>f.go(It);let Zt;const En=new Set,_n={currentRoute:$,listening:!0,addRoute:nt,removeRoute:st,hasRoute:it,getRoutes:rt,resolve:ot,options:i,push:ct,replace:pt,go:gn,back:()=>gn(-1),forward:()=>gn(1),beforeEach:d.add,beforeResolve:m.add,afterEach:_.add,onError:At.add,isReady:zt,install(It){const $t=this;It.component("RouterLink",RouterLink),It.component("RouterView",RouterView),It.config.globalProperties.$router=$t,Object.defineProperty(It.config.globalProperties,"$route",{enumerable:!0,get:()=>unref($)}),isBrowser&&!Zt&&$.value===START_LOCATION_NORMALIZED&&(Zt=!0,ct(f.location).catch(nn=>{}));const xt={};for(const nn in START_LOCATION_NORMALIZED)xt[nn]=computed(()=>$.value[nn]);It.provide(routerKey,$t),It.provide(routeLocationKey,reactive(xt)),It.provide(routerViewLocationKey,$);const Kt=It.unmount;En.add(It),It.unmount=function(){En.delete(It),En.size<1&&(G=START_LOCATION_NORMALIZED,bt&&bt(),bt=null,$.value=START_LOCATION_NORMALIZED,Zt=!1,Ft=!1),Kt()}}};return _n}function runGuardQueue(i){return i.reduce((e,o)=>e.then(()=>o()),Promise.resolve())}function extractChangingRecords(i,e){const o=[],s=[],f=[],d=Math.max(e.matched.length,i.matched.length);for(let m=0;m<d;m++){const _=e.matched[m];_&&(i.matched.find(G=>isSameRouteRecord(G,_))?s.push(_):o.push(_));const $=i.matched[m];$&&(e.matched.find(G=>isSameRouteRecord(G,$))||f.push($))}return[o,s,f]}const _hoisted_1$8={class:"container"},_hoisted_2$7=createBaseVNode("h1",{class:"welcome"},"Welcome To Quote Heaven",-1),_sfc_main$8={__name:"App",setup(i){return(e,o)=>(openBlock(),createElementBlock("div",_hoisted_1$8,[_hoisted_2$7,createVNode(unref(RouterView))]))}},_imports_0="/Vue_Test_Task/assets/load.ce9505ef.gif";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getAugmentedNamespace(i){var e=i.default;if(typeof e=="function"){var o=function(){return e.apply(this,arguments)};o.prototype=e.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var f=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(o,s,f.get?f:{enumerable:!0,get:function(){return i[s]}})}),o}var setTimeoutFunc=setTimeout;function noop$1(){}function bind(i,e){return function(){i.apply(e,arguments)}}function Promise$1(i){if(!(this instanceof Promise$1))throw new TypeError("Promises must be constructed via new");if(typeof i!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(i,this)}function handle(i,e){for(;i._state===3;)i=i._value;if(i._state===0){i._deferreds.push(e);return}i._handled=!0,Promise$1._immediateFn(function(){var o=i._state===1?e.onFulfilled:e.onRejected;if(o===null){(i._state===1?resolve$1:reject$1)(e.promise,i._value);return}var s;try{s=o(i._value)}catch(f){reject$1(e.promise,f);return}resolve$1(e.promise,s)})}function resolve$1(i,e){try{if(e===i)throw new TypeError("A promise cannot be resolved with itself.");if(e&&(typeof e=="object"||typeof e=="function")){var o=e.then;if(e instanceof Promise$1){i._state=3,i._value=e,finale(i);return}else if(typeof o=="function"){doResolve(bind(o,e),i);return}}i._state=1,i._value=e,finale(i)}catch(s){reject$1(i,s)}}function reject$1(i,e){i._state=2,i._value=e,finale(i)}function finale(i){i._state===2&&i._deferreds.length===0&&Promise$1._immediateFn(function(){i._handled||Promise$1._unhandledRejectionFn(i._value)});for(var e=0,o=i._deferreds.length;e<o;e++)handle(i,i._deferreds[e]);i._deferreds=null}function Handler(i,e,o){this.onFulfilled=typeof i=="function"?i:null,this.onRejected=typeof e=="function"?e:null,this.promise=o}function doResolve(i,e){var o=!1;try{i(function(s){o||(o=!0,resolve$1(e,s))},function(s){o||(o=!0,reject$1(e,s))})}catch(s){if(o)return;o=!0,reject$1(e,s)}}Promise$1.prototype.catch=function(i){return this.then(null,i)};Promise$1.prototype.then=function(i,e){var o=new this.constructor(noop$1);return handle(this,new Handler(i,e,o)),o};Promise$1.prototype.finally=function(i){var e=this.constructor;return this.then(function(o){return e.resolve(i()).then(function(){return o})},function(o){return e.resolve(i()).then(function(){return e.reject(o)})})};Promise$1.all=function(i){return new Promise$1(function(e,o){if(!i||typeof i.length>"u")throw new TypeError("Promise.all accepts an array");var s=Array.prototype.slice.call(i);if(s.length===0)return e([]);var f=s.length;function d(_,$){try{if($&&(typeof $=="object"||typeof $=="function")){var G=$.then;if(typeof G=="function"){G.call($,function(Z){d(_,Z)},o);return}}s[_]=$,--f===0&&e(s)}catch(Z){o(Z)}}for(var m=0;m<s.length;m++)d(m,s[m])})};Promise$1.resolve=function(i){return i&&typeof i=="object"&&i.constructor===Promise$1?i:new Promise$1(function(e){e(i)})};Promise$1.reject=function(i){return new Promise$1(function(e,o){o(i)})};Promise$1.race=function(i){return new Promise$1(function(e,o){for(var s=0,f=i.length;s<f;s++)i[s].then(e,o)})};Promise$1._immediateFn=typeof setImmediate=="function"&&function(i){setImmediate(i)}||function(i){setTimeoutFunc(i,0)};Promise$1._unhandledRejectionFn=function(e){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};const src=Object.freeze(Object.defineProperty({__proto__:null,default:Promise$1},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(src);var __global=function(){if(typeof commonjsGlobal<"u")return commonjsGlobal;if(typeof window<"u")return window;if(typeof self<"u")return self;throw new Error("unable to locate global object")}();typeof Promise>"u"&&(__global.Promise=Promise=require$$0$1);Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(i){if(this==null)throw new TypeError('"this" is null or not defined');var e=Object(this),o=e.length>>>0;if(typeof i!="function")throw new TypeError("predicate must be a function");for(var s=arguments[1],f=0;f<o;){var d=e[f];if(i.call(s,d,f,e))return d;f++}}});Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(i){if(this==null)throw new TypeError('"this" is null or not defined');var e=Object(this),o=e.length>>>0;if(typeof i!="function")throw new TypeError("predicate must be a function");for(var s=arguments[1],f=0;f<o;){var d=e[f];if(i.call(s,d,f,e))return f;f++}return-1}});String.prototype.startsWith||(String.prototype.startsWith=function(i,e){return this.substr(!e||e<0?0:+e,i.length)===i});var cjs$1={},assert$1={},constants={};Object.defineProperty(constants,"__esModule",{value:!0});constants.CONSTANTS={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=constants;i.assert=function(o,s){if(!o)throw i.assertionError(s)},i.assertionError=function(o){return new Error("Firebase Database ("+e.CONSTANTS.SDK_VERSION+") INTERNAL ASSERT FAILED: "+o)}})(assert$1);var crypt={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=function(s){for(var f=[],d=0,m=0;m<s.length;m++){var _=s.charCodeAt(m);_<128?f[d++]=_:_<2048?(f[d++]=_>>6|192,f[d++]=_&63|128):(_&64512)==55296&&m+1<s.length&&(s.charCodeAt(m+1)&64512)==56320?(_=65536+((_&1023)<<10)+(s.charCodeAt(++m)&1023),f[d++]=_>>18|240,f[d++]=_>>12&63|128,f[d++]=_>>6&63|128,f[d++]=_&63|128):(f[d++]=_>>12|224,f[d++]=_>>6&63|128,f[d++]=_&63|128)}return f},o=function(s){for(var f=[],d=0,m=0;d<s.length;){var _=s[d++];if(_<128)f[m++]=String.fromCharCode(_);else if(_>191&&_<224){var $=s[d++];f[m++]=String.fromCharCode((_&31)<<6|$&63)}else if(_>239&&_<365){var $=s[d++],G=s[d++],Z=s[d++],et=((_&7)<<18|($&63)<<12|(G&63)<<6|Z&63)-65536;f[m++]=String.fromCharCode(55296+(et>>10)),f[m++]=String.fromCharCode(56320+(et&1023))}else{var $=s[d++],G=s[d++];f[m++]=String.fromCharCode((_&15)<<12|($&63)<<6|G&63)}}return f.join("")};i.base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray:function(s,f){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var d=f?this.byteToCharMapWebSafe_:this.byteToCharMap_,m=[],_=0;_<s.length;_+=3){var $=s[_],G=_+1<s.length,Z=G?s[_+1]:0,et=_+2<s.length,tt=et?s[_+2]:0,nt=$>>2,st=($&3)<<4|Z>>4,rt=(Z&15)<<2|tt>>6,it=tt&63;et||(it=64,G||(rt=64)),m.push(d[nt],d[st],d[rt],d[it])}return m.join("")},encodeString:function(s,f){return this.HAS_NATIVE_SUPPORT&&!f?btoa(s):this.encodeByteArray(e(s),f)},decodeString:function(s,f){return this.HAS_NATIVE_SUPPORT&&!f?atob(s):o(this.decodeStringToByteArray(s,f))},decodeStringToByteArray:function(s,f){this.init_();for(var d=f?this.charToByteMapWebSafe_:this.charToByteMap_,m=[],_=0;_<s.length;){var $=d[s.charAt(_++)],G=_<s.length,Z=G?d[s.charAt(_)]:0;++_;var et=_<s.length,tt=et?d[s.charAt(_)]:64;++_;var nt=_<s.length,st=nt?d[s.charAt(_)]:64;if(++_,$==null||Z==null||tt==null||st==null)throw Error();var rt=$<<2|Z>>4;if(m.push(rt),tt!=64){var it=Z<<4&240|tt>>2;if(m.push(it),st!=64){var ot=tt<<6&192|st;m.push(ot)}}}return m},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}},i.base64Encode=function(s){var f=e(s);return i.base64.encodeByteArray(f,!0)},i.base64Decode=function(s){try{return i.base64.decodeString(s,!0)}catch(f){console.error("base64Decode failed: ",f)}return null}})(crypt);var deepCopy$2={};Object.defineProperty(deepCopy$2,"__esModule",{value:!0});function deepCopy$1(i){return deepExtend$1(void 0,i)}deepCopy$2.deepCopy=deepCopy$1;function deepExtend$1(i,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:var o=e;return new Date(o.getTime());case Object:i===void 0&&(i={});break;case Array:i=[];break;default:return e}for(var s in e)!e.hasOwnProperty(s)||(i[s]=deepExtend$1(i[s],e[s]));return i}deepCopy$2.deepExtend=deepExtend$1;function patchProperty$1(i,e,o){i[e]=o}deepCopy$2.patchProperty=patchProperty$1;var deferred={};Object.defineProperty(deferred,"__esModule",{value:!0});var Deferred$1=function(){function i(){var e=this;this.promise=new Promise(function(o,s){e.resolve=o,e.reject=s})}return i.prototype.wrapCallback=function(e){var o=this;return function(s,f){s?o.reject(s):o.resolve(f),typeof e=="function"&&(o.promise.catch(function(){}),e.length===1?e(s):e(s,f))}},i}();deferred.Deferred=Deferred$1;var environment={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=constants;i.getUA=function(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""},i.isMobileCordova=function(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(i.getUA())},i.isReactNative=function(){return typeof navigator=="object"&&navigator.product==="ReactNative"},i.isNodeSdk=function(){return e.CONSTANTS.NODE_CLIENT===!0||e.CONSTANTS.NODE_ADMIN===!0}})(environment);var errors$1={};Object.defineProperty(errors$1,"__esModule",{value:!0});var ERROR_NAME="FirebaseError",captureStackTrace=Error.captureStackTrace;function patchCapture(i){var e=captureStackTrace;return captureStackTrace=i,e}errors$1.patchCapture=patchCapture;var FirebaseError=function(){function i(e,o){if(this.code=e,this.message=o,captureStackTrace)captureStackTrace(this,ErrorFactory$1.prototype.create);else{var s=Error.apply(this,arguments);this.name=ERROR_NAME,Object.defineProperty(this,"stack",{get:function(){return s.stack}})}}return i}();errors$1.FirebaseError=FirebaseError;FirebaseError.prototype=Object.create(Error.prototype);FirebaseError.prototype.constructor=FirebaseError;FirebaseError.prototype.name=ERROR_NAME;var ErrorFactory$1=function(){function i(e,o,s){this.service=e,this.serviceName=o,this.errors=s,this.pattern=/\{\$([^}]+)}/g}return i.prototype.create=function(e,o){o===void 0&&(o={});var s=this.errors[e],f=this.service+"/"+e,d;s===void 0?d="Error":d=s.replace(this.pattern,function($,G){var Z=o[G];return Z!==void 0?Z.toString():"<"+G+"?>"}),d=this.serviceName+": "+d+" ("+f+").";var m=new FirebaseError(f,d);for(var _ in o)!o.hasOwnProperty(_)||_.slice(-1)==="_"||(m[_]=o[_]);return m},i}();errors$1.ErrorFactory=ErrorFactory$1;var json={};Object.defineProperty(json,"__esModule",{value:!0});function jsonEval(i){return JSON.parse(i)}json.jsonEval=jsonEval;function stringify(i){return JSON.stringify(i)}json.stringify=stringify;var jwt={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=crypt,o=json;i.decode=function(s){var f={},d={},m={},_="";try{var $=s.split(".");f=o.jsonEval(e.base64Decode($[0])||""),d=o.jsonEval(e.base64Decode($[1])||""),_=$[2],m=d.d||{},delete d.d}catch{}return{header:f,claims:d,data:m,signature:_}},i.isValidTimestamp=function(s){var f=i.decode(s).claims,d=Math.floor(new Date().getTime()/1e3),m,_;return typeof f=="object"&&(f.hasOwnProperty("nbf")?m=f.nbf:f.hasOwnProperty("iat")&&(m=f.iat),f.hasOwnProperty("exp")?_=f.exp:_=m+86400),d&&m&&_&&d>=m&&d<=_},i.issuedAtTime=function(s){var f=i.decode(s).claims;return typeof f=="object"&&f.hasOwnProperty("iat")?f.iat:null},i.isValidFormat=function(s){var f=i.decode(s),d=f.claims;return!!f.signature&&!!d&&typeof d=="object"&&d.hasOwnProperty("iat")},i.isAdmin=function(s){var f=i.decode(s).claims;return typeof f=="object"&&f.admin===!0}})(jwt);var obj={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.contains=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},i.safeGet=function(e,o){if(Object.prototype.hasOwnProperty.call(e,o))return e[o]},i.forEach=function(e,o){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&o(s,e[s])},i.extend=function(e,o){return i.forEach(o,function(s,f){e[s]=f}),e},i.clone=function(e){return i.extend({},e)},i.isNonNullObject=function(e){return typeof e=="object"&&e!==null},i.isEmpty=function(e){for(var o in e)return!1;return!0},i.getCount=function(e){var o=0;for(var s in e)o++;return o},i.map=function(e,o,s){var f={};for(var d in e)f[d]=o.call(s,e[d],d,e);return f},i.findKey=function(e,o,s){for(var f in e)if(o.call(s,e[f],f,e))return f},i.findValue=function(e,o,s){var f=i.findKey(e,o,s);return f&&e[f]},i.getAnyKey=function(e){for(var o in e)return o},i.getValues=function(e){var o=[],s=0;for(var f in e)o[s++]=e[f];return o},i.every=function(e,o){for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&!o(s,e[s]))return!1;return!0}})(obj);var query={};Object.defineProperty(query,"__esModule",{value:!0});var obj_1$1=obj;query.querystring=function(i){var e=[];return obj_1$1.forEach(i,function(o,s){Array.isArray(s)?s.forEach(function(f){e.push(encodeURIComponent(o)+"="+encodeURIComponent(f))}):e.push(encodeURIComponent(o)+"="+encodeURIComponent(s))}),e.length?"&"+e.join("&"):""};query.querystringDecode=function(i){var e={},o=i.replace(/^\?/,"").split("&");return o.forEach(function(s){if(s){var f=s.split("=");e[f[0]]=f[1]}}),e};var sha1={},tslib={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(i){var e,o,s,f,d,m,_,$,G,Z,et,tt,nt,st,rt,it,ot,lt,ft,ct,pt,gt,Tt;(function(Et){var Mt=typeof commonjsGlobal=="object"?commonjsGlobal:typeof self=="object"?self:typeof this=="object"?this:{};Et(vt(Mt,vt(i.exports)));function vt(yt,bt){return yt!==Mt&&(typeof Object.create=="function"?Object.defineProperty(yt,"__esModule",{value:!0}):yt.__esModule=!0),function(Pt,wt){return yt[Pt]=bt?bt(Pt,wt):wt}}})(function(Et){var Mt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(vt,yt){vt.__proto__=yt}||function(vt,yt){for(var bt in yt)yt.hasOwnProperty(bt)&&(vt[bt]=yt[bt])};e=function(vt,yt){Mt(vt,yt);function bt(){this.constructor=vt}vt.prototype=yt===null?Object.create(yt):(bt.prototype=yt.prototype,new bt)},o=Object.assign||function(vt){for(var yt,bt=1,Pt=arguments.length;bt<Pt;bt++){yt=arguments[bt];for(var wt in yt)Object.prototype.hasOwnProperty.call(yt,wt)&&(vt[wt]=yt[wt])}return vt},s=function(vt,yt){var bt={};for(var Pt in vt)Object.prototype.hasOwnProperty.call(vt,Pt)&&yt.indexOf(Pt)<0&&(bt[Pt]=vt[Pt]);if(vt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var wt=0,Pt=Object.getOwnPropertySymbols(vt);wt<Pt.length;wt++)yt.indexOf(Pt[wt])<0&&Object.prototype.propertyIsEnumerable.call(vt,Pt[wt])&&(bt[Pt[wt]]=vt[Pt[wt]]);return bt},f=function(vt,yt,bt,Pt){var wt=arguments.length,At=wt<3?yt:Pt===null?Pt=Object.getOwnPropertyDescriptor(yt,bt):Pt,Ft;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")At=Reflect.decorate(vt,yt,bt,Pt);else for(var Bt=vt.length-1;Bt>=0;Bt--)(Ft=vt[Bt])&&(At=(wt<3?Ft(At):wt>3?Ft(yt,bt,At):Ft(yt,bt))||At);return wt>3&&At&&Object.defineProperty(yt,bt,At),At},d=function(vt,yt){return function(bt,Pt){yt(bt,Pt,vt)}},m=function(vt,yt){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(vt,yt)},_=function(vt,yt,bt,Pt){function wt(At){return At instanceof bt?At:new bt(function(Ft){Ft(At)})}return new(bt||(bt=Promise))(function(At,Ft){function Bt(ln){try{Ht(Pt.next(ln))}catch(gn){Ft(gn)}}function zt(ln){try{Ht(Pt.throw(ln))}catch(gn){Ft(gn)}}function Ht(ln){ln.done?At(ln.value):wt(ln.value).then(Bt,zt)}Ht((Pt=Pt.apply(vt,yt||[])).next())})},$=function(vt,yt){var bt={label:0,sent:function(){if(At[0]&1)throw At[1];return At[1]},trys:[],ops:[]},Pt,wt,At,Ft;return Ft={next:Bt(0),throw:Bt(1),return:Bt(2)},typeof Symbol=="function"&&(Ft[Symbol.iterator]=function(){return this}),Ft;function Bt(Ht){return function(ln){return zt([Ht,ln])}}function zt(Ht){if(Pt)throw new TypeError("Generator is already executing.");for(;bt;)try{if(Pt=1,wt&&(At=Ht[0]&2?wt.return:Ht[0]?wt.throw||((At=wt.return)&&At.call(wt),0):wt.next)&&!(At=At.call(wt,Ht[1])).done)return At;switch(wt=0,At&&(Ht=[Ht[0]&2,At.value]),Ht[0]){case 0:case 1:At=Ht;break;case 4:return bt.label++,{value:Ht[1],done:!1};case 5:bt.label++,wt=Ht[1],Ht=[0];continue;case 7:Ht=bt.ops.pop(),bt.trys.pop();continue;default:if(At=bt.trys,!(At=At.length>0&&At[At.length-1])&&(Ht[0]===6||Ht[0]===2)){bt=0;continue}if(Ht[0]===3&&(!At||Ht[1]>At[0]&&Ht[1]<At[3])){bt.label=Ht[1];break}if(Ht[0]===6&&bt.label<At[1]){bt.label=At[1],At=Ht;break}if(At&&bt.label<At[2]){bt.label=At[2],bt.ops.push(Ht);break}At[2]&&bt.ops.pop(),bt.trys.pop();continue}Ht=yt.call(vt,bt)}catch(ln){Ht=[6,ln],wt=0}finally{Pt=At=0}if(Ht[0]&5)throw Ht[1];return{value:Ht[0]?Ht[1]:void 0,done:!0}}},Tt=function(vt,yt,bt,Pt){Pt===void 0&&(Pt=bt),vt[Pt]=yt[bt]},G=function(vt,yt){for(var bt in vt)bt!=="default"&&!yt.hasOwnProperty(bt)&&(yt[bt]=vt[bt])},Z=function(vt){var yt=typeof Symbol=="function"&&Symbol.iterator,bt=yt&&vt[yt],Pt=0;if(bt)return bt.call(vt);if(vt&&typeof vt.length=="number")return{next:function(){return vt&&Pt>=vt.length&&(vt=void 0),{value:vt&&vt[Pt++],done:!vt}}};throw new TypeError(yt?"Object is not iterable.":"Symbol.iterator is not defined.")},et=function(vt,yt){var bt=typeof Symbol=="function"&&vt[Symbol.iterator];if(!bt)return vt;var Pt=bt.call(vt),wt,At=[],Ft;try{for(;(yt===void 0||yt-- >0)&&!(wt=Pt.next()).done;)At.push(wt.value)}catch(Bt){Ft={error:Bt}}finally{try{wt&&!wt.done&&(bt=Pt.return)&&bt.call(Pt)}finally{if(Ft)throw Ft.error}}return At},tt=function(){for(var vt=[],yt=0;yt<arguments.length;yt++)vt=vt.concat(et(arguments[yt]));return vt},nt=function(){for(var vt=0,yt=0,bt=arguments.length;yt<bt;yt++)vt+=arguments[yt].length;for(var Pt=Array(vt),wt=0,yt=0;yt<bt;yt++)for(var At=arguments[yt],Ft=0,Bt=At.length;Ft<Bt;Ft++,wt++)Pt[wt]=At[Ft];return Pt},st=function(vt){return this instanceof st?(this.v=vt,this):new st(vt)},rt=function(vt,yt,bt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Pt=bt.apply(vt,yt||[]),wt,At=[];return wt={},Ft("next"),Ft("throw"),Ft("return"),wt[Symbol.asyncIterator]=function(){return this},wt;function Ft(Zt){Pt[Zt]&&(wt[Zt]=function(En){return new Promise(function(_n,It){At.push([Zt,En,_n,It])>1||Bt(Zt,En)})})}function Bt(Zt,En){try{zt(Pt[Zt](En))}catch(_n){gn(At[0][3],_n)}}function zt(Zt){Zt.value instanceof st?Promise.resolve(Zt.value.v).then(Ht,ln):gn(At[0][2],Zt)}function Ht(Zt){Bt("next",Zt)}function ln(Zt){Bt("throw",Zt)}function gn(Zt,En){Zt(En),At.shift(),At.length&&Bt(At[0][0],At[0][1])}},it=function(vt){var yt,bt;return yt={},Pt("next"),Pt("throw",function(wt){throw wt}),Pt("return"),yt[Symbol.iterator]=function(){return this},yt;function Pt(wt,At){yt[wt]=vt[wt]?function(Ft){return(bt=!bt)?{value:st(vt[wt](Ft)),done:wt==="return"}:At?At(Ft):Ft}:At}},ot=function(vt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var yt=vt[Symbol.asyncIterator],bt;return yt?yt.call(vt):(vt=typeof Z=="function"?Z(vt):vt[Symbol.iterator](),bt={},Pt("next"),Pt("throw"),Pt("return"),bt[Symbol.asyncIterator]=function(){return this},bt);function Pt(At){bt[At]=vt[At]&&function(Ft){return new Promise(function(Bt,zt){Ft=vt[At](Ft),wt(Bt,zt,Ft.done,Ft.value)})}}function wt(At,Ft,Bt,zt){Promise.resolve(zt).then(function(Ht){At({value:Ht,done:Bt})},Ft)}},lt=function(vt,yt){return Object.defineProperty?Object.defineProperty(vt,"raw",{value:yt}):vt.raw=yt,vt},ft=function(vt){if(vt&&vt.__esModule)return vt;var yt={};if(vt!=null)for(var bt in vt)Object.hasOwnProperty.call(vt,bt)&&(yt[bt]=vt[bt]);return yt.default=vt,yt},ct=function(vt){return vt&&vt.__esModule?vt:{default:vt}},pt=function(vt,yt){if(!yt.has(vt))throw new TypeError("attempted to get private field on non-instance");return yt.get(vt)},gt=function(vt,yt,bt){if(!yt.has(vt))throw new TypeError("attempted to set private field on non-instance");return yt.set(vt,bt),bt},Et("__extends",e),Et("__assign",o),Et("__rest",s),Et("__decorate",f),Et("__param",d),Et("__metadata",m),Et("__awaiter",_),Et("__generator",$),Et("__exportStar",G),Et("__createBinding",Tt),Et("__values",Z),Et("__read",et),Et("__spread",tt),Et("__spreadArrays",nt),Et("__await",st),Et("__asyncGenerator",rt),Et("__asyncDelegator",it),Et("__asyncValues",ot),Et("__makeTemplateObject",lt),Et("__importStar",ft),Et("__importDefault",ct),Et("__classPrivateFieldGet",pt),Et("__classPrivateFieldSet",gt)})})(tslib);var hash={};Object.defineProperty(hash,"__esModule",{value:!0});var Hash=function(){function i(){this.blockSize=-1}return i}();hash.Hash=Hash;Object.defineProperty(sha1,"__esModule",{value:!0});var tslib_1$8=tslib.exports,hash_1=hash,Sha1=function(i){tslib_1$8.__extends(e,i);function e(){var o=i.call(this)||this;o.chain_=[],o.buf_=[],o.W_=[],o.pad_=[],o.inbuf_=0,o.total_=0,o.blockSize=512/8,o.pad_[0]=128;for(var s=1;s<o.blockSize;++s)o.pad_[s]=0;return o.reset(),o}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(o,s){s||(s=0);var f=this.W_;if(typeof o=="string")for(var d=0;d<16;d++)f[d]=o.charCodeAt(s)<<24|o.charCodeAt(s+1)<<16|o.charCodeAt(s+2)<<8|o.charCodeAt(s+3),s+=4;else for(var d=0;d<16;d++)f[d]=o[s]<<24|o[s+1]<<16|o[s+2]<<8|o[s+3],s+=4;for(var d=16;d<80;d++){var m=f[d-3]^f[d-8]^f[d-14]^f[d-16];f[d]=(m<<1|m>>>31)&4294967295}for(var _=this.chain_[0],$=this.chain_[1],G=this.chain_[2],Z=this.chain_[3],et=this.chain_[4],tt,nt,d=0;d<80;d++){d<40?d<20?(tt=Z^$&(G^Z),nt=1518500249):(tt=$^G^Z,nt=1859775393):d<60?(tt=$&G|Z&($|G),nt=2400959708):(tt=$^G^Z,nt=3395469782);var m=(_<<5|_>>>27)+tt+et+nt+f[d]&4294967295;et=Z,Z=G,G=($<<30|$>>>2)&4294967295,$=_,_=m}this.chain_[0]=this.chain_[0]+_&4294967295,this.chain_[1]=this.chain_[1]+$&4294967295,this.chain_[2]=this.chain_[2]+G&4294967295,this.chain_[3]=this.chain_[3]+Z&4294967295,this.chain_[4]=this.chain_[4]+et&4294967295},e.prototype.update=function(o,s){if(o!=null){s===void 0&&(s=o.length);for(var f=s-this.blockSize,d=0,m=this.buf_,_=this.inbuf_;d<s;){if(_==0)for(;d<=f;)this.compress_(o,d),d+=this.blockSize;if(typeof o=="string"){for(;d<s;)if(m[_]=o.charCodeAt(d),++_,++d,_==this.blockSize){this.compress_(m),_=0;break}}else for(;d<s;)if(m[_]=o[d],++_,++d,_==this.blockSize){this.compress_(m),_=0;break}}this.inbuf_=_,this.total_+=s}},e.prototype.digest=function(){var o=[],s=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var f=this.blockSize-1;f>=56;f--)this.buf_[f]=s&255,s/=256;this.compress_(this.buf_);for(var d=0,f=0;f<5;f++)for(var m=24;m>=0;m-=8)o[d]=this.chain_[f]>>m&255,++d;return o},e}(hash_1.Hash);sha1.Sha1=Sha1;var subscribe={};Object.defineProperty(subscribe,"__esModule",{value:!0});function createSubscribe$1(i,e){var o=new ObserverProxy(i,e);return o.subscribe.bind(o)}subscribe.createSubscribe=createSubscribe$1;var ObserverProxy=function(){function i(e,o){var s=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=o,this.task.then(function(){e(s)}).catch(function(f){s.error(f)})}return i.prototype.next=function(e){this.forEachObserver(function(o){o.next(e)})},i.prototype.error=function(e){this.forEachObserver(function(o){o.error(e)}),this.close(e)},i.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},i.prototype.subscribe=function(e,o,s){var f=this,d;if(e===void 0&&o===void 0&&s===void 0)throw new Error("Missing Observer.");implementsAnyMethods$1(e,["next","error","complete"])?d=e:d={next:e,error:o,complete:s},d.next===void 0&&(d.next=noop),d.error===void 0&&(d.error=noop),d.complete===void 0&&(d.complete=noop);var m=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{f.finalError?d.error(f.finalError):d.complete()}catch{}}),this.observers.push(d),m},i.prototype.unsubscribeOne=function(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))},i.prototype.forEachObserver=function(e){if(!this.finalized)for(var o=0;o<this.observers.length;o++)this.sendOne(o,e)},i.prototype.sendOne=function(e,o){var s=this;this.task.then(function(){if(s.observers!==void 0&&s.observers[e]!==void 0)try{o(s.observers[e])}catch(f){typeof console<"u"&&console.error&&console.error(f)}})},i.prototype.close=function(e){var o=this;this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(function(){o.observers=void 0,o.onNoObservers=void 0}))},i}();function async$1(i,e){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];Promise.resolve(!0).then(function(){i.apply(void 0,o)}).catch(function(f){e&&e(f)})}}subscribe.async=async$1;function implementsAnyMethods$1(i,e){if(typeof i!="object"||i===null)return!1;for(var o=0,s=e;o<s.length;o++){var f=s[o];if(f in i&&typeof i[f]=="function")return!0}return!1}function noop(){}var validation$1={};Object.defineProperty(validation$1,"__esModule",{value:!0});validation$1.validateArgCount=function(i,e,o,s){var f;if(s<e?f="at least "+e:s>o&&(f=o===0?"none":"no more than "+o),f){var d=i+" failed: Was called with "+s+(s===1?" argument.":" arguments.")+" Expects "+f+".";throw new Error(d)}};function errorPrefix(i,e,o){var s="";switch(e){case 1:s=o?"first":"First";break;case 2:s=o?"second":"Second";break;case 3:s=o?"third":"Third";break;case 4:s=o?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var f=i+" failed: ";return f+=s+" argument ",f}validation$1.errorPrefix=errorPrefix;function validateNamespace(i,e,o,s){if(!(s&&!o)&&typeof o!="string")throw new Error(errorPrefix(i,e,s)+"must be a valid firebase namespace.")}validation$1.validateNamespace=validateNamespace;function validateCallback(i,e,o,s){if(!(s&&!o)&&typeof o!="function")throw new Error(errorPrefix(i,e,s)+"must be a valid function.")}validation$1.validateCallback=validateCallback;function validateContextObject(i,e,o,s){if(!(s&&!o)&&(typeof o!="object"||o===null))throw new Error(errorPrefix(i,e,s)+"must be a valid context object.")}validation$1.validateContextObject=validateContextObject;var utf8={};Object.defineProperty(utf8,"__esModule",{value:!0});var assert_1$1=assert$1;utf8.stringToByteArray=function(i){for(var e=[],o=0,s=0;s<i.length;s++){var f=i.charCodeAt(s);if(f>=55296&&f<=56319){var d=f-55296;s++,assert_1$1.assert(s<i.length,"Surrogate pair missing trail surrogate.");var m=i.charCodeAt(s)-56320;f=65536+(d<<10)+m}f<128?e[o++]=f:f<2048?(e[o++]=f>>6|192,e[o++]=f&63|128):f<65536?(e[o++]=f>>12|224,e[o++]=f>>6&63|128,e[o++]=f&63|128):(e[o++]=f>>18|240,e[o++]=f>>12&63|128,e[o++]=f>>6&63|128,e[o++]=f&63|128)}return e};utf8.stringLength=function(i){for(var e=0,o=0;o<i.length;o++){var s=i.charCodeAt(o);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,o++):e+=3}return e};Object.defineProperty(cjs$1,"__esModule",{value:!0});var assert_1=assert$1;cjs$1.assert=assert_1.assert;cjs$1.assertionError=assert_1.assertionError;var crypt_1=crypt;cjs$1.base64=crypt_1.base64;cjs$1.base64Decode=crypt_1.base64Decode;cjs$1.base64Encode=crypt_1.base64Encode;var constants_1=constants;cjs$1.CONSTANTS=constants_1.CONSTANTS;var deepCopy_1=deepCopy$2,deepCopy=cjs$1.deepCopy=deepCopy_1.deepCopy,deepExtend=cjs$1.deepExtend=deepCopy_1.deepExtend,patchProperty=cjs$1.patchProperty=deepCopy_1.patchProperty,deferred_1=deferred;cjs$1.Deferred=deferred_1.Deferred;var environment_1=environment;cjs$1.getUA=environment_1.getUA;cjs$1.isMobileCordova=environment_1.isMobileCordova;cjs$1.isNodeSdk=environment_1.isNodeSdk;cjs$1.isReactNative=environment_1.isReactNative;var errors_1=errors$1,ErrorFactory=cjs$1.ErrorFactory=errors_1.ErrorFactory;cjs$1.FirebaseError=errors_1.FirebaseError;cjs$1.patchCapture=errors_1.patchCapture;var json_1=json;cjs$1.jsonEval=json_1.jsonEval;cjs$1.stringify=json_1.stringify;var jwt_1=jwt;cjs$1.decode=jwt_1.decode;cjs$1.isAdmin=jwt_1.isAdmin;cjs$1.issuedAtTime=jwt_1.issuedAtTime;cjs$1.isValidFormat=jwt_1.isValidFormat;cjs$1.isValidTimestamp=jwt_1.isValidTimestamp;var obj_1=obj;cjs$1.clone=obj_1.clone;cjs$1.contains=obj_1.contains;cjs$1.every=obj_1.every;cjs$1.extend=obj_1.extend;cjs$1.findKey=obj_1.findKey;cjs$1.findValue=obj_1.findValue;cjs$1.forEach=obj_1.forEach;cjs$1.getAnyKey=obj_1.getAnyKey;cjs$1.getCount=obj_1.getCount;cjs$1.getValues=obj_1.getValues;cjs$1.isEmpty=obj_1.isEmpty;cjs$1.isNonNullObject=obj_1.isNonNullObject;cjs$1.map=obj_1.map;cjs$1.safeGet=obj_1.safeGet;var query_1=query;cjs$1.querystring=query_1.querystring;cjs$1.querystringDecode=query_1.querystringDecode;var sha1_1=sha1;cjs$1.Sha1=sha1_1.Sha1;var subscribe_1=subscribe;cjs$1.async=subscribe_1.async;var createSubscribe=cjs$1.createSubscribe=subscribe_1.createSubscribe,validation_1$2=validation$1;cjs$1.errorPrefix=validation_1$2.errorPrefix;cjs$1.validateArgCount=validation_1$2.validateArgCount;cjs$1.validateCallback=validation_1$2.validateCallback;cjs$1.validateContextObject=validation_1$2.validateContextObject;cjs$1.validateNamespace=validation_1$2.validateNamespace;var utf8_1=utf8;cjs$1.stringLength=utf8_1.stringLength;cjs$1.stringToByteArray=utf8_1.stringToByteArray;var contains$3=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},DEFAULT_ENTRY_NAME="[DEFAULT]",tokenListeners=[],FirebaseAppImpl=function(){function i(e,o,s){this.firebase_=s,this.isDeleted_=!1,this.services_={},this.name_=o,this.options_=deepCopy(e),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(f){tokenListeners.push(f),setTimeout(function(){return f(null)},0)},removeAuthTokenListener:function(f){tokenListeners=tokenListeners.filter(function(d){return d!==f})}}}return Object.defineProperty(i.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),i.prototype.delete=function(){var e=this;return new Promise(function(o){e.checkDestroyed_(),o()}).then(function(){e.firebase_.INTERNAL.removeApp(e.name_);var o=[];return Object.keys(e.services_).forEach(function(s){Object.keys(e.services_[s]).forEach(function(f){o.push(e.services_[s][f])})}),Promise.all(o.map(function(s){return s.INTERNAL.delete()}))}).then(function(){e.isDeleted_=!0,e.services_={}})},i.prototype._getService=function(e,o){if(o===void 0&&(o=DEFAULT_ENTRY_NAME),this.checkDestroyed_(),this.services_[e]||(this.services_[e]={}),!this.services_[e][o]){var s=o!==DEFAULT_ENTRY_NAME?o:void 0,f=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),s);this.services_[e][o]=f}return this.services_[e][o]},i.prototype.extendApp=function(e){var o=this;deepExtend(this,e),e.INTERNAL&&e.INTERNAL.addAuthTokenListener&&(tokenListeners.forEach(function(s){o.INTERNAL.addAuthTokenListener(s)}),tokenListeners=[])},i.prototype.checkDestroyed_=function(){this.isDeleted_&&error$1("app-deleted",{name:this.name_})},i}();FirebaseAppImpl.prototype.name&&FirebaseAppImpl.prototype.options||FirebaseAppImpl.prototype.delete||console.log("dc");function createFirebaseNamespace(){var i={},e={},o={},s={__esModule:!0,initializeApp:m,app:d,apps:null,Promise,SDK_VERSION:"4.10.1",INTERNAL:{registerService:$,createFirebaseNamespace,extendNamespace:G,createSubscribe,ErrorFactory,removeApp:f,factories:e,useAsService:et,Promise,deepExtend}};patchProperty(s,"default",s),Object.defineProperty(s,"apps",{get:_});function f(tt){var nt=i[tt];Z(nt,"delete"),delete i[tt]}function d(tt){return tt=tt||DEFAULT_ENTRY_NAME,contains$3(i,tt)||error$1("no-app",{name:tt}),i[tt]}patchProperty(d,"App",FirebaseAppImpl);function m(tt,nt){nt===void 0?nt=DEFAULT_ENTRY_NAME:(typeof nt!="string"||nt==="")&&error$1("bad-app-name",{name:nt+""}),contains$3(i,nt)&&error$1("duplicate-app",{name:nt});var st=new FirebaseAppImpl(tt,nt,s);return i[nt]=st,Z(st,"create"),st}function _(){return Object.keys(i).map(function(tt){return i[tt]})}function $(tt,nt,st,rt,it){e[tt]&&error$1("duplicate-service",{name:tt}),e[tt]=nt,rt&&(o[tt]=rt,_().forEach(function(lt){rt("create",lt)}));var ot=function(lt){return lt===void 0&&(lt=d()),typeof lt[tt]!="function"&&error$1("invalid-app-argument",{name:tt}),lt[tt]()};return st!==void 0&&deepExtend(ot,st),s[tt]=ot,FirebaseAppImpl.prototype[tt]=function(){for(var lt=[],ft=0;ft<arguments.length;ft++)lt[ft]=arguments[ft];var ct=this._getService.bind(this,tt);return ct.apply(this,it?lt:[])},ot}function G(tt){deepExtend(s,tt)}function Z(tt,nt){Object.keys(e).forEach(function(st){var rt=et(tt,st);rt!==null&&o[rt]&&o[rt](nt,tt)})}function et(tt,nt){if(nt==="serverAuth")return null;var st=nt;return tt.options,st}return s}function error$1(i,e){throw appErrors.create(i,e)}var errors={"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."},appErrors=new ErrorFactory("app","Firebase",errors),firebase$1=createFirebaseNamespace();const esm$1=Object.freeze(Object.defineProperty({__proto__:null,firebase:firebase$1,default:firebase$1},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(esm$1);var app$1=require$$0.default;(function(){var i=require$$0.default,e,o=o||{},s=this;function f(c){return typeof c=="string"}function d(c){return typeof c=="boolean"}function m(){}function _(c){var v=typeof c;if(v=="object")if(c){if(c instanceof Array)return"array";if(c instanceof Object)return v;var b=Object.prototype.toString.call(c);if(b=="[object Window]")return"object";if(b=="[object Array]"||typeof c.length=="number"&&typeof c.splice<"u"&&typeof c.propertyIsEnumerable<"u"&&!c.propertyIsEnumerable("splice"))return"array";if(b=="[object Function]"||typeof c.call<"u"&&typeof c.propertyIsEnumerable<"u"&&!c.propertyIsEnumerable("call"))return"function"}else return"null";else if(v=="function"&&typeof c.call>"u")return"object";return v}function $(c){return c===null}function G(c){return _(c)=="array"}function Z(c){var v=_(c);return v=="array"||v=="object"&&typeof c.length=="number"}function et(c){return _(c)=="function"}function tt(c){var v=typeof c;return v=="object"&&c!=null||v=="function"}var nt="closure_uid_"+(1e9*Math.random()>>>0),st=0;function rt(c,v,b){return c.call.apply(c.bind,arguments)}function it(c,v,b){if(!c)throw Error();if(2<arguments.length){var j=Array.prototype.slice.call(arguments,2);return function(){var _e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(_e,j),c.apply(v,_e)}}return function(){return c.apply(v,arguments)}}function ot(c,v,b){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ot=rt:ot=it,ot.apply(null,arguments)}function lt(c,v){var b=Array.prototype.slice.call(arguments,1);return function(){var j=b.slice();return j.push.apply(j,arguments),c.apply(this,j)}}var ft=Date.now||function(){return+new Date};function ct(c,v){function b(){}b.prototype=v.prototype,c.lb=v.prototype,c.prototype=new b,c.prototype.constructor=c,c.$c=function(j,_e,at){for(var ut=Array(arguments.length-2),mt=2;mt<arguments.length;mt++)ut[mt-2]=arguments[mt];return v.prototype[_e].apply(j,ut)}}function pt(c){c.prototype.then=c.prototype.then,c.prototype.$goog_Thenable=!0}function gt(c){if(!c)return!1;try{return!!c.$goog_Thenable}catch{return!1}}function Tt(c){if(Error.captureStackTrace)Error.captureStackTrace(this,Tt);else{var v=Error().stack;v&&(this.stack=v)}c&&(this.message=String(c))}ct(Tt,Error),Tt.prototype.name="CustomError";function Et(c,v){c=c.split("%s");for(var b="",j=c.length-1,_e=0;_e<j;_e++)b+=c[_e]+(_e<v.length?v[_e]:"%s");Tt.call(this,b+c[j])}ct(Et,Tt),Et.prototype.name="AssertionError";function Mt(c,v){throw new Et("Failure"+(c?": "+c:""),Array.prototype.slice.call(arguments,1))}function vt(c,v){this.c=c,this.f=v,this.b=0,this.a=null}vt.prototype.get=function(){if(0<this.b){this.b--;var c=this.a;this.a=c.next,c.next=null}else c=this.c();return c};function yt(c,v){c.f(v),100>c.b&&(c.b++,v.next=c.a,c.a=v)}function bt(){this.b=this.a=null}var Pt=new vt(function(){return new At},function(c){c.reset()});bt.prototype.add=function(c,v){var b=Pt.get();b.set(c,v),this.b?this.b.next=b:this.a=b,this.b=b};function wt(){var c=Tn,v=null;return c.a&&(v=c.a,c.a=c.a.next,c.a||(c.b=null),v.next=null),v}function At(){this.next=this.b=this.a=null}At.prototype.set=function(c,v){this.a=c,this.b=v,this.next=null},At.prototype.reset=function(){this.next=this.b=this.a=null};var Ft=Array.prototype.indexOf?function(c,v){return Array.prototype.indexOf.call(c,v,void 0)}:function(c,v){if(f(c))return f(v)&&v.length==1?c.indexOf(v,0):-1;for(var b=0;b<c.length;b++)if(b in c&&c[b]===v)return b;return-1},Bt=Array.prototype.forEach?function(c,v,b){Array.prototype.forEach.call(c,v,b)}:function(c,v,b){for(var j=c.length,_e=f(c)?c.split(""):c,at=0;at<j;at++)at in _e&&v.call(b,_e[at],at,c)};function zt(c,v){var b=c.length,j=f(c)?c.split(""):c;for(--b;0<=b;--b)b in j&&v.call(void 0,j[b],b,c)}var Ht=Array.prototype.map?function(c,v){return Array.prototype.map.call(c,v,void 0)}:function(c,v){for(var b=c.length,j=Array(b),_e=f(c)?c.split(""):c,at=0;at<b;at++)at in _e&&(j[at]=v.call(void 0,_e[at],at,c));return j},ln=Array.prototype.some?function(c,v){return Array.prototype.some.call(c,v,void 0)}:function(c,v){for(var b=c.length,j=f(c)?c.split(""):c,_e=0;_e<b;_e++)if(_e in j&&v.call(void 0,j[_e],_e,c))return!0;return!1};function gn(c){e:{for(var v=Sp,b=c.length,j=f(c)?c.split(""):c,_e=0;_e<b;_e++)if(_e in j&&v.call(void 0,j[_e],_e,c)){v=_e;break e}v=-1}return 0>v?null:f(c)?c.charAt(v):c[v]}function Zt(c,v){return 0<=Ft(c,v)}function En(c,v){v=Ft(c,v);var b;return(b=0<=v)&&Array.prototype.splice.call(c,v,1),b}function _n(c,v){var b=0;zt(c,function(j,_e){v.call(void 0,j,_e,c)&&Array.prototype.splice.call(c,_e,1).length==1&&b++})}function It(c){return Array.prototype.concat.apply([],arguments)}function $t(c){var v=c.length;if(0<v){for(var b=Array(v),j=0;j<v;j++)b[j]=c[j];return b}return[]}function xt(c,v){for(var b=c.split("%s"),j="",_e=Array.prototype.slice.call(arguments,1);_e.length&&1<b.length;)j+=b.shift()+_e.shift();return j+b.join("%s")}var Kt=String.prototype.trim?function(c){return c.trim()}:function(c){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(c)[1]};function nn(c){return Rt.test(c)&&(c.indexOf("&")!=-1&&(c=c.replace(cn,"&amp;")),c.indexOf("<")!=-1&&(c=c.replace(Jt,"&lt;")),c.indexOf(">")!=-1&&(c=c.replace(ht,"&gt;")),c.indexOf('"')!=-1&&(c=c.replace(dt,"&quot;")),c.indexOf("'")!=-1&&(c=c.replace(St,"&#39;")),c.indexOf("\0")!=-1&&(c=c.replace(Ct,"&#0;"))),c}var cn=/&/g,Jt=/</g,ht=/>/g,dt=/"/g,St=/'/g,Ct=/\x00/g,Rt=/[\x00&<>"']/;function Nt(c,v){return c.indexOf(v)!=-1}function Ut(c,v){return c<v?-1:c>v?1:0}var kt;e:{var Lt=s.navigator;if(Lt){var Ot=Lt.userAgent;if(Ot){kt=Ot;break e}}kt=""}function Vt(c){return Nt(kt,c)}function Wt(c,v){for(var b in c)v.call(void 0,c[b],b,c)}function qt(c){for(var v in c)return!1;return!0}function Qt(c){var v={},b;for(b in c)v[b]=c[b];return v}var en="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function on(c,v){for(var b,j,_e=1;_e<arguments.length;_e++){j=arguments[_e];for(b in j)c[b]=j[b];for(var at=0;at<en.length;at++)b=en[at],Object.prototype.hasOwnProperty.call(j,b)&&(c[b]=j[b])}}function sn(c){s.setTimeout(function(){throw c},0)}var hn;function An(){var c=s.MessageChannel;if(typeof c>"u"&&typeof window<"u"&&window.postMessage&&window.addEventListener&&!Vt("Presto")&&(c=function(){var _e=document.createElement("IFRAME");_e.style.display="none",_e.src="",document.documentElement.appendChild(_e);var at=_e.contentWindow;_e=at.document,_e.open(),_e.write(""),_e.close();var ut="callImmediate"+Math.random(),mt=at.location.protocol=="file:"?"*":at.location.protocol+"//"+at.location.host;_e=ot(function(Dt){(mt=="*"||Dt.origin==mt)&&Dt.data==ut&&this.port1.onmessage()},this),at.addEventListener("message",_e,!1),this.port1={},this.port2={postMessage:function(){at.postMessage(ut,mt)}}}),typeof c<"u"&&!Vt("Trident")&&!Vt("MSIE")){var v=new c,b={},j=b;return v.port1.onmessage=function(){if(b.next!==void 0){b=b.next;var _e=b.rb;b.rb=null,_e()}},function(_e){j.next={rb:_e},j=j.next,v.port2.postMessage(0)}}return typeof document<"u"&&"onreadystatechange"in document.createElement("SCRIPT")?function(_e){var at=document.createElement("SCRIPT");at.onreadystatechange=function(){at.onreadystatechange=null,at.parentNode.removeChild(at),at=null,_e(),_e=null},document.documentElement.appendChild(at)}:function(_e){s.setTimeout(_e,0)}}function Fn(c,v){lr||cr(),Or||(lr(),Or=!0),Tn.add(c,v)}var lr;function cr(){if(String(s.Promise).indexOf("[native code]")!=-1){var c=s.Promise.resolve(void 0);lr=function(){c.then(On)}}else lr=function(){var v=On;!et(s.setImmediate)||s.Window&&s.Window.prototype&&!Vt("Edge")&&s.Window.prototype.setImmediate==s.setImmediate?(hn||(hn=An()),hn(v)):s.setImmediate(v)}}var Or=!1,Tn=new bt;function On(){for(var c;c=wt();){try{c.a.call(c.b)}catch(v){sn(v)}yt(Pt,c)}Or=!1}function rn(c,v){if(this.a=hr,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,c!=m)try{var b=this;c.call(v,function(j){fr(b,ni,j)},function(j){if(!(j instanceof Pr))try{throw j instanceof Error?j:Error("Promise rejected.")}catch{}fr(b,Yn,j)})}catch(j){fr(this,Yn,j)}}var hr=0,ni=2,Yn=3;function lu(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}lu.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var cu=new vt(function(){return new lu},function(c){c.reset()});function _o(c,v,b){var j=cu.get();return j.g=c,j.b=v,j.f=b,j}function Xt(c){if(c instanceof rn)return c;var v=new rn(m);return fr(v,ni,c),v}function mn(c){return new rn(function(v,b){b(c)})}function hu(c,v,b){pu(c,v,b,null)||Fn(lt(v,c))}function df(c){return new rn(function(v,b){var j=c.length,_e=[];if(j)for(var at=function(jt,un){j--,_e[jt]=un,j==0&&v(_e)},ut=function(jt){b(jt)},mt=0,Dt;mt<c.length;mt++)Dt=c[mt],hu(Dt,lt(at,mt),ut);else v(_e)})}function pf(c){return new rn(function(v){var b=c.length,j=[];if(b)for(var _e=function(mt,Dt,jt){b--,j[mt]=Dt?{Zb:!0,value:jt}:{Zb:!1,reason:jt},b==0&&v(j)},at=0,ut;at<c.length;at++)ut=c[at],hu(ut,lt(_e,at,!0),lt(_e,at,!1));else v(j)})}rn.prototype.then=function(c,v,b){return du(this,et(c)?c:null,et(v)?v:null,b)},pt(rn),e=rn.prototype,e.ga=function(c,v){return c=_o(c,c,v),c.c=!0,Eo(this,c),this},e.o=function(c,v){return du(this,null,c,v)},e.cancel=function(c){this.a==hr&&Fn(function(){var v=new Pr(c);fu(this,v)},this)};function fu(c,v){if(c.a==hr)if(c.c){var b=c.c;if(b.b){for(var j=0,_e=null,at=null,ut=b.b;ut&&(ut.c||(j++,ut.a==c&&(_e=ut),!(_e&&1<j)));ut=ut.next)_e||(at=ut);_e&&(b.a==hr&&j==1?fu(b,v):(at?(j=at,j.next==b.f&&(b.f=j),j.next=j.next.next):mu(b),gu(b,_e,Yn,v)))}c.c=null}else fr(c,Yn,v)}function Eo(c,v){c.b||c.a!=ni&&c.a!=Yn||vu(c),c.f?c.f.next=v:c.b=v,c.f=v}function du(c,v,b,j){var _e=_o(null,null,null);return _e.a=new rn(function(at,ut){_e.g=v?function(mt){try{var Dt=v.call(j,mt);at(Dt)}catch(jt){ut(jt)}}:at,_e.b=b?function(mt){try{var Dt=b.call(j,mt);Dt===void 0&&mt instanceof Pr?ut(mt):at(Dt)}catch(jt){ut(jt)}}:ut}),_e.a.c=c,Eo(c,_e),_e.a}e.Jc=function(c){this.a=hr,fr(this,ni,c)},e.Kc=function(c){this.a=hr,fr(this,Yn,c)};function fr(c,v,b){c.a==hr&&(c===b&&(v=Yn,b=new TypeError("Promise cannot resolve to itself")),c.a=1,pu(b,c.Jc,c.Kc,c)||(c.i=b,c.a=v,c.c=null,vu(c),v!=Yn||b instanceof Pr||mf(c,b)))}function pu(c,v,b,j){if(c instanceof rn)return Eo(c,_o(v||m,b||null,j)),!0;if(gt(c))return c.then(v,b,j),!0;if(tt(c))try{var _e=c.then;if(et(_e))return vf(c,_e,v,b,j),!0}catch(at){return b.call(j,at),!0}return!1}function vf(c,v,b,j,_e){function at(Dt){mt||(mt=!0,j.call(_e,Dt))}function ut(Dt){mt||(mt=!0,b.call(_e,Dt))}var mt=!1;try{v.call(c,ut,at)}catch(Dt){at(Dt)}}function vu(c){c.h||(c.h=!0,Fn(c.Ub,c))}function mu(c){var v=null;return c.b&&(v=c.b,c.b=v.next,v.next=null),c.b||(c.f=null),v}e.Ub=function(){for(var c;c=mu(this);)gu(this,c,this.a,this.i);this.h=!1};function gu(c,v,b,j){if(b==Yn&&v.b&&!v.c)for(;c&&c.g;c=c.c)c.g=!1;if(v.a)v.a.c=null,yu(v,b,j);else try{v.c?v.g.call(v.f):yu(v,b,j)}catch(_e){_u.call(null,_e)}yt(cu,v)}function yu(c,v,b){v==ni?c.g.call(c.f,b):c.b&&c.b.call(c.f,b)}function mf(c,v){c.g=!0,Fn(function(){c.g&&_u.call(null,v)})}var _u=sn;function Pr(c){Tt.call(this,c)}ct(Pr,Tt),Pr.prototype.name="cancel";function Ai(){this.pa=this.pa,this.oa=this.oa}var gf=0;Ai.prototype.pa=!1;function Eu(c){!c.pa&&(c.pa=!0,c.ua(),gf!=0)&&(c[nt]||(c[nt]=++st))}Ai.prototype.ua=function(){if(this.oa)for(;this.oa.length;)this.oa.shift()()};function bo(c){return bo[" "](c),c}bo[" "]=m;function yf(c,v){var b=Sf;return Object.prototype.hasOwnProperty.call(b,c)?b[c]:b[c]=v(c)}var _f=Vt("Opera"),$n=Vt("Trident")||Vt("MSIE"),bu=Vt("Edge"),Ef=bu||$n,Su=Vt("Gecko")&&!(Nt(kt.toLowerCase(),"webkit")&&!Vt("Edge"))&&!(Vt("Trident")||Vt("MSIE"))&&!Vt("Edge"),bf=Nt(kt.toLowerCase(),"webkit")&&!Vt("Edge");function Tu(){var c=s.document;return c?c.documentMode:void 0}var Oi;e:{var So="",To=function(){var c=kt;if(Su)return/rv:([^\);]+)(\)|;)/.exec(c);if(bu)return/Edge\/([\d\.]+)/.exec(c);if($n)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(c);if(bf)return/WebKit\/(\S+)/.exec(c);if(_f)return/(?:Version)[ \/]?(\S+)/.exec(c)}();if(To&&(So=To?To[1]:""),$n){var Co=Tu();if(Co!=null&&Co>parseFloat(So)){Oi=String(Co);break e}}Oi=So}var Sf={};function Cu(c){return yf(c,function(){for(var v=0,b=Kt(String(Oi)).split("."),j=Kt(String(c)).split("."),_e=Math.max(b.length,j.length),at=0;v==0&&at<_e;at++){var ut=b[at]||"",mt=j[at]||"";do{if(ut=/(\d*)(\D*)(.*)/.exec(ut)||["","","",""],mt=/(\d*)(\D*)(.*)/.exec(mt)||["","","",""],ut[0].length==0&&mt[0].length==0)break;v=Ut(ut[1].length==0?0:parseInt(ut[1],10),mt[1].length==0?0:parseInt(mt[1],10))||Ut(ut[2].length==0,mt[2].length==0)||Ut(ut[2],mt[2]),ut=ut[3],mt=mt[3]}while(v==0)}return 0<=v})}var zn,wu=s.document;zn=wu&&$n?Tu()||(wu.compatMode=="CSS1Compat"?parseInt(Oi,10):5):void 0;var Tf=Object.freeze||function(c){return c},Iu=!$n||9<=Number(zn),Cf=$n&&!Cu("9"),wf=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var c=!1,v=Object.defineProperty({},"passive",{get:function(){c=!0}});return s.addEventListener("test",m,v),s.removeEventListener("test",m,v),c}();function kn(c,v){this.type=c,this.b=this.target=v,this.Eb=!0}kn.prototype.c=function(){this.Eb=!1};function dr(c,v){if(kn.call(this,c?c.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,c){var b=this.type=c.type,j=c.changedTouches?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.b=v,v=c.relatedTarget){if(Su){e:{try{bo(v.nodeName);var _e=!0;break e}catch{}_e=!1}_e||(v=null)}}else b=="mouseover"?v=c.fromElement:b=="mouseout"&&(v=c.toElement);this.relatedTarget=v,j===null?(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0):(this.clientX=j.clientX!==void 0?j.clientX:j.pageX,this.clientY=j.clientY!==void 0?j.clientY:j.pageY,this.screenX=j.screenX||0,this.screenY=j.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=f(c.pointerType)?c.pointerType:If[c.pointerType]||"",this.a=c,c.defaultPrevented&&this.c()}}ct(dr,kn);var If=Tf({2:"touch",3:"pen",4:"mouse"});dr.prototype.c=function(){dr.lb.c.call(this);var c=this.a;if(c.preventDefault)c.preventDefault();else if(c.returnValue=!1,Cf)try{(c.ctrlKey||112<=c.keyCode&&123>=c.keyCode)&&(c.keyCode=-1)}catch{}},dr.prototype.g=function(){return this.a};var ri="closure_listenable_"+(1e6*Math.random()|0),Nf=0;function Rf(c,v,b,j,_e){this.listener=c,this.proxy=null,this.src=v,this.type=b,this.capture=!!j,this.La=_e,this.key=++Nf,this.ma=this.Ha=!1}function Pi(c){c.ma=!0,c.listener=null,c.proxy=null,c.src=null,c.La=null}function Di(c){this.src=c,this.a={},this.b=0}Di.prototype.add=function(c,v,b,j,_e){var at=c.toString();c=this.a[at],c||(c=this.a[at]=[],this.b++);var ut=Io(c,v,j,_e);return-1<ut?(v=c[ut],b||(v.Ha=!1)):(v=new Rf(v,this.src,at,!!j,_e),v.Ha=b,c.push(v)),v};function wo(c,v){var b=v.type;b in c.a&&En(c.a[b],v)&&(Pi(v),c.a[b].length==0&&(delete c.a[b],c.b--))}function Io(c,v,b,j){for(var _e=0;_e<c.length;++_e){var at=c[_e];if(!at.ma&&at.listener==v&&at.capture==!!b&&at.La==j)return _e}return-1}var No="closure_lm_"+(1e6*Math.random()|0),Ro={};function Xn(c,v,b,j,_e){if(j&&j.once)Ao(c,v,b,j,_e);else if(G(v))for(var at=0;at<v.length;at++)Xn(c,v[at],b,j,_e);else b=Po(b),c&&c[ri]?Du(c,v,b,tt(j)?!!j.capture:!!j,_e):Nu(c,v,b,!1,j,_e)}function Nu(c,v,b,j,_e,at){if(!v)throw Error("Invalid event type");var ut=tt(_e)?!!_e.capture:!!_e,mt=ki(c);if(mt||(c[No]=mt=new Di(c)),b=mt.add(v,b,j,ut,at),!b.proxy)if(j=Af(),b.proxy=j,j.src=c,j.listener=b,c.addEventListener)wf||(_e=ut),_e===void 0&&(_e=!1),c.addEventListener(v.toString(),j,_e);else if(c.attachEvent)c.attachEvent(Au(v.toString()),j);else if(c.addListener&&c.removeListener)c.addListener(j);else throw Error("addEventListener and attachEvent are unavailable.")}function Af(){var c=Of,v=Iu?function(b){return c.call(v.src,v.listener,b)}:function(b){if(b=c.call(v.src,v.listener,b),!b)return b};return v}function Ao(c,v,b,j,_e){if(G(v))for(var at=0;at<v.length;at++)Ao(c,v[at],b,j,_e);else b=Po(b),c&&c[ri]?Do(c,v,b,tt(j)?!!j.capture:!!j,_e):Nu(c,v,b,!0,j,_e)}function xn(c,v,b,j,_e){if(G(v))for(var at=0;at<v.length;at++)xn(c,v[at],b,j,_e);else j=tt(j)?!!j.capture:!!j,b=Po(b),c&&c[ri]?(c=c.u,v=String(v).toString(),v in c.a&&(at=c.a[v],b=Io(at,b,j,_e),-1<b&&(Pi(at[b]),Array.prototype.splice.call(at,b,1),at.length==0&&(delete c.a[v],c.b--)))):c&&(c=ki(c))&&(v=c.a[v.toString()],c=-1,v&&(c=Io(v,b,j,_e)),(b=-1<c?v[c]:null)&&Ru(b))}function Ru(c){if(typeof c!="number"&&c&&!c.ma){var v=c.src;if(v&&v[ri])wo(v.u,c);else{var b=c.type,j=c.proxy;v.removeEventListener?v.removeEventListener(b,j,c.capture):v.detachEvent?v.detachEvent(Au(b),j):v.addListener&&v.removeListener&&v.removeListener(j),(b=ki(v))?(wo(b,c),b.b==0&&(b.src=null,v[No]=null)):Pi(c)}}}function Au(c){return c in Ro?Ro[c]:Ro[c]="on"+c}function Ou(c,v,b,j){var _e=!0;if((c=ki(c))&&(v=c.a[v.toString()]))for(v=v.concat(),c=0;c<v.length;c++){var at=v[c];at&&at.capture==b&&!at.ma&&(at=Pu(at,j),_e=_e&&at!==!1)}return _e}function Pu(c,v){var b=c.listener,j=c.La||c.src;return c.Ha&&Ru(c),b.call(j,v)}function Of(c,v){if(c.ma)return!0;if(!Iu){if(!v)e:{v=["window","event"];for(var b=s,j=0;j<v.length;j++)if(b=b[v[j]],b==null){v=null;break e}v=b}if(j=v,v=new dr(j,this),b=!0,!(0>j.keyCode||j.returnValue!=null)){e:{var _e=!1;if(j.keyCode==0)try{j.keyCode=-1;break e}catch{_e=!0}(_e||j.returnValue==null)&&(j.returnValue=!0)}for(j=[],_e=v.b;_e;_e=_e.parentNode)j.push(_e);for(c=c.type,_e=j.length-1;0<=_e;_e--){v.b=j[_e];var at=Ou(j[_e],c,!0,v);b=b&&at}for(_e=0;_e<j.length;_e++)v.b=j[_e],at=Ou(j[_e],c,!1,v),b=b&&at}return b}return Pu(c,new dr(v,this))}function ki(c){return c=c[No],c instanceof Di?c:null}var Oo="__closure_events_fn_"+(1e9*Math.random()>>>0);function Po(c){return et(c)?c:(c[Oo]||(c[Oo]=function(v){return c.handleEvent(v)}),c[Oo])}function wn(){Ai.call(this),this.u=new Di(this),this.Mb=this,this.Ta=null}ct(wn,Ai),wn.prototype[ri]=!0,wn.prototype.addEventListener=function(c,v,b,j){Xn(this,c,v,b,j)},wn.prototype.removeEventListener=function(c,v,b,j){xn(this,c,v,b,j)},wn.prototype.dispatchEvent=function(c){var v,b=this.Ta;if(b)for(v=[];b;b=b.Ta)v.push(b);b=this.Mb;var j=c.type||c;if(f(c))c=new kn(c,b);else if(c instanceof kn)c.target=c.target||b;else{var _e=c;c=new kn(j,b),on(c,_e)}if(_e=!0,v)for(var at=v.length-1;0<=at;at--){var ut=c.b=v[at];_e=Mi(ut,j,!0,c)&&_e}if(ut=c.b=b,_e=Mi(ut,j,!0,c)&&_e,_e=Mi(ut,j,!1,c)&&_e,v)for(at=0;at<v.length;at++)ut=c.b=v[at],_e=Mi(ut,j,!1,c)&&_e;return _e},wn.prototype.ua=function(){if(wn.lb.ua.call(this),this.u){var c=this.u,v;for(v in c.a){for(var b=c.a[v],j=0;j<b.length;j++)Pi(b[j]);delete c.a[v],c.b--}}this.Ta=null};function Du(c,v,b,j,_e){c.u.add(String(v),b,!1,j,_e)}function Do(c,v,b,j,_e){c.u.add(String(v),b,!0,j,_e)}function Mi(c,v,b,j){if(v=c.u.a[String(v)],!v)return!0;v=v.concat();for(var _e=!0,at=0;at<v.length;++at){var ut=v[at];if(ut&&!ut.ma&&ut.capture==b){var mt=ut.listener,Dt=ut.La||ut.src;ut.Ha&&wo(c.u,ut),_e=mt.call(Dt,j)!==!1&&_e}}return _e&&j.Eb!=0}function ko(c,v,b){if(et(c))b&&(c=ot(c,b));else if(c&&typeof c.handleEvent=="function")c=ot(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(v)?-1:s.setTimeout(c,v||0)}function pr(c){var v=null;return new rn(function(b,j){v=ko(function(){b(void 0)},c),v==-1&&j(Error("Failed to schedule timer."))}).o(function(b){throw s.clearTimeout(v),b})}function ku(c){if(c.R&&typeof c.R=="function")return c.R();if(f(c))return c.split("");if(Z(c)){for(var v=[],b=c.length,j=0;j<b;j++)v.push(c[j]);return v}v=[],b=0;for(j in c)v[b++]=c[j];return v}function Mu(c){if(c.T&&typeof c.T=="function")return c.T();if(!c.R||typeof c.R!="function"){if(Z(c)||f(c)){var v=[];c=c.length;for(var b=0;b<c;b++)v.push(b);return v}v=[],b=0;for(var j in c)v[b++]=j;return v}}function Pf(c,v){if(c.forEach&&typeof c.forEach=="function")c.forEach(v,void 0);else if(Z(c)||f(c))Bt(c,v,void 0);else for(var b=Mu(c),j=ku(c),_e=j.length,at=0;at<_e;at++)v.call(void 0,j[at],b&&b[at],c)}function Dr(c,v){this.b={},this.a=[],this.c=0;var b=arguments.length;if(1<b){if(b%2)throw Error("Uneven number of arguments");for(var j=0;j<b;j+=2)this.set(arguments[j],arguments[j+1])}else if(c)if(c instanceof Dr)for(b=c.T(),j=0;j<b.length;j++)this.set(b[j],c.get(b[j]));else for(j in c)this.set(j,c[j])}e=Dr.prototype,e.R=function(){Mo(this);for(var c=[],v=0;v<this.a.length;v++)c.push(this.b[this.a[v]]);return c},e.T=function(){return Mo(this),this.a.concat()},e.clear=function(){this.b={},this.c=this.a.length=0};function Mo(c){if(c.c!=c.a.length){for(var v=0,b=0;v<c.a.length;){var j=c.a[v];vr(c.b,j)&&(c.a[b++]=j),v++}c.a.length=b}if(c.c!=c.a.length){var _e={};for(b=v=0;v<c.a.length;)j=c.a[v],vr(_e,j)||(c.a[b++]=j,_e[j]=1),v++;c.a.length=b}}e.get=function(c,v){return vr(this.b,c)?this.b[c]:v},e.set=function(c,v){vr(this.b,c)||(this.c++,this.a.push(c)),this.b[c]=v},e.forEach=function(c,v){for(var b=this.T(),j=0;j<b.length;j++){var _e=b[j],at=this.get(_e);c.call(v,at,_e,this)}};function vr(c,v){return Object.prototype.hasOwnProperty.call(c,v)}var Lu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Df(c,v){if(c){c=c.split("&");for(var b=0;b<c.length;b++){var j=c[b].indexOf("="),_e=null;if(0<=j){var at=c[b].substring(0,j);_e=c[b].substring(j+1)}else at=c[b];v(at,_e?decodeURIComponent(_e.replace(/\+/g," ")):"")}}}function kr(c,v){if(this.b=this.l=this.c="",this.i=null,this.h=this.g="",this.f=!1,c instanceof kr){this.f=v!==void 0?v:c.f,Lo(this,c.c),this.l=c.l,this.b=c.b,Fu(this,c.i),this.g=c.g,v=c.a;var b=new Mr;b.c=v.c,v.a&&(b.a=new Dr(v.a),b.b=v.b),$u(this,b),this.h=c.h}else c&&(b=String(c).match(Lu))?(this.f=!!v,Lo(this,b[1]||"",!0),this.l=ii(b[2]||""),this.b=ii(b[3]||"",!0),Fu(this,b[4]),this.g=ii(b[5]||"",!0),$u(this,b[6]||"",!0),this.h=ii(b[7]||"")):(this.f=!!v,this.a=new Mr(null,this.f))}kr.prototype.toString=function(){var c=[],v=this.c;v&&c.push(oi(v,Bu,!0),":");var b=this.b;return(b||v=="file")&&(c.push("//"),(v=this.l)&&c.push(oi(v,Bu,!0),"@"),c.push(encodeURIComponent(String(b)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b=this.i,b!=null&&c.push(":",String(b))),(b=this.g)&&(this.b&&b.charAt(0)!="/"&&c.push("/"),c.push(oi(b,b.charAt(0)=="/"?Lf:Mf,!0))),(b=this.a.toString())&&c.push("?",b),(b=this.h)&&c.push("#",oi(b,$f)),c.join("")};function Lo(c,v,b){c.c=b?ii(v,!0):v,c.c&&(c.c=c.c.replace(/:$/,""))}function Fu(c,v){if(v){if(v=Number(v),isNaN(v)||0>v)throw Error("Bad port number "+v);c.i=v}else c.i=null}function $u(c,v,b){v instanceof Mr?(c.a=v,xf(c.a,c.f)):(b||(v=oi(v,Ff)),c.a=new Mr(v,c.f))}function yn(c,v,b){c.a.set(v,b)}function rr(c,v){return c.a.get(v)}function Jn(c){return c instanceof kr?new kr(c):new kr(c,void 0)}function xu(c,v){var b=new kr(null,void 0);return Lo(b,"https"),c&&(b.b=c),v&&(b.g=v),b}function ii(c,v){return c?v?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function oi(c,v,b){return f(c)?(c=encodeURI(c).replace(v,kf),b&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function kf(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Bu=/[#\/\?@]/g,Mf=/[#\?:]/g,Lf=/[#\?]/g,Ff=/[#\?@]/g,$f=/#/g;function Mr(c,v){this.b=this.a=null,this.c=c||null,this.f=!!v}function ir(c){c.a||(c.a=new Dr,c.b=0,c.c&&Df(c.c,function(v,b){c.add(decodeURIComponent(v.replace(/\+/g," ")),b)}))}function Uu(c){var v=Mu(c);if(typeof v>"u")throw Error("Keys are undefined");var b=new Mr(null,void 0);c=ku(c);for(var j=0;j<v.length;j++){var _e=v[j],at=c[j];G(at)?ju(b,_e,at):b.add(_e,at)}return b}e=Mr.prototype,e.add=function(c,v){ir(this),this.c=null,c=Lr(this,c);var b=this.a.get(c);return b||this.a.set(c,b=[]),b.push(v),this.b+=1,this};function Zn(c,v){ir(c),v=Lr(c,v),vr(c.a.b,v)&&(c.c=null,c.b-=c.a.get(v).length,c=c.a,vr(c.b,v)&&(delete c.b[v],c.c--,c.a.length>2*c.c&&Mo(c)))}e.clear=function(){this.a=this.c=null,this.b=0};function Vu(c,v){return ir(c),v=Lr(c,v),vr(c.a.b,v)}e.forEach=function(c,v){ir(this),this.a.forEach(function(b,j){Bt(b,function(_e){c.call(v,_e,j,this)},this)},this)},e.T=function(){ir(this);for(var c=this.a.R(),v=this.a.T(),b=[],j=0;j<v.length;j++)for(var _e=c[j],at=0;at<_e.length;at++)b.push(v[j]);return b},e.R=function(c){ir(this);var v=[];if(f(c))Vu(this,c)&&(v=It(v,this.a.get(Lr(this,c))));else{c=this.a.R();for(var b=0;b<c.length;b++)v=It(v,c[b])}return v},e.set=function(c,v){return ir(this),this.c=null,c=Lr(this,c),Vu(this,c)&&(this.b-=this.a.get(c).length),this.a.set(c,[v]),this.b+=1,this},e.get=function(c,v){return c=c?this.R(c):[],0<c.length?String(c[0]):v};function ju(c,v,b){Zn(c,v),0<b.length&&(c.c=null,c.a.set(Lr(c,v),$t(b)),c.b+=b.length)}e.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var c=[],v=this.a.T(),b=0;b<v.length;b++){var j=v[b],_e=encodeURIComponent(String(j));j=this.R(j);for(var at=0;at<j.length;at++){var ut=_e;j[at]!==""&&(ut+="="+encodeURIComponent(String(j[at]))),c.push(ut)}}return this.c=c.join("&")};function Lr(c,v){return v=String(v),c.f&&(v=v.toLowerCase()),v}function xf(c,v){v&&!c.f&&(ir(c),c.c=null,c.a.forEach(function(b,j){var _e=j.toLowerCase();j!=_e&&(Zn(this,j),ju(this,_e,b))},c)),c.f=v}var Bf=!$n||9<=Number(zn);function mr(){this.a="",this.b=qu}mr.prototype.la=!0,mr.prototype.ja=function(){return this.a},mr.prototype.toString=function(){return"Const{"+this.a+"}"};function Wu(c){return c instanceof mr&&c.constructor===mr&&c.b===qu?c.a:(Mt("expected object of type Const, got '"+c+"'"),"type_error:Const")}var qu={};function si(c){var v=new mr;return v.a=c,v}si("");function Fr(){this.a="",this.b=Gu}Fr.prototype.la=!0,Fr.prototype.ja=function(){return this.a},Fr.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};function Ku(c){return c instanceof Fr&&c.constructor===Fr&&c.b===Gu?c.a:(Mt("expected object of type TrustedResourceUrl, got '"+c+"' of type "+_(c)),"type_error:TrustedResourceUrl")}function Fo(c,v){var b=Wu(c);if(!Vf.test(b))throw Error("Invalid TrustedResourceUrl format: "+b);return c=b.replace(Uf,function(j,_e){if(!Object.prototype.hasOwnProperty.call(v,_e))throw Error('Found marker, "'+_e+'", in format string, "'+b+'", but no valid label mapping found in args: '+JSON.stringify(v));return j=v[_e],j instanceof mr?Wu(j):encodeURIComponent(String(j))}),jf(c)}var Uf=/%{(\w+)}/g,Vf=/^(?:https:)?\/\/[0-9a-z.:[\]-]+\/|^\/[^\/\\]|^about:blank#/i,Gu={};function jf(c){var v=new Fr;return v.a=c,v}function jn(){this.a="",this.b=Yu}jn.prototype.la=!0,jn.prototype.ja=function(){return this.a},jn.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};function Li(c){return c instanceof jn&&c.constructor===jn&&c.b===Yu?c.a:(Mt("expected object of type SafeUrl, got '"+c+"' of type "+_(c)),"type_error:SafeUrl")}var Hu=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function Qu(c){return c instanceof jn?c:(c=c.la?c.ja():String(c),Hu.test(c)||(c="about:invalid#zClosurez"),$o(c))}var Yu={};function $o(c){var v=new jn;return v.a=c,v}$o("about:blank");function $r(){this.a="",this.b=zu}$r.prototype.la=!0,$r.prototype.ja=function(){return this.a},$r.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};function Wf(c){return c instanceof $r&&c.constructor===$r&&c.b===zu?c.a:(Mt("expected object of type SafeHtml, got '"+c+"' of type "+_(c)),"type_error:SafeHtml")}var zu={};function Fi(c){var v=new $r;return v.a=c,v}Fi("<!DOCTYPE html>"),Fi(""),Fi("<br>");function $i(c){var v=document;return f(c)?v.getElementById(c):c}function Xu(c,v){Wt(v,function(b,j){b&&b.la&&(b=b.ja()),j=="style"?c.style.cssText=b:j=="class"?c.className=b:j=="for"?c.htmlFor=b:Ju.hasOwnProperty(j)?c.setAttribute(Ju[j],b):j.lastIndexOf("aria-",0)==0||j.lastIndexOf("data-",0)==0?c.setAttribute(j,b):c[j]=b})}var Ju={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function qf(c,v,b){var j=arguments,_e=document,at=String(j[0]),ut=j[1];if(!Bf&&ut&&(ut.name||ut.type)){if(at=["<",at],ut.name&&at.push(' name="',nn(ut.name),'"'),ut.type){at.push(' type="',nn(ut.type),'"');var mt={};on(mt,ut),delete mt.type,ut=mt}at.push(">"),at=at.join("")}return at=_e.createElement(at),ut&&(f(ut)?at.className=ut:G(ut)?at.className=ut.join(" "):Xu(at,ut)),2<j.length&&Kf(_e,at,j),at}function Kf(c,v,b){function j(ut){ut&&v.appendChild(f(ut)?c.createTextNode(ut):ut)}for(var _e=2;_e<b.length;_e++){var at=b[_e];!Z(at)||tt(at)&&0<at.nodeType?j(at):Bt(Gf(at)?$t(at):at,j)}}function Gf(c){if(c&&typeof c.length=="number"){if(tt(c))return typeof c.item=="function"||typeof c.item=="string";if(et(c))return typeof c.item=="function"}return!1}function Zu(c){var v=[];return xo(new Hf,c,v),v.join("")}function Hf(){}function xo(c,v,b){if(v==null)b.push("null");else{if(typeof v=="object"){if(G(v)){var j=v;v=j.length,b.push("[");for(var _e="",at=0;at<v;at++)b.push(_e),xo(c,j[at],b),_e=",";b.push("]");return}if(v instanceof String||v instanceof Number||v instanceof Boolean)v=v.valueOf();else{b.push("{"),_e="";for(j in v)Object.prototype.hasOwnProperty.call(v,j)&&(at=v[j],typeof at!="function"&&(b.push(_e),tl(j,b),b.push(":"),xo(c,at,b),_e=","));b.push("}");return}}switch(typeof v){case"string":tl(v,b);break;case"number":b.push(isFinite(v)&&!isNaN(v)?String(v):"null");break;case"boolean":b.push(String(v));break;case"function":b.push("null");break;default:throw Error("Unknown type: "+typeof v)}}}var el={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\u000b"},Qf=/\uffff/.test("\uFFFF")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function tl(c,v){v.push('"',c.replace(Qf,function(b){var j=el[b];return j||(j="\\u"+(b.charCodeAt(0)|65536).toString(16).substr(1),el[b]=j),j}),'"')}function Bo(){var c=bn();return $n&&!!zn&&zn==11||/Edge\/\d+/.test(c)}function xr(){return s.window&&s.window.location.href||self&&self.location&&self.location.href||""}function nl(c,v){v=v||s.window;var b="about:blank";c&&(b=Li(Qu(c))),v.location.href=b}function rl(c,v){var b=[],j;for(j in c)if(j in v)if(typeof c[j]!=typeof v[j])b.push(j);else if(G(c[j])){e:{var _e=void 0,at=c[j],ut=v[j];for(_e in at)if(!(_e in ut)||at[_e]!==ut[_e]){_e=!1;break e}for(_e in ut)if(!(_e in at)){_e=!1;break e}_e=!0}_e||b.push(j)}else typeof c[j]=="object"&&c[j]!=null&&v[j]!=null?0<rl(c[j],v[j]).length&&b.push(j):c[j]!==v[j]&&b.push(j);else b.push(j);for(j in v)j in c||b.push(j);return b}function Yf(){var c=bn();return c=Br(c)!=al?null:(c=c.match(/\sChrome\/(\d+)/i))&&c.length==2?parseInt(c[1],10):null,c&&30>c?!1:!$n||!zn||9<zn}function il(c){return c=(c||bn()).toLowerCase(),!!(c.match(/android/)||c.match(/webos/)||c.match(/iphone|ipad|ipod/)||c.match(/blackberry/)||c.match(/windows phone/)||c.match(/iemobile/))}function gr(c){c=c||s.window;try{c.close()}catch{}}function ol(c,v,b){var j=Math.floor(1e9*Math.random()).toString();v=v||500,b=b||600;var _e=(window.screen.availHeight-b)/2,at=(window.screen.availWidth-v)/2;v={width:v,height:b,top:0<_e?_e:0,left:0<at?at:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},b=bn().toLowerCase(),j&&(v.target=j,Nt(b,"crios/")&&(v.target="_blank")),Br(bn())==Wo&&(c=c||"http://localhost",v.scrollbars=!0),b=c||"",(c=v)||(c={}),j=window,v=b instanceof jn?b:Qu(typeof b.href<"u"?b.href:String(b)),b=c.target||b.target,_e=[];for(ut in c)switch(ut){case"width":case"height":case"top":case"left":_e.push(ut+"="+c[ut]);break;case"target":case"noopener":case"noreferrer":break;default:_e.push(ut+"="+(c[ut]?1:0))}var ut=_e.join(",");if((Vt("iPhone")&&!Vt("iPod")&&!Vt("iPad")||Vt("iPad")||Vt("iPod"))&&j.navigator&&j.navigator.standalone&&b&&b!="_self"?(ut=j.document.createElement("A"),v instanceof jn||v instanceof jn||(v=v.la?v.ja():String(v),Hu.test(v)||(v="about:invalid#zClosurez"),v=$o(v)),ut.href=Li(v),ut.setAttribute("target",b),c.noreferrer&&ut.setAttribute("rel","noreferrer"),c=document.createEvent("MouseEvent"),c.initMouseEvent("click",!0,!0,j,1),ut.dispatchEvent(c),ut={}):c.noreferrer?(ut=j.open("",b,ut),c=Li(v),ut&&(Ef&&Nt(c,";")&&(c="'"+c.replace(/'/g,"%27")+"'"),ut.opener=null,si("b/12014412, meta tag with sanitized URL"),c='<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+nn(c)+'">',c=Fi(c),ut.document.write(Wf(c)),ut.document.close())):(ut=j.open(Li(v),b,ut))&&c.noopener&&(ut.opener=null),ut)try{ut.focus()}catch{}return ut}function zf(c){return new rn(function(v){function b(){pr(2e3).then(function(){if(!c||c.closed)v();else return b()})}return b()})}var Xf=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;function Uo(){var c=null;return new rn(function(v){s.document.readyState=="complete"?v():(c=function(){v()},Ao(window,"load",c))}).o(function(v){throw xn(window,"load",c),v})}function Jf(){return Vo(void 0)?Uo().then(function(){return new rn(function(c,v){var b=s.document,j=setTimeout(function(){v(Error("Cordova framework is not ready."))},1e3);b.addEventListener("deviceready",function(){clearTimeout(j),c()},!1)})}):mn(Error("Cordova must run in an Android or iOS file scheme."))}function Vo(c){return c=c||bn(),!(ui()!=="file:"||!c.toLowerCase().match(/iphone|ipad|ipod|android/))}function jo(){var c=s.window;try{return!(!c||c==c.top)}catch{return!1}}function yr(){return typeof s.window!="object"&&typeof s.importScripts=="function"}function Wn(){return i.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":i.INTERNAL.hasOwnProperty("node")?"Node":yr()?"Worker":"Browser"}function sl(){var c=Wn();return c==="ReactNative"||c==="Node"}var Wo="Firefox",al="Chrome";function Br(c){var v=c.toLowerCase();if(Nt(v,"opera/")||Nt(v,"opr/")||Nt(v,"opios/"))return"Opera";if(Nt(v,"iemobile"))return"IEMobile";if(Nt(v,"msie")||Nt(v,"trident/"))return"IE";if(Nt(v,"edge/"))return"Edge";if(Nt(v,"firefox/"))return Wo;if(Nt(v,"silk/"))return"Silk";if(Nt(v,"blackberry"))return"Blackberry";if(Nt(v,"webos"))return"Webos";if(!Nt(v,"safari/")||Nt(v,"chrome/")||Nt(v,"crios/")||Nt(v,"android"))if(!Nt(v,"chrome/")&&!Nt(v,"crios/")||Nt(v,"edge/")){if(Nt(v,"android"))return"Android";if((c=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&c.length==2)return c[1]}else return al;else return"Safari";return"Other"}var ul={Pc:"FirebaseCore-web",Rc:"FirebaseUI-web"};function Ur(c,v){v=v||[];var b=[],j={},_e;for(_e in ul)j[ul[_e]]=!0;for(_e=0;_e<v.length;_e++)typeof j[v[_e]]<"u"&&(delete j[v[_e]],b.push(v[_e]));return b.sort(),v=b,v.length||(v=["FirebaseCore-web"]),b=Wn(),b==="Browser"?(j=bn(),b=Br(j)):b==="Worker"&&(j=bn(),b=Br(j)+"-"+b),b+"/JsCore/"+c+"/"+v.join(",")}function bn(){return s.navigator&&s.navigator.userAgent||""}function fn(c,v){c=c.split("."),v=v||s;for(var b=0;b<c.length&&typeof v=="object"&&v!=null;b++)v=v[c[b]];return b!=c.length&&(v=void 0),v}function qo(){try{var c=s.localStorage,v=jr();if(c)return c.setItem(v,"1"),c.removeItem(v),Bo()?!!s.indexedDB:!0}catch{return yr()&&!!s.indexedDB}return!1}function _r(){return(ai()||ui()==="chrome-extension:"||Vo())&&!sl()&&qo()&&!yr()}function ai(){return ui()==="http:"||ui()==="https:"}function ui(){return s.location&&s.location.protocol||null}function li(c){return c=c||bn(),!(il(c)||Br(c)==Wo)}function ci(c){return typeof c>"u"?null:Zu(c)}function ll(c){var v={},b;for(b in c)c.hasOwnProperty(b)&&c[b]!==null&&c[b]!==void 0&&(v[b]=c[b]);return v}function Vr(c){if(c!==null)return JSON.parse(c)}function jr(c){return c||Math.floor(1e9*Math.random()).toString()}function cl(c){return c=c||bn(),!(Br(c)=="Safari"||c.toLowerCase().match(/iphone|ipad|ipod/))}function hl(){var c=s.___jsl;if(c&&c.H){for(var v in c.H)if(c.H[v].r=c.H[v].r||[],c.H[v].L=c.H[v].L||[],c.H[v].r=c.H[v].L.concat(),c.CP)for(var b=0;b<c.CP.length;b++)c.CP[b]=null}}function Ko(){var c=s.navigator;return c&&typeof c.onLine=="boolean"&&(ai()||ui()==="chrome-extension:"||typeof c.connection<"u")?c.onLine:!0}function Er(c,v){if(c>v)throw Error("Short delay should be less than long delay!");this.c=c,this.b=v,c=bn(),v=Wn(),this.a=il(c)||v==="ReactNative"}Er.prototype.get=function(){return this.a?this.b:this.c};function Go(){var c=s.document;return c&&typeof c.visibilityState<"u"?c.visibilityState=="visible":!0}function Zf(){var c=s.document,v=null;return Go()||!c?Xt():new rn(function(b){v=function(){Go()&&(c.removeEventListener("visibilitychange",v,!1),b())},c.addEventListener("visibilitychange",v,!1)}).o(function(b){throw c.removeEventListener("visibilitychange",v,!1),b})}function fl(c){try{var v=new Date(parseInt(c,10));if(!isNaN(v.getTime())&&!/[^0-9]/.test(c))return v.toUTCString()}catch{}return null}function dl(){return!(!fn("fireauth.oauthhelper",s)&&!fn("fireauth.iframe",s))}var pl={},Ho;try{var Qo={};Object.defineProperty(Qo,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Qo,"abcd",{configurable:!0,enumerable:!0,value:2}),Ho=Qo.abcd==2}catch{Ho=!1}function Yt(c,v,b){Ho?Object.defineProperty(c,v,{configurable:!0,enumerable:!0,value:b}):c[v]=b}function Pn(c,v){if(v)for(var b in v)v.hasOwnProperty(b)&&Yt(c,b,v[b])}function er(c){var v={};return Pn(v,c),v}function _d(c){var v={},b;for(b in c)c.hasOwnProperty(b)&&(v[b]=c[b]);return v}function Id(c,v){if(!v||!v.length)return!0;if(!c)return!1;for(var b=0;b<v.length;b++){var j=c[v[b]];if(j==null||j==="")return!1}return!0}function Yo(c){var v=c;if(typeof c=="object"&&c!=null){v="length"in c?[]:{};for(var b in c)Yt(v,b,Yo(c[b]))}return v}function Jd(c){var v={},b=c[tp],j=c[np];if(c=c[rp],!c||c!=ep&&!b)throw Error("Invalid provider user info!");v[op]=j||null,v[ip]=b||null,Yt(this,ap,c),Yt(this,sp,Yo(v))}var ep="EMAIL_SIGNIN",tp="email",np="newEmail",rp="requestType",ip="email",op="fromEmail",sp="data",ap="operation";function _t(c,v){this.code=hi+c,this.message=v||up[c]||""}ct(_t,Error),_t.prototype.C=function(){return{code:this.code,message:this.message}},_t.prototype.toJSON=function(){return this.C()};function vl(c){var v=c&&c.code;return v?new _t(v.substring(hi.length),c.message):null}var hi="auth/",up={"argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function zo(c){var v=c[lp];if(typeof v>"u")throw new _t("missing-continue-uri");if(typeof v!="string"||typeof v=="string"&&!v.length)throw new _t("invalid-continue-uri");this.h=v,this.b=this.a=null,this.g=!1;var b=c[ml];if(b&&typeof b=="object"){v=b[El];var j=b[yl];if(b=b[_l],typeof v=="string"&&v.length){if(this.a=v,typeof j<"u"&&typeof j!="boolean")throw new _t("argument-error",yl+" property must be a boolean when specified.");if(this.g=!!j,typeof b<"u"&&(typeof b!="string"||typeof b=="string"&&!b.length))throw new _t("argument-error",_l+" property must be a non empty string when specified.");this.b=b||null}else{if(typeof v<"u")throw new _t("argument-error",El+" property must be a non empty string when specified.");if(typeof j<"u"||typeof b<"u")throw new _t("missing-android-pkg-name")}}else if(typeof b<"u")throw new _t("argument-error",ml+" property must be a non null object when specified.");if(this.f=null,(v=c[gl])&&typeof v=="object"){if(v=v[bl],typeof v=="string"&&v.length)this.f=v;else if(typeof v<"u")throw new _t("argument-error",bl+" property must be a non empty string when specified.")}else if(typeof v<"u")throw new _t("argument-error",gl+" property must be a non null object when specified.");if(c=c[Xo],typeof c<"u"&&typeof c!="boolean")throw new _t("argument-error",Xo+" property must be a boolean when specified.");this.c=!!c}var ml="android",Xo="handleCodeInApp",gl="iOS",lp="url",yl="installApp",_l="minimumVersion",El="packageName",bl="bundleId";function Jo(c){var v={};v.continueUrl=c.h,v.canHandleCodeInApp=c.c,(v.androidPackageName=c.a)&&(v.androidMinimumVersion=c.b,v.androidInstallApp=c.g),v.iOSBundleId=c.f;for(var b in v)v[b]===null&&delete v[b];return v}function cp(c){return Ht(c,function(v){return v=v.toString(16),1<v.length?v:"0"+v}).join("")}var xi=null,Bi=null;function hp(c){var v="";return fp(c,function(b){v+=String.fromCharCode(b)}),v}function fp(c,v){function b(Dt){for(;j<c.length;){var jt=c.charAt(j++),un=Bi[jt];if(un!=null)return un;if(!/^[\s\xa0]*$/.test(jt))throw Error("Unknown base64 encoding at char: "+jt)}return Dt}dp();for(var j=0;;){var _e=b(-1),at=b(0),ut=b(64),mt=b(64);if(mt===64&&_e===-1)break;v(_e<<2|at>>4),ut!=64&&(v(at<<4&240|ut>>2),mt!=64&&v(ut<<6&192|mt))}}function dp(){if(!xi){xi={},Bi={};for(var c=0;65>c;c++)xi[c]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c),Bi[xi[c]]=c,62<=c&&(Bi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(c)]=c)}}function Sl(c){this.c=c.sub,this.a=c.provider_id||c.firebase&&c.firebase.sign_in_provider||null,this.b=!!c.is_anonymous||this.a=="anonymous"}Sl.prototype.f=function(){return this.b};function Tl(c){if(c=c.split("."),c.length!=3)return null;c=c[1];for(var v=(4-c.length%4)%4,b=0;b<v;b++)c+=".";try{var j=JSON.parse(hp(c));if(j.sub&&j.iss&&j.aud&&j.exp)return new Sl(j)}catch{}return null}var Cl="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Ui=["client_id","response_type","scope","redirect_uri","state"],Zo={Qc:{Ma:"locale",Aa:500,za:600,Na:"facebook.com",cb:Ui},Sc:{Ma:null,Aa:500,za:620,Na:"github.com",cb:Ui},Tc:{Ma:"hl",Aa:515,za:680,Na:"google.com",cb:Ui},Zc:{Ma:"lang",Aa:485,za:705,Na:"twitter.com",cb:Cl}};function es(c){for(var v in Zo)if(Zo[v].Na==c)return Zo[v];return null}function ts(c){var v={};v["facebook.com"]=Il,v["google.com"]=Rl,v["github.com"]=Nl,v["twitter.com"]=Al;var b=c&&c[wl];try{if(b)return v[b]?new v[b](c):new qn(c);if(typeof c[ns]<"u")return new rs(c)}catch{}return null}var ns="idToken",wl="providerId";function rs(c){var v=c[wl];if(!v&&c[ns]){var b=Tl(c[ns]);b&&b.a&&(v=b.a)}if(!v)throw Error("Invalid additional user info!");(v=="anonymous"||v=="custom")&&(v=null),b=!1,typeof c.isNewUser<"u"?b=!!c.isNewUser:c.kind==="identitytoolkit#SignupNewUserResponse"&&(b=!0),Yt(this,"providerId",v),Yt(this,"isNewUser",b)}function qn(c){rs.call(this,c),c=Vr(c.rawUserInfo||"{}"),Yt(this,"profile",Yo(c||{}))}ct(qn,rs);function Il(c){if(qn.call(this,c),this.providerId!="facebook.com")throw Error("Invalid provider ID!")}ct(Il,qn);function Nl(c){if(qn.call(this,c),this.providerId!="github.com")throw Error("Invalid provider ID!");Yt(this,"username",this.profile&&this.profile.login||null)}ct(Nl,qn);function Rl(c){if(qn.call(this,c),this.providerId!="google.com")throw Error("Invalid provider ID!")}ct(Rl,qn);function Al(c){if(qn.call(this,c),this.providerId!="twitter.com")throw Error("Invalid provider ID!");Yt(this,"username",c.screenName||null)}ct(Al,qn);function pp(c){this.a=Jn(c)}function Vi(c,v){return c.then(function(b){if(b[Bn]){var j=Tl(b[Bn]);if(!j||v!=j.c)throw new _t("user-mismatch");return b}throw new _t("user-mismatch")}).o(function(b){throw b&&b.code&&b.code==hi+"user-not-found"?new _t("user-mismatch"):b})}function Wr(c,v,b){if(v.idToken||v.accessToken)v.idToken&&Yt(this,"idToken",v.idToken),v.accessToken&&Yt(this,"accessToken",v.accessToken);else if(v.oauthToken&&v.oauthTokenSecret)Yt(this,"accessToken",v.oauthToken),Yt(this,"secret",v.oauthTokenSecret);else throw new _t("internal-error","failed to construct a credential");Yt(this,"providerId",c),Yt(this,"signInMethod",b)}Wr.prototype.xa=function(c){return th(c,is(this))},Wr.prototype.c=function(c,v){var b=is(this);return b.idToken=v,nh(c,b)},Wr.prototype.f=function(c,v){var b=is(this);return Vi(rh(c,b),v)};function is(c){var v={};return c.idToken&&(v.id_token=c.idToken),c.accessToken&&(v.access_token=c.accessToken),c.secret&&(v.oauth_token_secret=c.secret),v.providerId=c.providerId,{postBody:Uu(v).toString(),requestUri:"http://localhost"}}Wr.prototype.C=function(){var c={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(c.oauthIdToken=this.idToken),this.accessToken&&(c.oauthAccessToken=this.accessToken),this.secret&&(c.oauthTokenSecret=this.secret),c};function fi(c,v){this.zc=v||[],Pn(this,{providerId:c,isOAuthProvider:!0}),this.tb={},this.Za=(es(c)||{}).Ma||null,this.Xa=null}fi.prototype.Ca=function(c){return this.tb=Qt(c),this};function Dn(c){fi.call(this,c,Ui),this.a=[]}ct(Dn,fi),Dn.prototype.ta=function(c){return Zt(this.a,c)||this.a.push(c),this},Dn.prototype.yb=function(){return $t(this.a)},Dn.prototype.credential=function(c,v){if(!c&&!v)throw new _t("argument-error","credential failed: must provide the ID token and/or the access token.");return new Wr(this.providerId,{idToken:c||null,accessToken:v||null},this.providerId)};function br(){Dn.call(this,"facebook.com")}ct(br,Dn),Yt(br,"PROVIDER_ID","facebook.com"),Yt(br,"FACEBOOK_SIGN_IN_METHOD","facebook.com");function Ol(c){if(!c)throw new _t("argument-error","credential failed: expected 1 argument (the OAuth access token).");var v=c;return tt(c)&&(v=c.accessToken),new br().credential(null,v)}function Sr(){Dn.call(this,"github.com")}ct(Sr,Dn),Yt(Sr,"PROVIDER_ID","github.com"),Yt(Sr,"GITHUB_SIGN_IN_METHOD","github.com");function Pl(c){if(!c)throw new _t("argument-error","credential failed: expected 1 argument (the OAuth access token).");var v=c;return tt(c)&&(v=c.accessToken),new Sr().credential(null,v)}function Tr(){Dn.call(this,"google.com"),this.ta("profile")}ct(Tr,Dn),Yt(Tr,"PROVIDER_ID","google.com"),Yt(Tr,"GOOGLE_SIGN_IN_METHOD","google.com");function Dl(c,v){var b=c;return tt(c)&&(b=c.idToken,v=c.accessToken),new Tr().credential(b,v)}function qr(){fi.call(this,"twitter.com",Cl)}ct(qr,fi),Yt(qr,"PROVIDER_ID","twitter.com"),Yt(qr,"TWITTER_SIGN_IN_METHOD","twitter.com");function kl(c,v){var b=c;if(tt(b)||(b={oauthToken:c,oauthTokenSecret:v}),!b.oauthToken||!b.oauthTokenSecret)throw new _t("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Wr("twitter.com",b,"twitter.com")}function Kr(c,v,b){this.a=c,this.b=v,Yt(this,"providerId","password"),Yt(this,"signInMethod",b===Mn.EMAIL_LINK_SIGN_IN_METHOD?Mn.EMAIL_LINK_SIGN_IN_METHOD:Mn.EMAIL_PASSWORD_SIGN_IN_METHOD)}Kr.prototype.xa=function(c){return this.signInMethod==Mn.EMAIL_LINK_SIGN_IN_METHOD?an(c,Qp,{email:this.a,oobCode:this.b}):an(c,ah,{email:this.a,password:this.b})},Kr.prototype.c=function(c,v){return this.signInMethod==Mn.EMAIL_LINK_SIGN_IN_METHOD?an(c,Yp,{idToken:v,email:this.a,oobCode:this.b}):an(c,sh,{idToken:v,email:this.a,password:this.b})},Kr.prototype.f=function(c,v){return Vi(this.xa(c),v)},Kr.prototype.C=function(){return{email:this.a,password:this.b,signInMethod:this.signInMethod}};function Mn(){Pn(this,{providerId:"password",isOAuthProvider:!1})}function Ml(c,v){if(v=Ll(v),!v)throw new _t("argument-error","Invalid email link!");return new Kr(c,v,Mn.EMAIL_LINK_SIGN_IN_METHOD)}function Ll(c){c=new pp(c);var v=rr(c.a,"oobCode")||null;return(rr(c.a,"mode")||null)==="signIn"&&v?v:null}Pn(Mn,{PROVIDER_ID:"password"}),Pn(Mn,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Pn(Mn,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"});function Gr(c){if(!(c.Ra&&c.Qa||c.Ea&&c.Y))throw new _t("internal-error");this.a=c,Yt(this,"providerId","phone"),Yt(this,"signInMethod","phone")}Gr.prototype.xa=function(c){return c.Sa(os(this))},Gr.prototype.c=function(c,v){var b=os(this);return b.idToken=v,an(c,cv,b)},Gr.prototype.f=function(c,v){var b=os(this);return b.operation="REAUTH",c=an(c,hv,b),Vi(c,v)},Gr.prototype.C=function(){var c={providerId:"phone"};return this.a.Ra&&(c.verificationId=this.a.Ra),this.a.Qa&&(c.verificationCode=this.a.Qa),this.a.Ea&&(c.temporaryProof=this.a.Ea),this.a.Y&&(c.phoneNumber=this.a.Y),c};function os(c){return c.a.Ea&&c.a.Y?{temporaryProof:c.a.Ea,phoneNumber:c.a.Y}:{sessionInfo:c.a.Ra,code:c.a.Qa}}function or(c){try{this.a=c||i.auth()}catch{throw new _t("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Pn(this,{providerId:"phone",isOAuthProvider:!1})}or.prototype.Sa=function(c,v){var b=this.a.b;return Xt(v.verify()).then(function(j){if(!f(j))throw new _t("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(v.type){case"recaptcha":return Vp(b,{phoneNumber:c,recaptchaToken:j}).then(function(_e){return typeof v.reset=="function"&&v.reset(),_e},function(_e){throw typeof v.reset=="function"&&v.reset(),_e});default:throw new _t("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})};function Fl(c,v){if(!c)throw new _t("missing-verification-id");if(!v)throw new _t("missing-verification-code");return new Gr({Ra:c,Qa:v})}Pn(or,{PROVIDER_ID:"phone"}),Pn(or,{PHONE_SIGN_IN_METHOD:"phone"});function ji(c){if(c.temporaryProof&&c.phoneNumber)return new Gr({Ea:c.temporaryProof,Y:c.phoneNumber});var v=c&&c.providerId;if(!v||v==="password")return null;var b=c&&c.oauthAccessToken,j=c&&c.oauthTokenSecret;c=c&&c.oauthIdToken;try{switch(v){case"google.com":return Dl(c,b);case"facebook.com":return Ol(b);case"github.com":return Pl(b);case"twitter.com":return kl(b,j);default:return new Dn(v).credential(c,b)}}catch{return null}}function ss(c){if(!c.isOAuthProvider)throw new _t("invalid-oauth-provider")}function tr(c,v,b,j,_e){if(this.b=c,this.c=v||null,this.f=b||null,this.g=j||null,this.a=_e||null,this.f||this.a){if(this.f&&this.a)throw new _t("invalid-auth-event");if(this.f&&!this.g)throw new _t("invalid-auth-event")}else throw new _t("invalid-auth-event")}tr.prototype.C=function(){return{type:this.b,eventId:this.c,urlResponse:this.f,sessionId:this.g,error:this.a&&this.a.C()}};function $l(c){return c=c||{},c.type?new tr(c.type,c.eventId,c.urlResponse,c.sessionId,c.error&&vl(c.error)):null}function as(){this.b=null,this.a=[]}var us=null;as.prototype.subscribe=function(c){var v=this;this.a.push(c),this.b||(this.b=function(b){for(var j=0;j<v.a.length;j++)v.a[j](b)},c=fn("universalLinks.subscribe",s),typeof c=="function"&&c(null,this.b))},as.prototype.unsubscribe=function(c){_n(this.a,function(v){return v==c})};function ls(c){var v="unauthorized-domain",b=void 0,j=Jn(c);c=j.b,j=j.c,j=="chrome-extension"?b=xt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",c):j=="http"||j=="https"?b=xt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",c):v="operation-not-supported-in-this-environment",_t.call(this,v,b)}ct(ls,_t);function di(c,v,b){_t.call(this,c,b),c=v||{},c.ub&&Yt(this,"email",c.ub),c.Y&&Yt(this,"phoneNumber",c.Y),c.credential&&Yt(this,"credential",c.credential)}ct(di,_t),di.prototype.C=function(){var c={code:this.code,message:this.message};this.email&&(c.email=this.email),this.phoneNumber&&(c.phoneNumber=this.phoneNumber);var v=this.credential&&this.credential.C();return v&&on(c,v),c},di.prototype.toJSON=function(){return this.C()};function Wi(c){if(c.code){var v=c.code||"";v.indexOf(hi)==0&&(v=v.substring(hi.length));var b={credential:ji(c)};if(c.email)b.ub=c.email;else if(c.phoneNumber)b.Y=c.phoneNumber;else return new _t(v,c.message||void 0);return new di(v,b,c.message)}return null}var vp=/^[+a-zA-Z0-9_.!#$%&'*\/=?^`{|}~-]+@([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,63}$/;function pi(){}pi.prototype.c=null;function xl(c){return c.c||(c.c=c.b())}var cs;function qi(){}ct(qi,pi),qi.prototype.a=function(){var c=Bl(this);return c?new ActiveXObject(c):new XMLHttpRequest},qi.prototype.b=function(){var c={};return Bl(this)&&(c[0]=!0,c[1]=!0),c};function Bl(c){if(!c.f&&typeof XMLHttpRequest>"u"&&typeof ActiveXObject<"u"){for(var v=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],b=0;b<v.length;b++){var j=v[b];try{return new ActiveXObject(j),c.f=j}catch{}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return c.f}cs=new qi;function Ki(){}ct(Ki,pi),Ki.prototype.a=function(){var c=new XMLHttpRequest;if("withCredentials"in c)return c;if(typeof XDomainRequest<"u")return new Ul;throw Error("Unsupported browser")},Ki.prototype.b=function(){return{}};function Ul(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseText="",this.status=-1,this.statusText="",this.a.onload=ot(this.ac,this),this.a.onerror=ot(this.zb,this),this.a.onprogress=ot(this.bc,this),this.a.ontimeout=ot(this.ec,this)}e=Ul.prototype,e.open=function(c,v,b){if(b!=null&&!b)throw Error("Only async requests are supported.");this.a.open(c,v)},e.send=function(c){if(c)if(typeof c=="string")this.a.send(c);else throw Error("Only string data is supported");else this.a.send()},e.abort=function(){this.a.abort()},e.setRequestHeader=function(){},e.getResponseHeader=function(c){return c.toLowerCase()=="content-type"?this.a.contentType:""},e.ac=function(){this.status=200,this.responseText=this.a.responseText,hs(this,4)},e.zb=function(){this.status=500,this.responseText="",hs(this,4)},e.ec=function(){this.zb()},e.bc=function(){this.status=200,hs(this,1)};function hs(c,v){c.readyState=v,c.onreadystatechange&&c.onreadystatechange()}e.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType};function fs(c,v,b){this.reset(c,v,b,void 0,void 0)}fs.prototype.a=null,fs.prototype.reset=function(c,v,b,j,_e){delete this.a};function ds(c){this.f=c,this.b=this.c=this.a=null}function vi(c,v){this.name=c,this.value=v}vi.prototype.toString=function(){return this.name};var Vl=new vi("SEVERE",1e3),ps=new vi("WARNING",900),mp=new vi("CONFIG",700),gp=new vi("FINE",500);function jl(c){return c.c?c.c:c.a?jl(c.a):(Mt("Root logger has no level set."),null)}ds.prototype.log=function(c,v,b){if(c.value>=jl(this).value)for(et(v)&&(v=v()),c=new fs(c,String(v),this.f),b&&(c.a=b),b=this;b;)b=b.a};var vs={},Gi=null;function ms(c){Gi||(Gi=new ds(""),vs[""]=Gi,Gi.c=mp);var v;if(!(v=vs[c])){v=new ds(c);var b=c.lastIndexOf("."),j=c.substr(b+1);b=ms(c.substr(0,b)),b.b||(b.b={}),b.b[j]=v,v.a=b,vs[c]=v}return v}function Ln(c,v){c&&c.log(gp,v,void 0)}function Hi(c){this.f=c}ct(Hi,pi),Hi.prototype.a=function(){return new gs(this.f)},Hi.prototype.b=function(c){return function(){return c}}({});function gs(c){wn.call(this),this.i=c,this.readyState=ys,this.status=0,this.responseText=this.statusText="",this.onreadystatechange=null,this.g=new Headers,this.b=null,this.h="GET",this.c="",this.a=!1,this.f=ms("goog.net.FetchXmlHttp")}ct(gs,wn);var ys=0;e=gs.prototype,e.open=function(c,v){if(this.readyState!=ys)throw this.abort(),Error("Error reopening a connection");this.h=c,this.c=v,this.readyState=1,Hr(this)},e.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.a=!0;var v={headers:this.g,method:this.h,credentials:void 0,cache:void 0};c&&(v.body=c),this.i.fetch(new Request(this.c,v)).then(this.dc.bind(this),this.Ab.bind(this))},e.abort=function(){this.responseText="",this.g=new Headers,this.status=0,1<=this.readyState&&this.a&&this.readyState!=4&&(this.readyState=4,this.a=!1,Hr(this)),this.readyState=ys},e.dc=function(c){this.a&&(this.b||(this.b=c.headers,this.readyState=2,Hr(this)),this.a&&(this.readyState=3,Hr(this),this.a&&c.text().then(this.cc.bind(this,c),this.Ab.bind(this))))},e.cc=function(c,v){this.a&&(this.status=c.status,this.statusText=c.statusText,this.responseText=v,this.readyState=4,Hr(this))},e.Ab=function(c){var v=this.f;v&&v.log(ps,"Failed to fetch url "+this.c,c instanceof Error?c:Error(c)),this.a&&(this.readyState=4,Hr(this))},e.setRequestHeader=function(c,v){this.g.append(c,v)},e.getResponseHeader=function(c){return this.b?this.b.get(c.toLowerCase())||"":((c=this.f)&&c.log(ps,"Attempting to get response header but no headers have been received for url: "+this.c,void 0),"")},e.getAllResponseHeaders=function(){if(!this.b){var c=this.f;return c&&c.log(ps,"Attempting to get all response headers but no headers have been received for url: "+this.c,void 0),""}c=[];for(var v=this.b.entries(),b=v.next();!b.done;)b=b.value,c.push(b[0]+": "+b[1]),b=v.next();return c.join(`\r
`)};function Hr(c){c.onreadystatechange&&c.onreadystatechange.call(c)}function mi(c){wn.call(this),this.headers=new Dr,this.D=c||null,this.c=!1,this.A=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.s=null,this.m=Wl,this.v=this.O=!1}ct(mi,wn);var Wl="";mi.prototype.b=ms("goog.net.XhrIo");var yp=/^https?$/i,_p=["POST","PUT"];function Ep(c,v,b,j,_e){if(c.a)throw Error("[goog.net.XhrIo] Object is active with another request="+c.l+"; newUri="+v);b=b?b.toUpperCase():"GET",c.l=v,c.h="",c.N=b,c.G=!1,c.c=!0,c.a=c.D?c.D.a():cs.a(),c.A=c.D?xl(c.D):xl(cs),c.a.onreadystatechange=ot(c.Db,c);try{Ln(c.b,nr(c,"Opening Xhr")),c.I=!0,c.a.open(b,String(v),!0),c.I=!1}catch(ut){Ln(c.b,nr(c,"Error opening Xhr: "+ut.message)),ql(c,ut);return}v=j||"";var at=new Dr(c.headers);_e&&Pf(_e,function(ut,mt){at.set(mt,ut)}),_e=gn(at.T()),j=s.FormData&&v instanceof s.FormData,!Zt(_p,b)||_e||j||at.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),at.forEach(function(ut,mt){this.a.setRequestHeader(mt,ut)},c),c.m&&(c.a.responseType=c.m),"withCredentials"in c.a&&c.a.withCredentials!==c.O&&(c.a.withCredentials=c.O);try{Hl(c),0<c.g&&(c.v=bp(c.a),Ln(c.b,nr(c,"Will abort after "+c.g+"ms if incomplete, xhr2 "+c.v)),c.v?(c.a.timeout=c.g,c.a.ontimeout=ot(c.Fa,c)):c.s=ko(c.Fa,c.g,c)),Ln(c.b,nr(c,"Sending request")),c.i=!0,c.a.send(v),c.i=!1}catch(ut){Ln(c.b,nr(c,"Send error: "+ut.message)),ql(c,ut)}}function bp(c){return $n&&Cu(9)&&typeof c.timeout=="number"&&c.ontimeout!==void 0}function Sp(c){return c.toLowerCase()=="content-type"}e=mi.prototype,e.Fa=function(){typeof o<"u"&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Ln(this.b,nr(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))};function ql(c,v){c.c=!1,c.a&&(c.f=!0,c.a.abort(),c.f=!1),c.h=v,Kl(c),Qi(c)}function Kl(c){c.G||(c.G=!0,c.dispatchEvent("complete"),c.dispatchEvent("error"))}e.abort=function(){this.a&&this.c&&(Ln(this.b,nr(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Qi(this))},e.ua=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),Qi(this,!0)),mi.lb.ua.call(this)},e.Db=function(){this.pa||(this.I||this.i||this.f?Gl(this):this.sc())},e.sc=function(){Gl(this)};function Gl(c){if(c.c&&typeof o<"u"){if(c.A[1]&&gi(c)==4&&Yi(c)==2)Ln(c.b,nr(c,"Local request error detected and ignored"));else if(c.i&&gi(c)==4)ko(c.Db,0,c);else if(c.dispatchEvent("readystatechange"),gi(c)==4){Ln(c.b,nr(c,"Request complete")),c.c=!1;try{var v=Yi(c);e:switch(v){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break e;default:b=!1}var j;if(!(j=b)){var _e;if(_e=v===0){var at=String(c.l).match(Lu)[1]||null;if(!at&&s.self&&s.self.location){var ut=s.self.location.protocol;at=ut.substr(0,ut.length-1)}_e=!yp.test(at?at.toLowerCase():"")}j=_e}if(j)c.dispatchEvent("complete"),c.dispatchEvent("success");else{try{var mt=2<gi(c)?c.a.statusText:""}catch(Dt){Ln(c.b,"Can not get status: "+Dt.message),mt=""}c.h=mt+" ["+Yi(c)+"]",Kl(c)}}finally{Qi(c)}}}}function Qi(c,v){if(c.a){Hl(c);var b=c.a,j=c.A[0]?m:null;c.a=null,c.A=null,v||c.dispatchEvent("ready");try{b.onreadystatechange=j}catch(_e){(c=c.b)&&c.log(Vl,"Problem encountered resetting onreadystatechange: "+_e.message,void 0)}}}function Hl(c){c.a&&c.v&&(c.a.ontimeout=null),c.s&&(s.clearTimeout(c.s),c.s=null)}function gi(c){return c.a?c.a.readyState:0}function Yi(c){try{return 2<gi(c)?c.a.status:-1}catch{return-1}}function Tp(c){try{return c.a?c.a.responseText:""}catch(v){return Ln(c.b,"Can not get responseText: "+v.message),""}}e.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case Wl:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var c=this.b;return c&&c.log(Vl,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(v){return Ln(this.b,"Can not get response: "+v.message),null}};function nr(c,v){return v+" ["+c.N+" "+c.l+" "+Yi(c)+"]"}function sr(c,v){this.g=[],this.v=c,this.s=v||null,this.f=this.a=!1,this.c=void 0,this.u=this.A=this.i=!1,this.h=0,this.b=null,this.l=0}sr.prototype.cancel=function(c){if(this.a)this.c instanceof sr&&this.c.cancel();else{if(this.b){var v=this.b;delete this.b,c?v.cancel(c):(v.l--,0>=v.l&&v.cancel())}this.v?this.v.call(this.s,this):this.u=!0,this.a||(c=new _i,zi(this),yi(this,!1,c))}},sr.prototype.m=function(c,v){this.i=!1,yi(this,c,v)};function yi(c,v,b){c.a=!0,c.c=b,c.f=!v,Yl(c)}function zi(c){if(c.a){if(!c.u)throw new Xi;c.u=!1}}sr.prototype.D=function(){zi(this),yi(this,!0,null)};function Cp(c,v){_s(c,null,v,void 0)}function _s(c,v,b,j){c.g.push([v,b,j]),c.a&&Yl(c)}sr.prototype.then=function(c,v,b){var j,_e,at=new rn(function(ut,mt){j=ut,_e=mt});return _s(this,j,function(ut){ut instanceof _i?at.cancel():_e(ut)}),at.then(c,v,b)},pt(sr);function Ql(c){return ln(c.g,function(v){return et(v[1])})}function Yl(c){if(c.h&&c.a&&Ql(c)){var v=c.h,b=Ji[v];b&&(s.clearTimeout(b.a),delete Ji[v]),c.h=0}c.b&&(c.b.l--,delete c.b),v=c.c;for(var j=b=!1;c.g.length&&!c.i;){var _e=c.g.shift(),at=_e[0],ut=_e[1];if(_e=_e[2],at=c.f?ut:at)try{var mt=at.call(_e||c.s,v);mt!==void 0&&(c.f=c.f&&(mt==v||mt instanceof Error),c.c=v=mt),(gt(v)||typeof s.Promise=="function"&&v instanceof s.Promise)&&(j=!0,c.i=!0)}catch(Dt){v=Dt,c.f=!0,Ql(c)||(b=!0)}}c.c=v,j&&(mt=ot(c.m,c,!0),j=ot(c.m,c,!1),v instanceof sr?(_s(v,mt,j),v.A=!0):v.then(mt,j)),b&&(v=new zl(v),Ji[v.a]=v,c.h=v.a)}function Xi(){Tt.call(this)}ct(Xi,Tt),Xi.prototype.message="Deferred has already fired",Xi.prototype.name="AlreadyCalledError";function _i(){Tt.call(this)}ct(_i,Tt),_i.prototype.message="Deferred was canceled",_i.prototype.name="CanceledError";function zl(c){this.a=s.setTimeout(ot(this.c,this),0),this.b=c}zl.prototype.c=function(){throw delete Ji[this.a],this.b};var Ji={};function Es(c){var v={},b=v.document||document,j=Ku(c),_e=document.createElement("SCRIPT"),at={Fb:_e,Fa:void 0},ut=new sr(Ip,at),mt=null,Dt=v.timeout!=null?v.timeout:5e3;return 0<Dt&&(mt=window.setTimeout(function(){Zi(_e,!0);var jt=new bs(Rp,"Timeout reached for loading script "+j);zi(ut),yi(ut,!1,jt)},Dt),at.Fa=mt),_e.onload=_e.onreadystatechange=function(){_e.readyState&&_e.readyState!="loaded"&&_e.readyState!="complete"||(Zi(_e,v.ad||!1,mt),ut.D())},_e.onerror=function(){Zi(_e,!0,mt);var jt=new bs(Np,"Error while loading script "+j);zi(ut),yi(ut,!1,jt)},at=v.attributes||{},on(at,{type:"text/javascript",charset:"UTF-8"}),Xu(_e,at),_e.src=Ku(c),wp(b).appendChild(_e),ut}function wp(c){var v;return(v=(c||document).getElementsByTagName("HEAD"))&&v.length!=0?v[0]:c.documentElement}function Ip(){if(this&&this.Fb){var c=this.Fb;c&&c.tagName=="SCRIPT"&&Zi(c,!0,this.Fa)}}function Zi(c,v,b){b!=null&&s.clearTimeout(b),c.onload=m,c.onerror=m,c.onreadystatechange=m,v&&window.setTimeout(function(){c&&c.parentNode&&c.parentNode.removeChild(c)},0)}var Np=0,Rp=1;function bs(c,v){var b="Jsloader error (code #"+c+")";v&&(b+=": "+v),Tt.call(this,b),this.code=c}ct(bs,Tt);function eo(c){this.f=c}ct(eo,pi),eo.prototype.a=function(){return new this.f},eo.prototype.b=function(){return{}};function Kn(c,v,b){if(this.b=c,c=v||{},this.i=c.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.l=c.secureTokenTimeout||Ap,this.f=Qt(c.secureTokenHeaders||Op),this.g=c.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=c.firebaseTimeout||Pp,this.a=Qt(c.firebaseHeaders||Dp),b&&(this.a["X-Client-Version"]=b,this.f["X-Client-Version"]=b),b=Wn()=="Node",b=s.XMLHttpRequest||b&&i.INTERNAL.node&&i.INTERNAL.node.XMLHttpRequest,!b&&!yr())throw new _t("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,yr()?this.c=new Hi(self):sl()?this.c=new eo(b):this.c=new Ki}var Ss,Bn="idToken",Ap=new Er(3e4,6e4),Op={"Content-Type":"application/x-www-form-urlencoded"},Pp=new Er(3e4,6e4),Dp={"Content-Type":"application/json"};function Xl(c,v){v?c.a["X-Firebase-Locale"]=v:delete c.a["X-Firebase-Locale"]}function Jl(c,v){v?(c.a["X-Client-Version"]=v,c.f["X-Client-Version"]=v):(delete c.a["X-Client-Version"],delete c.f["X-Client-Version"])}function Zl(c,v,b,j,_e,at,ut){Ko()?(Yf()||yr()?c=ot(c.m,c):(Ss||(Ss=new rn(function(mt,Dt){Mp(mt,Dt)})),c=ot(c.u,c)),c(v,b,j,_e,at,ut)):b&&b(null)}Kn.prototype.m=function(c,v,b,j,_e,at){var ut=new mi(this.c);if(at){ut.g=Math.max(0,at);var mt=setTimeout(function(){ut.dispatchEvent("timeout")},at)}Du(ut,"complete",function(){mt&&clearTimeout(mt);var Dt=null;try{Dt=JSON.parse(Tp(this))||null}catch{Dt=null}v&&v(Dt)}),Do(ut,"ready",function(){mt&&clearTimeout(mt),Eu(this)}),Do(ut,"timeout",function(){mt&&clearTimeout(mt),Eu(this),v&&v(null)}),Ep(ut,c,b,j,_e)};var kp=si("https://apis.google.com/js/client.js?onload=%{onload}"),ec="__fcb"+Math.floor(1e6*Math.random()).toString();function Mp(c,v){if(((window.gapi||{}).client||{}).request)c();else{s[ec]=function(){((window.gapi||{}).client||{}).request?c():v(Error("CORS_UNSUPPORTED"))};var b=Fo(kp,{onload:ec});Cp(Es(b),function(){v(Error("CORS_UNSUPPORTED"))})}}Kn.prototype.u=function(c,v,b,j,_e){var at=this;Ss.then(function(){window.gapi.client.setApiKey(at.b);var ut=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:c,method:b,body:j,headers:_e,authType:"none",callback:function(mt){window.gapi.auth.setToken(ut),v&&v(mt)}})}).o(function(ut){v&&v({error:{message:ut&&ut.message||"CORS_UNSUPPORTED"}})})};function Lp(c,v){return new rn(function(b,j){v.grant_type=="refresh_token"&&v.refresh_token||v.grant_type=="authorization_code"&&v.code?Zl(c,c.i+"?key="+encodeURIComponent(c.b),function(_e){_e?_e.error?j(Is(_e)):_e.access_token&&_e.refresh_token?b(_e):j(new _t("internal-error")):j(new _t("network-request-failed"))},"POST",Uu(v).toString(),c.f,c.l.get()):j(new _t("internal-error"))})}function Fp(c,v,b,j,_e,at){var ut=Jn(c.g+v);yn(ut,"key",c.b),at&&yn(ut,"cb",ft().toString());var mt=b=="GET";if(mt)for(var Dt in j)j.hasOwnProperty(Dt)&&yn(ut,Dt,j[Dt]);return new rn(function(jt,un){Zl(c,ut.toString(),function(vn){vn?vn.error?un(Is(vn,_e||{})):jt(vn):un(new _t("network-request-failed"))},b,mt?void 0:Zu(ll(j)),c.a,c.h.get())})}function Cr(c){if(!vp.test(c.email))throw new _t("invalid-email")}function _c(c){"email"in c&&Cr(c)}function $p(c,v){return an(c,ih,{identifier:v,continueUri:ai()?xr():"http://localhost"}).then(function(b){return b.allProviders||[]})}function xp(c,v){return an(c,ih,{identifier:v,continueUri:ai()?xr():"http://localhost"}).then(function(b){return b.signinMethods||[]})}function Bp(c){return an(c,ev,{}).then(function(v){return v.authorizedDomains||[]})}function Gn(c){if(!c[Bn])throw new _t("internal-error")}function Ts(c){if(c.phoneNumber||c.temporaryProof){if(!c.phoneNumber||!c.temporaryProof)throw new _t("internal-error")}else{if(!c.sessionInfo)throw new _t("missing-verification-id");if(!c.code)throw new _t("missing-verification-code")}}Kn.prototype.jb=function(){return an(this,iv,{})},Kn.prototype.mb=function(c,v){return an(this,oh,{idToken:c,email:v})},Kn.prototype.nb=function(c,v){return an(this,sh,{idToken:c,password:v})};var Up={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};e=Kn.prototype,e.ob=function(c,v){var b={idToken:c},j=[];return Wt(Up,function(_e,at){var ut=v[at];ut===null?j.push(_e):at in v&&(b[at]=ut)}),j.length&&(b.deleteAttribute=j),an(this,oh,b)},e.gb=function(c,v){return c={requestType:"PASSWORD_RESET",email:c},on(c,v),an(this,Zp,c)},e.hb=function(c,v){return c={requestType:"EMAIL_SIGNIN",email:c},on(c,v),an(this,Xp,c)},e.fb=function(c,v){return c={requestType:"VERIFY_EMAIL",idToken:c},on(c,v),an(this,Jp,c)};function Vp(c,v){return an(c,rv,v)}e.Sa=function(c){return an(this,lv,c)};function jp(c,v,b){return an(c,Hp,{idToken:v,deleteProvider:b})}function Cs(c){if(!c.requestUri||!c.sessionId&&!c.postBody)throw new _t("internal-error")}function eh(c){var v=null;if(c.needConfirmation?(c.code="account-exists-with-different-credential",v=Wi(c)):c.errorMessage=="FEDERATED_USER_ID_ALREADY_LINKED"?(c.code="credential-already-in-use",v=Wi(c)):c.errorMessage=="EMAIL_EXISTS"?(c.code="email-already-in-use",v=Wi(c)):c.errorMessage&&(v=uh(c.errorMessage)),v)throw v;if(!c[Bn])throw new _t("internal-error")}function th(c,v){return v.returnIdpCredential=!0,an(c,ov,v)}function nh(c,v){return v.returnIdpCredential=!0,an(c,av,v)}function rh(c,v){return v.returnIdpCredential=!0,v.autoCreate=!1,an(c,sv,v)}function ws(c){if(!c.oobCode)throw new _t("invalid-action-code")}e.Wa=function(c,v){return an(this,nv,{oobCode:c,newPassword:v})},e.Ia=function(c){return an(this,qp,{oobCode:c})},e.Ua=function(c){return an(this,Wp,{oobCode:c})};var Wp={endpoint:"setAccountInfo",w:ws,$:"email"},qp={endpoint:"resetPassword",w:ws,J:function(c){if(!c.email||!c.requestType)throw new _t("internal-error")}},Kp={endpoint:"signupNewUser",w:function(c){if(Cr(c),!c.password)throw new _t("weak-password")},J:Gn,P:!0},ih={endpoint:"createAuthUri"},Gp={endpoint:"deleteAccount",S:["idToken"]},Hp={endpoint:"setAccountInfo",S:["idToken","deleteProvider"],w:function(c){if(!G(c.deleteProvider))throw new _t("internal-error")}},Qp={endpoint:"emailLinkSignin",S:["email","oobCode"],w:Cr,J:Gn,P:!0},Yp={endpoint:"emailLinkSignin",S:["idToken","email","oobCode"],w:Cr,J:Gn,P:!0},zp={endpoint:"getAccountInfo"},Xp={endpoint:"getOobConfirmationCode",S:["requestType"],w:function(c){if(c.requestType!="EMAIL_SIGNIN")throw new _t("internal-error");Cr(c)},$:"email"},Jp={endpoint:"getOobConfirmationCode",S:["idToken","requestType"],w:function(c){if(c.requestType!="VERIFY_EMAIL")throw new _t("internal-error")},$:"email"},Zp={endpoint:"getOobConfirmationCode",S:["requestType"],w:function(c){if(c.requestType!="PASSWORD_RESET")throw new _t("internal-error");Cr(c)},$:"email"},ev={pb:!0,endpoint:"getProjectConfig",Cb:"GET"},tv={pb:!0,endpoint:"getRecaptchaParam",Cb:"GET",J:function(c){if(!c.recaptchaSiteKey)throw new _t("internal-error")}},nv={endpoint:"resetPassword",w:ws,$:"email"},rv={endpoint:"sendVerificationCode",S:["phoneNumber","recaptchaToken"],$:"sessionInfo"},oh={endpoint:"setAccountInfo",S:["idToken"],w:_c,P:!0},sh={endpoint:"setAccountInfo",S:["idToken"],w:function(c){if(_c(c),!c.password)throw new _t("weak-password")},J:Gn,P:!0},iv={endpoint:"signupNewUser",J:Gn,P:!0},ov={endpoint:"verifyAssertion",w:Cs,J:eh,P:!0},sv={endpoint:"verifyAssertion",w:Cs,J:function(c){if(c.errorMessage&&c.errorMessage=="USER_NOT_FOUND")throw new _t("user-not-found");if(c.errorMessage)throw uh(c.errorMessage);if(!c[Bn])throw new _t("internal-error")},P:!0},av={endpoint:"verifyAssertion",w:function(c){if(Cs(c),!c.idToken)throw new _t("internal-error")},J:eh,P:!0},uv={endpoint:"verifyCustomToken",w:function(c){if(!c.token)throw new _t("invalid-custom-token")},J:Gn,P:!0},ah={endpoint:"verifyPassword",w:function(c){if(Cr(c),!c.password)throw new _t("wrong-password")},J:Gn,P:!0},lv={endpoint:"verifyPhoneNumber",w:Ts,J:Gn},cv={endpoint:"verifyPhoneNumber",w:function(c){if(!c.idToken)throw new _t("internal-error");Ts(c)},J:function(c){if(c.temporaryProof)throw c.code="credential-already-in-use",Wi(c);Gn(c)}},hv={Tb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",w:Ts,J:Gn};function an(c,v,b){if(!Id(b,v.S))return mn(new _t("internal-error"));var j=v.Cb||"POST",_e;return Xt(b).then(v.w).then(function(){return v.P&&(b.returnSecureToken=!0),Fp(c,v.endpoint,j,b,v.Tb,v.pb||!1)}).then(function(at){return _e=at}).then(v.J).then(function(){if(!v.$)return _e;if(!(v.$ in _e))throw new _t("internal-error");return _e[v.$]})}function uh(c){return Is({error:{errors:[{message:c}],code:400,message:c}})}function Is(c,v){var b=(c.error&&c.error.errors&&c.error.errors[0]||{}).reason||"",j={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(b=j[b]?new _t(j[b]):null)return b;b=c.error&&c.error.message||"",j={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash"},on(j,v||{}),v=(v=b.match(/^[^\s]+\s*:\s*(.*)$/))&&1<v.length?v[1]:void 0;for(var _e in j)if(b.indexOf(_e)===0)return new _t(j[_e],v);return!v&&c&&(v=ci(c)),new _t("internal-error",v)}var Ns={Vc:{Ya:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",eb:"https://securetoken.googleapis.com/v1/token",id:"p"},Xc:{Ya:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",eb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},Yc:{Ya:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",eb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ei(c){for(var v in Ns)if(Ns[v].id===c)return c=Ns[v],{firebaseEndpoint:c.Ya,secureTokenEndpoint:c.eb};return null}var bi;bi=Ei("__EID__")?"__EID__":void 0;function fv(c){this.b=c,this.a=null,this.ab=dv(this)}function dv(c){return _v().then(function(){return new rn(function(v,b){fn("gapi.iframes.getContext")().open({where:document.body,url:c.b,messageHandlersFilter:fn("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(j){function _e(){clearTimeout(at),v()}c.a=j,c.a.restyle({setHideOnLeave:!1});var at=setTimeout(function(){b(Error("Network Error"))},yv.get());j.ping(_e).then(_e,function(){b(Error("Network Error"))})})})})}function pv(c,v){return c.ab.then(function(){return new rn(function(b){c.a.send(v.type,v,b,fn("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}function vv(c,v){c.ab.then(function(){c.a.register("authEvent",v,fn("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}var mv=si("https://apis.google.com/js/api.js?onload=%{onload}"),gv=new Er(3e4,6e4),yv=new Er(5e3,15e3),to=null;function _v(){return to||(to=new rn(function(c,v){if(Ko()){var b=function(){hl(),fn("gapi.load")("gapi.iframes",{callback:c,ontimeout:function(){hl(),v(Error("Network Error"))},timeout:gv.get()})};if(fn("gapi.iframes.Iframe"))c();else if(fn("gapi.load"))b();else{var j="__iframefcb"+Math.floor(1e6*Math.random()).toString();s[j]=function(){fn("gapi.load")?b():v(Error("Network Error"))},j=Fo(mv,{onload:j}),Xt(Es(j)).o(function(){v(Error("Network Error"))})}}else v(Error("Network Error"))}).o(function(c){throw to=null,c}))}function lh(c,v,b){this.i=c,this.g=v,this.h=b,this.f=null,this.a=xu(this.i,"/__/auth/iframe"),yn(this.a,"apiKey",this.g),yn(this.a,"appName",this.h),this.b=null,this.c=[]}lh.prototype.toString=function(){return this.f?yn(this.a,"v",this.f):Zn(this.a.a,"v"),this.b?yn(this.a,"eid",this.b):Zn(this.a.a,"eid"),this.c.length?yn(this.a,"fw",this.c.join(",")):Zn(this.a.a,"fw"),this.a.toString()};function ch(c,v,b,j,_e){this.m=c,this.u=v,this.c=b,this.l=j,this.h=this.g=this.i=null,this.a=_e,this.f=null}ch.prototype.toString=function(){var c=xu(this.m,"/__/auth/handler");if(yn(c,"apiKey",this.u),yn(c,"appName",this.c),yn(c,"authType",this.l),this.a.isOAuthProvider){var v=this.a;try{var b=i.app(this.c).auth().aa()}catch{b=null}v.Xa=b,yn(c,"providerId",this.a.providerId),v=this.a,b=ll(v.tb);for(var j in b)b[j]=b[j].toString();j=v.zc,b=Qt(b);for(var _e=0;_e<j.length;_e++){var at=j[_e];at in b&&delete b[at]}v.Za&&v.Xa&&!b[v.Za]&&(b[v.Za]=v.Xa),qt(b)||yn(c,"customParameters",ci(b))}if(typeof this.a.yb=="function"&&(v=this.a.yb(),v.length&&yn(c,"scopes",v.join(","))),this.i?yn(c,"redirectUrl",this.i):Zn(c.a,"redirectUrl"),this.g?yn(c,"eventId",this.g):Zn(c.a,"eventId"),this.h?yn(c,"v",this.h):Zn(c.a,"v"),this.b)for(var ut in this.b)this.b.hasOwnProperty(ut)&&!rr(c,ut)&&yn(c,ut,this.b[ut]);return this.f?yn(c,"eid",this.f):Zn(c.a,"eid"),ut=Rs(this.c),ut.length&&yn(c,"fw",ut.join(",")),c.toString()};function Rs(c){try{return i.app(c).auth().Ka()}catch{return[]}}function hh(c,v,b,j,_e){this.u=c,this.f=v,this.b=b,this.c=j||null,this.h=_e||null,this.m=this.s=this.v=null,this.g=[],this.l=this.a=null}function fh(c){var v=xr();return Bp(c).then(function(b){e:{var j=Jn(v),_e=j.c;j=j.b;for(var at=0;at<b.length;at++){var ut=b[at],mt=j,Dt=_e;if(ut.indexOf("chrome-extension://")==0?mt=Jn(ut).b==mt&&Dt=="chrome-extension":Dt!="http"&&Dt!="https"?mt=!1:Xf.test(ut)?mt=mt==ut:(ut=ut.split(".").join("\\."),mt=new RegExp("^(.+\\."+ut+"|"+ut+")$","i").test(mt)),mt){b=!0;break e}}b=!1}if(!b)throw new ls(xr())})}function dh(c){return c.l||(c.l=Uo().then(function(){if(!c.s){var v=c.c,b=c.h,j=Rs(c.b),_e=new lh(c.u,c.f,c.b);_e.f=v,_e.b=b,_e.c=$t(j||[]),c.s=_e.toString()}c.i=new fv(c.s),Ev(c)})),c.l}e=hh.prototype,e.Da=function(c,v,b){var j=new _t("popup-closed-by-user"),_e=new _t("web-storage-unsupported"),at=this,ut=!1;return this.ca().then(function(){bv(at).then(function(mt){mt||(c&&gr(c),v(_e),ut=!0)})}).o(function(){}).then(function(){if(!ut)return zf(c)}).then(function(){if(!ut)return pr(b).then(function(){v(j)})})},e.Gb=function(){var c=bn();return!li(c)&&!cl(c)},e.Bb=function(){return!1},e.xb=function(c,v,b,j,_e,at,ut){if(!c)return mn(new _t("popup-blocked"));if(ut&&!li())return this.ca().o(function(Dt){gr(c),_e(Dt)}),j(),Xt();this.a||(this.a=fh(ph(this)));var mt=this;return this.a.then(function(){var Dt=mt.ca().o(function(jt){throw gr(c),_e(jt),jt});return j(),Dt}).then(function(){if(ss(b),!ut){var Dt=Si(mt.u,mt.f,mt.b,v,b,null,at,mt.c,void 0,mt.h);nl(Dt,c)}}).o(function(Dt){throw Dt.code=="auth/network-request-failed"&&(mt.a=null),Dt})};function ph(c){return c.m||(c.v=c.c?Ur(c.c,Rs(c.b)):null,c.m=new Kn(c.f,Ei(c.h),c.v)),c.m}e.Ba=function(c,v,b){this.a||(this.a=fh(ph(this)));var j=this;return this.a.then(function(){ss(v);var _e=Si(j.u,j.f,j.b,c,v,xr(),b,j.c,void 0,j.h);nl(_e)}).o(function(_e){throw _e.code=="auth/network-request-failed"&&(j.a=null),_e})},e.ca=function(){var c=this;return dh(this).then(function(){return c.i.ab}).o(function(){throw c.a=null,new _t("network-request-failed")})},e.Lb=function(){return!0};function Si(c,v,b,j,_e,at,ut,mt,Dt,jt){return c=new ch(c,v,b,j,_e),c.i=at,c.g=ut,c.h=mt,c.b=Qt(Dt||null),c.f=jt,c.toString()}function Ev(c){if(!c.i)throw Error("IfcHandler must be initialized!");vv(c.i,function(v){var b={};if(v&&v.authEvent){var j=!1;for(v=$l(v.authEvent),b=0;b<c.g.length;b++)j=c.g[b](v)||j;return b={},b.status=j?"ACK":"ERROR",Xt(b)}return b.status="ERROR",Xt(b)})}function bv(c){var v={type:"webStorageSupport"};return dh(c).then(function(){return pv(c.i,v)}).then(function(b){if(b&&b.length&&typeof b[0].webStorageSupport<"u")return b[0].webStorageSupport;throw Error()})}e.va=function(c){this.g.push(c)},e.Ja=function(c){_n(this.g,function(v){return v==c})};function vh(c){if(this.a=c||i.INTERNAL.reactNative&&i.INTERNAL.reactNative.AsyncStorage,!this.a)throw new _t("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}e=vh.prototype,e.get=function(c){return Xt(this.a.getItem(c)).then(function(v){return v&&Vr(v)})},e.set=function(c,v){return Xt(this.a.setItem(c,ci(v)))},e.X=function(c){return Xt(this.a.removeItem(c))},e.ia=function(){},e.ea=function(){};function no(){this.a={},this.type="inMemory"}e=no.prototype,e.get=function(c){return Xt(this.a[c])},e.set=function(c,v){return this.a[c]=v,Xt()},e.X=function(c){return delete this.a[c],Xt()},e.ia=function(){},e.ea=function(){};function mh(){try{var c=!!s.indexedDB}catch{c=!1}if(!c)throw new _t("web-storage-unsupported");this.f={},this.c=[],this.a=0,this.h=s.indexedDB,this.type="indexedDB"}var As;function Sv(c){return new rn(function(v,b){var j=c.h.open("firebaseLocalStorageDb",1);j.onerror=function(_e){b(Error(_e.target.errorCode))},j.onupgradeneeded=function(_e){_e=_e.target.result;try{_e.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(at){b(at)}},j.onsuccess=function(_e){v(_e.target.result)}})}function ro(c){return c.g||(c.g=Sv(c)),c.g}function Ti(c){return c.objectStore("firebaseLocalStorage")}function Ci(c,v){return c.transaction(["firebaseLocalStorage"],v?"readwrite":"readonly")}function Qr(c){return new rn(function(v,b){c.onsuccess=function(j){j&&j.target?v(j.target.result):v()},c.onerror=function(j){b(Error(j.target.errorCode))}})}e=mh.prototype,e.set=function(c,v){var b=!1,j,_e=this;return ro(this).then(function(at){return j=at,at=Ti(Ci(j,!0)),Qr(at.get(c))}).then(function(at){var ut=Ti(Ci(j,!0));return at?(at.value=v,Qr(ut.put(at))):(_e.a++,b=!0,at={},at.fbase_key=c,at.value=v,Qr(ut.add(at)))}).then(function(){_e.f[c]=v}).ga(function(){b&&_e.a--})},e.get=function(c){return ro(this).then(function(v){return Qr(Ti(Ci(v,!1)).get(c))}).then(function(v){return v&&v.value})},e.X=function(c){var v=!1,b=this;return ro(this).then(function(j){return v=!0,b.a++,Qr(Ti(Ci(j,!0)).delete(c))}).then(function(){delete b.f[c]}).ga(function(){v&&b.a--})},e.Ic=function(){var c=this;return ro(this).then(function(v){var b=Ti(Ci(v,!1));return b.getAll?Qr(b.getAll()):new rn(function(j,_e){var at=[],ut=b.openCursor();ut.onsuccess=function(mt){(mt=mt.target.result)?(at.push(mt.value),mt.continue()):j(at)},ut.onerror=function(mt){_e(Error(mt.target.errorCode))}})}).then(function(v){var b={},j=[];if(c.a==0){for(j=0;j<v.length;j++)b[v[j].fbase_key]=v[j].value;j=rl(c.f,b),c.f=b}return j})},e.ia=function(c){this.c.length==0&&Tv(this),this.c.push(c)},e.ea=function(c){_n(this.c,function(v){return v==c}),this.c.length==0&&this.b&&this.b.cancel("STOP_EVENT")};function Tv(c){function v(){return c.b=pr(800).then(ot(c.Ic,c)).then(function(b){0<b.length&&Bt(c.c,function(j){j(b)})}).then(v).o(function(b){b.message!="STOP_EVENT"&&v()}),c.b}c.b&&c.b.cancel("STOP_EVENT"),v()}function io(){if(!Cv())throw Wn()=="Node"?new _t("internal-error","The LocalStorage compatibility library was not found."):new _t("web-storage-unsupported");this.a=gh()||i.INTERNAL.node.localStorage,this.type="localStorage"}function gh(){try{var c=s.localStorage,v=jr();return c&&(c.setItem(v,"1"),c.removeItem(v)),c}catch{return null}}function Cv(){var c=Wn()=="Node";if(c=gh()||c&&i.INTERNAL.node&&i.INTERNAL.node.localStorage,!c)return!1;try{return c.setItem("__sak","1"),c.removeItem("__sak"),!0}catch{return!1}}e=io.prototype,e.get=function(c){var v=this;return Xt().then(function(){var b=v.a.getItem(c);return Vr(b)})},e.set=function(c,v){var b=this;return Xt().then(function(){var j=ci(v);j===null?b.X(c):b.a.setItem(c,j)})},e.X=function(c){var v=this;return Xt().then(function(){v.a.removeItem(c)})},e.ia=function(c){s.window&&Xn(s.window,"storage",c)},e.ea=function(c){s.window&&xn(s.window,"storage",c)};function Os(){this.type="nullStorage"}e=Os.prototype,e.get=function(){return Xt(null)},e.set=function(){return Xt()},e.X=function(){return Xt()},e.ia=function(){},e.ea=function(){};function Ps(){if(!wv())throw Wn()=="Node"?new _t("internal-error","The SessionStorage compatibility library was not found."):new _t("web-storage-unsupported");this.a=yh()||i.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function yh(){try{var c=s.sessionStorage,v=jr();return c&&(c.setItem(v,"1"),c.removeItem(v)),c}catch{return null}}function wv(){var c=Wn()=="Node";if(c=yh()||c&&i.INTERNAL.node&&i.INTERNAL.node.sessionStorage,!c)return!1;try{return c.setItem("__sak","1"),c.removeItem("__sak"),!0}catch{return!1}}e=Ps.prototype,e.get=function(c){var v=this;return Xt().then(function(){var b=v.a.getItem(c);return Vr(b)})},e.set=function(c,v){var b=this;return Xt().then(function(){var j=ci(v);j===null?b.X(c):b.a.setItem(c,j)})},e.X=function(c){var v=this;return Xt().then(function(){v.a.removeItem(c)})},e.ia=function(){},e.ea=function(){};function Iv(){var c={};c.Browser=Nv,c.Node=Rv,c.ReactNative=Av,c.Worker=Ov,this.a=c[Wn()]}var Ds,Nv={B:io,Pa:Ps},Rv={B:io,Pa:Ps},Av={B:vh,Pa:Os},Ov={B:io,Pa:Os},Yr={Uc:"local",NONE:"none",Wc:"session"};function Pv(c){var v=new _t("invalid-persistence-type"),b=new _t("unsupported-persistence-type");e:{for(j in Yr)if(Yr[j]==c){var j=!0;break e}j=!1}if(!j||typeof c!="string")throw v;switch(Wn()){case"ReactNative":if(c==="session")throw b;break;case"Node":if(c!=="none")throw b;break;default:if(!qo()&&c!=="none")throw b}}function _h(){var c=!!(!cl(bn())&&jo()),v=li(),b=qo();this.m=c,this.h=v,this.l=b,this.a={},Ds||(Ds=new Iv),c=Ds;try{if(!Bo()&&dl()||!s.indexedDB)var j=new c.a.B;else As||(As=new mh),j=As;this.g=j}catch{this.g=new no,this.h=!0}try{this.i=new c.a.Pa}catch{this.i=new no}this.u=new no,this.f=ot(this.Kb,this),this.b={}}var ks;function wi(){return ks||(ks=new _h),ks}function wr(c,v){switch(v){case"session":return c.i;case"none":return c.u;default:return c.g}}function zr(c,v){return"firebase:"+c.name+(v?":"+v:"")}function Dv(c,v,b){var j=zr(v,b),_e=wr(c,v.B);return c.get(v,b).then(function(at){var ut=null;try{ut=Vr(s.localStorage.getItem(j))}catch{}if(ut&&!at)return s.localStorage.removeItem(j),c.set(v,ut,b);ut&&at&&_e.type!="localStorage"&&s.localStorage.removeItem(j)})}e=_h.prototype,e.get=function(c,v){return wr(this,c.B).get(zr(c,v))};function Xr(c,v,b){return b=zr(v,b),v.B=="local"&&(c.b[b]=null),wr(c,v.B).X(b)}e.set=function(c,v,b){var j=zr(c,b),_e=this,at=wr(this,c.B);return at.set(j,v).then(function(){return at.get(j)}).then(function(ut){c.B=="local"&&(_e.b[j]=ut)})},e.addListener=function(c,v,b){c=zr(c,v),this.l&&(this.b[c]=s.localStorage.getItem(c)),qt(this.a)&&(wr(this,"local").ia(this.f),this.h||(Bo()||!dl())&&s.indexedDB||!this.l||kv(this)),this.a[c]||(this.a[c]=[]),this.a[c].push(b)},e.removeListener=function(c,v,b){c=zr(c,v),this.a[c]&&(_n(this.a[c],function(j){return j==b}),this.a[c].length==0&&delete this.a[c]),qt(this.a)&&(wr(this,"local").ea(this.f),Ms(this))};function kv(c){Ms(c),c.c=setInterval(function(){for(var v in c.a){var b=s.localStorage.getItem(v),j=c.b[v];b!=j&&(c.b[v]=b,b=new dr({type:"storage",key:v,target:window,oldValue:j,newValue:b,a:!0}),c.Kb(b))}},1e3)}function Ms(c){c.c&&(clearInterval(c.c),c.c=null)}e.Kb=function(c){if(c&&c.g){var v=c.a.key;if(v==null)for(var b in this.a){var j=this.b[b];typeof j>"u"&&(j=null);var _e=s.localStorage.getItem(b);_e!==j&&(this.b[b]=_e,this.Va(b))}else if(v.indexOf("firebase:")==0&&this.a[v]){if(typeof c.a.a<"u"?wr(this,"local").ea(this.f):Ms(this),this.m){if(b=s.localStorage.getItem(v),j=c.a.newValue,j!==b)j!==null?s.localStorage.setItem(v,j):s.localStorage.removeItem(v);else if(this.b[v]===j&&typeof c.a.a>"u")return}var at=this;b=function(){(typeof c.a.a<"u"||at.b[v]!==s.localStorage.getItem(v))&&(at.b[v]=s.localStorage.getItem(v),at.Va(v))},$n&&zn&&zn==10&&s.localStorage.getItem(v)!==c.a.newValue&&c.a.newValue!==c.a.oldValue?setTimeout(b,10):b()}}else Bt(c,ot(this.Va,this))},e.Va=function(c){this.a[c]&&Bt(this.a[c],function(v){v()})};function Mv(c){this.a=c,this.b=wi()}var Ls={name:"authEvent",B:"local"};function Lv(c){return c.b.get(Ls,c.a).then(function(v){return $l(v)})}function Fv(){this.a=wi()}function $v(){this.b=-1}function oo(c,v){this.b=-1,this.b=Eh,this.f=s.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=c,this.h=v,this.l=s.Int32Array?new Int32Array(64):Array(64),so!==void 0||(s.Int32Array?so=new Int32Array(Th):so=Th),this.reset()}var so;ct(oo,$v);for(var Eh=64,xv=Eh-1,bh=[],Fs=0;Fs<xv;Fs++)bh[Fs]=0;var Sh=It(128,bh);oo.prototype.reset=function(){this.g=this.c=0,this.a=s.Int32Array?new Int32Array(this.h):$t(this.h)};function $s(c){for(var v=c.f,b=c.l,j=0,_e=0;_e<v.length;)b[j++]=v[_e]<<24|v[_e+1]<<16|v[_e+2]<<8|v[_e+3],_e=4*j;for(v=16;64>v;v++){_e=b[v-15]|0,j=b[v-2]|0;var at=(b[v-16]|0)+((_e>>>7|_e<<25)^(_e>>>18|_e<<14)^_e>>>3)|0,ut=(b[v-7]|0)+((j>>>17|j<<15)^(j>>>19|j<<13)^j>>>10)|0;b[v]=at+ut|0}j=c.a[0]|0,_e=c.a[1]|0;var mt=c.a[2]|0,Dt=c.a[3]|0,jt=c.a[4]|0,un=c.a[5]|0,vn=c.a[6]|0;for(at=c.a[7]|0,v=0;64>v;v++){var Qn=((j>>>2|j<<30)^(j>>>13|j<<19)^(j>>>22|j<<10))+(j&_e^j&mt^_e&mt)|0;ut=jt&un^~jt&vn,at=at+((jt>>>6|jt<<26)^(jt>>>11|jt<<21)^(jt>>>25|jt<<7))|0,ut=ut+(so[v]|0)|0,ut=at+(ut+(b[v]|0)|0)|0,at=vn,vn=un,un=jt,jt=Dt+ut|0,Dt=mt,mt=_e,_e=j,j=ut+Qn|0}c.a[0]=c.a[0]+j|0,c.a[1]=c.a[1]+_e|0,c.a[2]=c.a[2]+mt|0,c.a[3]=c.a[3]+Dt|0,c.a[4]=c.a[4]+jt|0,c.a[5]=c.a[5]+un|0,c.a[6]=c.a[6]+vn|0,c.a[7]=c.a[7]+at|0}function xs(c,v,b){b===void 0&&(b=v.length);var j=0,_e=c.c;if(f(v))for(;j<b;)c.f[_e++]=v.charCodeAt(j++),_e==c.b&&($s(c),_e=0);else if(Z(v))for(;j<b;){var at=v[j++];if(!(typeof at=="number"&&0<=at&&255>=at&&at==(at|0)))throw Error("message must be a byte array");c.f[_e++]=at,_e==c.b&&($s(c),_e=0)}else throw Error("message must be string or array");c.c=_e,c.g+=b}var Th=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Ch(){oo.call(this,8,Bv)}ct(Ch,oo);var Bv=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function wh(c,v,b,j,_e){this.u=c,this.i=v,this.l=b,this.m=j||null,this.s=_e||null,this.h=v+":"+b,this.v=new Fv,this.g=new Mv(this.h),this.f=null,this.b=[],this.a=this.c=null}function ao(c){return new _t("invalid-cordova-configuration",c)}e=wh.prototype,e.ca=function(){return this.ya?this.ya:this.ya=Jf().then(function(){if(typeof fn("universalLinks.subscribe",s)!="function")throw ao("cordova-universal-links-plugin is not installed");if(typeof fn("BuildInfo.packageName",s)>"u")throw ao("cordova-plugin-buildinfo is not installed");if(typeof fn("cordova.plugins.browsertab.openUrl",s)!="function")throw ao("cordova-plugin-browsertab is not installed");if(typeof fn("cordova.InAppBrowser.open",s)!="function")throw ao("cordova-plugin-inappbrowser is not installed")},function(){throw new _t("cordova-not-ready")})};function Uv(){for(var c=20,v=[];0<c;)v.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),c--;return v.join("")}function Vv(c){var v=new Ch;xs(v,c),c=[];var b=8*v.g;56>v.c?xs(v,Sh,56-v.c):xs(v,Sh,v.b-(v.c-56));for(var j=63;56<=j;j--)v.f[j]=b&255,b/=256;for($s(v),j=b=0;j<v.i;j++)for(var _e=24;0<=_e;_e-=8)c[b++]=v.a[j]>>_e&255;return cp(c)}e.Da=function(c,v){return v(new _t("operation-not-supported-in-this-environment")),Xt()},e.xb=function(){return mn(new _t("operation-not-supported-in-this-environment"))},e.Lb=function(){return!1},e.Gb=function(){return!0},e.Bb=function(){return!0},e.Ba=function(c,v,b){if(this.c)return mn(new _t("redirect-operation-pending"));var j=this,_e=s.document,at=null,ut=null,mt=null,Dt=null;return this.c=Xt().then(function(){return ss(v),Nh(j)}).then(function(){return jv(j,c,v,b)}).then(function(){return new rn(function(jt,un){ut=function(){var vn=fn("cordova.plugins.browsertab.close",s);return jt(),typeof vn=="function"&&vn(),j.a&&typeof j.a.close=="function"&&(j.a.close(),j.a=null),!1},j.va(ut),mt=function(){at||(at=pr(2e3).then(function(){un(new _t("redirect-cancelled-by-user"))}))},Dt=function(){Go()&&mt()},_e.addEventListener("resume",mt,!1),bn().toLowerCase().match(/android/)||_e.addEventListener("visibilitychange",Dt,!1)}).o(function(jt){return Bs(j).then(function(){throw jt})})}).ga(function(){mt&&_e.removeEventListener("resume",mt,!1),Dt&&_e.removeEventListener("visibilitychange",Dt,!1),at&&at.cancel(),ut&&j.Ja(ut),j.c=null})};function jv(c,v,b,j){var _e=Uv(),at=new tr(v,j,null,_e,new _t("no-auth-event")),ut=fn("BuildInfo.packageName",s);if(typeof ut!="string")throw new _t("invalid-cordova-configuration");var mt=fn("BuildInfo.displayName",s),Dt={};if(bn().toLowerCase().match(/iphone|ipad|ipod/))Dt.ibi=ut;else if(bn().toLowerCase().match(/android/))Dt.apn=ut;else return mn(new _t("operation-not-supported-in-this-environment"));mt&&(Dt.appDisplayName=mt),_e=Vv(_e),Dt.sessionId=_e;var jt=Si(c.u,c.i,c.l,v,b,null,j,c.m,Dt,c.s);return c.ca().then(function(){var un=c.h;return c.v.a.set(Ls,at.C(),un)}).then(function(){var un=fn("cordova.plugins.browsertab.isAvailable",s);if(typeof un!="function")throw new _t("invalid-cordova-configuration");var vn=null;un(function(Qn){if(Qn){if(vn=fn("cordova.plugins.browsertab.openUrl",s),typeof vn!="function")throw new _t("invalid-cordova-configuration");vn(jt)}else{if(vn=fn("cordova.InAppBrowser.open",s),typeof vn!="function")throw new _t("invalid-cordova-configuration");Qn=bn(),Qn=!(!Qn.match(/(iPad|iPhone|iPod).*OS 7_\d/i)&&!Qn.match(/(iPad|iPhone|iPod).*OS 8_\d/i)),c.a=vn(jt,Qn?"_blank":"_system","location=yes")}})})}function Ih(c,v){for(var b=0;b<c.b.length;b++)try{c.b[b](v)}catch{}}function Nh(c){return c.f||(c.f=c.ca().then(function(){return new rn(function(v){function b(j){return v(j),c.Ja(b),!1}c.va(b),Wv(c)})})),c.f}function Bs(c){var v=null;return Lv(c.g).then(function(b){return v=b,b=c.g,Xr(b.b,Ls,b.a)}).then(function(){return v})}function Wv(c){function v(ut){j=!0,_e&&_e.cancel(),Bs(c).then(function(mt){var Dt=b;if(mt&&ut&&ut.url){Dt=null;var jt=ut.url,un=Jn(jt),vn=rr(un,"link"),Qn=rr(Jn(vn),"link");un=rr(un,"deep_link_id"),jt=rr(Jn(un),"link")||un||Qn||vn||jt,jt.indexOf("/__/auth/callback")!=-1&&(Dt=Jn(jt),Dt=Vr(rr(Dt,"firebaseError")||null),Dt=(Dt=typeof Dt=="object"?vl(Dt):null)?new tr(mt.b,mt.c,null,null,Dt):new tr(mt.b,mt.c,jt,mt.g)),Dt=Dt||b}Ih(c,Dt)})}var b=new tr("unknown",null,null,null,new _t("no-auth-event")),j=!1,_e=pr(500).then(function(){return Bs(c).then(function(){j||Ih(c,b)})}),at=s.handleOpenURL;s.handleOpenURL=function(ut){if(ut.toLowerCase().indexOf(fn("BuildInfo.packageName",s).toLowerCase()+"://")==0&&v({url:ut}),typeof at=="function")try{at(ut)}catch(mt){console.error(mt)}},us||(us=new as),us.subscribe(v)}e.va=function(c){this.b.push(c),Nh(this).o(function(v){v.code==="auth/invalid-cordova-configuration"&&(v=new tr("unknown",null,null,null,new _t("no-auth-event")),c(v))})},e.Ja=function(c){_n(this.b,function(v){return v==c})};function qv(c){this.a=c,this.b=wi()}var Us={name:"pendingRedirect",B:"session"};function Kv(c){return c.b.set(Us,"pending",c.a)}function Vs(c){return Xr(c.b,Us,c.a)}function Gv(c){return c.b.get(Us,c.a).then(function(v){return v=="pending"})}function ar(c,v,b){this.v=c,this.l=v,this.u=b,this.h=[],this.f=!1,this.i=ot(this.m,this),this.c=new uo,this.s=new Lh,this.g=new qv(this.l+":"+this.u),this.b={},this.b.unknown=this.c,this.b.signInViaRedirect=this.c,this.b.linkViaRedirect=this.c,this.b.reauthViaRedirect=this.c,this.b.signInViaPopup=this.s,this.b.linkViaPopup=this.s,this.b.reauthViaPopup=this.s,this.a=Rh(this.v,this.l,this.u,bi)}function Rh(c,v,b,j){var _e=i.SDK_VERSION||null;return Vo()?new wh(c,v,b,_e,j):new hh(c,v,b,_e,j)}ar.prototype.reset=function(){this.f=!1,this.a.Ja(this.i),this.a=Rh(this.v,this.l,this.u)};function Ah(c){c.f||(c.f=!0,c.a.va(c.i));var v=c.a;return c.a.ca().o(function(b){throw c.a==v&&c.reset(),b})}function Oh(c){c.a.Gb()&&Ah(c).o(function(v){var b=new tr("unknown",null,null,null,new _t("operation-not-supported-in-this-environment"));js(v)&&c.m(b)}),c.a.Bb()||kh(c.c)}ar.prototype.subscribe=function(c){if(Zt(this.h,c)||this.h.push(c),!this.f){var v=this;Gv(this.g).then(function(b){b?Vs(v.g).then(function(){Ah(v).o(function(j){var _e=new tr("unknown",null,null,null,new _t("operation-not-supported-in-this-environment"));js(j)&&v.m(_e)})}):Oh(v)}).o(function(){Oh(v)})}},ar.prototype.unsubscribe=function(c){_n(this.h,function(v){return v==c})},ar.prototype.m=function(c){if(!c)throw new _t("invalid-auth-event");for(var v=!1,b=0;b<this.h.length;b++){var j=this.h[b];if(j.qb(c.b,c.c)){(v=this.b[c.b])&&v.h(c,j),v=!0;break}}return kh(this.c),v};var Hv=new Er(2e3,1e4),Qv=new Er(3e4,6e4);ar.prototype.ba=function(){return this.c.ba()};function Ph(c,v,b,j,_e,at){return c.a.xb(v,b,j,function(){c.f||(c.f=!0,c.a.va(c.i))},function(){c.reset()},_e,at)}function js(c){return!!(c&&c.code=="auth/cordova-not-ready")}ar.prototype.Ba=function(c,v,b){var j=this,_e;return Kv(this.g).then(function(){return j.a.Ba(c,v,b).o(function(at){if(js(at))throw new _t("operation-not-supported-in-this-environment");return _e=at,Vs(j.g).then(function(){throw _e})}).then(function(){return j.a.Lb()?new rn(function(){}):Vs(j.g).then(function(){return j.ba()}).then(function(){}).o(function(){})})})},ar.prototype.Da=function(c,v,b,j){return this.a.Da(b,function(_e){c.fa(v,null,_e,j)},Hv.get())};var Ws={};function Dh(c,v,b){var j=v+":"+b;return Ws[j]||(Ws[j]=new ar(c,v,b)),Ws[j]}function uo(){this.b=null,this.f=[],this.c=[],this.a=null,this.g=!1}uo.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},uo.prototype.h=function(c,v){if(c){this.reset(),this.g=!0;var b=c.b,j=c.c,_e=c.a&&c.a.code=="auth/web-storage-unsupported",at=c.a&&c.a.code=="auth/operation-not-supported-in-this-environment";b!="unknown"||_e||at?c.a?(Jr(this,!0,null,c.a),Xt()):v.wa(b,j)?Yv(this,c,v):mn(new _t("invalid-auth-event")):(Jr(this,!1,null,null),Xt())}else mn(new _t("invalid-auth-event"))};function kh(c){c.g||(c.g=!0,Jr(c,!1,null,null))}function Yv(c,v,b){b=b.wa(v.b,v.c);var j=v.f,_e=v.g,at=!!v.b.match(/Redirect$/);b(j,_e).then(function(ut){Jr(c,at,ut,null)}).o(function(ut){Jr(c,at,null,ut)})}function zv(c,v){if(c.b=function(){return mn(v)},c.c.length)for(var b=0;b<c.c.length;b++)c.c[b](v)}function Mh(c,v){if(c.b=function(){return Xt(v)},c.f.length)for(var b=0;b<c.f.length;b++)c.f[b](v)}function Jr(c,v,b,j){v?j?zv(c,j):Mh(c,b):Mh(c,{user:null}),c.f=[],c.c=[]}uo.prototype.ba=function(){var c=this;return new rn(function(v,b){c.b?c.b().then(v,b):(c.f.push(v),c.c.push(b),Xv(c))})};function Xv(c){var v=new _t("timeout");c.a&&c.a.cancel(),c.a=pr(Qv.get()).then(function(){c.b||Jr(c,!0,null,v)})}function Lh(){}Lh.prototype.h=function(c,v){if(c){var b=c.b,j=c.c;c.a?(v.fa(c.b,null,c.a,c.c),Xt()):v.wa(b,j)?Jv(c,v):mn(new _t("invalid-auth-event"))}else mn(new _t("invalid-auth-event"))};function Jv(c,v){var b=c.c,j=c.b;v.wa(j,b)(c.f,c.g).then(function(_e){v.fa(j,_e,null,b)}).o(function(_e){v.fa(j,null,_e,b)})}function qs(c,v){this.a=v,Yt(this,"verificationId",c)}qs.prototype.confirm=function(c){return c=Fl(this.verificationId,c),this.a(c)};function Ks(c,v,b,j){return new or(c).Sa(v,b).then(function(_e){return new qs(_e,j)})}function Gs(c,v,b){if(this.h=c,this.i=v,this.g=b,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}Gs.prototype.start=function(){this.a=this.c,Hs(this,!0)};function Zv(c,v){return v?(c.a=c.c,c.g()):(v=c.a,c.a*=2,c.a>c.f&&(c.a=c.f),v)}function Hs(c,v){c.stop(),c.b=pr(Zv(c,v)).then(function(){return Zf()}).then(function(){return c.h()}).then(function(){Hs(c,!0)}).o(function(b){c.i(b)&&Hs(c,!1)})}Gs.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)};function Qs(c){this.f=c,this.b=this.a=null,this.c=0}Qs.prototype.C=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}};function Fh(c,v){var b=v[Bn],j=v.refreshToken;v=$h(v.expiresIn),c.b=b,c.c=v,c.a=j}function $h(c){return ft()+1e3*parseInt(c,10)}function em(c,v){return Lp(c.f,v).then(function(b){return c.b=b.access_token,c.c=$h(b.expires_in),c.a=b.refresh_token,{accessToken:c.b,expirationTime:c.c,refreshToken:c.a}}).o(function(b){throw b.code=="auth/user-token-expired"&&(c.a=null),b})}Qs.prototype.getToken=function(c){return c=!!c,this.b&&!this.a?mn(new _t("user-token-expired")):c||!this.b||ft()>this.c-3e4?this.a?em(this,{grant_type:"refresh_token",refresh_token:this.a}):Xt(null):Xt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})};function lo(c,v){this.a=c||null,this.b=v||null,Pn(this,{lastSignInTime:fl(v||null),creationTime:fl(c||null)})}function tm(c){return new lo(c.a,c.b)}lo.prototype.C=function(){return{lastLoginAt:this.b,createdAt:this.a}};function nm(c,v,b,j,_e,at){Pn(this,{uid:c,displayName:j||null,photoURL:_e||null,email:b||null,phoneNumber:at||null,providerId:v})}function Ii(c,v){kn.call(this,c);for(var b in v)this[b]=v[b]}ct(Ii,kn);function Un(c,v,b){this.D=[],this.G=c.apiKey,this.s=c.appName,this.A=c.authDomain||null,c=i.SDK_VERSION?Ur(i.SDK_VERSION):null,this.b=new Kn(this.G,Ei(bi),c),this.h=new Qs(this.b),Js(this,v[Bn]),Fh(this.h,v),Yt(this,"refreshToken",this.h.a),Uh(this,b||{}),wn.call(this),this.I=!1,this.A&&_r()&&(this.a=Dh(this.A,this.G,this.s)),this.N=[],this.i=null,this.l=rm(this),this.U=ot(this.Ga,this);var j=this;this.ha=null,this.sa=function(_e){j.na(_e.h)},this.W=null,this.O=[],this.ra=function(_e){co(j,_e.f)},this.V=null}ct(Un,wn),Un.prototype.na=function(c){this.ha=c,Xl(this.b,c)},Un.prototype.aa=function(){return this.ha};function Ys(c,v){c.W&&xn(c.W,"languageCodeChanged",c.sa),(c.W=v)&&Xn(v,"languageCodeChanged",c.sa)}function co(c,v){c.O=v,Jl(c.b,i.SDK_VERSION?Ur(i.SDK_VERSION,c.O):null)}Un.prototype.Ka=function(){return $t(this.O)};function zs(c,v){c.V&&xn(c.V,"frameworkChanged",c.ra),(c.V=v)&&Xn(v,"frameworkChanged",c.ra)}Un.prototype.Ga=function(){this.l.b&&(this.l.stop(),this.l.start())};function xh(c){try{return i.app(c.s).auth()}catch{throw new _t("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+c.s+"'!")}}function rm(c){return new Gs(function(){return c.F(!0)},function(v){return!!(v&&v.code=="auth/network-request-failed")},function(){var v=c.h.c-ft()-3e5;return 0<v?v:0})}function Bh(c){c.m||c.l.b||(c.l.start(),xn(c,"tokenChanged",c.U),Xn(c,"tokenChanged",c.U))}function Xs(c){xn(c,"tokenChanged",c.U),c.l.stop()}function Js(c,v){c.qa=v,Yt(c,"_lat",v)}function im(c,v){_n(c.N,function(b){return b==v})}function Ir(c){for(var v=[],b=0;b<c.N.length;b++)v.push(c.N[b](c));return pf(v).then(function(){return c})}function ho(c){c.a&&!c.I&&(c.I=!0,c.a.subscribe(c))}function Uh(c,v){Pn(c,{uid:v.uid,displayName:v.displayName||null,photoURL:v.photoURL||null,email:v.email||null,emailVerified:v.emailVerified||!1,phoneNumber:v.phoneNumber||null,isAnonymous:v.isAnonymous||!1,metadata:new lo(v.createdAt,v.lastLoginAt),providerData:[]})}Yt(Un.prototype,"providerId","firebase");function Vh(){}function Zs(c){return Xt().then(function(){if(c.m)throw new _t("app-deleted")})}function ra(c){return Ht(c.providerData,function(v){return v.providerId})}function pa(c,v){v&&(jh(c,v.providerId),c.providerData.push(v))}function jh(c,v){_n(c.providerData,function(b){return b.providerId==v})}function ur(c,v,b){(v!="uid"||b)&&c.hasOwnProperty(v)&&Yt(c,v,b)}function Wh(c,v){c!=v&&(Pn(c,{uid:v.uid,displayName:v.displayName,photoURL:v.photoURL,email:v.email,emailVerified:v.emailVerified,phoneNumber:v.phoneNumber,isAnonymous:v.isAnonymous,providerData:[]}),v.metadata?Yt(c,"metadata",tm(v.metadata)):Yt(c,"metadata",new lo),Bt(v.providerData,function(b){pa(c,b)}),c.h=v.h,Yt(c,"refreshToken",c.h.a))}e=Un.prototype,e.reload=function(){var c=this;return Sn(this,Zs(this).then(function(){return ga(c).then(function(){return Ir(c)}).then(Vh)}))};function ga(c){return c.F().then(function(v){var b=c.isAnonymous;return om(c,v).then(function(){return b||ur(c,"isAnonymous",!1),v})})}e.F=function(c){var v=this;return Sn(this,Zs(this).then(function(){return v.h.getToken(c)}).then(function(b){if(!b)throw new _t("internal-error");return b.accessToken!=v.qa&&(Js(v,b.accessToken),v.dispatchEvent(new Ii("tokenChanged"))),ur(v,"refreshToken",b.refreshToken),b.accessToken}))},e.getToken=function(c){return pl["firebase.User.prototype.getToken is deprecated. Please use firebase.User.prototype.getIdToken instead."]||(pl["firebase.User.prototype.getToken is deprecated. Please use firebase.User.prototype.getIdToken instead."]=!0,typeof console<"u"&&typeof console.warn=="function"&&console.warn("firebase.User.prototype.getToken is deprecated. Please use firebase.User.prototype.getIdToken instead.")),this.F(c)};function Nr(c,v){v[Bn]&&c.qa!=v[Bn]&&(Fh(c.h,v),c.dispatchEvent(new Ii("tokenChanged")),Js(c,v[Bn]),ur(c,"refreshToken",c.h.a))}function om(c,v){return an(c.b,zp,{idToken:v}).then(ot(c.tc,c))}e.tc=function(c){if(c=c.users,!c||!c.length)throw new _t("internal-error");c=c[0],Uh(this,{uid:c.localId,displayName:c.displayName,photoURL:c.photoUrl,email:c.email,emailVerified:!!c.emailVerified,phoneNumber:c.phoneNumber,lastLoginAt:c.lastLoginAt,createdAt:c.createdAt});for(var v=sm(c),b=0;b<v.length;b++)pa(this,v[b]);ur(this,"isAnonymous",!(this.email&&c.passwordHash)&&!(this.providerData&&this.providerData.length))};function sm(c){return(c=c.providerUserInfo)&&c.length?Ht(c,function(v){return new nm(v.rawId,v.providerId,v.email,v.displayName,v.photoUrl,v.phoneNumber)}):[]}e.bb=function(c){var v=this,b=null;return Sn(this,c.f(this.b,this.uid).then(function(j){return Nr(v,j),b=po(v,j,"reauthenticate"),v.i=null,v.reload()}).then(function(){return b}),!0)},e.uc=function(c){return this.bb(c).then(function(){})};function fo(c,v){return ga(c).then(function(){if(Zt(ra(c),v))return Ir(c).then(function(){throw new _t("provider-already-linked")})})}e.$a=function(c){var v=this,b=null;return Sn(this,fo(this,c.providerId).then(function(){return v.F()}).then(function(j){return c.c(v.b,j)}).then(function(j){return b=po(v,j,"link"),qh(v,j)}).then(function(){return b}))},e.kc=function(c){return this.$a(c).then(function(v){return v.user})},e.mc=function(c,v){var b=this;return Sn(this,fo(this,"phone").then(function(){return Ks(xh(b),c,v,ot(b.$a,b))}))},e.vc=function(c,v){var b=this;return Sn(this,Xt().then(function(){return Ks(xh(b),c,v,ot(b.bb,b))}),!0)};function po(c,v,b){var j=ji(v);return v=ts(v),er({user:c,credential:j,additionalUserInfo:v,operationType:b})}function qh(c,v){return Nr(c,v),c.reload().then(function(){return c})}e.mb=function(c){var v=this;return Sn(this,this.F().then(function(b){return v.b.mb(b,c)}).then(function(b){return Nr(v,b),v.reload()}))},e.Mc=function(c){var v=this;return Sn(this,this.F().then(function(b){return c.c(v.b,b)}).then(function(b){return Nr(v,b),v.reload()}))},e.nb=function(c){var v=this;return Sn(this,this.F().then(function(b){return v.b.nb(b,c)}).then(function(b){return Nr(v,b),v.reload()}))},e.ob=function(c){if(c.displayName===void 0&&c.photoURL===void 0)return Zs(this);var v=this;return Sn(this,this.F().then(function(b){return v.b.ob(b,{displayName:c.displayName,photoUrl:c.photoURL})}).then(function(b){return Nr(v,b),ur(v,"displayName",b.displayName||null),ur(v,"photoURL",b.photoUrl||null),Bt(v.providerData,function(j){j.providerId==="password"&&(Yt(j,"displayName",v.displayName),Yt(j,"photoURL",v.photoURL))}),Ir(v)}).then(Vh))},e.Lc=function(c){var v=this;return Sn(this,ga(this).then(function(b){return Zt(ra(v),c)?jp(v.b,b,[c]).then(function(j){var _e={};return Bt(j.providerUserInfo||[],function(at){_e[at.providerId]=!0}),Bt(ra(v),function(at){_e[at]||jh(v,at)}),_e[or.PROVIDER_ID]||Yt(v,"phoneNumber",null),Ir(v)}):Ir(v).then(function(){throw new _t("no-such-provider")})}))},e.delete=function(){var c=this;return Sn(this,this.F().then(function(v){return an(c.b,Gp,{idToken:v})}).then(function(){c.dispatchEvent(new Ii("userDeleted"))})).then(function(){for(var v=0;v<c.D.length;v++)c.D[v].cancel("app-deleted");Ys(c,null),zs(c,null),c.D=[],c.m=!0,Xs(c),Yt(c,"refreshToken",null),c.a&&c.a.unsubscribe(c)})},e.qb=function(c,v){return!!(c=="linkViaPopup"&&(this.g||null)==v&&this.f||c=="reauthViaPopup"&&(this.g||null)==v&&this.f||c=="linkViaRedirect"&&(this.Z||null)==v||c=="reauthViaRedirect"&&(this.Z||null)==v)},e.fa=function(c,v,b,j){c!="linkViaPopup"&&c!="reauthViaPopup"||j!=(this.g||null)||(b&&this.v?this.v(b):v&&!b&&this.f&&this.f(v),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},e.wa=function(c,v){return c=="linkViaPopup"&&v==(this.g||null)?ot(this.vb,this):c=="reauthViaPopup"&&v==(this.g||null)?ot(this.wb,this):c=="linkViaRedirect"&&(this.Z||null)==v?ot(this.vb,this):c=="reauthViaRedirect"&&(this.Z||null)==v?ot(this.wb,this):null},e.nc=function(c){var v=this;return Kh(this,"linkViaPopup",c,function(){return fo(v,c.providerId).then(function(){return Ir(v)})},!1)},e.wc=function(c){return Kh(this,"reauthViaPopup",c,function(){return Xt()},!0)};function Kh(c,v,b,j,_e){if(!_r())return mn(new _t("operation-not-supported-in-this-environment"));if(c.i&&!_e)return mn(c.i);var at=es(b.providerId),ut=jr(c.uid+":::"),mt=null;(!li()||jo())&&c.A&&b.isOAuthProvider&&(mt=Si(c.A,c.G,c.s,v,b,null,ut,i.SDK_VERSION||null));var Dt=ol(mt,at&&at.Aa,at&&at.za);return j=j().then(function(){if(Hh(c),!_e)return c.F().then(function(){})}).then(function(){return Ph(c.a,Dt,v,b,ut,!!mt)}).then(function(){return new rn(function(jt,un){c.fa(v,null,new _t("cancelled-popup-request"),c.g||null),c.f=jt,c.v=un,c.g=ut,c.c=c.a.Da(c,v,Dt,ut)})}).then(function(jt){return Dt&&gr(Dt),jt?er(jt):null}).o(function(jt){throw Dt&&gr(Dt),jt}),Sn(c,j,_e)}e.oc=function(c){var v=this;return Gh(this,"linkViaRedirect",c,function(){return fo(v,c.providerId)},!1)},e.xc=function(c){return Gh(this,"reauthViaRedirect",c,function(){return Xt()},!0)};function Gh(c,v,b,j,_e){if(!_r())return mn(new _t("operation-not-supported-in-this-environment"));if(c.i&&!_e)return mn(c.i);var at=null,ut=jr(c.uid+":::");return j=j().then(function(){if(Hh(c),!_e)return c.F().then(function(){})}).then(function(){return c.Z=ut,Ir(c)}).then(function(mt){return c.da&&(mt=c.da,mt=mt.b.set(eu,c.C(),mt.a)),mt}).then(function(){return c.a.Ba(v,b,ut)}).o(function(mt){if(at=mt,c.da)return Yh(c.da);throw at}).then(function(){if(at)throw at}),Sn(c,j,_e)}function Hh(c){if(!c.a||!c.I)throw c.a&&!c.I?new _t("internal-error"):new _t("auth-domain-config-required")}e.vb=function(c,v){var b=this;this.c&&(this.c.cancel(),this.c=null);var j=null,_e=this.F().then(function(at){return nh(b.b,{requestUri:c,sessionId:v,idToken:at})}).then(function(at){return j=po(b,at,"link"),qh(b,at)}).then(function(){return j});return Sn(this,_e)},e.wb=function(c,v){var b=this;this.c&&(this.c.cancel(),this.c=null);var j=null,_e=Xt().then(function(){return Vi(rh(b.b,{requestUri:c,sessionId:v}),b.uid)}).then(function(at){return j=po(b,at,"reauthenticate"),Nr(b,at),b.i=null,b.reload()}).then(function(){return j});return Sn(this,_e,!0)},e.fb=function(c){var v=this,b=null;return Sn(this,this.F().then(function(j){return b=j,typeof c>"u"||qt(c)?{}:Jo(new zo(c))}).then(function(j){return v.b.fb(b,j)}).then(function(j){if(v.email!=j)return v.reload()}).then(function(){}))};function Sn(c,v,b){var j=am(c,v,b);return c.D.push(j),j.ga(function(){En(c.D,j)}),j}function am(c,v,b){return c.i&&!b?(v.cancel(),mn(c.i)):v.o(function(j){throw!j||j.code!="auth/user-disabled"&&j.code!="auth/user-token-expired"||(c.i||c.dispatchEvent(new Ii("userInvalidated")),c.i=j),j})}e.toJSON=function(){return this.C()},e.C=function(){var c={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.G,appName:this.s,authDomain:this.A,stsTokenManager:this.h.C(),redirectEventId:this.Z||null};return this.metadata&&on(c,this.metadata.C()),Bt(this.providerData,function(v){c.providerData.push(_d(v))}),c};function Qh(c){if(!c.apiKey)return null;var v={apiKey:c.apiKey,authDomain:c.authDomain,appName:c.appName},b={};if(c.stsTokenManager&&c.stsTokenManager.accessToken&&c.stsTokenManager.expirationTime)b[Bn]=c.stsTokenManager.accessToken,b.refreshToken=c.stsTokenManager.refreshToken||null,b.expiresIn=(c.stsTokenManager.expirationTime-ft())/1e3;else return null;var j=new Un(v,b,c);return c.providerData&&Bt(c.providerData,function(_e){_e&&pa(j,er(_e))}),c.redirectEventId&&(j.Z=c.redirectEventId),j}function um(c,v,b,j){var _e=new Un(c,v);return b&&(_e.da=b),j&&co(_e,j),_e.reload().then(function(){return _e})}function lm(c){this.a=c,this.b=wi()}var eu={name:"redirectUser",B:"session"};function Yh(c){return Xr(c.b,eu,c.a)}function cm(c,v){return c.b.get(eu,c.a).then(function(b){return b&&v&&(b.authDomain=v),Qh(b||{})})}function tu(c){this.a=c,this.b=wi(),this.c=null,this.f=hm(this),this.b.addListener(Hn("local"),this.a,ot(this.g,this))}tu.prototype.g=function(){var c=this,v=Hn("local");Zr(this,function(){return Xt().then(function(){return c.c&&c.c.B!="local"?c.b.get(v,c.a):null}).then(function(b){if(b)return nu(c,"local").then(function(){c.c=v})})})};function nu(c,v){var b=[],j;for(j in Yr)Yr[j]!==v&&b.push(Xr(c.b,Hn(Yr[j]),c.a));return b.push(Xr(c.b,ru,c.a)),df(b)}function hm(c){var v=Hn("local"),b=Hn("session"),j=Hn("none");return Dv(c.b,v,c.a).then(function(){return c.b.get(b,c.a)}).then(function(_e){return _e?b:c.b.get(j,c.a).then(function(at){return at?j:c.b.get(v,c.a).then(function(ut){return ut?v:c.b.get(ru,c.a).then(function(mt){return mt?Hn(mt):v})})})}).then(function(_e){return c.c=_e,nu(c,_e.B)}).o(function(){c.c||(c.c=v)})}var ru={name:"persistence",B:"session"};function Hn(c){return{name:"authUser",B:c}}tu.prototype.ib=function(c){var v=null,b=this;return Pv(c),Zr(this,function(){return c!=b.c.B?b.b.get(b.c,b.a).then(function(j){return v=j,nu(b,c)}).then(function(){if(b.c=Hn(c),v)return b.b.set(b.c,v,b.a)}):Xt()})};function fm(c){return Zr(c,function(){return c.b.set(ru,c.c.B,c.a)})}function zh(c,v){return Zr(c,function(){return c.b.set(c.c,v.C(),c.a)})}function Xh(c){return Zr(c,function(){return Xr(c.b,c.c,c.a)})}function Jh(c,v){return Zr(c,function(){return c.b.get(c.c,c.a).then(function(b){return b&&v&&(b.authDomain=v),Qh(b||{})})})}function Zr(c,v){return c.f=c.f.then(v,v),c.f}function Vn(c){if(this.l=!1,Yt(this,"app",c),dn(this).options&&dn(this).options.apiKey)c=i.SDK_VERSION?Ur(i.SDK_VERSION):null,this.b=new Kn(dn(this).options&&dn(this).options.apiKey,Ei(bi),c);else throw new _t("invalid-api-key");this.N=[],this.m=[],this.I=[],this.Ob=i.INTERNAL.createSubscribe(ot(this.hc,this)),this.O=void 0,this.Pb=i.INTERNAL.createSubscribe(ot(this.ic,this)),Ni(this,null),this.h=new tu(dn(this).options.apiKey+":"+dn(this).name),this.G=new lm(dn(this).options.apiKey+":"+dn(this).name),this.U=pn(this,mm(this)),this.i=pn(this,gm(this)),this.W=!1,this.ha=ot(this.Hc,this),this.Ga=ot(this.ka,this),this.qa=ot(this.Yb,this),this.ra=ot(this.fc,this),this.sa=ot(this.gc,this),pm(this),this.INTERNAL={},this.INTERNAL.delete=ot(this.delete,this),this.INTERNAL.logFramework=ot(this.pc,this),this.s=0,wn.call(this),dm(this),this.D=[]}ct(Vn,wn);function Zh(c){kn.call(this,"languageCodeChanged"),this.h=c}ct(Zh,kn);function ef(c){kn.call(this,"frameworkChanged"),this.f=c}ct(ef,kn),e=Vn.prototype,e.ib=function(c){return c=this.h.ib(c),pn(this,c)},e.na=function(c){this.V===c||this.l||(this.V=c,Xl(this.b,this.V),this.dispatchEvent(new Zh(this.aa())))},e.aa=function(){return this.V},e.Nc=function(){var c=s.navigator;this.na(c&&(c.languages&&c.languages[0]||c.language||c.userLanguage)||null)},e.pc=function(c){this.D.push(c),Jl(this.b,i.SDK_VERSION?Ur(i.SDK_VERSION,this.D):null),this.dispatchEvent(new ef(this.D))},e.Ka=function(){return $t(this.D)};function dm(c){Object.defineProperty(c,"lc",{get:function(){return this.aa()},set:function(v){this.na(v)},enumerable:!1}),c.V=null}e.toJSON=function(){return{apiKey:dn(this).options.apiKey,authDomain:dn(this).options.authDomain,appName:dn(this).name,currentUser:tn(this)&&tn(this).C()}};function iu(c){return c.Nb||mn(new _t("auth-domain-config-required"))}function pm(c){var v=dn(c).options.authDomain,b=dn(c).options.apiKey;v&&_r()&&(c.Nb=c.U.then(function(){if(!c.l){if(c.a=Dh(v,b,dn(c).name),c.a.subscribe(c),tn(c)&&ho(tn(c)),c.A){ho(c.A);var j=c.A;j.na(c.aa()),Ys(j,c),j=c.A,co(j,c.D),zs(j,c),c.A=null}return c.a}}))}e.qb=function(c,v){switch(c){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==v&&!!this.f;default:return!1}},e.fa=function(c,v,b,j){c=="signInViaPopup"&&this.g==j&&(b&&this.v?this.v(b):v&&!b&&this.f&&this.f(v),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},e.wa=function(c,v){return c=="signInViaRedirect"||c=="signInViaPopup"&&this.g==v&&this.f?ot(this.Xb,this):null},e.Xb=function(c,v){var b=this;c={requestUri:c,sessionId:v},this.c&&(this.c.cancel(),this.c=null);var j=null,_e=null,at=th(b.b,c).then(function(ut){return j=ji(ut),_e=ts(ut),ut});return c=b.U.then(function(){return at}).then(function(ut){return tf(b,ut)}).then(function(){return er({user:tn(b),credential:j,additionalUserInfo:_e,operationType:"signIn"})}),pn(this,c)},e.Fc=function(c){if(!_r())return mn(new _t("operation-not-supported-in-this-environment"));var v=this,b=es(c.providerId),j=jr(),_e=null;(!li()||jo())&&dn(this).options.authDomain&&c.isOAuthProvider&&(_e=Si(dn(this).options.authDomain,dn(this).options.apiKey,dn(this).name,"signInViaPopup",c,null,j,i.SDK_VERSION||null));var at=ol(_e,b&&b.Aa,b&&b.za);return b=iu(this).then(function(ut){return Ph(ut,at,"signInViaPopup",c,j,!!_e)}).then(function(){return new rn(function(ut,mt){v.fa("signInViaPopup",null,new _t("cancelled-popup-request"),v.g),v.f=ut,v.v=mt,v.g=j,v.c=v.a.Da(v,"signInViaPopup",at,j)})}).then(function(ut){return at&&gr(at),ut?er(ut):null}).o(function(ut){throw at&&gr(at),ut}),pn(this,b)},e.Gc=function(c){if(!_r())return mn(new _t("operation-not-supported-in-this-environment"));var v=this,b=iu(this).then(function(){return fm(v.h)}).then(function(){return v.a.Ba("signInViaRedirect",c)});return pn(this,b)},e.ba=function(){if(!_r())return mn(new _t("operation-not-supported-in-this-environment"));var c=this,v=iu(this).then(function(){return c.a.ba()}).then(function(b){return b?er(b):null});return pn(this,v)};function tf(c,v){var b={};return b.apiKey=dn(c).options.apiKey,b.authDomain=dn(c).options.authDomain,b.appName=dn(c).name,c.U.then(function(){return um(b,v,c.G,c.Ka())}).then(function(j){return tn(c)&&j.uid==tn(c).uid?(Wh(tn(c),j),c.ka(j)):(Ni(c,j),ho(j),c.ka(j))}).then(function(){mo(c)})}function Ni(c,v){tn(c)&&(im(tn(c),c.Ga),xn(tn(c),"tokenChanged",c.qa),xn(tn(c),"userDeleted",c.ra),xn(tn(c),"userInvalidated",c.sa),Xs(tn(c))),v&&(v.N.push(c.Ga),Xn(v,"tokenChanged",c.qa),Xn(v,"userDeleted",c.ra),Xn(v,"userInvalidated",c.sa),0<c.s&&Bh(v)),Yt(c,"currentUser",v),v&&(v.na(c.aa()),Ys(v,c),co(v,c.D),zs(v,c))}e.kb=function(){var c=this,v=this.i.then(function(){return tn(c)?(Ni(c,null),Xh(c.h).then(function(){mo(c)})):Xt()});return pn(this,v)};function vm(c){var v=cm(c.G,dn(c).options.authDomain).then(function(b){return(c.A=b)&&(b.da=c.G),Yh(c.G)});return pn(c,v)}function mm(c){var v=dn(c).options.authDomain,b=vm(c).then(function(){return Jh(c.h,v)}).then(function(j){return j?(j.da=c.G,c.A&&(c.A.Z||null)==(j.Z||null)?j:j.reload().then(function(){return zh(c.h,j).then(function(){return j})}).o(function(_e){return _e.code=="auth/network-request-failed"?j:Xh(c.h)})):null}).then(function(j){Ni(c,j||null)});return pn(c,b)}function gm(c){return c.U.then(function(){return c.ba()}).o(function(){}).then(function(){if(!c.l)return c.ha()}).o(function(){}).then(function(){if(!c.l){c.W=!0;var v=c.h;v.b.addListener(Hn("local"),v.a,c.ha)}})}e.Hc=function(){var c=this;return Jh(this.h,dn(this).options.authDomain).then(function(v){if(!c.l){var b;if(b=tn(c)&&v){b=tn(c).uid;var j=v.uid;b=b==null||b===""||j===void 0||j===null||j===""?!1:b==j}if(b)return Wh(tn(c),v),tn(c).F();(tn(c)||v)&&(Ni(c,v),v&&(ho(v),v.da=c.G),c.a&&c.a.subscribe(c),mo(c))}})},e.ka=function(c){return zh(this.h,c)},e.Yb=function(){mo(this),this.ka(tn(this))},e.fc=function(){this.kb()},e.gc=function(){this.kb()};function Ri(c,v){var b=null,j=null;return pn(c,v.then(function(_e){return b=ji(_e),j=ts(_e),tf(c,_e)}).then(function(){return er({user:tn(c),credential:b,additionalUserInfo:j,operationType:"signIn"})}))}e.hc=function(c){var v=this;this.addAuthTokenListener(function(){c.next(tn(v))})},e.ic=function(c){var v=this;ym(this,function(){c.next(tn(v))})},e.rc=function(c,v,b){var j=this;return this.W&&i.Promise.resolve().then(function(){et(c)?c(tn(j)):et(c.next)&&c.next(tn(j))}),this.Ob(c,v,b)},e.qc=function(c,v,b){var j=this;return this.W&&i.Promise.resolve().then(function(){j.O=j.getUid(),et(c)?c(tn(j)):et(c.next)&&c.next(tn(j))}),this.Pb(c,v,b)},e.$b=function(c){var v=this,b=this.i.then(function(){return tn(v)?tn(v).F(c).then(function(j){return{accessToken:j}}):null});return pn(this,b)},e.Bc=function(c){return this.Hb(c).then(function(v){return v.user})},e.Hb=function(c){var v=this;return this.i.then(function(){return Ri(v,an(v.b,uv,{token:c}))}).then(function(b){var j=b.user;return ur(j,"isAnonymous",!1),v.ka(j),b})},e.Ib=function(c,v){var b=this;return this.i.then(function(){return Ri(b,an(b.b,ah,{email:c,password:v}))})},e.Cc=function(c,v){return this.Ib(c,v).then(function(b){return b.user})},e.Sb=function(c,v){return this.sb(c,v).then(function(b){return b.user})},e.sb=function(c,v){var b=this;return this.i.then(function(){return Ri(b,an(b.b,Kp,{email:c,password:v}))})},e.Ac=function(c){return this.Oa(c).then(function(v){return v.user})},e.Oa=function(c){var v=this;return this.i.then(function(){return Ri(v,c.xa(v.b))})},e.jb=function(){return this.Jb().then(function(c){return c.user})},e.Jb=function(){var c=this;return this.i.then(function(){var v=tn(c);if(v&&v.isAnonymous){var b=er({providerId:null,isNewUser:!1});return er({user:v,credential:null,additionalUserInfo:b,operationType:"signIn"})}return Ri(c,c.b.jb()).then(function(j){var _e=j.user;return ur(_e,"isAnonymous",!0),c.ka(_e),j})})};function dn(c){return c.app}function tn(c){return c.currentUser}e.getUid=function(){return tn(this)&&tn(this).uid||null};function vo(c){return tn(c)&&tn(c)._lat||null}function mo(c){if(c.W){for(var v=0;v<c.m.length;v++)c.m[v]&&c.m[v](vo(c));if(c.O!==c.getUid()&&c.I.length)for(c.O=c.getUid(),v=0;v<c.I.length;v++)c.I[v]&&c.I[v](vo(c))}}e.Qb=function(c){this.addAuthTokenListener(c),this.s++,0<this.s&&tn(this)&&Bh(tn(this))},e.yc=function(c){var v=this;Bt(this.m,function(b){b==c&&v.s--}),0>this.s&&(this.s=0),this.s==0&&tn(this)&&Xs(tn(this)),this.removeAuthTokenListener(c)},e.addAuthTokenListener=function(c){var v=this;this.m.push(c),pn(this,this.i.then(function(){v.l||Zt(v.m,c)&&c(vo(v))}))},e.removeAuthTokenListener=function(c){_n(this.m,function(v){return v==c})};function ym(c,v){c.I.push(v),pn(c,c.i.then(function(){!c.l&&Zt(c.I,v)&&c.O!==c.getUid()&&(c.O=c.getUid(),v(vo(c)))}))}e.delete=function(){this.l=!0;for(var c=0;c<this.N.length;c++)this.N[c].cancel("app-deleted");return this.N=[],this.h&&(c=this.h,c.b.removeListener(Hn("local"),c.a,this.ha)),this.a&&this.a.unsubscribe(this),i.Promise.resolve()};function pn(c,v){return c.N.push(v),v.ga(function(){En(c.N,v)}),v}e.Vb=function(c){return pn(this,$p(this.b,c))},e.Wb=function(c){return pn(this,xp(this.b,c))},e.jc=function(c){return!!Ll(c)},e.hb=function(c,v){var b=this;return pn(this,Xt().then(function(){var j=new zo(v);if(!j.c)throw new _t("argument-error",Xo+" must be true when sending sign in link to email");return Jo(j)}).then(function(j){return b.b.hb(c,j)}).then(function(){}))},e.Oc=function(c){return this.Ia(c).then(function(v){return v.data.email})},e.Wa=function(c,v){return pn(this,this.b.Wa(c,v).then(function(){}))},e.Ia=function(c){return pn(this,this.b.Ia(c).then(function(v){return new Jd(v)}))},e.Ua=function(c){return pn(this,this.b.Ua(c).then(function(){}))},e.gb=function(c,v){var b=this;return pn(this,Xt().then(function(){return typeof v>"u"||qt(v)?{}:Jo(new zo(v))}).then(function(j){return b.b.gb(c,j)}).then(function(){}))},e.Ec=function(c,v){return pn(this,Ks(this,c,v,ot(this.Oa,this)))},e.Dc=function(c,v){var b=this;return pn(this,Xt().then(function(){var j=Ml(c,v||xr());return b.Oa(j)}))};function ou(c,v,b,j,_e,at){if(Yt(this,"type","recaptcha"),this.b=this.c=null,this.m=!1,this.l=v,this.a=b||{theme:"light",type:"image"},this.g=[],this.a[of])throw new _t("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.h=this.a[_m]==="invisible",!s.document)throw new _t("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!$i(v)||!this.h&&$i(v).hasChildNodes())throw new _t("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new Kn(c,at||null,_e||null),this.s=j||function(){return null};var ut=this;this.i=[];var mt=this.a[nf];this.a[nf]=function(jt){if(sf(ut,jt),typeof mt=="function")mt(jt);else if(typeof mt=="string"){var un=fn(mt,s);typeof un=="function"&&un(jt)}};var Dt=this.a[rf];this.a[rf]=function(){if(sf(ut,null),typeof Dt=="function")Dt();else if(typeof Dt=="string"){var jt=fn(Dt,s);typeof jt=="function"&&jt()}}}var nf="callback",rf="expired-callback",of="sitekey",_m="size";function sf(c,v){for(var b=0;b<c.i.length;b++)try{c.i[b](v)}catch{}}function Em(c,v){_n(c.i,function(b){return b==v})}function su(c,v){return c.g.push(v),v.ga(function(){En(c.g,v)}),v}e=ou.prototype,e.ya=function(){var c=this;return this.c?this.c:this.c=su(this,Xt().then(function(){if(ai()&&!yr())return Uo();throw new _t("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return Tm(uf(),c.s())}).then(function(){return an(c.u,tv,{})}).then(function(v){c.a[of]=v.recaptchaSiteKey}).o(function(v){throw c.c=null,v}))},e.render=function(){go(this);var c=this;return su(this,this.ya().then(function(){if(c.b===null){var v=c.l;if(!c.h){var b=$i(v);v=qf("DIV"),b.appendChild(v)}c.b=grecaptcha.render(v,c.a)}return c.b}))},e.verify=function(){go(this);var c=this;return su(this,this.render().then(function(v){return new rn(function(b){var j=grecaptcha.getResponse(v);if(j)b(j);else{var _e=function(at){at&&(Em(c,_e),b(at))};c.i.push(_e),c.h&&grecaptcha.execute(c.b)}})}))},e.reset=function(){go(this),this.b!==null&&grecaptcha.reset(this.b)};function go(c){if(c.m)throw new _t("internal-error","RecaptchaVerifier instance has been destroyed.")}e.clear=function(){go(this),this.m=!0,uf().b--;for(var c=0;c<this.g.length;c++)this.g[c].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.h){c=$i(this.l);for(var v;v=c.firstChild;)c.removeChild(v)}};var bm=si("https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}");function Sm(){this.b=s.grecaptcha?1/0:0,this.c=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}function Tm(c,v){return new rn(function(b,j){if(Ko())if(!s.grecaptcha||v!==c.c&&!c.b){s[c.a]=function(){if(s.grecaptcha){c.c=v;var at=s.grecaptcha.render;s.grecaptcha.render=function(ut,mt){return ut=at(ut,mt),c.b++,ut},b()}else j(new _t("internal-error"));delete s[c.a]};var _e=Fo(bm,{onload:c.a,hl:v||""});Xt(Es(_e)).o(function(){j(new _t("internal-error","Unable to load external reCAPTCHA dependencies!"))})}else b();else j(new _t("network-request-failed"))})}var au=null;function uf(){return au||(au=new Sm),au}function uu(c,v,b){try{this.f=b||i.app()}catch{throw new _t("argument-error","No firebase.app.App instance is currently initialized.")}if(this.f.options&&this.f.options.apiKey)b=this.f.options.apiKey;else throw new _t("invalid-api-key");var j=this,_e=null;try{_e=this.f.auth().Ka()}catch{}_e=i.SDK_VERSION?Ur(i.SDK_VERSION,_e):null,ou.call(this,b,c,v,function(){try{var at=j.f.auth().aa()}catch{at=null}return at},_e,Ei(bi))}ct(uu,ou);function lf(c,v,b,j){e:{b=Array.prototype.slice.call(b);for(var _e=0,at=!1,ut=0;ut<v.length;ut++)if(v[ut].optional)at=!0;else{if(at)throw new _t("internal-error","Argument validator encountered a required argument after an optional argument.");_e++}if(at=v.length,b.length<_e||at<b.length)j="Expected "+(_e==at?_e==1?"1 argument":_e+" arguments":_e+"-"+at+" arguments")+" but got "+b.length+".";else{for(_e=0;_e<b.length;_e++)if(at=v[_e].optional&&b[_e]===void 0,!v[_e].M(b[_e])&&!at){if(v=v[_e],0>_e||_e>=cf.length)throw new _t("internal-error","Argument validator received an unsupported number of arguments.");b=cf[_e],j=(j?"":b+" argument ")+(v.name?'"'+v.name+'" ':"")+"must be "+v.K+".";break e}j=null}}if(j)throw new _t("argument-error",c+" failed: "+j)}var cf="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Gt(c,v){return{name:c||"",K:"a valid string",optional:!!v,M:f}}function hf(){return{name:"opt_forceRefresh",K:"a boolean",optional:!0,M:d}}function Cn(c,v){return{name:c||"",K:"a valid object",optional:!!v,M:tt}}function ei(c,v){return{name:c||"",K:"a function",optional:!!v,M:et}}function Rr(c,v){return{name:c||"",K:"null",optional:!!v,M:$}}function Cm(){return{name:"",K:"an HTML element",optional:!1,M:function(c){return!!(c&&c instanceof Element)}}}function wm(){return{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(c){return!!(c&&c instanceof Vn)}}}function Im(){return{name:"app",K:"an instance of Firebase App",optional:!0,M:function(c){return!!(c&&c instanceof i.app.App)}}}function Ar(c){return{name:c?c+"Credential":"credential",K:c?"a valid "+c+" credential":"a valid credential",optional:!1,M:function(v){if(!v)return!1;var b=!c||v.providerId===c;return!(!v.xa||!b)}}}function ti(){return{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(c){return!!(c&&c.providerId&&c.hasOwnProperty&&c.hasOwnProperty("isOAuthProvider"))}}}function yo(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(c){return!!(c&&f(c.type)&&et(c.verify))}}}function Nn(c,v,b,j){return{name:b||"",K:c.K+" or "+v.K,optional:!!j,M:function(_e){return c.M(_e)||v.M(_e)}}}function Rn(c,v){for(var b in v){var j=v[b].name;c[j]=ff(j,c[b],v[b].j)}}function In(c,v,b,j){c[v]=ff(v,b,j)}function ff(c,v,b){function j(){var ut=Array.prototype.slice.call(arguments);return lf(_e,b,ut),v.apply(this,ut)}if(!b)return v;var _e=Nm(c),at;for(at in v)j[at]=v[at];for(at in v.prototype)j.prototype[at]=v.prototype[at];return j}function Nm(c){return c=c.split("."),c[c.length-1]}Rn(Vn.prototype,{Ua:{name:"applyActionCode",j:[Gt("code")]},Ia:{name:"checkActionCode",j:[Gt("code")]},Wa:{name:"confirmPasswordReset",j:[Gt("code"),Gt("newPassword")]},Sb:{name:"createUserWithEmailAndPassword",j:[Gt("email"),Gt("password")]},sb:{name:"createUserAndRetrieveDataWithEmailAndPassword",j:[Gt("email"),Gt("password")]},Vb:{name:"fetchProvidersForEmail",j:[Gt("email")]},Wb:{name:"fetchSignInMethodsForEmail",j:[Gt("email")]},ba:{name:"getRedirectResult",j:[]},jc:{name:"isSignInWithEmailLink",j:[Gt("emailLink")]},qc:{name:"onAuthStateChanged",j:[Nn(Cn(),ei(),"nextOrObserver"),ei("opt_error",!0),ei("opt_completed",!0)]},rc:{name:"onIdTokenChanged",j:[Nn(Cn(),ei(),"nextOrObserver"),ei("opt_error",!0),ei("opt_completed",!0)]},gb:{name:"sendPasswordResetEmail",j:[Gt("email"),Nn(Cn("opt_actionCodeSettings",!0),Rr(null,!0),"opt_actionCodeSettings",!0)]},hb:{name:"sendSignInLinkToEmail",j:[Gt("email"),Cn("actionCodeSettings")]},ib:{name:"setPersistence",j:[Gt("persistence")]},Oa:{name:"signInAndRetrieveDataWithCredential",j:[Ar()]},jb:{name:"signInAnonymously",j:[]},Jb:{name:"signInAnonymouslyAndRetrieveData",j:[]},Ac:{name:"signInWithCredential",j:[Ar()]},Bc:{name:"signInWithCustomToken",j:[Gt("token")]},Hb:{name:"signInAndRetrieveDataWithCustomToken",j:[Gt("token")]},Cc:{name:"signInWithEmailAndPassword",j:[Gt("email"),Gt("password")]},Dc:{name:"signInWithEmailLink",j:[Gt("email"),Gt("emailLink",!0)]},Ib:{name:"signInAndRetrieveDataWithEmailAndPassword",j:[Gt("email"),Gt("password")]},Ec:{name:"signInWithPhoneNumber",j:[Gt("phoneNumber"),yo()]},Fc:{name:"signInWithPopup",j:[ti()]},Gc:{name:"signInWithRedirect",j:[ti()]},kb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Gt(null,!0)]},Nc:{name:"useDeviceLanguage",j:[]},Oc:{name:"verifyPasswordResetCode",j:[Gt("code")]}}),function(c,v){for(var b in v){var j=v[b].name;if(j!==b){var _e=v[b].Rb;Object.defineProperty(c,j,{get:function(){return this[b]},set:function(at){lf(j,[_e],[at],!0),this[b]=at},enumerable:!0})}}}(Vn.prototype,{lc:{name:"languageCode",Rb:Nn(Gt(),Rr(),"languageCode")}}),Vn.Persistence=Yr,Vn.Persistence.LOCAL="local",Vn.Persistence.SESSION="session",Vn.Persistence.NONE="none",Rn(Un.prototype,{delete:{name:"delete",j:[]},F:{name:"getIdToken",j:[hf()]},getToken:{name:"getToken",j:[hf()]},$a:{name:"linkAndRetrieveDataWithCredential",j:[Ar()]},kc:{name:"linkWithCredential",j:[Ar()]},mc:{name:"linkWithPhoneNumber",j:[Gt("phoneNumber"),yo()]},nc:{name:"linkWithPopup",j:[ti()]},oc:{name:"linkWithRedirect",j:[ti()]},bb:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Ar()]},uc:{name:"reauthenticateWithCredential",j:[Ar()]},vc:{name:"reauthenticateWithPhoneNumber",j:[Gt("phoneNumber"),yo()]},wc:{name:"reauthenticateWithPopup",j:[ti()]},xc:{name:"reauthenticateWithRedirect",j:[ti()]},reload:{name:"reload",j:[]},fb:{name:"sendEmailVerification",j:[Nn(Cn("opt_actionCodeSettings",!0),Rr(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Gt(null,!0)]},Lc:{name:"unlink",j:[Gt("provider")]},mb:{name:"updateEmail",j:[Gt("email")]},nb:{name:"updatePassword",j:[Gt("password")]},Mc:{name:"updatePhoneNumber",j:[Ar("phone")]},ob:{name:"updateProfile",j:[Cn("profile")]}}),Rn(rn.prototype,{ga:{name:"finally"},o:{name:"catch"},then:{name:"then"}}),Rn(qs.prototype,{confirm:{name:"confirm",j:[Gt("verificationCode")]}}),In(Mn,"credential",function(c,v){return new Kr(c,v)},[Gt("email"),Gt("password")]),Rn(br.prototype,{ta:{name:"addScope",j:[Gt("scope")]},Ca:{name:"setCustomParameters",j:[Cn("customOAuthParameters")]}}),In(br,"credential",Ol,[Nn(Gt(),Cn(),"token")]),In(Mn,"credentialWithLink",Ml,[Gt("email"),Gt("emailLink")]),Rn(Sr.prototype,{ta:{name:"addScope",j:[Gt("scope")]},Ca:{name:"setCustomParameters",j:[Cn("customOAuthParameters")]}}),In(Sr,"credential",Pl,[Nn(Gt(),Cn(),"token")]),Rn(Tr.prototype,{ta:{name:"addScope",j:[Gt("scope")]},Ca:{name:"setCustomParameters",j:[Cn("customOAuthParameters")]}}),In(Tr,"credential",Dl,[Nn(Gt(),Nn(Cn(),Rr()),"idToken"),Nn(Gt(),Rr(),"accessToken",!0)]),Rn(qr.prototype,{Ca:{name:"setCustomParameters",j:[Cn("customOAuthParameters")]}}),In(qr,"credential",kl,[Nn(Gt(),Cn(),"token"),Gt("secret",!0)]),Rn(Dn.prototype,{ta:{name:"addScope",j:[Gt("scope")]},credential:{name:"credential",j:[Nn(Gt(),Rr(),"idToken",!0),Nn(Gt(),Rr(),"accessToken",!0)]},Ca:{name:"setCustomParameters",j:[Cn("customOAuthParameters")]}}),In(or,"credential",Fl,[Gt("verificationId"),Gt("verificationCode")]),Rn(or.prototype,{Sa:{name:"verifyPhoneNumber",j:[Gt("phoneNumber"),yo()]}}),Rn(_t.prototype,{toJSON:{name:"toJSON",j:[Gt(null,!0)]}}),Rn(di.prototype,{toJSON:{name:"toJSON",j:[Gt(null,!0)]}}),Rn(ls.prototype,{toJSON:{name:"toJSON",j:[Gt(null,!0)]}}),Rn(uu.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(typeof i<"u"&&i.INTERNAL&&i.INTERNAL.registerService){var c={Auth:Vn,Error:_t};In(c,"EmailAuthProvider",Mn,[]),In(c,"FacebookAuthProvider",br,[]),In(c,"GithubAuthProvider",Sr,[]),In(c,"GoogleAuthProvider",Tr,[]),In(c,"TwitterAuthProvider",qr,[]),In(c,"OAuthProvider",Dn,[Gt("providerId")]),In(c,"PhoneAuthProvider",or,[wm()]),In(c,"RecaptchaVerifier",uu,[Nn(Gt(),Cm(),"recaptchaContainer"),Cn("recaptchaParameters",!0),Im()]),i.INTERNAL.registerService("auth",function(v,b){return v=new Vn(v),b({INTERNAL:{getUid:ot(v.getUid,v),getToken:ot(v.$b,v),addAuthTokenListener:ot(v.Qb,v),removeAuthTokenListener:ot(v.yc,v)}}),v},c,function(v,b){if(v==="create")try{b.auth()}catch{}}),i.INTERNAL.extendNamespace({User:Un})}else throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.")}()}).call(typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{});var database={exports:{}},cjs={exports:{}},Database={},util={},storage={},DOMStorageWrapper$1={};Object.defineProperty(DOMStorageWrapper$1,"__esModule",{value:!0});var util_1$N=cjs$1,DOMStorageWrapper=function(){function i(e){this.domStorage_=e,this.prefix_="firebase:"}return i.prototype.set=function(e,o){o==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),util_1$N.stringify(o))},i.prototype.get=function(e){var o=this.domStorage_.getItem(this.prefixedName_(e));return o==null?null:util_1$N.jsonEval(o)},i.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},i.prototype.prefixedName_=function(e){return this.prefix_+e},i.prototype.toString=function(){return this.domStorage_.toString()},i}();DOMStorageWrapper$1.DOMStorageWrapper=DOMStorageWrapper;var MemoryStorage$1={};Object.defineProperty(MemoryStorage$1,"__esModule",{value:!0});var util_1$M=cjs$1,MemoryStorage=function(){function i(){this.cache_={},this.isInMemoryStorage=!0}return i.prototype.set=function(e,o){o==null?delete this.cache_[e]:this.cache_[e]=o},i.prototype.get=function(e){return util_1$M.contains(this.cache_,e)?this.cache_[e]:null},i.prototype.remove=function(e){delete this.cache_[e]},i}();MemoryStorage$1.MemoryStorage=MemoryStorage;Object.defineProperty(storage,"__esModule",{value:!0});var DOMStorageWrapper_1=DOMStorageWrapper$1,MemoryStorage_1=MemoryStorage$1,createStoragefor=function(i){try{if(typeof window<"u"&&typeof window[i]<"u"){var e=window[i];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new DOMStorageWrapper_1.DOMStorageWrapper(e)}}catch{}return new MemoryStorage_1.MemoryStorage};storage.PersistentStorage=createStoragefor("localStorage");storage.SessionStorage=createStoragefor("sessionStorage");var instances=[],LogLevel$1;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(LogLevel$1||(LogLevel$1={}));var defaultLogLevel=LogLevel$1.INFO,defaultLogHandler=function(i,e){for(var o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(!(e<i.logLevel)){var f=new Date().toISOString();switch(e){case LogLevel$1.DEBUG:console.log.apply(console,["["+f+"]  "+i.name+":"].concat(o));break;case LogLevel$1.VERBOSE:console.log.apply(console,["["+f+"]  "+i.name+":"].concat(o));break;case LogLevel$1.INFO:console.info.apply(console,["["+f+"]  "+i.name+":"].concat(o));break;case LogLevel$1.WARN:console.warn.apply(console,["["+f+"]  "+i.name+":"].concat(o));break;case LogLevel$1.ERROR:console.error.apply(console,["["+f+"]  "+i.name+":"].concat(o));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},Logger=function(){function i(e){this.name=e,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,instances.push(this)}return Object.defineProperty(i.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in LogLevel$1))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!0,configurable:!0}),i.prototype.debug=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this._logHandler.apply(this,[this,LogLevel$1.DEBUG].concat(e))},i.prototype.log=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this._logHandler.apply(this,[this,LogLevel$1.VERBOSE].concat(e))},i.prototype.info=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this._logHandler.apply(this,[this,LogLevel$1.INFO].concat(e))},i.prototype.warn=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this._logHandler.apply(this,[this,LogLevel$1.WARN].concat(e))},i.prototype.error=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this._logHandler.apply(this,[this,LogLevel$1.ERROR].concat(e))},i}();function setLogLevel$1(i){instances.forEach(function(e){e.logLevel=i})}const esm=Object.freeze(Object.defineProperty({__proto__:null,setLogLevel:setLogLevel$1,Logger,get LogLevel(){return LogLevel$1}},Symbol.toStringTag,{value:"Module"})),require$$2=getAugmentedNamespace(esm);(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=cjs$1,o=cjs$1,s=cjs$1,f=cjs$1,d=cjs$1,m=cjs$1,_=storage,$=cjs$1,G=require$$2,Z=new G.Logger("@firebase/database");i.LUIDGenerator=function(){var nt=1;return function(){return nt++}}(),i.sha1=function(nt){var st=d.stringToByteArray(nt),rt=new f.Sha1;rt.update(st);var it=rt.digest();return s.base64.encodeByteArray(it)};var et=function(){for(var nt=[],st=0;st<arguments.length;st++)nt[st]=arguments[st];for(var rt="",it=0;it<nt.length;it++)Array.isArray(nt[it])||nt[it]&&typeof nt[it]=="object"&&typeof nt[it].length=="number"?rt+=et.apply(null,nt[it]):typeof nt[it]=="object"?rt+=m.stringify(nt[it]):rt+=nt[it],rt+=" ";return rt};i.logger=null;var tt=!0;i.enableLogging=function(nt,st){e.assert(!st||nt===!0||nt===!1,"Can't turn on custom loggers persistently."),nt===!0?(Z.logLevel=G.LogLevel.VERBOSE,i.logger=Z.log.bind(Z),st&&_.SessionStorage.set("logging_enabled",!0)):typeof nt=="function"?i.logger=nt:(i.logger=null,_.SessionStorage.remove("logging_enabled"))},i.log=function(){for(var nt=[],st=0;st<arguments.length;st++)nt[st]=arguments[st];if(tt===!0&&(tt=!1,i.logger===null&&_.SessionStorage.get("logging_enabled")===!0&&i.enableLogging(!0)),i.logger){var rt=et.apply(null,nt);i.logger(rt)}},i.logWrapper=function(nt){return function(){for(var st=[],rt=0;rt<arguments.length;rt++)st[rt]=arguments[rt];i.log.apply(void 0,[nt].concat(st))}},i.error=function(){for(var nt=[],st=0;st<arguments.length;st++)nt[st]=arguments[st];var rt="FIREBASE INTERNAL ERROR: "+et.apply(void 0,nt);Z.error(rt)},i.fatal=function(){for(var nt=[],st=0;st<arguments.length;st++)nt[st]=arguments[st];var rt="FIREBASE FATAL ERROR: "+et.apply(void 0,nt);throw Z.error(rt),new Error(rt)},i.warn=function(){for(var nt=[],st=0;st<arguments.length;st++)nt[st]=arguments[st];var rt="FIREBASE WARNING: "+et.apply(void 0,nt);Z.warn(rt)},i.warnIfPageIsSecure=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&i.warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},i.warnAboutUnsupportedMethod=function(nt){i.warn(nt+" is unsupported and will likely change soon.  Please do not use.")},i.isInvalidJSONNumber=function(nt){return typeof nt=="number"&&(nt!=nt||nt==Number.POSITIVE_INFINITY||nt==Number.NEGATIVE_INFINITY)},i.executeWhenDOMReady=function(nt){if($.isNodeSdk()||document.readyState==="complete")nt();else{var st=!1,rt=function(){if(!document.body){setTimeout(rt,Math.floor(10));return}st||(st=!0,nt())};document.addEventListener?(document.addEventListener("DOMContentLoaded",rt,!1),window.addEventListener("load",rt,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){document.readyState==="complete"&&rt()}),window.attachEvent("onload",rt))}},i.MIN_NAME="[MIN_NAME]",i.MAX_NAME="[MAX_NAME]",i.nameCompare=function(nt,st){if(nt===st)return 0;if(nt===i.MIN_NAME||st===i.MAX_NAME)return-1;if(st===i.MIN_NAME||nt===i.MAX_NAME)return 1;var rt=i.tryParseInt(nt),it=i.tryParseInt(st);return rt!==null?it!==null?rt-it==0?nt.length-st.length:rt-it:-1:it!==null?1:nt<st?-1:1},i.stringCompare=function(nt,st){return nt===st?0:nt<st?-1:1},i.requireKey=function(nt,st){if(st&&nt in st)return st[nt];throw new Error("Missing required key ("+nt+") in object: "+m.stringify(st))},i.ObjectToUniqueKey=function(nt){if(typeof nt!="object"||nt===null)return m.stringify(nt);var st=[];for(var rt in nt)st.push(rt);st.sort();for(var it="{",ot=0;ot<st.length;ot++)ot!==0&&(it+=","),it+=m.stringify(st[ot]),it+=":",it+=i.ObjectToUniqueKey(nt[st[ot]]);return it+="}",it},i.splitStringBySize=function(nt,st){var rt=nt.length;if(rt<=st)return[nt];for(var it=[],ot=0;ot<rt;ot+=st)ot+st>rt?it.push(nt.substring(ot,rt)):it.push(nt.substring(ot,ot+st));return it},i.each=function(nt,st){if(Array.isArray(nt))for(var rt=0;rt<nt.length;++rt)st(rt,nt[rt]);else o.forEach(nt,function(it,ot){return st(ot,it)})},i.bindCallback=function(nt,st){return st?nt.bind(st):nt},i.doubleToIEEE754String=function(nt){e.assert(!i.isInvalidJSONNumber(nt),"Invalid JSON number");var st=11,rt=52,it=(1<<st-1)-1,ot,lt,ft,ct,pt,gt,Tt;for(nt===0?(lt=0,ft=0,ot=1/nt===-1/0?1:0):(ot=nt<0,nt=Math.abs(nt),nt>=Math.pow(2,1-it)?(ct=Math.min(Math.floor(Math.log(nt)/Math.LN2),it),lt=ct+it,ft=Math.round(nt*Math.pow(2,rt-ct)-Math.pow(2,rt))):(lt=0,ft=Math.round(nt/Math.pow(2,1-it-rt)))),gt=[],pt=rt;pt;pt-=1)gt.push(ft%2?1:0),ft=Math.floor(ft/2);for(pt=st;pt;pt-=1)gt.push(lt%2?1:0),lt=Math.floor(lt/2);gt.push(ot?1:0),gt.reverse(),Tt=gt.join("");var Et="";for(pt=0;pt<64;pt+=8){var Mt=parseInt(Tt.substr(pt,8),2).toString(16);Mt.length===1&&(Mt="0"+Mt),Et=Et+Mt}return Et.toLowerCase()},i.isChromeExtensionContentScript=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},i.isWindowsStoreApp=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},i.errorForServerCode=function(nt,st){var rt="Unknown Error";nt==="too_big"?rt="The data requested exceeds the maximum size that can be accessed with a single request.":nt=="permission_denied"?rt="Client doesn't have permission to access the desired data.":nt=="unavailable"&&(rt="The service is unavailable");var it=new Error(nt+" at "+st.path.toString()+": "+rt);return it.code=nt.toUpperCase(),it},i.INTEGER_REGEXP_=new RegExp("^-?\\d{1,10}$"),i.tryParseInt=function(nt){if(i.INTEGER_REGEXP_.test(nt)){var st=Number(nt);if(st>=-2147483648&&st<=2147483647)return st}return null},i.exceptionGuard=function(nt){try{nt()}catch(st){setTimeout(function(){var rt=st.stack||"";throw i.warn("Exception was thrown by user callback.",rt),st},Math.floor(0))}},i.callUserCallback=function(nt){for(var st=[],rt=1;rt<arguments.length;rt++)st[rt-1]=arguments[rt];typeof nt=="function"&&i.exceptionGuard(function(){nt.apply(void 0,st)})},i.beingCrawled=function(){var nt=typeof window=="object"&&window.navigator&&window.navigator.userAgent||"";return nt.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},i.exportPropGetter=function(nt,st,rt){Object.defineProperty(nt,st,{get:rt})},i.setTimeoutNonBlocking=function(nt,st){var rt=setTimeout(nt,st);return typeof rt=="object"&&rt.unref&&rt.unref(),rt}})(util);var parser={},Path$2={};Object.defineProperty(Path$2,"__esModule",{value:!0});var util_1$L=util,util_2$o=cjs$1,Path$1=function(){function i(e,o){if(o===void 0){this.pieces_=e.split("/");for(var s=0,f=0;f<this.pieces_.length;f++)this.pieces_[f].length>0&&(this.pieces_[s]=this.pieces_[f],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=o}return Object.defineProperty(i,"Empty",{get:function(){return new i("")},enumerable:!0,configurable:!0}),i.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},i.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},i.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new i(this.pieces_,e)},i.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},i.prototype.toString=function(){for(var e="",o=this.pieceNum_;o<this.pieces_.length;o++)this.pieces_[o]!==""&&(e+="/"+this.pieces_[o]);return e||"/"},i.prototype.toUrlEncodedString=function(){for(var e="",o=this.pieceNum_;o<this.pieces_.length;o++)this.pieces_[o]!==""&&(e+="/"+encodeURIComponent(String(this.pieces_[o])));return e||"/"},i.prototype.slice=function(e){return e===void 0&&(e=0),this.pieces_.slice(this.pieceNum_+e)},i.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],o=this.pieceNum_;o<this.pieces_.length-1;o++)e.push(this.pieces_[o]);return new i(e,0)},i.prototype.child=function(e){for(var o=[],s=this.pieceNum_;s<this.pieces_.length;s++)o.push(this.pieces_[s]);if(e instanceof i)for(var s=e.pieceNum_;s<e.pieces_.length;s++)o.push(e.pieces_[s]);else for(var f=e.split("/"),s=0;s<f.length;s++)f[s].length>0&&o.push(f[s]);return new i(o,0)},i.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},i.relativePath=function(e,o){var s=e.getFront(),f=o.getFront();if(s===null)return o;if(s===f)return i.relativePath(e.popFront(),o.popFront());throw new Error("INTERNAL ERROR: innerPath ("+o+") is not within outerPath ("+e+")")},i.comparePaths=function(e,o){for(var s=e.slice(),f=o.slice(),d=0;d<s.length&&d<f.length;d++){var m=util_1$L.nameCompare(s[d],f[d]);if(m!==0)return m}return s.length===f.length?0:s.length<f.length?-1:1},i.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var o=this.pieceNum_,s=e.pieceNum_;o<=this.pieces_.length;o++,s++)if(this.pieces_[o]!==e.pieces_[s])return!1;return!0},i.prototype.contains=function(e){var o=this.pieceNum_,s=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;o<this.pieces_.length;){if(this.pieces_[o]!==e.pieces_[s])return!1;++o,++s}return!0},i}();Path$2.Path=Path$1;var ValidationPath=function(){function i(e,o){this.errorPrefix_=o,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var s=0;s<this.parts_.length;s++)this.byteLength_+=util_2$o.stringLength(this.parts_[s]);this.checkValid_()}return Object.defineProperty(i,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(i,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),i.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=util_2$o.stringLength(e),this.checkValid_()},i.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=util_2$o.stringLength(e),this.parts_.length>0&&(this.byteLength_-=1)},i.prototype.checkValid_=function(){if(this.byteLength_>i.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+i.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>i.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+i.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},i.prototype.toErrorString=function(){return this.parts_.length==0?"":"in property '"+this.parts_.join(".")+"'"},i}();Path$2.ValidationPath=ValidationPath;var RepoInfo$1={},Constants={};Object.defineProperty(Constants,"__esModule",{value:!0});Constants.PROTOCOL_VERSION="5";Constants.VERSION_PARAM="v";Constants.TRANSPORT_SESSION_PARAM="s";Constants.REFERER_PARAM="r";Constants.FORGE_REF="f";Constants.FORGE_DOMAIN="firebaseio.com";Constants.LAST_SESSION_PARAM="ls";Constants.WEBSOCKET="websocket";Constants.LONG_POLLING="long_polling";Object.defineProperty(RepoInfo$1,"__esModule",{value:!0});var util_1$K=cjs$1,util_2$n=cjs$1,storage_1$2=storage,Constants_1$2=Constants,RepoInfo=function(){function i(e,o,s,f,d){d===void 0&&(d=""),this.secure=o,this.namespace=s,this.webSocketOnly=f,this.persistenceKey=d,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=storage_1$2.PersistentStorage.get("host:"+e)||this.host}return i.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},i.prototype.isCacheableHost=function(){return this.internalHost.substr(0,2)==="s-"},i.prototype.isDemoHost=function(){return this.domain==="firebaseio-demo.com"},i.prototype.isCustomHost=function(){return this.domain!=="firebaseio.com"&&this.domain!=="firebaseio-demo.com"},i.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&storage_1$2.PersistentStorage.set("host:"+this.host,this.internalHost))},i.prototype.connectionURL=function(e,o){util_1$K.assert(typeof e=="string","typeof type must == string"),util_1$K.assert(typeof o=="object","typeof params must == object");var s;if(e===Constants_1$2.WEBSOCKET)s=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else if(e===Constants_1$2.LONG_POLLING)s=(this.secure?"https://":"http://")+this.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);this.needsQueryParam()&&(o.ns=this.namespace);var f=[];return util_2$n.forEach(o,function(d,m){f.push(d+"="+m)}),s+f.join("&")},i.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},i.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},i}();RepoInfo$1.RepoInfo=RepoInfo;(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=Path$2,o=RepoInfo$1,s=util;function f(m){for(var _="",$=m.split("/"),G=0;G<$.length;G++)if($[G].length>0){var Z=$[G];try{Z=decodeURIComponent(Z.replace(/\+/g," "))}catch{}_+="/"+Z}return _}function d(m){var _={};m.startsWith("?")&&(m=m.substring(1));for(var $=0,G=m.split("&");$<G.length;$++){var Z=G[$];if(Z.length!==0){var et=Z.split("=");et.length===2?_[decodeURIComponent(et[0])]=decodeURIComponent(et[1]):s.warn("Invalid query segment '"+Z+"' in query '"+m+"'")}}return _}i.parseRepoInfo=function(m){var _=i.parseURL(m),$=_.subdomain;_.domain==="firebase"&&s.fatal(_.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!$||$=="undefined")&&_.domain!=="localhost"&&s.fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),_.secure||s.warnIfPageIsSecure();var G=_.scheme==="ws"||_.scheme==="wss";return{repoInfo:new o.RepoInfo(_.host,_.secure,$,G),path:new e.Path(_.pathString)}},i.parseURL=function(m){var _="",$="",G="",Z="",et=!0,tt="https",nt=443;if(typeof m=="string"){var st=m.indexOf("//");st>=0&&(tt=m.substring(0,st-1),m=m.substring(st+2));var rt=m.indexOf("/");rt===-1&&(rt=m.length);var it=m.indexOf("?");it===-1&&(it=m.length),_=m.substring(0,Math.min(rt,it)),rt<it&&(Z=f(m.substring(rt,it)));var ot=d(m.substring(Math.min(m.length,it)));st=_.indexOf(":"),st>=0?(et=tt==="https"||tt==="wss",nt=parseInt(_.substring(st+1),10)):st=m.length;var lt=_.split(".");lt.length===3?($=lt[1],G=lt[0].toLowerCase()):lt.length===2?$=lt[0]:lt[0].slice(0,st).toLowerCase()==="localhost"&&($="localhost"),G===""&&"ns"in ot&&(G=ot.ns)}return{host:_,port:nt,domain:$,subdomain:G,secure:et,scheme:tt,pathString:Z}}})(parser);var Reference$1={},onDisconnect={},validation={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=Path$2,o=cjs$1,s=util,f=cjs$1,d=cjs$1;i.INVALID_KEY_REGEX_=/[\[\].#$\/\u0000-\u001F\u007F]/,i.INVALID_PATH_REGEX_=/[\[\].#$\u0000-\u001F\u007F]/,i.MAX_LEAF_SIZE_=10*1024*1024,i.isValidKey=function(m){return typeof m=="string"&&m.length!==0&&!i.INVALID_KEY_REGEX_.test(m)},i.isValidPathString=function(m){return typeof m=="string"&&m.length!==0&&!i.INVALID_PATH_REGEX_.test(m)},i.isValidRootPathString=function(m){return m&&(m=m.replace(/^\/*\.info(\/|$)/,"/")),i.isValidPathString(m)},i.isValidPriority=function(m){return m===null||typeof m=="string"||typeof m=="number"&&!s.isInvalidJSONNumber(m)||m&&typeof m=="object"&&o.contains(m,".sv")},i.validateFirebaseDataArg=function(m,_,$,G,Z){Z&&$===void 0||i.validateFirebaseData(f.errorPrefix(m,_,Z),$,G)},i.validateFirebaseData=function(m,_,$){var G=$ instanceof e.Path?new e.ValidationPath($,m):$;if(_===void 0)throw new Error(m+"contains undefined "+G.toErrorString());if(typeof _=="function")throw new Error(m+"contains a function "+G.toErrorString()+" with contents = "+_.toString());if(s.isInvalidJSONNumber(_))throw new Error(m+"contains "+_.toString()+" "+G.toErrorString());if(typeof _=="string"&&_.length>i.MAX_LEAF_SIZE_/3&&d.stringLength(_)>i.MAX_LEAF_SIZE_)throw new Error(m+"contains a string greater than "+i.MAX_LEAF_SIZE_+" utf8 bytes "+G.toErrorString()+" ('"+_.substring(0,50)+"...')");if(_&&typeof _=="object"){var Z=!1,et=!1;if(o.forEach(_,function(tt,nt){if(tt===".value")Z=!0;else if(tt!==".priority"&&tt!==".sv"&&(et=!0,!i.isValidKey(tt)))throw new Error(m+" contains an invalid key ("+tt+") "+G.toErrorString()+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);G.push(tt),i.validateFirebaseData(m,nt,G),G.pop()}),Z&&et)throw new Error(m+' contains ".value" child '+G.toErrorString()+" in addition to actual children.")}},i.validateFirebaseMergePaths=function(m,_){var $,G;for($=0;$<_.length;$++){G=_[$];for(var Z=G.slice(),et=0;et<Z.length;et++)if(!(Z[et]===".priority"&&et===Z.length-1)){if(!i.isValidKey(Z[et]))throw new Error(m+"contains an invalid key ("+Z[et]+") in path "+G.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}_.sort(e.Path.comparePaths);var tt=null;for($=0;$<_.length;$++){if(G=_[$],tt!==null&&tt.contains(G))throw new Error(m+"contains a path "+tt.toString()+" that is ancestor of another path "+G.toString());tt=G}},i.validateFirebaseMergeDataArg=function(m,_,$,G,Z){if(!(Z&&$===void 0)){var et=f.errorPrefix(m,_,Z);if(!($&&typeof $=="object")||Array.isArray($))throw new Error(et+" must be an object containing the children to replace.");var tt=[];o.forEach($,function(nt,st){var rt=new e.Path(nt);if(i.validateFirebaseData(et,st,G.child(rt)),rt.getBack()===".priority"&&!i.isValidPriority(st))throw new Error(et+"contains an invalid value for '"+rt.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");tt.push(rt)}),i.validateFirebaseMergePaths(et,tt)}},i.validatePriority=function(m,_,$,G){if(!(G&&$===void 0)){if(s.isInvalidJSONNumber($))throw new Error(f.errorPrefix(m,_,G)+"is "+$.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!i.isValidPriority($))throw new Error(f.errorPrefix(m,_,G)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},i.validateEventType=function(m,_,$,G){if(!(G&&$===void 0))switch($){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(f.errorPrefix(m,_,G)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},i.validateKey=function(m,_,$,G){if(!(G&&$===void 0)&&!i.isValidKey($))throw new Error(f.errorPrefix(m,_,G)+'was an invalid key = "'+$+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},i.validatePathString=function(m,_,$,G){if(!(G&&$===void 0)&&!i.isValidPathString($))throw new Error(f.errorPrefix(m,_,G)+'was an invalid path = "'+$+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},i.validateRootPathString=function(m,_,$,G){$&&($=$.replace(/^\/*\.info(\/|$)/,"/")),i.validatePathString(m,_,$,G)},i.validateWritablePath=function(m,_){if(_.getFront()===".info")throw new Error(m+" failed = Can't modify data under /.info/")},i.validateUrl=function(m,_,$){var G=$.path.toString();if(typeof $.repoInfo.host!="string"||$.repoInfo.host.length===0||!i.isValidKey($.repoInfo.namespace)&&$.repoInfo.host.split(":")[0]!=="localhost"||G.length!==0&&!i.isValidRootPathString(G))throw new Error(f.errorPrefix(m,_,!1)+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)},i.validateCredential=function(m,_,$,G){if(!(G&&$===void 0)&&typeof $!="string")throw new Error(f.errorPrefix(m,_,G)+"must be a valid credential (a string).")},i.validateBoolean=function(m,_,$,G){if(!(G&&$===void 0)&&typeof $!="boolean")throw new Error(f.errorPrefix(m,_,G)+"must be a boolean.")},i.validateString=function(m,_,$,G){if(!(G&&$===void 0)&&typeof $!="string")throw new Error(f.errorPrefix(m,_,G)+"must be a valid string.")},i.validateObject=function(m,_,$,G){if(!(G&&$===void 0)&&(!($&&typeof $=="object")||$===null))throw new Error(f.errorPrefix(m,_,G)+"must be a valid object.")},i.validateObjectContainsKey=function(m,_,$,G,Z,et){var tt=$&&typeof $=="object"&&o.contains($,G);if(!tt){if(Z)return;throw new Error(f.errorPrefix(m,_,Z)+'must contain the key "'+G+'"')}if(et){var nt=o.safeGet($,G);if(et==="number"&&typeof nt!="number"||et==="string"&&typeof nt!="string"||et==="boolean"&&typeof nt!="boolean"||et==="function"&&typeof nt!="function"||et==="object"&&typeof nt!="object"&&nt)throw Z?new Error(f.errorPrefix(m,_,Z)+'contains invalid value for key "'+G+'" (must be of type "'+et+'")'):new Error(f.errorPrefix(m,_,Z)+'must contain the key "'+G+'" with type "'+et+'"')}}})(validation);Object.defineProperty(onDisconnect,"__esModule",{value:!0});var util_1$J=cjs$1,validation_1$1=validation,util_2$m=util,util_3$7=cjs$1,OnDisconnect=function(){function i(e,o){this.repo_=e,this.path_=o}return i.prototype.cancel=function(e){util_1$J.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),util_1$J.validateCallback("OnDisconnect.cancel",1,e,!0);var o=new util_3$7.Deferred;return this.repo_.onDisconnectCancel(this.path_,o.wrapCallback(e)),o.promise},i.prototype.remove=function(e){util_1$J.validateArgCount("OnDisconnect.remove",0,1,arguments.length),validation_1$1.validateWritablePath("OnDisconnect.remove",this.path_),util_1$J.validateCallback("OnDisconnect.remove",1,e,!0);var o=new util_3$7.Deferred;return this.repo_.onDisconnectSet(this.path_,null,o.wrapCallback(e)),o.promise},i.prototype.set=function(e,o){util_1$J.validateArgCount("OnDisconnect.set",1,2,arguments.length),validation_1$1.validateWritablePath("OnDisconnect.set",this.path_),validation_1$1.validateFirebaseDataArg("OnDisconnect.set",1,e,this.path_,!1),util_1$J.validateCallback("OnDisconnect.set",2,o,!0);var s=new util_3$7.Deferred;return this.repo_.onDisconnectSet(this.path_,e,s.wrapCallback(o)),s.promise},i.prototype.setWithPriority=function(e,o,s){util_1$J.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),validation_1$1.validateWritablePath("OnDisconnect.setWithPriority",this.path_),validation_1$1.validateFirebaseDataArg("OnDisconnect.setWithPriority",1,e,this.path_,!1),validation_1$1.validatePriority("OnDisconnect.setWithPriority",2,o,!1),util_1$J.validateCallback("OnDisconnect.setWithPriority",3,s,!0);var f=new util_3$7.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,e,o,f.wrapCallback(s)),f.promise},i.prototype.update=function(e,o){if(util_1$J.validateArgCount("OnDisconnect.update",1,2,arguments.length),validation_1$1.validateWritablePath("OnDisconnect.update",this.path_),Array.isArray(e)){for(var s={},f=0;f<e.length;++f)s[""+f]=e[f];e=s,util_2$m.warn("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}validation_1$1.validateFirebaseMergeDataArg("OnDisconnect.update",1,e,this.path_,!1),util_1$J.validateCallback("OnDisconnect.update",2,o,!0);var d=new util_3$7.Deferred;return this.repo_.onDisconnectUpdate(this.path_,e,d.wrapCallback(o)),d.promise},i}();onDisconnect.OnDisconnect=OnDisconnect;var TransactionResult$1={};Object.defineProperty(TransactionResult$1,"__esModule",{value:!0});var util_1$I=cjs$1,TransactionResult=function(){function i(e,o){this.committed=e,this.snapshot=o}return i.prototype.toJSON=function(){return util_1$I.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},i}();TransactionResult$1.TransactionResult=TransactionResult;var NextPushId={};Object.defineProperty(NextPushId,"__esModule",{value:!0});var util_1$H=cjs$1;NextPushId.nextPushId=function(){var i="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",e=0,o=[];return function(s){var f=s===e;e=s;var d,m=new Array(8);for(d=7;d>=0;d--)m[d]=i.charAt(s%64),s=Math.floor(s/64);util_1$H.assert(s===0,"Cannot push at time == 0");var _=m.join("");if(f){for(d=11;d>=0&&o[d]===63;d--)o[d]=0;o[d]++}else for(d=0;d<12;d++)o[d]=Math.floor(Math.random()*64);for(d=0;d<12;d++)_+=i.charAt(o[d]);return util_1$H.assert(_.length===20,"nextPushId: Length should be 20."),_}}();var Query$3={},KeyIndex$1={},Index$1={},Node={};Object.defineProperty(Node,"__esModule",{value:!0});var NamedNode=function(){function i(e,o){this.name=e,this.node=o}return i.Wrap=function(e,o){return new i(e,o)},i}();Node.NamedNode=NamedNode;Object.defineProperty(Index$1,"__esModule",{value:!0});var Node_1$a=Node,util_1$G=util,Index=function(){function i(){}return i.prototype.getCompare=function(){return this.compare.bind(this)},i.prototype.indexedValueChanged=function(e,o){var s=new Node_1$a.NamedNode(util_1$G.MIN_NAME,e),f=new Node_1$a.NamedNode(util_1$G.MIN_NAME,o);return this.compare(s,f)!==0},i.prototype.minPost=function(){return Node_1$a.NamedNode.MIN},i}();Index$1.Index=Index;Object.defineProperty(KeyIndex$1,"__esModule",{value:!0});var tslib_1$7=tslib.exports,Index_1$3=Index$1,Node_1$9=Node,util_1$F=util,util_2$l=cjs$1,__EMPTY_NODE,KeyIndex=function(i){tslib_1$7.__extends(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return __EMPTY_NODE},set:function(o){__EMPTY_NODE=o},enumerable:!0,configurable:!0}),e.prototype.compare=function(o,s){return util_1$F.nameCompare(o.name,s.name)},e.prototype.isDefinedOn=function(o){throw util_2$l.assertionError("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(o,s){return!1},e.prototype.minPost=function(){return Node_1$9.NamedNode.MIN},e.prototype.maxPost=function(){return new Node_1$9.NamedNode(util_1$F.MAX_NAME,__EMPTY_NODE)},e.prototype.makePost=function(o,s){return util_2$l.assert(typeof o=="string","KeyIndex indexValue must always be a string."),new Node_1$9.NamedNode(o,__EMPTY_NODE)},e.prototype.toString=function(){return".key"},e}(Index_1$3.Index);KeyIndex$1.KeyIndex=KeyIndex;KeyIndex$1.KEY_INDEX=new KeyIndex;var PriorityIndex$1={},LeafNode$1={},snap={};Object.defineProperty(snap,"__esModule",{value:!0});var util_1$E=cjs$1,util_2$k=util,util_3$6=cjs$1,MAX_NODE$1;function setMaxNode$1(i){MAX_NODE$1=i}snap.setMaxNode=setMaxNode$1;snap.priorityHashText=function(i){return typeof i=="number"?"number:"+util_2$k.doubleToIEEE754String(i):"string:"+i};snap.validatePriorityNode=function(i){if(i.isLeafNode()){var e=i.val();util_1$E.assert(typeof e=="string"||typeof e=="number"||typeof e=="object"&&util_3$6.contains(e,".sv"),"Priority must be a string or number.")}else util_1$E.assert(i===MAX_NODE$1||i.isEmpty(),"priority of unexpected type.");util_1$E.assert(i===MAX_NODE$1||i.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};Object.defineProperty(LeafNode$1,"__esModule",{value:!0});var util_1$D=cjs$1,util_2$j=util,snap_1=snap,__childrenNodeConstructor,LeafNode=function(){function i(e,o){o===void 0&&(o=i.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=o,this.lazyHash_=null,util_1$D.assert(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),snap_1.validatePriorityNode(this.priorityNode_)}return Object.defineProperty(i,"__childrenNodeConstructor",{get:function(){return __childrenNodeConstructor},set:function(e){__childrenNodeConstructor=e},enumerable:!0,configurable:!0}),i.prototype.isLeafNode=function(){return!0},i.prototype.getPriority=function(){return this.priorityNode_},i.prototype.updatePriority=function(e){return new i(this.value_,e)},i.prototype.getImmediateChild=function(e){return e===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE},i.prototype.getChild=function(e){return e.isEmpty()?this:e.getFront()===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE},i.prototype.hasChild=function(){return!1},i.prototype.getPredecessorChildName=function(e,o){return null},i.prototype.updateImmediateChild=function(e,o){return e===".priority"?this.updatePriority(o):o.isEmpty()&&e!==".priority"?this:i.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,o).updatePriority(this.priorityNode_)},i.prototype.updateChild=function(e,o){var s=e.getFront();return s===null?o:o.isEmpty()&&s!==".priority"?this:(util_1$D.assert(s!==".priority"||e.getLength()===1,".priority must be the last token in a path"),this.updateImmediateChild(s,i.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),o)))},i.prototype.isEmpty=function(){return!1},i.prototype.numChildren=function(){return 0},i.prototype.forEachChild=function(e,o){return!1},i.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},i.prototype.hash=function(){if(this.lazyHash_===null){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+snap_1.priorityHashText(this.priorityNode_.val())+":");var o=typeof this.value_;e+=o+":",o==="number"?e+=util_2$j.doubleToIEEE754String(this.value_):e+=this.value_,this.lazyHash_=util_2$j.sha1(e)}return this.lazyHash_},i.prototype.getValue=function(){return this.value_},i.prototype.compareTo=function(e){return e===i.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof i.__childrenNodeConstructor?-1:(util_1$D.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},i.prototype.compareToLeafNode_=function(e){var o=typeof e.value_,s=typeof this.value_,f=i.VALUE_TYPE_ORDER.indexOf(o),d=i.VALUE_TYPE_ORDER.indexOf(s);return util_1$D.assert(f>=0,"Unknown leaf type: "+o),util_1$D.assert(d>=0,"Unknown leaf type: "+s),f===d?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:d-f},i.prototype.withIndex=function(){return this},i.prototype.isIndexed=function(){return!0},i.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var o=e;return this.value_===o.value_&&this.priorityNode_.equals(o.priorityNode_)}else return!1},i.VALUE_TYPE_ORDER=["object","boolean","number","string"],i}();LeafNode$1.LeafNode=LeafNode;Object.defineProperty(PriorityIndex$1,"__esModule",{value:!0});var tslib_1$6=tslib.exports,Index_1$2=Index$1,util_1$C=util,Node_1$8=Node,LeafNode_1$1=LeafNode$1,nodeFromJSON$2,MAX_NODE;function setNodeFromJSON(i){nodeFromJSON$2=i}PriorityIndex$1.setNodeFromJSON=setNodeFromJSON;function setMaxNode(i){MAX_NODE=i}PriorityIndex$1.setMaxNode=setMaxNode;var PriorityIndex=function(i){tslib_1$6.__extends(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.compare=function(o,s){var f=o.node.getPriority(),d=s.node.getPriority(),m=f.compareTo(d);return m===0?util_1$C.nameCompare(o.name,s.name):m},e.prototype.isDefinedOn=function(o){return!o.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(o,s){return!o.getPriority().equals(s.getPriority())},e.prototype.minPost=function(){return Node_1$8.NamedNode.MIN},e.prototype.maxPost=function(){return new Node_1$8.NamedNode(util_1$C.MAX_NAME,new LeafNode_1$1.LeafNode("[PRIORITY-POST]",MAX_NODE))},e.prototype.makePost=function(o,s){var f=nodeFromJSON$2(o);return new Node_1$8.NamedNode(s,new LeafNode_1$1.LeafNode("[PRIORITY-POST]",f))},e.prototype.toString=function(){return".priority"},e}(Index_1$2.Index);PriorityIndex$1.PriorityIndex=PriorityIndex;PriorityIndex$1.PRIORITY_INDEX=new PriorityIndex;var ValueIndex$1={},nodeFromJSON$1={},ChildrenNode={},SortedMap$2={};Object.defineProperty(SortedMap$2,"__esModule",{value:!0});var SortedMapIterator$1=function(){function i(e,o,s,f,d){d===void 0&&(d=null),this.isReverse_=f,this.resultGenerator_=d,this.nodeStack_=[];for(var m=1;!e.isEmpty();)if(e=e,m=o?s(e.key,o):1,f&&(m*=-1),m<0)this.isReverse_?e=e.left:e=e.right;else if(m===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}return i.prototype.getNext=function(){if(this.nodeStack_.length===0)return null;var e=this.nodeStack_.pop(),o;if(this.resultGenerator_?o=this.resultGenerator_(e.key,e.value):o={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return o},i.prototype.hasNext=function(){return this.nodeStack_.length>0},i.prototype.peek=function(){if(this.nodeStack_.length===0)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},i}();SortedMap$2.SortedMapIterator=SortedMapIterator$1;var LLRBNode$1=function(){function i(e,o,s,f,d){this.key=e,this.value=o,this.color=s!=null?s:i.RED,this.left=f!=null?f:SortedMap$1.EMPTY_NODE,this.right=d!=null?d:SortedMap$1.EMPTY_NODE}return i.prototype.copy=function(e,o,s,f,d){return new i(e!=null?e:this.key,o!=null?o:this.value,s!=null?s:this.color,f!=null?f:this.left,d!=null?d:this.right)},i.prototype.count=function(){return this.left.count()+1+this.right.count()},i.prototype.isEmpty=function(){return!1},i.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},i.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},i.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},i.prototype.minKey=function(){return this.min_().key},i.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},i.prototype.insert=function(e,o,s){var f,d;return d=this,f=s(e,d.key),f<0?d=d.copy(null,null,null,d.left.insert(e,o,s),null):f===0?d=d.copy(null,o,null,null,null):d=d.copy(null,null,null,null,d.right.insert(e,o,s)),d.fixUp_()},i.prototype.removeMin_=function(){if(this.left.isEmpty())return SortedMap$1.EMPTY_NODE;var e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()},i.prototype.remove=function(e,o){var s,f;if(s=this,o(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,o),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),o(e,s.key)===0){if(s.right.isEmpty())return SortedMap$1.EMPTY_NODE;f=s.right.min_(),s=s.copy(f.key,f.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,o))}return s.fixUp_()},i.prototype.isRed_=function(){return this.color},i.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},i.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e},i.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e},i.prototype.rotateLeft_=function(){var e=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},i.prototype.rotateRight_=function(){var e=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},i.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,o)},i.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},i.prototype.check_=function(){var e;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if(e=this.left.check_(),e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},i.RED=!0,i.BLACK=!1,i}();SortedMap$2.LLRBNode=LLRBNode$1;var LLRBEmptyNode$1=function(){function i(){}return i.prototype.copy=function(e,o,s,f,d){return this},i.prototype.insert=function(e,o,s){return new LLRBNode$1(e,o,null)},i.prototype.remove=function(e,o){return this},i.prototype.count=function(){return 0},i.prototype.isEmpty=function(){return!0},i.prototype.inorderTraversal=function(e){return!1},i.prototype.reverseTraversal=function(e){return!1},i.prototype.minKey=function(){return null},i.prototype.maxKey=function(){return null},i.prototype.check_=function(){return 0},i.prototype.isRed_=function(){return!1},i}();SortedMap$2.LLRBEmptyNode=LLRBEmptyNode$1;var SortedMap$1=function(){function i(e,o){o===void 0&&(o=i.EMPTY_NODE),this.comparator_=e,this.root_=o}return i.prototype.insert=function(e,o){return new i(this.comparator_,this.root_.insert(e,o,this.comparator_).copy(null,null,LLRBNode$1.BLACK,null,null))},i.prototype.remove=function(e){return new i(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,LLRBNode$1.BLACK,null,null))},i.prototype.get=function(e){for(var o,s=this.root_;!s.isEmpty();){if(o=this.comparator_(e,s.key),o===0)return s.value;o<0?s=s.left:o>0&&(s=s.right)}return null},i.prototype.getPredecessorKey=function(e){for(var o,s=this.root_,f=null;!s.isEmpty();)if(o=this.comparator_(e,s.key),o===0){if(s.left.isEmpty())return f?f.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else o<0?s=s.left:o>0&&(f=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},i.prototype.isEmpty=function(){return this.root_.isEmpty()},i.prototype.count=function(){return this.root_.count()},i.prototype.minKey=function(){return this.root_.minKey()},i.prototype.maxKey=function(){return this.root_.maxKey()},i.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},i.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},i.prototype.getIterator=function(e){return new SortedMapIterator$1(this.root_,null,this.comparator_,!1,e)},i.prototype.getIteratorFrom=function(e,o){return new SortedMapIterator$1(this.root_,e,this.comparator_,!1,o)},i.prototype.getReverseIteratorFrom=function(e,o){return new SortedMapIterator$1(this.root_,e,this.comparator_,!0,o)},i.prototype.getReverseIterator=function(e){return new SortedMapIterator$1(this.root_,null,this.comparator_,!0,e)},i.EMPTY_NODE=new LLRBEmptyNode$1,i}();SortedMap$2.SortedMap=SortedMap$1;var IndexMap$1={},childSet={};Object.defineProperty(childSet,"__esModule",{value:!0});var SortedMap_1$1=SortedMap$2,SortedMap_2=SortedMap$2,LOG_2=Math.log(2),Base12Num=function(){function i(e){var o=function(d){return parseInt(Math.log(d)/LOG_2,10)},s=function(d){return parseInt(Array(d+1).join("1"),2)};this.count=o(e+1),this.current_=this.count-1;var f=s(this.count);this.bits_=e+1&f}return i.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},i}();childSet.buildChildSet=function(i,e,o,s){i.sort(e);var f=function($,G){var Z=G-$,et,tt;if(Z==0)return null;if(Z==1)return et=i[$],tt=o?o(et):et,new SortedMap_1$1.LLRBNode(tt,et.node,SortedMap_1$1.LLRBNode.BLACK,null,null);var nt=parseInt(Z/2,10)+$,st=f($,nt),rt=f(nt+1,G);return et=i[nt],tt=o?o(et):et,new SortedMap_1$1.LLRBNode(tt,et.node,SortedMap_1$1.LLRBNode.BLACK,st,rt)},d=function($){for(var G=null,Z=null,et=i.length,tt=function(ot,lt){var ft=et-ot,ct=et;et-=ot;var pt=f(ft+1,ct),gt=i[ft],Tt=o?o(gt):gt;nt(new SortedMap_1$1.LLRBNode(Tt,gt.node,lt,null,pt))},nt=function(ot){G?(G.left=ot,G=ot):(Z=ot,G=ot)},st=0;st<$.count;++st){var rt=$.nextBitIsOne(),it=Math.pow(2,$.count-(st+1));rt?tt(it,SortedMap_1$1.LLRBNode.BLACK):(tt(it,SortedMap_1$1.LLRBNode.BLACK),tt(it,SortedMap_1$1.LLRBNode.RED))}return Z},m=new Base12Num(i.length),_=d(m);return new SortedMap_2.SortedMap(s||e,_)};Object.defineProperty(IndexMap$1,"__esModule",{value:!0});var util_1$B=cjs$1,childSet_1$1=childSet,util_2$i=cjs$1,Node_1$7=Node,PriorityIndex_1$9=PriorityIndex$1,KeyIndex_1$3=KeyIndex$1,_defaultIndexMap,fallbackObject={},IndexMap=function(){function i(e,o){this.indexes_=e,this.indexSet_=o}return Object.defineProperty(i,"Default",{get:function(){return util_1$B.assert(fallbackObject&&PriorityIndex_1$9.PRIORITY_INDEX,"ChildrenNode.ts has not been loaded"),_defaultIndexMap=_defaultIndexMap||new i({".priority":fallbackObject},{".priority":PriorityIndex_1$9.PRIORITY_INDEX}),_defaultIndexMap},enumerable:!0,configurable:!0}),i.prototype.get=function(e){var o=util_2$i.safeGet(this.indexes_,e);if(!o)throw new Error("No index defined for "+e);return o===fallbackObject?null:o},i.prototype.hasIndex=function(e){return util_2$i.contains(this.indexSet_,e.toString())},i.prototype.addIndex=function(e,o){util_1$B.assert(e!==KeyIndex_1$3.KEY_INDEX,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var s=[],f=!1,d=o.getIterator(Node_1$7.NamedNode.Wrap),m=d.getNext();m;)f=f||e.isDefinedOn(m.node),s.push(m),m=d.getNext();var _;f?_=childSet_1$1.buildChildSet(s,e.getCompare()):_=fallbackObject;var $=e.toString(),G=util_2$i.clone(this.indexSet_);G[$]=e;var Z=util_2$i.clone(this.indexes_);return Z[$]=_,new i(Z,G)},i.prototype.addToIndexes=function(e,o){var s=this,f=util_2$i.map(this.indexes_,function(d,m){var _=util_2$i.safeGet(s.indexSet_,m);if(util_1$B.assert(_,"Missing index implementation for "+m),d===fallbackObject)if(_.isDefinedOn(e.node)){for(var $=[],G=o.getIterator(Node_1$7.NamedNode.Wrap),Z=G.getNext();Z;)Z.name!=e.name&&$.push(Z),Z=G.getNext();return $.push(e),childSet_1$1.buildChildSet($,_.getCompare())}else return fallbackObject;else{var et=o.get(e.name),tt=d;return et&&(tt=tt.remove(new Node_1$7.NamedNode(e.name,et))),tt.insert(e,e.node)}});return new i(f,this.indexSet_)},i.prototype.removeFromIndexes=function(e,o){var s=util_2$i.map(this.indexes_,function(f){if(f===fallbackObject)return f;var d=o.get(e.name);return d?f.remove(new Node_1$7.NamedNode(e.name,d)):f});return new i(s,this.indexSet_)},i}();IndexMap$1.IndexMap=IndexMap;var comparators={};Object.defineProperty(comparators,"__esModule",{value:!0});var util_1$A=util;function NAME_ONLY_COMPARATOR(i,e){return util_1$A.nameCompare(i.name,e.name)}comparators.NAME_ONLY_COMPARATOR=NAME_ONLY_COMPARATOR;function NAME_COMPARATOR(i,e){return util_1$A.nameCompare(i,e)}comparators.NAME_COMPARATOR=NAME_COMPARATOR;(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=tslib.exports,o=cjs$1,s=util,f=SortedMap$2,d=Node,m=snap,_=PriorityIndex$1,$=KeyIndex$1,G=IndexMap$1,Z=LeafNode$1,et=comparators,tt,nt=function(){function rt(it,ot,lt){this.children_=it,this.priorityNode_=ot,this.indexMap_=lt,this.lazyHash_=null,this.priorityNode_&&m.validatePriorityNode(this.priorityNode_),this.children_.isEmpty()&&o.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(rt,"EMPTY_NODE",{get:function(){return tt||(tt=new rt(new f.SortedMap(et.NAME_COMPARATOR),null,G.IndexMap.Default))},enumerable:!0,configurable:!0}),rt.prototype.isLeafNode=function(){return!1},rt.prototype.getPriority=function(){return this.priorityNode_||tt},rt.prototype.updatePriority=function(it){return this.children_.isEmpty()?this:new rt(this.children_,it,this.indexMap_)},rt.prototype.getImmediateChild=function(it){if(it===".priority")return this.getPriority();var ot=this.children_.get(it);return ot===null?tt:ot},rt.prototype.getChild=function(it){var ot=it.getFront();return ot===null?this:this.getImmediateChild(ot).getChild(it.popFront())},rt.prototype.hasChild=function(it){return this.children_.get(it)!==null},rt.prototype.updateImmediateChild=function(it,ot){if(o.assert(ot,"We should always be passing snapshot nodes"),it===".priority")return this.updatePriority(ot);var lt=new d.NamedNode(it,ot),ft=void 0,ct=void 0,pt=void 0;return ot.isEmpty()?(ft=this.children_.remove(it),ct=this.indexMap_.removeFromIndexes(lt,this.children_)):(ft=this.children_.insert(it,ot),ct=this.indexMap_.addToIndexes(lt,this.children_)),pt=ft.isEmpty()?tt:this.priorityNode_,new rt(ft,pt,ct)},rt.prototype.updateChild=function(it,ot){var lt=it.getFront();if(lt===null)return ot;o.assert(it.getFront()!==".priority"||it.getLength()===1,".priority must be the last token in a path");var ft=this.getImmediateChild(lt).updateChild(it.popFront(),ot);return this.updateImmediateChild(lt,ft)},rt.prototype.isEmpty=function(){return this.children_.isEmpty()},rt.prototype.numChildren=function(){return this.children_.count()},rt.prototype.val=function(it){if(this.isEmpty())return null;var ot={},lt=0,ft=0,ct=!0;if(this.forEachChild(_.PRIORITY_INDEX,function(Tt,Et){ot[Tt]=Et.val(it),lt++,ct&&rt.INTEGER_REGEXP_.test(Tt)?ft=Math.max(ft,Number(Tt)):ct=!1}),!it&&ct&&ft<2*lt){var pt=[];for(var gt in ot)pt[gt]=ot[gt];return pt}else return it&&!this.getPriority().isEmpty()&&(ot[".priority"]=this.getPriority().val()),ot},rt.prototype.hash=function(){if(this.lazyHash_===null){var it="";this.getPriority().isEmpty()||(it+="priority:"+m.priorityHashText(this.getPriority().val())+":"),this.forEachChild(_.PRIORITY_INDEX,function(ot,lt){var ft=lt.hash();ft!==""&&(it+=":"+ot+":"+ft)}),this.lazyHash_=it===""?"":s.sha1(it)}return this.lazyHash_},rt.prototype.getPredecessorChildName=function(it,ot,lt){var ft=this.resolveIndex_(lt);if(ft){var ct=ft.getPredecessorKey(new d.NamedNode(it,ot));return ct?ct.name:null}else return this.children_.getPredecessorKey(it)},rt.prototype.getFirstChildName=function(it){var ot=this.resolveIndex_(it);if(ot){var lt=ot.minKey();return lt&&lt.name}else return this.children_.minKey()},rt.prototype.getFirstChild=function(it){var ot=this.getFirstChildName(it);return ot?new d.NamedNode(ot,this.children_.get(ot)):null},rt.prototype.getLastChildName=function(it){var ot=this.resolveIndex_(it);if(ot){var lt=ot.maxKey();return lt&&lt.name}else return this.children_.maxKey()},rt.prototype.getLastChild=function(it){var ot=this.getLastChildName(it);return ot?new d.NamedNode(ot,this.children_.get(ot)):null},rt.prototype.forEachChild=function(it,ot){var lt=this.resolveIndex_(it);return lt?lt.inorderTraversal(function(ft){return ot(ft.name,ft.node)}):this.children_.inorderTraversal(ot)},rt.prototype.getIterator=function(it){return this.getIteratorFrom(it.minPost(),it)},rt.prototype.getIteratorFrom=function(it,ot){var lt=this.resolveIndex_(ot);if(lt)return lt.getIteratorFrom(it,function(pt){return pt});for(var ft=this.children_.getIteratorFrom(it.name,d.NamedNode.Wrap),ct=ft.peek();ct!=null&&ot.compare(ct,it)<0;)ft.getNext(),ct=ft.peek();return ft},rt.prototype.getReverseIterator=function(it){return this.getReverseIteratorFrom(it.maxPost(),it)},rt.prototype.getReverseIteratorFrom=function(it,ot){var lt=this.resolveIndex_(ot);if(lt)return lt.getReverseIteratorFrom(it,function(pt){return pt});for(var ft=this.children_.getReverseIteratorFrom(it.name,d.NamedNode.Wrap),ct=ft.peek();ct!=null&&ot.compare(ct,it)>0;)ft.getNext(),ct=ft.peek();return ft},rt.prototype.compareTo=function(it){return this.isEmpty()?it.isEmpty()?0:-1:it.isLeafNode()||it.isEmpty()?1:it===i.MAX_NODE?-1:0},rt.prototype.withIndex=function(it){if(it===$.KEY_INDEX||this.indexMap_.hasIndex(it))return this;var ot=this.indexMap_.addIndex(it,this.children_);return new rt(this.children_,this.priorityNode_,ot)},rt.prototype.isIndexed=function(it){return it===$.KEY_INDEX||this.indexMap_.hasIndex(it)},rt.prototype.equals=function(it){if(it===this)return!0;if(it.isLeafNode())return!1;var ot=it;if(this.getPriority().equals(ot.getPriority()))if(this.children_.count()===ot.children_.count()){for(var lt=this.getIterator(_.PRIORITY_INDEX),ft=ot.getIterator(_.PRIORITY_INDEX),ct=lt.getNext(),pt=ft.getNext();ct&&pt;){if(ct.name!==pt.name||!ct.node.equals(pt.node))return!1;ct=lt.getNext(),pt=ft.getNext()}return ct===null&&pt===null}else return!1;else return!1},rt.prototype.resolveIndex_=function(it){return it===$.KEY_INDEX?null:this.indexMap_.get(it.toString())},rt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,rt}();i.ChildrenNode=nt;var st=function(rt){e.__extends(it,rt);function it(){return rt.call(this,new f.SortedMap(et.NAME_COMPARATOR),nt.EMPTY_NODE,G.IndexMap.Default)||this}return it.prototype.compareTo=function(ot){return ot===this?0:1},it.prototype.equals=function(ot){return ot===this},it.prototype.getPriority=function(){return this},it.prototype.getImmediateChild=function(ot){return nt.EMPTY_NODE},it.prototype.isEmpty=function(){return!1},it}(nt);i.MaxNode=st,i.MAX_NODE=new st,Object.defineProperties(d.NamedNode,{MIN:{value:new d.NamedNode(s.MIN_NAME,nt.EMPTY_NODE)},MAX:{value:new d.NamedNode(s.MAX_NAME,i.MAX_NODE)}}),$.KeyIndex.__EMPTY_NODE=nt.EMPTY_NODE,Z.LeafNode.__childrenNodeConstructor=nt,m.setMaxNode(i.MAX_NODE),_.setMaxNode(i.MAX_NODE)})(ChildrenNode);Object.defineProperty(nodeFromJSON$1,"__esModule",{value:!0});var ChildrenNode_1$b=ChildrenNode,LeafNode_1=LeafNode$1,Node_1$6=Node,util_1$z=cjs$1,util_2$h=cjs$1,childSet_1=childSet,comparators_1=comparators,IndexMap_1=IndexMap$1,PriorityIndex_1$8=PriorityIndex$1,USE_HINZE=!0;function nodeFromJSON(i,e){if(e===void 0&&(e=null),i===null)return ChildrenNode_1$b.ChildrenNode.EMPTY_NODE;if(typeof i=="object"&&".priority"in i&&(e=i[".priority"]),util_2$h.assert(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof i=="object"&&".value"in i&&i[".value"]!==null&&(i=i[".value"]),typeof i!="object"||".sv"in i){var o=i;return new LeafNode_1.LeafNode(o,nodeFromJSON(e))}if(!(i instanceof Array)&&USE_HINZE){var s=[],f=!1,d=i;if(util_1$z.forEach(d,function(Z,et){if(typeof Z!="string"||Z.substring(0,1)!=="."){var tt=nodeFromJSON(d[Z]);tt.isEmpty()||(f=f||!tt.getPriority().isEmpty(),s.push(new Node_1$6.NamedNode(Z,tt)))}}),s.length==0)return ChildrenNode_1$b.ChildrenNode.EMPTY_NODE;var m=childSet_1.buildChildSet(s,comparators_1.NAME_ONLY_COMPARATOR,function(Z){return Z.name},comparators_1.NAME_COMPARATOR);if(f){var _=childSet_1.buildChildSet(s,PriorityIndex_1$8.PRIORITY_INDEX.getCompare());return new ChildrenNode_1$b.ChildrenNode(m,nodeFromJSON(e),new IndexMap_1.IndexMap({".priority":_},{".priority":PriorityIndex_1$8.PRIORITY_INDEX}))}else return new ChildrenNode_1$b.ChildrenNode(m,nodeFromJSON(e),IndexMap_1.IndexMap.Default)}else{var $=ChildrenNode_1$b.ChildrenNode.EMPTY_NODE,G=i;return util_1$z.forEach(G,function(Z,et){if(util_1$z.contains(G,Z)&&Z.substring(0,1)!=="."){var tt=nodeFromJSON(et);(tt.isLeafNode()||!tt.isEmpty())&&($=$.updateImmediateChild(Z,tt))}}),$.updatePriority(nodeFromJSON(e))}}nodeFromJSON$1.nodeFromJSON=nodeFromJSON;PriorityIndex_1$8.setNodeFromJSON(nodeFromJSON);Object.defineProperty(ValueIndex$1,"__esModule",{value:!0});var tslib_1$5=tslib.exports,Index_1$1=Index$1,Node_1$5=Node,util_1$y=util,nodeFromJSON_1$1=nodeFromJSON$1,ValueIndex=function(i){tslib_1$5.__extends(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.compare=function(o,s){var f=o.node.compareTo(s.node);return f===0?util_1$y.nameCompare(o.name,s.name):f},e.prototype.isDefinedOn=function(o){return!0},e.prototype.indexedValueChanged=function(o,s){return!o.equals(s)},e.prototype.minPost=function(){return Node_1$5.NamedNode.MIN},e.prototype.maxPost=function(){return Node_1$5.NamedNode.MAX},e.prototype.makePost=function(o,s){var f=nodeFromJSON_1$1.nodeFromJSON(o);return new Node_1$5.NamedNode(s,f)},e.prototype.toString=function(){return".value"},e}(Index_1$1.Index);ValueIndex$1.ValueIndex=ValueIndex;ValueIndex$1.VALUE_INDEX=new ValueIndex;var PathIndex$1={};Object.defineProperty(PathIndex$1,"__esModule",{value:!0});var tslib_1$4=tslib.exports,util_1$x=cjs$1,util_2$g=util,Index_1=Index$1,ChildrenNode_1$a=ChildrenNode,Node_1$4=Node,nodeFromJSON_1=nodeFromJSON$1,PathIndex=function(i){tslib_1$4.__extends(e,i);function e(o){var s=i.call(this)||this;return s.indexPath_=o,util_1$x.assert(!o.isEmpty()&&o.getFront()!==".priority","Can't create PathIndex with empty path or .priority key"),s}return e.prototype.extractChild=function(o){return o.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(o){return!o.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(o,s){var f=this.extractChild(o.node),d=this.extractChild(s.node),m=f.compareTo(d);return m===0?util_2$g.nameCompare(o.name,s.name):m},e.prototype.makePost=function(o,s){var f=nodeFromJSON_1.nodeFromJSON(o),d=ChildrenNode_1$a.ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,f);return new Node_1$4.NamedNode(s,d)},e.prototype.maxPost=function(){var o=ChildrenNode_1$a.ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,ChildrenNode_1$a.MAX_NODE);return new Node_1$4.NamedNode(util_2$g.MAX_NAME,o)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(Index_1.Index);PathIndex$1.PathIndex=PathIndex;var EventRegistration={},DataSnapshot={},hasRequiredDataSnapshot;function requireDataSnapshot(){if(hasRequiredDataSnapshot)return DataSnapshot;hasRequiredDataSnapshot=1,Object.defineProperty(DataSnapshot,"__esModule",{value:!0});var i=cjs$1,e=validation,o=Path$2,s=PriorityIndex$1,f=function(){function d(m,_,$){this.node_=m,this.ref_=_,this.index_=$}return d.prototype.val=function(){return i.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},d.prototype.exportVal=function(){return i.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},d.prototype.toJSON=function(){return i.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},d.prototype.exists=function(){return i.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},d.prototype.child=function(m){i.validateArgCount("DataSnapshot.child",0,1,arguments.length),m=String(m),e.validatePathString("DataSnapshot.child",1,m,!1);var _=new o.Path(m),$=this.ref_.child(_);return new d(this.node_.getChild(_),$,s.PRIORITY_INDEX)},d.prototype.hasChild=function(m){i.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),e.validatePathString("DataSnapshot.hasChild",1,m,!1);var _=new o.Path(m);return!this.node_.getChild(_).isEmpty()},d.prototype.getPriority=function(){return i.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},d.prototype.forEach=function(m){var _=this;if(i.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),i.validateCallback("DataSnapshot.forEach",1,m,!1),this.node_.isLeafNode())return!1;var $=this.node_;return!!$.forEachChild(this.index_,function(G,Z){return m(new d(Z,_.ref_.child(G),s.PRIORITY_INDEX))})},d.prototype.hasChildren=function(){return i.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),this.node_.isLeafNode()?!1:!this.node_.isEmpty()},Object.defineProperty(d.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),d.prototype.numChildren=function(){return i.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},d.prototype.getRef=function(){return i.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(d.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),d}();return DataSnapshot.DataSnapshot=f,DataSnapshot}var Event$1={};Object.defineProperty(Event$1,"__esModule",{value:!0});var util_1$w=cjs$1,DataEvent=function(){function i(e,o,s,f){this.eventType=e,this.eventRegistration=o,this.snapshot=s,this.prevName=f}return i.prototype.getPath=function(){var e=this.snapshot.getRef();return this.eventType==="value"?e.path:e.getParent().path},i.prototype.getEventType=function(){return this.eventType},i.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},i.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+util_1$w.stringify(this.snapshot.exportVal())},i}();Event$1.DataEvent=DataEvent;var CancelEvent=function(){function i(e,o,s){this.eventRegistration=e,this.error=o,this.path=s}return i.prototype.getPath=function(){return this.path},i.prototype.getEventType=function(){return"cancel"},i.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},i.prototype.toString=function(){return this.path.toString()+":cancel"},i}();Event$1.CancelEvent=CancelEvent;Object.defineProperty(EventRegistration,"__esModule",{value:!0});var DataSnapshot_1=requireDataSnapshot(),Event_1=Event$1,util_1$v=cjs$1,util_2$f=cjs$1,ValueEventRegistration=function(){function i(e,o,s){this.callback_=e,this.cancelCallback_=o,this.context_=s}return i.prototype.respondsTo=function(e){return e==="value"},i.prototype.createEvent=function(e,o){var s=o.getQueryParams().getIndex();return new Event_1.DataEvent("value",this,new DataSnapshot_1.DataSnapshot(e.snapshotNode,o.getRef(),s))},i.prototype.getEventRunner=function(e){var o=this.context_;if(e.getEventType()==="cancel"){util_2$f.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var s=this.cancelCallback_;return function(){s.call(o,e.error)}}else{var f=this.callback_;return function(){f.call(o,e.snapshot)}}},i.prototype.createCancelEvent=function(e,o){return this.cancelCallback_?new Event_1.CancelEvent(this,e,o):null},i.prototype.matches=function(e){return e instanceof i?!e.callback_||!this.callback_?!0:e.callback_===this.callback_&&e.context_===this.context_:!1},i.prototype.hasAnyCallback=function(){return this.callback_!==null},i}();EventRegistration.ValueEventRegistration=ValueEventRegistration;var ChildEventRegistration=function(){function i(e,o,s){this.callbacks_=e,this.cancelCallback_=o,this.context_=s}return i.prototype.respondsTo=function(e){var o=e==="children_added"?"child_added":e;return o=o==="children_removed"?"child_removed":o,util_1$v.contains(this.callbacks_,o)},i.prototype.createCancelEvent=function(e,o){return this.cancelCallback_?new Event_1.CancelEvent(this,e,o):null},i.prototype.createEvent=function(e,o){util_2$f.assert(e.childName!=null,"Child events should have a childName.");var s=o.getRef().child(e.childName),f=o.getQueryParams().getIndex();return new Event_1.DataEvent(e.type,this,new DataSnapshot_1.DataSnapshot(e.snapshotNode,s,f),e.prevName)},i.prototype.getEventRunner=function(e){var o=this.context_;if(e.getEventType()==="cancel"){util_2$f.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var s=this.cancelCallback_;return function(){s.call(o,e.error)}}else{var f=this.callbacks_[e.eventType];return function(){f.call(o,e.snapshot,e.prevName)}}},i.prototype.matches=function(e){if(e instanceof i){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var o=util_1$v.getCount(e.callbacks_),s=util_1$v.getCount(this.callbacks_);if(o===s)if(o===1){var f=util_1$v.getAnyKey(e.callbacks_),d=util_1$v.getAnyKey(this.callbacks_);return d===f&&(!e.callbacks_[f]||!this.callbacks_[d]||e.callbacks_[f]===this.callbacks_[d])}else return util_1$v.every(this.callbacks_,function(m,_){return e.callbacks_[m]===_})}}return!1},i.prototype.hasAnyCallback=function(){return this.callbacks_!==null},i}();EventRegistration.ChildEventRegistration=ChildEventRegistration;Object.defineProperty(Query$3,"__esModule",{value:!0});var util_1$u=cjs$1,KeyIndex_1$2=KeyIndex$1,PriorityIndex_1$7=PriorityIndex$1,ValueIndex_1$1=ValueIndex$1,PathIndex_1$1=PathIndex$1,util_2$e=util,Path_1$c=Path$2,validation_1=validation,util_3$5=cjs$1,EventRegistration_1=EventRegistration,util_4$3=cjs$1,__referenceConstructor$1,Query$2=function(){function i(e,o,s,f){this.repo=e,this.path=o,this.queryParams_=s,this.orderByCalled_=f}return Object.defineProperty(i,"__referenceConstructor",{get:function(){return util_1$u.assert(__referenceConstructor$1,"Reference.ts has not been loaded"),__referenceConstructor$1},set:function(e){__referenceConstructor$1=e},enumerable:!0,configurable:!0}),i.validateQueryEndpoints_=function(e){var o=null,s=null;if(e.hasStart()&&(o=e.getIndexStartValue()),e.hasEnd()&&(s=e.getIndexEndValue()),e.getIndex()===KeyIndex_1$2.KEY_INDEX){var f="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",d="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){var m=e.getIndexStartName();if(m!=util_2$e.MIN_NAME)throw new Error(f);if(typeof o!="string")throw new Error(d)}if(e.hasEnd()){var _=e.getIndexEndName();if(_!=util_2$e.MAX_NAME)throw new Error(f);if(typeof s!="string")throw new Error(d)}}else if(e.getIndex()===PriorityIndex_1$7.PRIORITY_INDEX){if(o!=null&&!validation_1.isValidPriority(o)||s!=null&&!validation_1.isValidPriority(s))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(util_1$u.assert(e.getIndex()instanceof PathIndex_1$1.PathIndex||e.getIndex()===ValueIndex_1$1.VALUE_INDEX,"unknown index type."),o!=null&&typeof o=="object"||s!=null&&typeof s=="object")throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},i.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},i.prototype.validateNoPreviousOrderByCall_=function(e){if(this.orderByCalled_===!0)throw new Error(e+": You can't combine multiple orderBy calls.")},i.prototype.getQueryParams=function(){return this.queryParams_},i.prototype.getRef=function(){return util_3$5.validateArgCount("Query.ref",0,0,arguments.length),new i.__referenceConstructor(this.repo,this.path)},i.prototype.on=function(e,o,s,f){util_3$5.validateArgCount("Query.on",2,4,arguments.length),validation_1.validateEventType("Query.on",1,e,!1),util_3$5.validateCallback("Query.on",2,o,!1);var d=i.getCancelAndContextArgs_("Query.on",s,f);if(e==="value")this.onValueEvent(o,d.cancel,d.context);else{var m={};m[e]=o,this.onChildEvent(m,d.cancel,d.context)}return o},i.prototype.onValueEvent=function(e,o,s){var f=new EventRegistration_1.ValueEventRegistration(e,o||null,s||null);this.repo.addEventCallbackForQuery(this,f)},i.prototype.onChildEvent=function(e,o,s){var f=new EventRegistration_1.ChildEventRegistration(e,o,s);this.repo.addEventCallbackForQuery(this,f)},i.prototype.off=function(e,o,s){util_3$5.validateArgCount("Query.off",0,3,arguments.length),validation_1.validateEventType("Query.off",1,e,!0),util_3$5.validateCallback("Query.off",2,o,!0),util_3$5.validateContextObject("Query.off",3,s,!0);var f=null,d=null;if(e==="value"){var m=o||null;f=new EventRegistration_1.ValueEventRegistration(m,null,s||null)}else e&&(o&&(d={},d[e]=o),f=new EventRegistration_1.ChildEventRegistration(d,null,s||null));this.repo.removeEventCallbackForQuery(this,f)},i.prototype.once=function(e,o,s,f){var d=this;util_3$5.validateArgCount("Query.once",1,4,arguments.length),validation_1.validateEventType("Query.once",1,e,!1),util_3$5.validateCallback("Query.once",2,o,!0);var m=i.getCancelAndContextArgs_("Query.once",s,f),_=!0,$=new util_4$3.Deferred;$.promise.catch(function(){});var G=function(Z){_&&(_=!1,d.off(e,G),o&&o.bind(m.context)(Z),$.resolve(Z))};return this.on(e,G,function(Z){d.off(e,G),m.cancel&&m.cancel.bind(m.context)(Z),$.reject(Z)}),$.promise},i.prototype.limitToFirst=function(e){if(util_3$5.validateArgCount("Query.limitToFirst",1,1,arguments.length),typeof e!="number"||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new i(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},i.prototype.limitToLast=function(e){if(util_3$5.validateArgCount("Query.limitToLast",1,1,arguments.length),typeof e!="number"||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new i(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},i.prototype.orderByChild=function(e){if(util_3$5.validateArgCount("Query.orderByChild",1,1,arguments.length),e==="$key")throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if(e==="$priority")throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if(e==="$value")throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');validation_1.validatePathString("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var o=new Path_1$c.Path(e);if(o.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var s=new PathIndex_1$1.PathIndex(o),f=this.queryParams_.orderBy(s);return i.validateQueryEndpoints_(f),new i(this.repo,this.path,f,!0)},i.prototype.orderByKey=function(){util_3$5.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(KeyIndex_1$2.KEY_INDEX);return i.validateQueryEndpoints_(e),new i(this.repo,this.path,e,!0)},i.prototype.orderByPriority=function(){util_3$5.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(PriorityIndex_1$7.PRIORITY_INDEX);return i.validateQueryEndpoints_(e),new i(this.repo,this.path,e,!0)},i.prototype.orderByValue=function(){util_3$5.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(ValueIndex_1$1.VALUE_INDEX);return i.validateQueryEndpoints_(e),new i(this.repo,this.path,e,!0)},i.prototype.startAt=function(e,o){e===void 0&&(e=null),util_3$5.validateArgCount("Query.startAt",0,2,arguments.length),validation_1.validateFirebaseDataArg("Query.startAt",1,e,this.path,!0),validation_1.validateKey("Query.startAt",2,o,!0);var s=this.queryParams_.startAt(e,o);if(i.validateLimit_(s),i.validateQueryEndpoints_(s),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return e===void 0&&(e=null,o=null),new i(this.repo,this.path,s,this.orderByCalled_)},i.prototype.endAt=function(e,o){e===void 0&&(e=null),util_3$5.validateArgCount("Query.endAt",0,2,arguments.length),validation_1.validateFirebaseDataArg("Query.endAt",1,e,this.path,!0),validation_1.validateKey("Query.endAt",2,o,!0);var s=this.queryParams_.endAt(e,o);if(i.validateLimit_(s),i.validateQueryEndpoints_(s),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new i(this.repo,this.path,s,this.orderByCalled_)},i.prototype.equalTo=function(e,o){if(util_3$5.validateArgCount("Query.equalTo",1,2,arguments.length),validation_1.validateFirebaseDataArg("Query.equalTo",1,e,this.path,!1),validation_1.validateKey("Query.equalTo",2,o,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,o).endAt(e,o)},i.prototype.toString=function(){return util_3$5.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},i.prototype.toJSON=function(){return util_3$5.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},i.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},i.prototype.queryIdentifier=function(){var e=this.queryObject(),o=util_2$e.ObjectToUniqueKey(e);return o==="{}"?"default":o},i.prototype.isEqual=function(e){if(util_3$5.validateArgCount("Query.isEqual",1,1,arguments.length),!(e instanceof i)){var o="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(o)}var s=this.repo===e.repo,f=this.path.equals(e.path),d=this.queryIdentifier()===e.queryIdentifier();return s&&f&&d},i.getCancelAndContextArgs_=function(e,o,s){var f={cancel:null,context:null};if(o&&s)f.cancel=o,util_3$5.validateCallback(e,3,f.cancel,!0),f.context=s,util_3$5.validateContextObject(e,4,f.context,!0);else if(o)if(typeof o=="object"&&o!==null)f.context=o;else if(typeof o=="function")f.cancel=o;else throw new Error(util_3$5.errorPrefix(e,3,!0)+" must either be a cancel callback or a context object.");return f},Object.defineProperty(i.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),i}();Query$3.Query=Query$2;var Repo={},ServerValues={},SparseSnapshotTree$1={},CountedSet$1={};Object.defineProperty(CountedSet$1,"__esModule",{value:!0});var util_1$t=cjs$1,CountedSet=function(){function i(){this.set={}}return i.prototype.add=function(e,o){this.set[e]=o!==null?o:!0},i.prototype.contains=function(e){return util_1$t.contains(this.set,e)},i.prototype.get=function(e){return this.contains(e)?this.set[e]:void 0},i.prototype.remove=function(e){delete this.set[e]},i.prototype.clear=function(){this.set={}},i.prototype.isEmpty=function(){return util_1$t.isEmpty(this.set)},i.prototype.count=function(){return util_1$t.getCount(this.set)},i.prototype.each=function(e){util_1$t.forEach(this.set,function(o,s){return e(o,s)})},i.prototype.keys=function(){var e=[];return util_1$t.forEach(this.set,function(o){e.push(o)}),e},i}();CountedSet$1.CountedSet=CountedSet;Object.defineProperty(SparseSnapshotTree$1,"__esModule",{value:!0});var Path_1$b=Path$2,PriorityIndex_1$6=PriorityIndex$1,CountedSet_1=CountedSet$1,SparseSnapshotTree=function(){function i(){this.value_=null,this.children_=null}return i.prototype.find=function(e){if(this.value_!=null)return this.value_.getChild(e);if(!e.isEmpty()&&this.children_!=null){var o=e.getFront();if(e=e.popFront(),this.children_.contains(o)){var s=this.children_.get(o);return s.find(e)}else return null}else return null},i.prototype.remember=function(e,o){if(e.isEmpty())this.value_=o,this.children_=null;else if(this.value_!==null)this.value_=this.value_.updateChild(e,o);else{this.children_==null&&(this.children_=new CountedSet_1.CountedSet);var s=e.getFront();this.children_.contains(s)||this.children_.add(s,new i);var f=this.children_.get(s);e=e.popFront(),f.remember(e,o)}},i.prototype.forget=function(e){if(e.isEmpty())return this.value_=null,this.children_=null,!0;if(this.value_!==null){if(this.value_.isLeafNode())return!1;var o=this.value_;this.value_=null;var s=this;return o.forEachChild(PriorityIndex_1$6.PRIORITY_INDEX,function(m,_){s.remember(new Path_1$b.Path(m),_)}),this.forget(e)}else if(this.children_!==null){var f=e.getFront();if(e=e.popFront(),this.children_.contains(f)){var d=this.children_.get(f).forget(e);d&&this.children_.remove(f)}return this.children_.isEmpty()?(this.children_=null,!0):!1}else return!0},i.prototype.forEachTree=function(e,o){this.value_!==null?o(e,this.value_):this.forEachChild(function(s,f){var d=new Path_1$b.Path(e.toString()+"/"+s);f.forEachTree(d,o)})},i.prototype.forEachChild=function(e){this.children_!==null&&this.children_.each(function(o,s){e(o,s)})},i}();SparseSnapshotTree$1.SparseSnapshotTree=SparseSnapshotTree;(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=cjs$1,o=Path$2,s=SparseSnapshotTree$1,f=LeafNode$1,d=nodeFromJSON$1,m=PriorityIndex$1;i.generateWithValues=function(_){return _=_||{},_.timestamp=_.timestamp||new Date().getTime(),_},i.resolveDeferredValue=function(_,$){return!_||typeof _!="object"?_:(e.assert(".sv"in _,"Unexpected leaf node or priority contents"),$[_[".sv"]])},i.resolveDeferredValueTree=function(_,$){var G=new s.SparseSnapshotTree;return _.forEachTree(new o.Path(""),function(Z,et){G.remember(Z,i.resolveDeferredValueSnapshot(et,$))}),G},i.resolveDeferredValueSnapshot=function(_,$){var G=_.getPriority().val(),Z=i.resolveDeferredValue(G,$),et;if(_.isLeafNode()){var tt=_,nt=i.resolveDeferredValue(tt.getValue(),$);return nt!==tt.getValue()||Z!==tt.getPriority().val()?new f.LeafNode(nt,d.nodeFromJSON(Z)):_}else{var st=_;return et=st,Z!==st.getPriority().val()&&(et=et.updatePriority(new f.LeafNode(Z))),st.forEachChild(m.PRIORITY_INDEX,function(rt,it){var ot=i.resolveDeferredValueSnapshot(it,$);ot!==it&&(et=et.updateImmediateChild(rt,ot))}),et}}})(ServerValues);var SyncTree$1={},AckUserWrite$1={},Operation={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=cjs$1;(function(s){s[s.OVERWRITE=0]="OVERWRITE",s[s.MERGE=1]="MERGE",s[s.ACK_USER_WRITE=2]="ACK_USER_WRITE",s[s.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(i.OperationType||(i.OperationType={}));var o=function(){function s(f,d,m,_){this.fromUser=f,this.fromServer=d,this.queryId=m,this.tagged=_,e.assert(!_||d,"Tagged queries must be from server.")}return s.User=new s(!0,!1,null,!1),s.Server=new s(!1,!0,null,!1),s.forServerTaggedQuery=function(f){return new s(!1,!0,f,!0)},s}();i.OperationSource=o})(Operation);Object.defineProperty(AckUserWrite$1,"__esModule",{value:!0});var util_1$s=cjs$1,Path_1$a=Path$2,Operation_1$6=Operation,AckUserWrite=function(){function i(e,o,s){this.path=e,this.affectedTree=o,this.revert=s,this.type=Operation_1$6.OperationType.ACK_USER_WRITE,this.source=Operation_1$6.OperationSource.User}return i.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(this.affectedTree.value!=null)return util_1$s.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var o=this.affectedTree.subtree(new Path_1$a.Path(e));return new i(Path_1$a.Path.Empty,o,this.revert)}else return util_1$s.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new i(this.path.popFront(),this.affectedTree,this.revert)},i}();AckUserWrite$1.AckUserWrite=AckUserWrite;var ImmutableTree$1={};Object.defineProperty(ImmutableTree$1,"__esModule",{value:!0});var SortedMap_1=SortedMap$2,Path_1$9=Path$2,util_1$r=util,util_2$d=cjs$1,emptyChildrenSingleton,EmptyChildren=function(){return emptyChildrenSingleton||(emptyChildrenSingleton=new SortedMap_1.SortedMap(util_1$r.stringCompare)),emptyChildrenSingleton},ImmutableTree=function(){function i(e,o){o===void 0&&(o=EmptyChildren()),this.value=e,this.children=o}return i.fromObject=function(e){var o=i.Empty;return util_2$d.forEach(e,function(s,f){o=o.set(new Path_1$9.Path(s),f)}),o},i.prototype.isEmpty=function(){return this.value===null&&this.children.isEmpty()},i.prototype.findRootMostMatchingPathAndValue=function(e,o){if(this.value!=null&&o(this.value))return{path:Path_1$9.Path.Empty,value:this.value};if(e.isEmpty())return null;var s=e.getFront(),f=this.children.get(s);if(f!==null){var d=f.findRootMostMatchingPathAndValue(e.popFront(),o);if(d!=null){var m=new Path_1$9.Path(s).child(d.path);return{path:m,value:d.value}}else return null}else return null},i.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},i.prototype.subtree=function(e){if(e.isEmpty())return this;var o=e.getFront(),s=this.children.get(o);return s!==null?s.subtree(e.popFront()):i.Empty},i.prototype.set=function(e,o){if(e.isEmpty())return new i(o,this.children);var s=e.getFront(),f=this.children.get(s)||i.Empty,d=f.set(e.popFront(),o),m=this.children.insert(s,d);return new i(this.value,m)},i.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?i.Empty:new i(null,this.children);var o=e.getFront(),s=this.children.get(o);if(s){var f=s.remove(e.popFront()),d=void 0;return f.isEmpty()?d=this.children.remove(o):d=this.children.insert(o,f),this.value===null&&d.isEmpty()?i.Empty:new i(this.value,d)}else return this},i.prototype.get=function(e){if(e.isEmpty())return this.value;var o=e.getFront(),s=this.children.get(o);return s?s.get(e.popFront()):null},i.prototype.setTree=function(e,o){if(e.isEmpty())return o;var s=e.getFront(),f=this.children.get(s)||i.Empty,d=f.setTree(e.popFront(),o),m=void 0;return d.isEmpty()?m=this.children.remove(s):m=this.children.insert(s,d),new i(this.value,m)},i.prototype.fold=function(e){return this.fold_(Path_1$9.Path.Empty,e)},i.prototype.fold_=function(e,o){var s={};return this.children.inorderTraversal(function(f,d){s[f]=d.fold_(e.child(f),o)}),o(e,this.value,s)},i.prototype.findOnPath=function(e,o){return this.findOnPath_(e,Path_1$9.Path.Empty,o)},i.prototype.findOnPath_=function(e,o,s){var f=this.value?s(o,this.value):!1;if(f)return f;if(e.isEmpty())return null;var d=e.getFront(),m=this.children.get(d);return m?m.findOnPath_(e.popFront(),o.child(d),s):null},i.prototype.foreachOnPath=function(e,o){return this.foreachOnPath_(e,Path_1$9.Path.Empty,o)},i.prototype.foreachOnPath_=function(e,o,s){if(e.isEmpty())return this;this.value&&s(o,this.value);var f=e.getFront(),d=this.children.get(f);return d?d.foreachOnPath_(e.popFront(),o.child(f),s):i.Empty},i.prototype.foreach=function(e){this.foreach_(Path_1$9.Path.Empty,e)},i.prototype.foreach_=function(e,o){this.children.inorderTraversal(function(s,f){f.foreach_(e.child(s),o)}),this.value&&o(e,this.value)},i.prototype.foreachChild=function(e){this.children.inorderTraversal(function(o,s){s.value&&e(o,s.value)})},i.Empty=new i(null),i}();ImmutableTree$1.ImmutableTree=ImmutableTree;var ListenComplete$1={};Object.defineProperty(ListenComplete$1,"__esModule",{value:!0});var Path_1$8=Path$2,Operation_1$5=Operation,ListenComplete=function(){function i(e,o){this.source=e,this.path=o,this.type=Operation_1$5.OperationType.LISTEN_COMPLETE}return i.prototype.operationForChild=function(e){return this.path.isEmpty()?new i(this.source,Path_1$8.Path.Empty):new i(this.source,this.path.popFront())},i}();ListenComplete$1.ListenComplete=ListenComplete;var Merge$1={},Overwrite$1={};Object.defineProperty(Overwrite$1,"__esModule",{value:!0});var Operation_1$4=Operation,Path_1$7=Path$2,Overwrite=function(){function i(e,o,s){this.source=e,this.path=o,this.snap=s,this.type=Operation_1$4.OperationType.OVERWRITE}return i.prototype.operationForChild=function(e){return this.path.isEmpty()?new i(this.source,Path_1$7.Path.Empty,this.snap.getImmediateChild(e)):new i(this.source,this.path.popFront(),this.snap)},i}();Overwrite$1.Overwrite=Overwrite;Object.defineProperty(Merge$1,"__esModule",{value:!0});var Operation_1$3=Operation,Overwrite_1$1=Overwrite$1,Path_1$6=Path$2,util_1$q=cjs$1,Merge=function(){function i(e,o,s){this.source=e,this.path=o,this.children=s,this.type=Operation_1$3.OperationType.MERGE}return i.prototype.operationForChild=function(e){if(this.path.isEmpty()){var o=this.children.subtree(new Path_1$6.Path(e));return o.isEmpty()?null:o.value?new Overwrite_1$1.Overwrite(this.source,Path_1$6.Path.Empty,o.value):new i(this.source,Path_1$6.Path.Empty,o)}else return util_1$q.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new i(this.source,this.path.popFront(),this.children)},i.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},i}();Merge$1.Merge=Merge;var SyncPoint$1={},CacheNode$1={};Object.defineProperty(CacheNode$1,"__esModule",{value:!0});var CacheNode=function(){function i(e,o,s){this.node_=e,this.fullyInitialized_=o,this.filtered_=s}return i.prototype.isFullyInitialized=function(){return this.fullyInitialized_},i.prototype.isFiltered=function(){return this.filtered_},i.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var o=e.getFront();return this.isCompleteForChild(o)},i.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},i.prototype.getNode=function(){return this.node_},i}();CacheNode$1.CacheNode=CacheNode;var ViewCache$1={};Object.defineProperty(ViewCache$1,"__esModule",{value:!0});var ChildrenNode_1$9=ChildrenNode,CacheNode_1$3=CacheNode$1,ViewCache=function(){function i(e,o){this.eventCache_=e,this.serverCache_=o}return i.prototype.updateEventSnap=function(e,o,s){return new i(new CacheNode_1$3.CacheNode(e,o,s),this.serverCache_)},i.prototype.updateServerSnap=function(e,o,s){return new i(this.eventCache_,new CacheNode_1$3.CacheNode(e,o,s))},i.prototype.getEventCache=function(){return this.eventCache_},i.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},i.prototype.getServerCache=function(){return this.serverCache_},i.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},i.Empty=new i(new CacheNode_1$3.CacheNode(ChildrenNode_1$9.ChildrenNode.EMPTY_NODE,!1,!1),new CacheNode_1$3.CacheNode(ChildrenNode_1$9.ChildrenNode.EMPTY_NODE,!1,!1)),i}();ViewCache$1.ViewCache=ViewCache;var View$2={},IndexedFilter$1={},Change$1={};Object.defineProperty(Change$1,"__esModule",{value:!0});var Change=function(){function i(e,o,s,f,d){this.type=e,this.snapshotNode=o,this.childName=s,this.oldSnap=f,this.prevName=d}return i.valueChange=function(e){return new i(i.VALUE,e)},i.childAddedChange=function(e,o){return new i(i.CHILD_ADDED,o,e)},i.childRemovedChange=function(e,o){return new i(i.CHILD_REMOVED,o,e)},i.childChangedChange=function(e,o,s){return new i(i.CHILD_CHANGED,o,e,s)},i.childMovedChange=function(e,o){return new i(i.CHILD_MOVED,o,e)},i.CHILD_ADDED="child_added",i.CHILD_REMOVED="child_removed",i.CHILD_CHANGED="child_changed",i.CHILD_MOVED="child_moved",i.VALUE="value",i}();Change$1.Change=Change;Object.defineProperty(IndexedFilter$1,"__esModule",{value:!0});var util_1$p=cjs$1,Change_1$5=Change$1,ChildrenNode_1$8=ChildrenNode,PriorityIndex_1$5=PriorityIndex$1,IndexedFilter=function(){function i(e){this.index_=e}return i.prototype.updateChild=function(e,o,s,f,d,m){util_1$p.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var _=e.getImmediateChild(o);return _.getChild(f).equals(s.getChild(f))&&_.isEmpty()==s.isEmpty()||(m!=null&&(s.isEmpty()?e.hasChild(o)?m.trackChildChange(Change_1$5.Change.childRemovedChange(o,_)):util_1$p.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):_.isEmpty()?m.trackChildChange(Change_1$5.Change.childAddedChange(o,s)):m.trackChildChange(Change_1$5.Change.childChangedChange(o,s,_))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(o,s).withIndex(this.index_)},i.prototype.updateFullNode=function(e,o,s){return s!=null&&(e.isLeafNode()||e.forEachChild(PriorityIndex_1$5.PRIORITY_INDEX,function(f,d){o.hasChild(f)||s.trackChildChange(Change_1$5.Change.childRemovedChange(f,d))}),o.isLeafNode()||o.forEachChild(PriorityIndex_1$5.PRIORITY_INDEX,function(f,d){if(e.hasChild(f)){var m=e.getImmediateChild(f);m.equals(d)||s.trackChildChange(Change_1$5.Change.childChangedChange(f,d,m))}else s.trackChildChange(Change_1$5.Change.childAddedChange(f,d))})),o.withIndex(this.index_)},i.prototype.updatePriority=function(e,o){return e.isEmpty()?ChildrenNode_1$8.ChildrenNode.EMPTY_NODE:e.updatePriority(o)},i.prototype.filtersNodes=function(){return!1},i.prototype.getIndexedFilter=function(){return this},i.prototype.getIndex=function(){return this.index_},i}();IndexedFilter$1.IndexedFilter=IndexedFilter;var ViewProcessor$1={},ChildChangeAccumulator$1={};Object.defineProperty(ChildChangeAccumulator$1,"__esModule",{value:!0});var util_1$o=cjs$1,Change_1$4=Change$1,util_2$c=cjs$1,ChildChangeAccumulator=function(){function i(){this.changeMap_={}}return i.prototype.trackChildChange=function(e){var o=e.type,s=e.childName;util_2$c.assert(o==Change_1$4.Change.CHILD_ADDED||o==Change_1$4.Change.CHILD_CHANGED||o==Change_1$4.Change.CHILD_REMOVED,"Only child changes supported for tracking"),util_2$c.assert(s!==".priority","Only non-priority child changes can be tracked.");var f=util_1$o.safeGet(this.changeMap_,s);if(f){var d=f.type;if(o==Change_1$4.Change.CHILD_ADDED&&d==Change_1$4.Change.CHILD_REMOVED)this.changeMap_[s]=Change_1$4.Change.childChangedChange(s,e.snapshotNode,f.snapshotNode);else if(o==Change_1$4.Change.CHILD_REMOVED&&d==Change_1$4.Change.CHILD_ADDED)delete this.changeMap_[s];else if(o==Change_1$4.Change.CHILD_REMOVED&&d==Change_1$4.Change.CHILD_CHANGED)this.changeMap_[s]=Change_1$4.Change.childRemovedChange(s,f.oldSnap);else if(o==Change_1$4.Change.CHILD_CHANGED&&d==Change_1$4.Change.CHILD_ADDED)this.changeMap_[s]=Change_1$4.Change.childAddedChange(s,e.snapshotNode);else if(o==Change_1$4.Change.CHILD_CHANGED&&d==Change_1$4.Change.CHILD_CHANGED)this.changeMap_[s]=Change_1$4.Change.childChangedChange(s,e.snapshotNode,f.oldSnap);else throw util_2$c.assertionError("Illegal combination of changes: "+e+" occurred after "+f)}else this.changeMap_[s]=e},i.prototype.getChanges=function(){return util_1$o.getValues(this.changeMap_)},i}();ChildChangeAccumulator$1.ChildChangeAccumulator=ChildChangeAccumulator;var CompleteChildSource={};Object.defineProperty(CompleteChildSource,"__esModule",{value:!0});var CacheNode_1$2=CacheNode$1,NoCompleteChildSource_=function(){function i(){}return i.prototype.getCompleteChild=function(e){return null},i.prototype.getChildAfterChild=function(e,o,s){return null},i}();CompleteChildSource.NoCompleteChildSource_=NoCompleteChildSource_;CompleteChildSource.NO_COMPLETE_CHILD_SOURCE=new NoCompleteChildSource_;var WriteTreeCompleteChildSource=function(){function i(e,o,s){s===void 0&&(s=null),this.writes_=e,this.viewCache_=o,this.optCompleteServerCache_=s}return i.prototype.getCompleteChild=function(e){var o=this.viewCache_.getEventCache();if(o.isCompleteForChild(e))return o.getNode().getImmediateChild(e);var s=this.optCompleteServerCache_!=null?new CacheNode_1$2.CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,s)},i.prototype.getChildAfterChild=function(e,o,s){var f=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),d=this.writes_.calcIndexedSlice(f,o,1,s,e);return d.length===0?null:d[0]},i}();CompleteChildSource.WriteTreeCompleteChildSource=WriteTreeCompleteChildSource;Object.defineProperty(ViewProcessor$1,"__esModule",{value:!0});var Operation_1$2=Operation,util_1$n=cjs$1,ChildChangeAccumulator_1=ChildChangeAccumulator$1,Change_1$3=Change$1,ChildrenNode_1$7=ChildrenNode,KeyIndex_1$1=KeyIndex$1,ImmutableTree_1$2=ImmutableTree$1,Path_1$5=Path$2,CompleteChildSource_1=CompleteChildSource,ProcessorResult=function(){function i(e,o){this.viewCache=e,this.changes=o}return i}();ViewProcessor$1.ProcessorResult=ProcessorResult;var ViewProcessor=function(){function i(e){this.filter_=e}return i.prototype.assertIndexed=function(e){util_1$n.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),util_1$n.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},i.prototype.applyOperation=function(e,o,s,f){var d=new ChildChangeAccumulator_1.ChildChangeAccumulator,m,_;if(o.type===Operation_1$2.OperationType.OVERWRITE){var $=o;$.source.fromUser?m=this.applyUserOverwrite_(e,$.path,$.snap,s,f,d):(util_1$n.assert($.source.fromServer,"Unknown source."),_=$.source.tagged||e.getServerCache().isFiltered()&&!$.path.isEmpty(),m=this.applyServerOverwrite_(e,$.path,$.snap,s,f,_,d))}else if(o.type===Operation_1$2.OperationType.MERGE){var G=o;G.source.fromUser?m=this.applyUserMerge_(e,G.path,G.children,s,f,d):(util_1$n.assert(G.source.fromServer,"Unknown source."),_=G.source.tagged||e.getServerCache().isFiltered(),m=this.applyServerMerge_(e,G.path,G.children,s,f,_,d))}else if(o.type===Operation_1$2.OperationType.ACK_USER_WRITE){var Z=o;Z.revert?m=this.revertUserWrite_(e,Z.path,s,f,d):m=this.ackUserWrite_(e,Z.path,Z.affectedTree,s,f,d)}else if(o.type===Operation_1$2.OperationType.LISTEN_COMPLETE)m=this.listenComplete_(e,o.path,s,d);else throw util_1$n.assertionError("Unknown operation type: "+o.type);var et=d.getChanges();return i.maybeAddValueEvent_(e,m,et),new ProcessorResult(m,et)},i.maybeAddValueEvent_=function(e,o,s){var f=o.getEventCache();if(f.isFullyInitialized()){var d=f.getNode().isLeafNode()||f.getNode().isEmpty(),m=e.getCompleteEventSnap();(s.length>0||!e.getEventCache().isFullyInitialized()||d&&!f.getNode().equals(m)||!f.getNode().getPriority().equals(m.getPriority()))&&s.push(Change_1$3.Change.valueChange(o.getCompleteEventSnap()))}},i.prototype.generateEventCacheAfterServerEvent_=function(e,o,s,f,d){var m=e.getEventCache();if(s.shadowingWrite(o)!=null)return e;var _=void 0,$=void 0;if(o.isEmpty())if(util_1$n.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var G=e.getCompleteServerSnap(),Z=G instanceof ChildrenNode_1$7.ChildrenNode?G:ChildrenNode_1$7.ChildrenNode.EMPTY_NODE,et=s.calcCompleteEventChildren(Z);_=this.filter_.updateFullNode(e.getEventCache().getNode(),et,d)}else{var tt=s.calcCompleteEventCache(e.getCompleteServerSnap());_=this.filter_.updateFullNode(e.getEventCache().getNode(),tt,d)}else{var nt=o.getFront();if(nt==".priority"){util_1$n.assert(o.getLength()==1,"Can't have a priority with additional path components");var st=m.getNode();$=e.getServerCache().getNode();var rt=s.calcEventCacheAfterServerOverwrite(o,st,$);rt!=null?_=this.filter_.updatePriority(st,rt):_=m.getNode()}else{var it=o.popFront(),ot=void 0;if(m.isCompleteForChild(nt)){$=e.getServerCache().getNode();var lt=s.calcEventCacheAfterServerOverwrite(o,m.getNode(),$);lt!=null?ot=m.getNode().getImmediateChild(nt).updateChild(it,lt):ot=m.getNode().getImmediateChild(nt)}else ot=s.calcCompleteChild(nt,e.getServerCache());ot!=null?_=this.filter_.updateChild(m.getNode(),nt,ot,it,f,d):_=m.getNode()}}return e.updateEventSnap(_,m.isFullyInitialized()||o.isEmpty(),this.filter_.filtersNodes())},i.prototype.applyServerOverwrite_=function(e,o,s,f,d,m,_){var $=e.getServerCache(),G,Z=m?this.filter_:this.filter_.getIndexedFilter();if(o.isEmpty())G=Z.updateFullNode($.getNode(),s,null);else if(Z.filtersNodes()&&!$.isFiltered()){var et=$.getNode().updateChild(o,s);G=Z.updateFullNode($.getNode(),et,null)}else{var tt=o.getFront();if(!$.isCompleteForPath(o)&&o.getLength()>1)return e;var nt=o.popFront(),st=$.getNode().getImmediateChild(tt),rt=st.updateChild(nt,s);tt==".priority"?G=Z.updatePriority($.getNode(),rt):G=Z.updateChild($.getNode(),tt,rt,nt,CompleteChildSource_1.NO_COMPLETE_CHILD_SOURCE,null)}var it=e.updateServerSnap(G,$.isFullyInitialized()||o.isEmpty(),Z.filtersNodes()),ot=new CompleteChildSource_1.WriteTreeCompleteChildSource(f,it,d);return this.generateEventCacheAfterServerEvent_(it,o,f,ot,_)},i.prototype.applyUserOverwrite_=function(e,o,s,f,d,m){var _=e.getEventCache(),$,G,Z=new CompleteChildSource_1.WriteTreeCompleteChildSource(f,e,d);if(o.isEmpty())G=this.filter_.updateFullNode(e.getEventCache().getNode(),s,m),$=e.updateEventSnap(G,!0,this.filter_.filtersNodes());else{var et=o.getFront();if(et===".priority")G=this.filter_.updatePriority(e.getEventCache().getNode(),s),$=e.updateEventSnap(G,_.isFullyInitialized(),_.isFiltered());else{var tt=o.popFront(),nt=_.getNode().getImmediateChild(et),st=void 0;if(tt.isEmpty())st=s;else{var rt=Z.getCompleteChild(et);rt!=null?tt.getBack()===".priority"&&rt.getChild(tt.parent()).isEmpty()?st=rt:st=rt.updateChild(tt,s):st=ChildrenNode_1$7.ChildrenNode.EMPTY_NODE}if(nt.equals(st))$=e;else{var it=this.filter_.updateChild(_.getNode(),et,st,tt,Z,m);$=e.updateEventSnap(it,_.isFullyInitialized(),this.filter_.filtersNodes())}}}return $},i.cacheHasChild_=function(e,o){return e.getEventCache().isCompleteForChild(o)},i.prototype.applyUserMerge_=function(e,o,s,f,d,m){var _=this,$=e;return s.foreach(function(G,Z){var et=o.child(G);i.cacheHasChild_(e,et.getFront())&&($=_.applyUserOverwrite_($,et,Z,f,d,m))}),s.foreach(function(G,Z){var et=o.child(G);i.cacheHasChild_(e,et.getFront())||($=_.applyUserOverwrite_($,et,Z,f,d,m))}),$},i.prototype.applyMerge_=function(e,o){return o.foreach(function(s,f){e=e.updateChild(s,f)}),e},i.prototype.applyServerMerge_=function(e,o,s,f,d,m,_){var $=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var G=e,Z;o.isEmpty()?Z=s:Z=ImmutableTree_1$2.ImmutableTree.Empty.setTree(o,s);var et=e.getServerCache().getNode();return Z.children.inorderTraversal(function(tt,nt){if(et.hasChild(tt)){var st=e.getServerCache().getNode().getImmediateChild(tt),rt=$.applyMerge_(st,nt);G=$.applyServerOverwrite_(G,new Path_1$5.Path(tt),rt,f,d,m,_)}}),Z.children.inorderTraversal(function(tt,nt){var st=!e.getServerCache().isCompleteForChild(tt)&&nt.value==null;if(!et.hasChild(tt)&&!st){var rt=e.getServerCache().getNode().getImmediateChild(tt),it=$.applyMerge_(rt,nt);G=$.applyServerOverwrite_(G,new Path_1$5.Path(tt),it,f,d,m,_)}}),G},i.prototype.ackUserWrite_=function(e,o,s,f,d,m){if(f.shadowingWrite(o)!=null)return e;var _=e.getServerCache().isFiltered(),$=e.getServerCache();if(s.value!=null){if(o.isEmpty()&&$.isFullyInitialized()||$.isCompleteForPath(o))return this.applyServerOverwrite_(e,o,$.getNode().getChild(o),f,d,_,m);if(o.isEmpty()){var G=ImmutableTree_1$2.ImmutableTree.Empty;return $.getNode().forEachChild(KeyIndex_1$1.KEY_INDEX,function(et,tt){G=G.set(new Path_1$5.Path(et),tt)}),this.applyServerMerge_(e,o,G,f,d,_,m)}else return e}else{var Z=ImmutableTree_1$2.ImmutableTree.Empty;return s.foreach(function(et,tt){var nt=o.child(et);$.isCompleteForPath(nt)&&(Z=Z.set(et,$.getNode().getChild(nt)))}),this.applyServerMerge_(e,o,Z,f,d,_,m)}},i.prototype.listenComplete_=function(e,o,s,f){var d=e.getServerCache(),m=e.updateServerSnap(d.getNode(),d.isFullyInitialized()||o.isEmpty(),d.isFiltered());return this.generateEventCacheAfterServerEvent_(m,o,s,CompleteChildSource_1.NO_COMPLETE_CHILD_SOURCE,f)},i.prototype.revertUserWrite_=function(e,o,s,f,d){var m;if(s.shadowingWrite(o)!=null)return e;var _=new CompleteChildSource_1.WriteTreeCompleteChildSource(s,e,f),$=e.getEventCache().getNode(),G=void 0;if(o.isEmpty()||o.getFront()===".priority"){var Z=void 0;if(e.getServerCache().isFullyInitialized())Z=s.calcCompleteEventCache(e.getCompleteServerSnap());else{var et=e.getServerCache().getNode();util_1$n.assert(et instanceof ChildrenNode_1$7.ChildrenNode,"serverChildren would be complete if leaf node"),Z=s.calcCompleteEventChildren(et)}Z=Z,G=this.filter_.updateFullNode($,Z,d)}else{var tt=o.getFront(),nt=s.calcCompleteChild(tt,e.getServerCache());nt==null&&e.getServerCache().isCompleteForChild(tt)&&(nt=$.getImmediateChild(tt)),nt!=null?G=this.filter_.updateChild($,tt,nt,o.popFront(),_,d):e.getEventCache().getNode().hasChild(tt)?G=this.filter_.updateChild($,tt,ChildrenNode_1$7.ChildrenNode.EMPTY_NODE,o.popFront(),_,d):G=$,G.isEmpty()&&e.getServerCache().isFullyInitialized()&&(m=s.calcCompleteEventCache(e.getCompleteServerSnap()),m.isLeafNode()&&(G=this.filter_.updateFullNode(G,m,d)))}return m=e.getServerCache().isFullyInitialized()||s.shadowingWrite(Path_1$5.Path.Empty)!=null,e.updateEventSnap(G,m,this.filter_.filtersNodes())},i}();ViewProcessor$1.ViewProcessor=ViewProcessor;var EventGenerator$1={};Object.defineProperty(EventGenerator$1,"__esModule",{value:!0});var Node_1$3=Node,Change_1$2=Change$1,util_1$m=cjs$1,EventGenerator=function(){function i(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return i.prototype.generateEventsForChanges=function(e,o,s){var f=this,d=[],m=[];return e.forEach(function(_){_.type===Change_1$2.Change.CHILD_CHANGED&&f.index_.indexedValueChanged(_.oldSnap,_.snapshotNode)&&m.push(Change_1$2.Change.childMovedChange(_.childName,_.snapshotNode))}),this.generateEventsForType_(d,Change_1$2.Change.CHILD_REMOVED,e,s,o),this.generateEventsForType_(d,Change_1$2.Change.CHILD_ADDED,e,s,o),this.generateEventsForType_(d,Change_1$2.Change.CHILD_MOVED,m,s,o),this.generateEventsForType_(d,Change_1$2.Change.CHILD_CHANGED,e,s,o),this.generateEventsForType_(d,Change_1$2.Change.VALUE,e,s,o),d},i.prototype.generateEventsForType_=function(e,o,s,f,d){var m=this,_=s.filter(function($){return $.type===o});_.sort(this.compareChanges_.bind(this)),_.forEach(function($){var G=m.materializeSingleChange_($,d);f.forEach(function(Z){Z.respondsTo($.type)&&e.push(Z.createEvent(G,m.query_))})})},i.prototype.materializeSingleChange_=function(e,o){return e.type==="value"||e.type==="child_removed"||(e.prevName=o.getPredecessorChildName(e.childName,e.snapshotNode,this.index_)),e},i.prototype.compareChanges_=function(e,o){if(e.childName==null||o.childName==null)throw util_1$m.assertionError("Should only compare child_ events.");var s=new Node_1$3.NamedNode(e.childName,e.snapshotNode),f=new Node_1$3.NamedNode(o.childName,o.snapshotNode);return this.index_.compare(s,f)},i}();EventGenerator$1.EventGenerator=EventGenerator;Object.defineProperty(View$2,"__esModule",{value:!0});var IndexedFilter_1$2=IndexedFilter$1,ViewProcessor_1=ViewProcessor$1,ChildrenNode_1$6=ChildrenNode,CacheNode_1$1=CacheNode$1,ViewCache_1$1=ViewCache$1,EventGenerator_1=EventGenerator$1,util_1$l=cjs$1,Operation_1$1=Operation,Change_1$1=Change$1,PriorityIndex_1$4=PriorityIndex$1,View$1=function(){function i(e,o){this.query_=e,this.eventRegistrations_=[];var s=this.query_.getQueryParams(),f=new IndexedFilter_1$2.IndexedFilter(s.getIndex()),d=s.getNodeFilter();this.processor_=new ViewProcessor_1.ViewProcessor(d);var m=o.getServerCache(),_=o.getEventCache(),$=f.updateFullNode(ChildrenNode_1$6.ChildrenNode.EMPTY_NODE,m.getNode(),null),G=d.updateFullNode(ChildrenNode_1$6.ChildrenNode.EMPTY_NODE,_.getNode(),null),Z=new CacheNode_1$1.CacheNode($,m.isFullyInitialized(),f.filtersNodes()),et=new CacheNode_1$1.CacheNode(G,_.isFullyInitialized(),d.filtersNodes());this.viewCache_=new ViewCache_1$1.ViewCache(et,Z),this.eventGenerator_=new EventGenerator_1.EventGenerator(this.query_)}return i.prototype.getQuery=function(){return this.query_},i.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},i.prototype.getCompleteServerCache=function(e){var o=this.viewCache_.getCompleteServerSnap();return o&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!o.getImmediateChild(e.getFront()).isEmpty())?o.getChild(e):null},i.prototype.isEmpty=function(){return this.eventRegistrations_.length===0},i.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},i.prototype.removeEventRegistration=function(e,o){var s=[];if(o){util_1$l.assert(e==null,"A cancel should cancel all event registrations.");var f=this.query_.path;this.eventRegistrations_.forEach(function($){o=o;var G=$.createCancelEvent(o,f);G&&s.push(G)})}if(e){for(var d=[],m=0;m<this.eventRegistrations_.length;++m){var _=this.eventRegistrations_[m];if(!_.matches(e))d.push(_);else if(e.hasAnyCallback()){d=d.concat(this.eventRegistrations_.slice(m+1));break}}this.eventRegistrations_=d}else this.eventRegistrations_=[];return s},i.prototype.applyOperation=function(e,o,s){e.type===Operation_1$1.OperationType.MERGE&&e.source.queryId!==null&&(util_1$l.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),util_1$l.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var f=this.viewCache_,d=this.processor_.applyOperation(f,e,o,s);return this.processor_.assertIndexed(d.viewCache),util_1$l.assert(d.viewCache.getServerCache().isFullyInitialized()||!f.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=d.viewCache,this.generateEventsForChanges_(d.changes,d.viewCache.getEventCache().getNode(),null)},i.prototype.getInitialEvents=function(e){var o=this.viewCache_.getEventCache(),s=[];if(!o.getNode().isLeafNode()){var f=o.getNode();f.forEachChild(PriorityIndex_1$4.PRIORITY_INDEX,function(d,m){s.push(Change_1$1.Change.childAddedChange(d,m))})}return o.isFullyInitialized()&&s.push(Change_1$1.Change.valueChange(o.getNode())),this.generateEventsForChanges_(s,o.getNode(),e)},i.prototype.generateEventsForChanges_=function(e,o,s){var f=s?[s]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,o,f)},i}();View$2.View=View$1;Object.defineProperty(SyncPoint$1,"__esModule",{value:!0});var CacheNode_1=CacheNode$1,ChildrenNode_1$5=ChildrenNode,util_1$k=cjs$1,util_2$b=cjs$1,ViewCache_1=ViewCache$1,View_1=View$2,__referenceConstructor,SyncPoint=function(){function i(){this.views_={}}return Object.defineProperty(i,"__referenceConstructor",{get:function(){return util_1$k.assert(__referenceConstructor,"Reference.ts has not been loaded"),__referenceConstructor},set:function(e){util_1$k.assert(!__referenceConstructor,"__referenceConstructor has already been defined"),__referenceConstructor=e},enumerable:!0,configurable:!0}),i.prototype.isEmpty=function(){return util_2$b.isEmpty(this.views_)},i.prototype.applyOperation=function(e,o,s){var f=e.source.queryId;if(f!==null){var d=util_2$b.safeGet(this.views_,f);return util_1$k.assert(d!=null,"SyncTree gave us an op for an invalid query."),d.applyOperation(e,o,s)}else{var m=[];return util_2$b.forEach(this.views_,function(_,$){m=m.concat($.applyOperation(e,o,s))}),m}},i.prototype.addEventRegistration=function(e,o,s,f,d){var m=e.queryIdentifier(),_=util_2$b.safeGet(this.views_,m);if(!_){var $=s.calcCompleteEventCache(d?f:null),G=!1;$?G=!0:f instanceof ChildrenNode_1$5.ChildrenNode?($=s.calcCompleteEventChildren(f),G=!1):($=ChildrenNode_1$5.ChildrenNode.EMPTY_NODE,G=!1);var Z=new ViewCache_1.ViewCache(new CacheNode_1.CacheNode($,G,!1),new CacheNode_1.CacheNode(f,d,!1));_=new View_1.View(e,Z),this.views_[m]=_}return _.addEventRegistration(o),_.getInitialEvents(o)},i.prototype.removeEventRegistration=function(e,o,s){var f=e.queryIdentifier(),d=[],m=[],_=this.hasCompleteView();if(f==="default"){var $=this;util_2$b.forEach(this.views_,function(Z,et){m=m.concat(et.removeEventRegistration(o,s)),et.isEmpty()&&(delete $.views_[Z],et.getQuery().getQueryParams().loadsAllData()||d.push(et.getQuery()))})}else{var G=util_2$b.safeGet(this.views_,f);G&&(m=m.concat(G.removeEventRegistration(o,s)),G.isEmpty()&&(delete this.views_[f],G.getQuery().getQueryParams().loadsAllData()||d.push(G.getQuery())))}return _&&!this.hasCompleteView()&&d.push(new i.__referenceConstructor(e.repo,e.path)),{removed:d,events:m}},i.prototype.getQueryViews=function(){var e=this,o=Object.keys(this.views_).map(function(s){return e.views_[s]});return o.filter(function(s){return!s.getQuery().getQueryParams().loadsAllData()})},i.prototype.getCompleteServerCache=function(e){var o=null;return util_2$b.forEach(this.views_,function(s,f){o=o||f.getCompleteServerCache(e)}),o},i.prototype.viewForQuery=function(e){var o=e.getQueryParams();if(o.loadsAllData())return this.getCompleteView();var s=e.queryIdentifier();return util_2$b.safeGet(this.views_,s)},i.prototype.viewExistsForQuery=function(e){return this.viewForQuery(e)!=null},i.prototype.hasCompleteView=function(){return this.getCompleteView()!=null},i.prototype.getCompleteView=function(){var e=util_2$b.findValue(this.views_,function(o){return o.getQuery().getQueryParams().loadsAllData()});return e||null},i}();SyncPoint$1.SyncPoint=SyncPoint;var WriteTree$1={},CompoundWrite$1={};Object.defineProperty(CompoundWrite$1,"__esModule",{value:!0});var ImmutableTree_1$1=ImmutableTree$1,Path_1$4=Path$2,util_1$j=cjs$1,Node_1$2=Node,PriorityIndex_1$3=PriorityIndex$1,util_2$a=cjs$1,CompoundWrite=function(){function i(e){this.writeTree_=e}return i.prototype.addWrite=function(e,o){if(e.isEmpty())return new i(new ImmutableTree_1$1.ImmutableTree(o));var s=this.writeTree_.findRootMostValueAndPath(e);if(s!=null){var f=s.path,d=s.value,m=Path_1$4.Path.relativePath(f,e);return d=d.updateChild(m,o),new i(this.writeTree_.set(f,d))}else{var _=new ImmutableTree_1$1.ImmutableTree(o),$=this.writeTree_.setTree(e,_);return new i($)}},i.prototype.addWrites=function(e,o){var s=this;return util_1$j.forEach(o,function(f,d){s=s.addWrite(e.child(f),d)}),s},i.prototype.removeWrite=function(e){if(e.isEmpty())return i.Empty;var o=this.writeTree_.setTree(e,ImmutableTree_1$1.ImmutableTree.Empty);return new i(o)},i.prototype.hasCompleteWrite=function(e){return this.getCompleteNode(e)!=null},i.prototype.getCompleteNode=function(e){var o=this.writeTree_.findRootMostValueAndPath(e);return o!=null?this.writeTree_.get(o.path).getChild(Path_1$4.Path.relativePath(o.path,e)):null},i.prototype.getCompleteChildren=function(){var e=[],o=this.writeTree_.value;return o!=null?o.isLeafNode()||o.forEachChild(PriorityIndex_1$3.PRIORITY_INDEX,function(s,f){e.push(new Node_1$2.NamedNode(s,f))}):this.writeTree_.children.inorderTraversal(function(s,f){f.value!=null&&e.push(new Node_1$2.NamedNode(s,f.value))}),e},i.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var o=this.getCompleteNode(e);return o!=null?new i(new ImmutableTree_1$1.ImmutableTree(o)):new i(this.writeTree_.subtree(e))},i.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},i.prototype.apply=function(e){return i.applySubtreeWrite_(Path_1$4.Path.Empty,this.writeTree_,e)},i.Empty=new i(new ImmutableTree_1$1.ImmutableTree(null)),i.applySubtreeWrite_=function(e,o,s){if(o.value!=null)return s.updateChild(e,o.value);var f=null;return o.children.inorderTraversal(function(d,m){d===".priority"?(util_2$a.assert(m.value!==null,"Priority writes must always be leaf nodes"),f=m.value):s=i.applySubtreeWrite_(e.child(d),m,s)}),!s.getChild(e).isEmpty()&&f!==null&&(s=s.updateChild(e.child(".priority"),f)),s},i}();CompoundWrite$1.CompoundWrite=CompoundWrite;Object.defineProperty(WriteTree$1,"__esModule",{value:!0});var util_1$i=cjs$1,util_2$9=cjs$1,Path_1$3=Path$2,CompoundWrite_1=CompoundWrite$1,PriorityIndex_1$2=PriorityIndex$1,ChildrenNode_1$4=ChildrenNode,WriteTree=function(){function i(){this.visibleWrites_=CompoundWrite_1.CompoundWrite.Empty,this.allWrites_=[],this.lastWriteId_=-1}return i.prototype.childWrites=function(e){return new WriteTreeRef(e,this)},i.prototype.addOverwrite=function(e,o,s,f){util_2$9.assert(s>this.lastWriteId_,"Stacking an older write on top of newer ones"),f===void 0&&(f=!0),this.allWrites_.push({path:e,snap:o,writeId:s,visible:f}),f&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,o)),this.lastWriteId_=s},i.prototype.addMerge=function(e,o,s){util_2$9.assert(s>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:o,writeId:s,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,o),this.lastWriteId_=s},i.prototype.getWrite=function(e){for(var o=0;o<this.allWrites_.length;o++){var s=this.allWrites_[o];if(s.writeId===e)return s}return null},i.prototype.removeWrite=function(e){var o=this,s=this.allWrites_.findIndex(function(Z){return Z.writeId===e});util_2$9.assert(s>=0,"removeWrite called with nonexistent writeId.");var f=this.allWrites_[s];this.allWrites_.splice(s,1);for(var d=f.visible,m=!1,_=this.allWrites_.length-1;d&&_>=0;){var $=this.allWrites_[_];$.visible&&(_>=s&&this.recordContainsPath_($,f.path)?d=!1:f.path.contains($.path)&&(m=!0)),_--}if(d){if(m)return this.resetTree_(),!0;if(f.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(f.path);else{var G=f.children;util_1$i.forEach(G,function(Z){o.visibleWrites_=o.visibleWrites_.removeWrite(f.path.child(Z))})}return!0}else return!1},i.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},i.prototype.calcCompleteEventCache=function(e,o,s,f){if(!s&&!f){var d=this.visibleWrites_.getCompleteNode(e);if(d!=null)return d;var m=this.visibleWrites_.childCompoundWrite(e);if(m.isEmpty())return o;if(o==null&&!m.hasCompleteWrite(Path_1$3.Path.Empty))return null;var _=o||ChildrenNode_1$4.ChildrenNode.EMPTY_NODE;return m.apply(_)}else{var $=this.visibleWrites_.childCompoundWrite(e);if(!f&&$.isEmpty())return o;if(!f&&o==null&&!$.hasCompleteWrite(Path_1$3.Path.Empty))return null;var G=function(tt){return(tt.visible||f)&&(!s||!~s.indexOf(tt.writeId))&&(tt.path.contains(e)||e.contains(tt.path))},Z=i.layerTree_(this.allWrites_,G,e),_=o||ChildrenNode_1$4.ChildrenNode.EMPTY_NODE;return Z.apply(_)}},i.prototype.calcCompleteEventChildren=function(e,o){var s=ChildrenNode_1$4.ChildrenNode.EMPTY_NODE,f=this.visibleWrites_.getCompleteNode(e);if(f)return f.isLeafNode()||f.forEachChild(PriorityIndex_1$2.PRIORITY_INDEX,function(_,$){s=s.updateImmediateChild(_,$)}),s;if(o){var d=this.visibleWrites_.childCompoundWrite(e);return o.forEachChild(PriorityIndex_1$2.PRIORITY_INDEX,function(_,$){var G=d.childCompoundWrite(new Path_1$3.Path(_)).apply($);s=s.updateImmediateChild(_,G)}),d.getCompleteChildren().forEach(function(_){s=s.updateImmediateChild(_.name,_.node)}),s}else{var m=this.visibleWrites_.childCompoundWrite(e);return m.getCompleteChildren().forEach(function(_){s=s.updateImmediateChild(_.name,_.node)}),s}},i.prototype.calcEventCacheAfterServerOverwrite=function(e,o,s,f){util_2$9.assert(s||f,"Either existingEventSnap or existingServerSnap must exist");var d=e.child(o);if(this.visibleWrites_.hasCompleteWrite(d))return null;var m=this.visibleWrites_.childCompoundWrite(d);return m.isEmpty()?f.getChild(o):m.apply(f.getChild(o))},i.prototype.calcCompleteChild=function(e,o,s){var f=e.child(o),d=this.visibleWrites_.getCompleteNode(f);if(d!=null)return d;if(s.isCompleteForChild(o)){var m=this.visibleWrites_.childCompoundWrite(f);return m.apply(s.getNode().getImmediateChild(o))}else return null},i.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},i.prototype.calcIndexedSlice=function(e,o,s,f,d,m){var _,$=this.visibleWrites_.childCompoundWrite(e),G=$.getCompleteNode(Path_1$3.Path.Empty);if(G!=null)_=G;else if(o!=null)_=$.apply(o);else return[];if(_=_.withIndex(m),!_.isEmpty()&&!_.isLeafNode()){for(var Z=[],et=m.getCompare(),tt=d?_.getReverseIteratorFrom(s,m):_.getIteratorFrom(s,m),nt=tt.getNext();nt&&Z.length<f;)et(nt,s)!==0&&Z.push(nt),nt=tt.getNext();return Z}else return[]},i.prototype.recordContainsPath_=function(e,o){return e.snap?e.path.contains(o):!!util_1$i.findKey(e.children,function(s,f){return e.path.child(f).contains(o)})},i.prototype.resetTree_=function(){this.visibleWrites_=i.layerTree_(this.allWrites_,i.DefaultFilter_,Path_1$3.Path.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},i.DefaultFilter_=function(e){return e.visible},i.layerTree_=function(e,o,s){for(var f=CompoundWrite_1.CompoundWrite.Empty,d=0;d<e.length;++d){var m=e[d];if(o(m)){var _=m.path,$=void 0;if(m.snap)s.contains(_)?($=Path_1$3.Path.relativePath(s,_),f=f.addWrite($,m.snap)):_.contains(s)&&($=Path_1$3.Path.relativePath(_,s),f=f.addWrite(Path_1$3.Path.Empty,m.snap.getChild($)));else if(m.children){if(s.contains(_))$=Path_1$3.Path.relativePath(s,_),f=f.addWrites($,m.children);else if(_.contains(s))if($=Path_1$3.Path.relativePath(_,s),$.isEmpty())f=f.addWrites(Path_1$3.Path.Empty,m.children);else{var G=util_1$i.safeGet(m.children,$.getFront());if(G){var Z=G.getChild($.popFront());f=f.addWrite(Path_1$3.Path.Empty,Z)}}}else throw util_2$9.assertionError("WriteRecord should have .snap or .children")}}return f},i}();WriteTree$1.WriteTree=WriteTree;var WriteTreeRef=function(){function i(e,o){this.treePath_=e,this.writeTree_=o}return i.prototype.calcCompleteEventCache=function(e,o,s){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,o,s)},i.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},i.prototype.calcEventCacheAfterServerOverwrite=function(e,o,s){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,o,s)},i.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},i.prototype.calcIndexedSlice=function(e,o,s,f,d){return this.writeTree_.calcIndexedSlice(this.treePath_,e,o,s,f,d)},i.prototype.calcCompleteChild=function(e,o){return this.writeTree_.calcCompleteChild(this.treePath_,e,o)},i.prototype.child=function(e){return new i(this.treePath_.child(e),this.writeTree_)},i}();WriteTree$1.WriteTreeRef=WriteTreeRef;Object.defineProperty(SyncTree$1,"__esModule",{value:!0});var util_1$h=cjs$1,util_2$8=util,AckUserWrite_1=AckUserWrite$1,ChildrenNode_1$3=ChildrenNode,util_3$4=cjs$1,ImmutableTree_1=ImmutableTree$1,ListenComplete_1=ListenComplete$1,Merge_1=Merge$1,Operation_1=Operation,Overwrite_1=Overwrite$1,Path_1$2=Path$2,SyncPoint_1=SyncPoint$1,WriteTree_1=WriteTree$1,SyncTree=function(){function i(e){this.listenProvider_=e,this.syncPointTree_=ImmutableTree_1.ImmutableTree.Empty,this.pendingWriteTree_=new WriteTree_1.WriteTree,this.tagToQueryMap_={},this.queryToTagMap_={}}return i.prototype.applyUserOverwrite=function(e,o,s,f){return this.pendingWriteTree_.addOverwrite(e,o,s,f),f?this.applyOperationToSyncPoints_(new Overwrite_1.Overwrite(Operation_1.OperationSource.User,e,o)):[]},i.prototype.applyUserMerge=function(e,o,s){this.pendingWriteTree_.addMerge(e,o,s);var f=ImmutableTree_1.ImmutableTree.fromObject(o);return this.applyOperationToSyncPoints_(new Merge_1.Merge(Operation_1.OperationSource.User,e,f))},i.prototype.ackUserWrite=function(e,o){o===void 0&&(o=!1);var s=this.pendingWriteTree_.getWrite(e),f=this.pendingWriteTree_.removeWrite(e);if(f){var d=ImmutableTree_1.ImmutableTree.Empty;return s.snap!=null?d=d.set(Path_1$2.Path.Empty,!0):util_3$4.forEach(s.children,function(m,_){d=d.set(new Path_1$2.Path(m),_)}),this.applyOperationToSyncPoints_(new AckUserWrite_1.AckUserWrite(s.path,d,o))}else return[]},i.prototype.applyServerOverwrite=function(e,o){return this.applyOperationToSyncPoints_(new Overwrite_1.Overwrite(Operation_1.OperationSource.Server,e,o))},i.prototype.applyServerMerge=function(e,o){var s=ImmutableTree_1.ImmutableTree.fromObject(o);return this.applyOperationToSyncPoints_(new Merge_1.Merge(Operation_1.OperationSource.Server,e,s))},i.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new ListenComplete_1.ListenComplete(Operation_1.OperationSource.Server,e))},i.prototype.applyTaggedQueryOverwrite=function(e,o,s){var f=this.queryKeyForTag_(s);if(f!=null){var d=i.parseQueryKey_(f),m=d.path,_=d.queryId,$=Path_1$2.Path.relativePath(m,e),G=new Overwrite_1.Overwrite(Operation_1.OperationSource.forServerTaggedQuery(_),$,o);return this.applyTaggedOperation_(m,G)}else return[]},i.prototype.applyTaggedQueryMerge=function(e,o,s){var f=this.queryKeyForTag_(s);if(f){var d=i.parseQueryKey_(f),m=d.path,_=d.queryId,$=Path_1$2.Path.relativePath(m,e),G=ImmutableTree_1.ImmutableTree.fromObject(o),Z=new Merge_1.Merge(Operation_1.OperationSource.forServerTaggedQuery(_),$,G);return this.applyTaggedOperation_(m,Z)}else return[]},i.prototype.applyTaggedListenComplete=function(e,o){var s=this.queryKeyForTag_(o);if(s){var f=i.parseQueryKey_(s),d=f.path,m=f.queryId,_=Path_1$2.Path.relativePath(d,e),$=new ListenComplete_1.ListenComplete(Operation_1.OperationSource.forServerTaggedQuery(m),_);return this.applyTaggedOperation_(d,$)}else return[]},i.prototype.addEventRegistration=function(e,o){var s=e.path,f=null,d=!1;this.syncPointTree_.foreachOnPath(s,function(rt,it){var ot=Path_1$2.Path.relativePath(rt,s);f=f||it.getCompleteServerCache(ot),d=d||it.hasCompleteView()});var m=this.syncPointTree_.get(s);m?(d=d||m.hasCompleteView(),f=f||m.getCompleteServerCache(Path_1$2.Path.Empty)):(m=new SyncPoint_1.SyncPoint,this.syncPointTree_=this.syncPointTree_.set(s,m));var _;if(f!=null)_=!0;else{_=!1,f=ChildrenNode_1$3.ChildrenNode.EMPTY_NODE;var $=this.syncPointTree_.subtree(s);$.foreachChild(function(rt,it){var ot=it.getCompleteServerCache(Path_1$2.Path.Empty);ot&&(f=f.updateImmediateChild(rt,ot))})}var G=m.viewExistsForQuery(e);if(!G&&!e.getQueryParams().loadsAllData()){var Z=i.makeQueryKey_(e);util_1$h.assert(!(Z in this.queryToTagMap_),"View does not exist, but we have a tag");var et=i.getNextQueryTag_();this.queryToTagMap_[Z]=et,this.tagToQueryMap_["_"+et]=Z}var tt=this.pendingWriteTree_.childWrites(s),nt=m.addEventRegistration(e,o,tt,f,_);if(!G&&!d){var st=m.viewForQuery(e);nt=nt.concat(this.setupListener_(e,st))}return nt},i.prototype.removeEventRegistration=function(e,o,s){var f=this,d=e.path,m=this.syncPointTree_.get(d),_=[];if(m&&(e.queryIdentifier()==="default"||m.viewExistsForQuery(e))){var $=m.removeEventRegistration(e,o,s);m.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(d));var G=$.removed;_=$.events;var Z=G.findIndex(function(ft){return ft.getQueryParams().loadsAllData()})!==-1,et=this.syncPointTree_.findOnPath(d,function(ft,ct){return ct.hasCompleteView()});if(Z&&!et){var tt=this.syncPointTree_.subtree(d);if(!tt.isEmpty())for(var nt=this.collectDistinctViewsForSubTree_(tt),st=0;st<nt.length;++st){var rt=nt[st],it=rt.getQuery(),ot=this.createListenerForView_(rt);this.listenProvider_.startListening(i.queryForListening_(it),this.tagForQuery_(it),ot.hashFn,ot.onComplete)}}if(!et&&G.length>0&&!s)if(Z){var lt=null;this.listenProvider_.stopListening(i.queryForListening_(e),lt)}else G.forEach(function(ft){var ct=f.queryToTagMap_[i.makeQueryKey_(ft)];f.listenProvider_.stopListening(i.queryForListening_(ft),ct)});this.removeTags_(G)}return _},i.prototype.calcCompleteEventCache=function(e,o){var s=!0,f=this.pendingWriteTree_,d=this.syncPointTree_.findOnPath(e,function(m,_){var $=Path_1$2.Path.relativePath(m,e),G=_.getCompleteServerCache($);if(G)return G});return f.calcCompleteEventCache(e,d,o,s)},i.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(o,s,f){if(s&&s.hasCompleteView()){var d=s.getCompleteView();return[d]}else{var m=[];return s&&(m=s.getQueryViews()),util_3$4.forEach(f,function(_,$){m=m.concat($)}),m}})},i.prototype.removeTags_=function(e){for(var o=0;o<e.length;++o){var s=e[o];if(!s.getQueryParams().loadsAllData()){var f=i.makeQueryKey_(s),d=this.queryToTagMap_[f];delete this.queryToTagMap_[f],delete this.tagToQueryMap_["_"+d]}}},i.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},i.prototype.setupListener_=function(e,o){var s=e.path,f=this.tagForQuery_(e),d=this.createListenerForView_(o),m=this.listenProvider_.startListening(i.queryForListening_(e),f,d.hashFn,d.onComplete),_=this.syncPointTree_.subtree(s);if(f)util_1$h.assert(!_.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var $=_.fold(function(et,tt,nt){if(!et.isEmpty()&&tt&&tt.hasCompleteView())return[tt.getCompleteView().getQuery()];var st=[];return tt&&(st=st.concat(tt.getQueryViews().map(function(rt){return rt.getQuery()}))),util_3$4.forEach(nt,function(rt,it){st=st.concat(it)}),st}),G=0;G<$.length;++G){var Z=$[G];this.listenProvider_.stopListening(i.queryForListening_(Z),this.tagForQuery_(Z))}return m},i.prototype.createListenerForView_=function(e){var o=this,s=e.getQuery(),f=this.tagForQuery_(s);return{hashFn:function(){var d=e.getServerCache()||ChildrenNode_1$3.ChildrenNode.EMPTY_NODE;return d.hash()},onComplete:function(d){if(d==="ok")return f?o.applyTaggedListenComplete(s.path,f):o.applyListenComplete(s.path);var m=util_2$8.errorForServerCode(d,s);return o.removeEventRegistration(s,null,m)}}},i.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},i.parseQueryKey_=function(e){var o=e.indexOf("$");return util_1$h.assert(o!==-1&&o<e.length-1,"Bad queryKey."),{queryId:e.substr(o+1),path:new Path_1$2.Path(e.substr(0,o))}},i.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap_["_"+e]},i.prototype.tagForQuery_=function(e){var o=i.makeQueryKey_(e);return util_3$4.safeGet(this.queryToTagMap_,o)},i.getNextQueryTag_=function(){return i.nextQueryTag_++},i.prototype.applyTaggedOperation_=function(e,o){var s=this.syncPointTree_.get(e);util_1$h.assert(s,"Missing sync point for query tag that we're tracking");var f=this.pendingWriteTree_.childWrites(e);return s.applyOperation(o,f,null)},i.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Path_1$2.Path.Empty))},i.prototype.applyOperationHelper_=function(e,o,s,f){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,o,s,f);var d=o.get(Path_1$2.Path.Empty);s==null&&d!=null&&(s=d.getCompleteServerCache(Path_1$2.Path.Empty));var m=[],_=e.path.getFront(),$=e.operationForChild(_),G=o.children.get(_);if(G&&$){var Z=s?s.getImmediateChild(_):null,et=f.child(_);m=m.concat(this.applyOperationHelper_($,G,Z,et))}return d&&(m=m.concat(d.applyOperation(e,f,s))),m},i.prototype.applyOperationDescendantsHelper_=function(e,o,s,f){var d=this,m=o.get(Path_1$2.Path.Empty);s==null&&m!=null&&(s=m.getCompleteServerCache(Path_1$2.Path.Empty));var _=[];return o.children.inorderTraversal(function($,G){var Z=s?s.getImmediateChild($):null,et=f.child($),tt=e.operationForChild($);tt&&(_=_.concat(d.applyOperationDescendantsHelper_(tt,G,Z,et)))}),m&&(_=_.concat(m.applyOperation(e,f,s))),_},i.nextQueryTag_=1,i}();SyncTree$1.SyncTree=SyncTree;var SnapshotHolder$1={};Object.defineProperty(SnapshotHolder$1,"__esModule",{value:!0});var ChildrenNode_1$2=ChildrenNode,SnapshotHolder=function(){function i(){this.rootNode_=ChildrenNode_1$2.ChildrenNode.EMPTY_NODE}return i.prototype.getNode=function(e){return this.rootNode_.getChild(e)},i.prototype.updateSnapshot=function(e,o){this.rootNode_=this.rootNode_.updateChild(e,o)},i}();SnapshotHolder$1.SnapshotHolder=SnapshotHolder;var AuthTokenProvider$1={};Object.defineProperty(AuthTokenProvider$1,"__esModule",{value:!0});var util_1$g=util,AuthTokenProvider=function(){function i(e){this.app_=e}return i.prototype.getToken=function(e){return this.app_.INTERNAL.getToken(e).then(null,function(o){return o&&o.code==="auth/token-not-initialized"?(util_1$g.log("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(o)})},i.prototype.addTokenChangeListener=function(e){this.app_.INTERNAL.addAuthTokenListener(e)},i.prototype.removeTokenChangeListener=function(e){this.app_.INTERNAL.removeAuthTokenListener(e)},i.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',util_1$g.warn(e)},i}();AuthTokenProvider$1.AuthTokenProvider=AuthTokenProvider;var StatsManager$1={},StatsCollection$1={};Object.defineProperty(StatsCollection$1,"__esModule",{value:!0});var util_1$f=cjs$1,util_2$7=cjs$1,StatsCollection=function(){function i(){this.counters_={}}return i.prototype.incrementCounter=function(e,o){o===void 0&&(o=1),util_2$7.contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=o},i.prototype.get=function(){return util_1$f.deepCopy(this.counters_)},i}();StatsCollection$1.StatsCollection=StatsCollection;Object.defineProperty(StatsManager$1,"__esModule",{value:!0});var StatsCollection_1=StatsCollection$1,StatsManager=function(){function i(){}return i.getCollection=function(e){var o=e.toString();return this.collections_[o]||(this.collections_[o]=new StatsCollection_1.StatsCollection),this.collections_[o]},i.getOrCreateReporter=function(e,o){var s=e.toString();return this.reporters_[s]||(this.reporters_[s]=o()),this.reporters_[s]},i.collections_={},i.reporters_={},i}();StatsManager$1.StatsManager=StatsManager;var StatsReporter$1={},StatsListener$1={};Object.defineProperty(StatsListener$1,"__esModule",{value:!0});var util_1$e=cjs$1,StatsListener=function(){function i(e){this.collection_=e,this.last_=null}return i.prototype.get=function(){var e=this.collection_.get(),o=util_1$e.clone(e);return this.last_&&util_1$e.forEach(this.last_,function(s,f){o[s]=o[s]-f}),this.last_=e,o},i}();StatsListener$1.StatsListener=StatsListener;Object.defineProperty(StatsReporter$1,"__esModule",{value:!0});var util_1$d=cjs$1,util_2$6=util,StatsListener_1=StatsListener$1,FIRST_STATS_MIN_TIME=10*1e3,FIRST_STATS_MAX_TIME=30*1e3,REPORT_STATS_INTERVAL=5*60*1e3,StatsReporter=function(){function i(e,o){this.server_=o,this.statsToReport_={},this.statsListener_=new StatsListener_1.StatsListener(e);var s=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();util_2$6.setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(s))}return i.prototype.includeStat=function(e){this.statsToReport_[e]=!0},i.prototype.reportStats_=function(){var e=this,o=this.statsListener_.get(),s={},f=!1;util_1$d.forEach(o,function(d,m){m>0&&util_1$d.contains(e.statsToReport_,d)&&(s[d]=m,f=!0)}),f&&this.server_.reportStats(s),util_2$6.setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(Math.random()*2*REPORT_STATS_INTERVAL))},i}();StatsReporter$1.StatsReporter=StatsReporter;var EventQueue$1={};Object.defineProperty(EventQueue$1,"__esModule",{value:!0});var util_1$c=util,EventQueue=function(){function i(){this.eventLists_=[],this.recursionDepth_=0}return i.prototype.queueEvents=function(e){for(var o=null,s=0;s<e.length;s++){var f=e[s],d=f.getPath();o!==null&&!d.equals(o.getPath())&&(this.eventLists_.push(o),o=null),o===null&&(o=new EventList(d)),o.add(f)}o&&this.eventLists_.push(o)},i.prototype.raiseEventsAtPath=function(e,o){this.queueEvents(o),this.raiseQueuedEventsMatchingPredicate_(function(s){return s.equals(e)})},i.prototype.raiseEventsForChangedPath=function(e,o){this.queueEvents(o),this.raiseQueuedEventsMatchingPredicate_(function(s){return s.contains(e)||e.contains(s)})},i.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var o=!0,s=0;s<this.eventLists_.length;s++){var f=this.eventLists_[s];if(f){var d=f.getPath();e(d)?(this.eventLists_[s].raise(),this.eventLists_[s]=null):o=!1}}o&&(this.eventLists_=[]),this.recursionDepth_--},i}();EventQueue$1.EventQueue=EventQueue;var EventList=function(){function i(e){this.path_=e,this.events_=[]}return i.prototype.add=function(e){this.events_.push(e)},i.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var o=this.events_[e];if(o!==null){this.events_[e]=null;var s=o.getEventRunner();util_1$c.logger&&util_1$c.log("event: "+o.toString()),util_1$c.exceptionGuard(s)}}},i.prototype.getPath=function(){return this.path_},i}();EventQueue$1.EventList=EventList;var PersistentConnection$1={},VisibilityMonitor$1={},EventEmitter$1={};Object.defineProperty(EventEmitter$1,"__esModule",{value:!0});var util_1$b=cjs$1,EventEmitter=function(){function i(e){this.allowedEvents_=e,this.listeners_={},util_1$b.assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return i.prototype.trigger=function(e){for(var o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];if(Array.isArray(this.listeners_[e]))for(var f=this.listeners_[e].slice(),d=0;d<f.length;d++)f[d].callback.apply(f[d].context,o)},i.prototype.on=function(e,o,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:o,context:s});var f=this.getInitialEvent(e);f&&o.apply(s,f)},i.prototype.off=function(e,o,s){this.validateEventType_(e);for(var f=this.listeners_[e]||[],d=0;d<f.length;d++)if(f[d].callback===o&&(!s||s===f[d].context)){f.splice(d,1);return}},i.prototype.validateEventType_=function(e){util_1$b.assert(this.allowedEvents_.find(function(o){return o===e}),"Unknown event: "+e)},i}();EventEmitter$1.EventEmitter=EventEmitter;Object.defineProperty(VisibilityMonitor$1,"__esModule",{value:!0});var tslib_1$3=tslib.exports,EventEmitter_1$1=EventEmitter$1,util_1$a=cjs$1,VisibilityMonitor=function(i){tslib_1$3.__extends(e,i);function e(){var o=i.call(this,["visible"])||this,s,f;return typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(f="visibilitychange",s="hidden"):typeof document.mozHidden<"u"?(f="mozvisibilitychange",s="mozHidden"):typeof document.msHidden<"u"?(f="msvisibilitychange",s="msHidden"):typeof document.webkitHidden<"u"&&(f="webkitvisibilitychange",s="webkitHidden")),o.visible_=!0,f&&document.addEventListener(f,function(){var d=!document[s];d!==o.visible_&&(o.visible_=d,o.trigger("visible",d))},!1),o}return e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(o){return util_1$a.assert(o==="visible","Unknown event type: "+o),[this.visible_]},e}(EventEmitter_1$1.EventEmitter);VisibilityMonitor$1.VisibilityMonitor=VisibilityMonitor;var OnlineMonitor$1={};Object.defineProperty(OnlineMonitor$1,"__esModule",{value:!0});var tslib_1$2=tslib.exports,util_1$9=cjs$1,EventEmitter_1=EventEmitter$1,util_2$5=cjs$1,OnlineMonitor=function(i){tslib_1$2.__extends(e,i);function e(){var o=i.call(this,["online"])||this;return o.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!util_2$5.isMobileCordova()&&(window.addEventListener("online",function(){o.online_||(o.online_=!0,o.trigger("online",!0))},!1),window.addEventListener("offline",function(){o.online_&&(o.online_=!1,o.trigger("online",!1))},!1)),o}return e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(o){return util_1$9.assert(o==="online","Unknown event type: "+o),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(EventEmitter_1.EventEmitter);OnlineMonitor$1.OnlineMonitor=OnlineMonitor;var Connection$1={},TransportManager$1={},BrowserPollConnection={},PacketReceiver$1={};Object.defineProperty(PacketReceiver$1,"__esModule",{value:!0});var util_1$8=util,PacketReceiver=function(){function i(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return i.prototype.closeAfter=function(e,o){this.closeAfterResponse=e,this.onClose=o,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},i.prototype.handleResponse=function(e,o){var s=this;this.pendingResponses[e]=o;for(var f=function(){var _=d.pendingResponses[d.currentResponseNum];delete d.pendingResponses[d.currentResponseNum];for(var $=function(Z){_[Z]&&util_1$8.exceptionGuard(function(){s.onMessage_(_[Z])})},G=0;G<_.length;++G)$(G);if(d.currentResponseNum===d.closeAfterResponse)return d.onClose&&(d.onClose(),d.onClose=null),"break";d.currentResponseNum++},d=this;this.pendingResponses[this.currentResponseNum];){var m=f();if(m==="break")break}},i}();PacketReceiver$1.PacketReceiver=PacketReceiver;(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=util,o=CountedSet$1,s=StatsManager$1,f=PacketReceiver$1,d=Constants,m=cjs$1,_=cjs$1;i.FIREBASE_LONGPOLL_START_PARAM="start",i.FIREBASE_LONGPOLL_CLOSE_COMMAND="close",i.FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand",i.FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB",i.FIREBASE_LONGPOLL_ID_PARAM="id",i.FIREBASE_LONGPOLL_PW_PARAM="pw",i.FIREBASE_LONGPOLL_SERIAL_PARAM="ser",i.FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb",i.FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg",i.FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts",i.FIREBASE_LONGPOLL_DATA_PARAM="d",i.FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM="disconn",i.FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe";var $=1870,G=30,Z=$-G,et=25e3,tt=3e4,nt=function(){function rt(it,ot,lt,ft){this.connId=it,this.repoInfo=ot,this.transportSessionId=lt,this.lastSessionId=ft,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=e.logWrapper(it),this.stats_=s.StatsManager.getCollection(ot),this.urlFn=function(ct){return ot.connectionURL(d.LONG_POLLING,ct)}}return rt.prototype.open=function(it,ot){var lt=this;this.curSegmentNum=0,this.onDisconnect_=ot,this.myPacketOrderer=new f.PacketReceiver(it),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){lt.log_("Timed out trying to connect."),lt.onClosed_(),lt.connectTimeoutTimer_=null},Math.floor(tt)),e.executeWhenDOMReady(function(){if(!lt.isClosed_){lt.scriptTagHolder=new st(function(){for(var pt=[],gt=0;gt<arguments.length;gt++)pt[gt]=arguments[gt];var Tt=pt[0],Et=pt[1],Mt=pt[2];if(pt[3],pt[4],lt.incrementIncomingBytes_(pt),!!lt.scriptTagHolder)if(lt.connectTimeoutTimer_&&(clearTimeout(lt.connectTimeoutTimer_),lt.connectTimeoutTimer_=null),lt.everConnected_=!0,Tt==i.FIREBASE_LONGPOLL_START_PARAM)lt.id=Et,lt.password=Mt;else if(Tt===i.FIREBASE_LONGPOLL_CLOSE_COMMAND)Et?(lt.scriptTagHolder.sendNewPolls=!1,lt.myPacketOrderer.closeAfter(Et,function(){lt.onClosed_()})):lt.onClosed_();else throw new Error("Unrecognized command received: "+Tt)},function(){for(var pt=[],gt=0;gt<arguments.length;gt++)pt[gt]=arguments[gt];var Tt=pt[0],Et=pt[1];lt.incrementIncomingBytes_(pt),lt.myPacketOrderer.handleResponse(Tt,Et)},function(){lt.onClosed_()},lt.urlFn);var ft={};ft[i.FIREBASE_LONGPOLL_START_PARAM]="t",ft[i.FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(Math.random()*1e8),lt.scriptTagHolder.uniqueCallbackIdentifier&&(ft[i.FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=lt.scriptTagHolder.uniqueCallbackIdentifier),ft[d.VERSION_PARAM]=d.PROTOCOL_VERSION,lt.transportSessionId&&(ft[d.TRANSPORT_SESSION_PARAM]=lt.transportSessionId),lt.lastSessionId&&(ft[d.LAST_SESSION_PARAM]=lt.lastSessionId),!_.isNodeSdk()&&typeof location<"u"&&location.href&&location.href.indexOf(d.FORGE_DOMAIN)!==-1&&(ft[d.REFERER_PARAM]=d.FORGE_REF);var ct=lt.urlFn(ft);lt.log_("Connecting via long-poll to "+ct),lt.scriptTagHolder.addTag(ct,function(){})}})},rt.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},rt.forceAllow=function(){rt.forceAllow_=!0},rt.forceDisallow=function(){rt.forceDisallow_=!0},rt.isAvailable=function(){return rt.forceAllow_||!rt.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!e.isChromeExtensionContentScript()&&!e.isWindowsStoreApp()&&!_.isNodeSdk()},rt.prototype.markConnectionHealthy=function(){},rt.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},rt.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},rt.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},rt.prototype.send=function(it){var ot=m.stringify(it);this.bytesSent+=ot.length,this.stats_.incrementCounter("bytes_sent",ot.length);for(var lt=m.base64Encode(ot),ft=e.splitStringBySize(lt,Z),ct=0;ct<ft.length;ct++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,ft.length,ft[ct]),this.curSegmentNum++},rt.prototype.addDisconnectPingFrame=function(it,ot){if(!_.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var lt={};lt[i.FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t",lt[i.FIREBASE_LONGPOLL_ID_PARAM]=it,lt[i.FIREBASE_LONGPOLL_PW_PARAM]=ot,this.myDisconnFrame.src=this.urlFn(lt),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},rt.prototype.incrementIncomingBytes_=function(it){var ot=m.stringify(it).length;this.bytesReceived+=ot,this.stats_.incrementCounter("bytes_received",ot)},rt}();i.BrowserPollConnection=nt;var st=function(){function rt(it,ot,lt,ft){if(this.onDisconnect=lt,this.urlFn=ft,this.outstandingRequests=new o.CountedSet,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,_.isNodeSdk())this.commandCB=it,this.onMessageCB=ot;else{this.uniqueCallbackIdentifier=e.LUIDGenerator(),window[i.FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=it,window[i.FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=ot,this.myIFrame=rt.createIFrame_();var ct="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"){var pt=document.domain;ct='<script>document.domain="'+pt+'";<\/script>'}var gt="<html><body>"+ct+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(gt),this.myIFrame.doc.close()}catch(Tt){e.log("frame writing exception"),Tt.stack&&e.log(Tt.stack),e.log(Tt)}}}return rt.createIFrame_=function(){var it=document.createElement("iframe");if(it.style.display="none",document.body){document.body.appendChild(it);try{var ot=it.contentWindow.document;ot||e.log("No IE domain setting required")}catch{var lt=document.domain;it.src="javascript:void((function(){document.open();document.domain='"+lt+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return it.contentDocument?it.doc=it.contentDocument:it.contentWindow?it.doc=it.contentWindow.document:it.document&&(it.doc=it.document),it},rt.prototype.close=function(){var it=this;if(this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){it.myIFrame!==null&&(document.body.removeChild(it.myIFrame),it.myIFrame=null)},Math.floor(0))),_.isNodeSdk()&&this.myID){var ot={};ot[i.FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM]="t",ot[i.FIREBASE_LONGPOLL_ID_PARAM]=this.myID,ot[i.FIREBASE_LONGPOLL_PW_PARAM]=this.myPW;var lt=this.urlFn(ot);rt.nodeRestRequest(lt)}var ft=this.onDisconnect;ft&&(this.onDisconnect=null,ft())},rt.prototype.startLongPoll=function(it,ot){for(this.myID=it,this.myPW=ot,this.alive=!0;this.newRequest_(););},rt.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var it={};it[i.FIREBASE_LONGPOLL_ID_PARAM]=this.myID,it[i.FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,it[i.FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;for(var ot=this.urlFn(it),lt="",ft=0;this.pendingSegs.length>0;){var ct=this.pendingSegs[0];if(ct.d.length+G+lt.length<=$){var pt=this.pendingSegs.shift();lt=lt+"&"+i.FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+ft+"="+pt.seg+"&"+i.FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+ft+"="+pt.ts+"&"+i.FIREBASE_LONGPOLL_DATA_PARAM+ft+"="+pt.d,ft++}else break}return ot=ot+lt,this.addLongPollTag_(ot,this.currentSerial),!0}else return!1},rt.prototype.enqueueSegment=function(it,ot,lt){this.pendingSegs.push({seg:it,ts:ot,d:lt}),this.alive&&this.newRequest_()},rt.prototype.addLongPollTag_=function(it,ot){var lt=this;this.outstandingRequests.add(ot,1);var ft=function(){lt.outstandingRequests.remove(ot),lt.newRequest_()},ct=setTimeout(ft,Math.floor(et)),pt=function(){clearTimeout(ct),ft()};this.addTag(it,pt)},rt.prototype.addTag=function(it,ot){var lt=this;_.isNodeSdk()?this.doNodeLongPoll(it,ot):setTimeout(function(){try{if(!lt.sendNewPolls)return;var ft=lt.myIFrame.doc.createElement("script");ft.type="text/javascript",ft.async=!0,ft.src=it,ft.onload=ft.onreadystatechange=function(){var ct=ft.readyState;(!ct||ct==="loaded"||ct==="complete")&&(ft.onload=ft.onreadystatechange=null,ft.parentNode&&ft.parentNode.removeChild(ft),ot())},ft.onerror=function(){e.log("Long-poll script failed to load: "+it),lt.sendNewPolls=!1,lt.close()},lt.myIFrame.doc.body.appendChild(ft)}catch{}},Math.floor(1))},rt}();i.FirebaseIFrameScriptHolder=st})(BrowserPollConnection);var WebSocketConnection$1={};Object.defineProperty(WebSocketConnection$1,"__esModule",{value:!0});var app_1$1=require$$0,util_1$7=cjs$1,util_2$4=util,StatsManager_1=StatsManager$1,Constants_1$1=Constants,util_3$3=cjs$1,storage_1$1=storage,util_4$2=cjs$1,util_5$2=cjs$1,WEBSOCKET_MAX_FRAME_SIZE=16384,WEBSOCKET_KEEPALIVE_INTERVAL=45e3,WebSocketImpl=null;typeof MozWebSocket<"u"?WebSocketImpl=MozWebSocket:typeof WebSocket<"u"&&(WebSocketImpl=WebSocket);function setWebSocketImpl(i){WebSocketImpl=i}WebSocketConnection$1.setWebSocketImpl=setWebSocketImpl;var WebSocketConnection=function(){function i(e,o,s,f){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=util_2$4.logWrapper(this.connId),this.stats_=StatsManager_1.StatsManager.getCollection(o),this.connURL=i.connectionURL_(o,s,f)}return i.connectionURL_=function(e,o,s){var f={};return f[Constants_1$1.VERSION_PARAM]=Constants_1$1.PROTOCOL_VERSION,!util_5$2.isNodeSdk()&&typeof location<"u"&&location.href&&location.href.indexOf(Constants_1$1.FORGE_DOMAIN)!==-1&&(f[Constants_1$1.REFERER_PARAM]=Constants_1$1.FORGE_REF),o&&(f[Constants_1$1.TRANSPORT_SESSION_PARAM]=o),s&&(f[Constants_1$1.LAST_SESSION_PARAM]=s),e.connectionURL(Constants_1$1.WEBSOCKET,f)},i.prototype.open=function(e,o){var s=this;this.onDisconnect=o,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,storage_1$1.PersistentStorage.set("previous_websocket_failure",!0);try{if(util_5$2.isNodeSdk()){var f=util_3$3.CONSTANTS.NODE_ADMIN?"AdminNode":"Node",d={headers:{"User-Agent":"Firebase/"+Constants_1$1.PROTOCOL_VERSION+"/"+app_1$1.default.SDK_VERSION+"/"+process.platform+"/"+f}},m=process.env,_=this.connURL.indexOf("wss://")==0?m.HTTPS_PROXY||m.https_proxy:m.HTTP_PROXY||m.http_proxy;_&&(d.proxy={origin:_}),this.mySock=new WebSocketImpl(this.connURL,[],d)}else this.mySock=new WebSocketImpl(this.connURL)}catch(G){this.log_("Error instantiating WebSocket.");var $=G.message||G.data;$&&this.log_($),this.onClosed_();return}this.mySock.onopen=function(){s.log_("Websocket connected."),s.everConnected_=!0},this.mySock.onclose=function(){s.log_("Websocket connection was disconnected."),s.mySock=null,s.onClosed_()},this.mySock.onmessage=function(G){s.handleIncomingFrame(G)},this.mySock.onerror=function(G){s.log_("WebSocket error.  Closing connection.");var Z=G.message||G.data;Z&&s.log_(Z),s.onClosed_()}},i.prototype.start=function(){},i.forceDisallow=function(){i.forceDisallow_=!0},i.isAvailable=function(){var e=!1;if(typeof navigator<"u"&&navigator.userAgent){var o=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(o);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&WebSocketImpl!==null&&!i.forceDisallow_},i.previouslyFailed=function(){return storage_1$1.PersistentStorage.isInMemoryStorage||storage_1$1.PersistentStorage.get("previous_websocket_failure")===!0},i.prototype.markConnectionHealthy=function(){storage_1$1.PersistentStorage.remove("previous_websocket_failure")},i.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length==this.totalFrames){var o=this.frames.join("");this.frames=null;var s=util_4$2.jsonEval(o);this.onMessage(s)}},i.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},i.prototype.extractFrameCount_=function(e){if(util_1$7.assert(this.frames===null,"We already have a frame buffer"),e.length<=6){var o=Number(e);if(!isNaN(o))return this.handleNewFrameCount_(o),null}return this.handleNewFrameCount_(1),e},i.prototype.handleIncomingFrame=function(e){if(this.mySock!==null){var o=e.data;if(this.bytesReceived+=o.length,this.stats_.incrementCounter("bytes_received",o.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(o);else{var s=this.extractFrameCount_(o);s!==null&&this.appendFrame_(s)}}},i.prototype.send=function(e){this.resetKeepAlive();var o=util_4$2.stringify(e);this.bytesSent+=o.length,this.stats_.incrementCounter("bytes_sent",o.length);var s=util_2$4.splitStringBySize(o,WEBSOCKET_MAX_FRAME_SIZE);s.length>1&&this.sendString_(String(s.length));for(var f=0;f<s.length;f++)this.sendString_(s[f])},i.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},i.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},i.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},i.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))},i.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(o){this.log_("Exception thrown from WebSocket.send():",o.message||o.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},i.responsesRequiredToBeHealthy=2,i.healthyTimeout=3e4,i}();WebSocketConnection$1.WebSocketConnection=WebSocketConnection;Object.defineProperty(TransportManager$1,"__esModule",{value:!0});var BrowserPollConnection_1$1=BrowserPollConnection,WebSocketConnection_1$1=WebSocketConnection$1,util_1$6=util,TransportManager=function(){function i(e){this.initTransports_(e)}return Object.defineProperty(i,"ALL_TRANSPORTS",{get:function(){return[BrowserPollConnection_1$1.BrowserPollConnection,WebSocketConnection_1$1.WebSocketConnection]},enumerable:!0,configurable:!0}),i.prototype.initTransports_=function(e){var o=WebSocketConnection_1$1.WebSocketConnection&&WebSocketConnection_1$1.WebSocketConnection.isAvailable(),s=o&&!WebSocketConnection_1$1.WebSocketConnection.previouslyFailed();if(e.webSocketOnly&&(o||util_1$6.warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[WebSocketConnection_1$1.WebSocketConnection];else{var f=this.transports_=[];util_1$6.each(i.ALL_TRANSPORTS,function(d,m){m&&m.isAvailable()&&f.push(m)})}},i.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},i.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},i}();TransportManager$1.TransportManager=TransportManager;Object.defineProperty(Connection$1,"__esModule",{value:!0});var util_1$5=util,storage_1=storage,Constants_1=Constants,TransportManager_1=TransportManager$1,UPGRADE_TIMEOUT=6e4,DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10*1024,BYTES_RECEIVED_HEALTHY_OVERRIDE=100*1024,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h",Connection=function(){function i(e,o,s,f,d,m,_){this.id=e,this.repoInfo_=o,this.onMessage_=s,this.onReady_=f,this.onDisconnect_=d,this.onKill_=m,this.lastSessionId=_,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=util_1$5.logWrapper("c:"+this.id+":"),this.transportManager_=new TransportManager_1.TransportManager(o),this.log_("Connection created"),this.start_()}return i.prototype.start_=function(){var e=this,o=this.transportManager_.initialTransport();this.conn_=new o(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=o.responsesRequiredToBeHealthy||0;var s=this.connReceiver_(this.conn_),f=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(s,f)},Math.floor(0));var d=o.healthyTimeout||0;d>0&&(this.healthyTimeout_=util_1$5.setTimeoutNonBlocking(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(d)))},i.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},i.prototype.disconnReceiver_=function(e){var o=this;return function(s){e===o.conn_?o.onConnectionLost_(s):e===o.secondaryConn_?(o.log_("Secondary connection lost."),o.onSecondaryConnectionLost_()):o.log_("closing an old connection")}},i.prototype.connReceiver_=function(e){var o=this;return function(s){o.state_!=2&&(e===o.rx_?o.onPrimaryMessageReceived_(s):e===o.secondaryConn_?o.onSecondaryMessageReceived_(s):o.log_("message on old connection"))}},i.prototype.sendRequest=function(e){var o={t:"d",d:e};this.sendData_(o)},i.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},i.prototype.onSecondaryControl_=function(e){if(MESSAGE_TYPE in e){var o=e[MESSAGE_TYPE];o===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():o===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):o===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},i.prototype.onSecondaryMessageReceived_=function(e){var o=util_1$5.requireKey("t",e),s=util_1$5.requireKey("d",e);if(o=="c")this.onSecondaryControl_(s);else if(o=="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+o)},i.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))},i.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},i.prototype.onPrimaryMessageReceived_=function(e){var o=util_1$5.requireKey("t",e),s=util_1$5.requireKey("d",e);o=="c"?this.onControl_(s):o=="d"&&this.onDataMessage_(s)},i.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},i.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},i.prototype.onControl_=function(e){var o=util_1$5.requireKey(MESSAGE_TYPE,e);if(MESSAGE_DATA in e){var s=e[MESSAGE_DATA];if(o===SERVER_HELLO)this.onHandshake_(s);else if(o===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var f=0;f<this.pendingDataMessages.length;++f)this.onDataMessage_(this.pendingDataMessages[f]);this.pendingDataMessages=[],this.tryCleanupConnection()}else o===CONTROL_SHUTDOWN?this.onConnectionShutdown_(s):o===CONTROL_RESET?this.onReset_(s):o===CONTROL_ERROR?util_1$5.error("Server Error: "+s):o===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):util_1$5.error("Unknown control packet command: "+o)}},i.prototype.onHandshake_=function(e){var o=e.ts,s=e.v,f=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(f),this.state_==0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,o),Constants_1.PROTOCOL_VERSION!==s&&util_1$5.warn("Protocol version mismatch detected"),this.tryStartUpgrade_())},i.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},i.prototype.startUpgrade_=function(e){var o=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var s=this.connReceiver_(this.secondaryConn_),f=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(s,f),util_1$5.setTimeoutNonBlocking(function(){o.secondaryConn_&&(o.log_("Timed out trying to upgrade."),o.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))},i.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),this.state_===1?this.close():(this.closeConnections_(),this.start_())},i.prototype.onConnectionEstablished_=function(e,o){var s=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(o,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):util_1$5.setTimeoutNonBlocking(function(){s.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))},i.prototype.sendPingOnPrimaryIfNecessary_=function(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))},i.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()},i.prototype.onConnectionLost_=function(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(storage_1.PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()},i.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},i.prototype.sendData_=function(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)},i.prototype.close=function(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},i.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},i}();Connection$1.Connection=Connection;var ServerActions$1={};Object.defineProperty(ServerActions$1,"__esModule",{value:!0});var ServerActions=function(){function i(){}return i.prototype.put=function(e,o,s,f){},i.prototype.merge=function(e,o,s,f){},i.prototype.refreshAuthToken=function(e){},i.prototype.onDisconnectPut=function(e,o,s){},i.prototype.onDisconnectMerge=function(e,o,s){},i.prototype.onDisconnectCancel=function(e,o){},i.prototype.reportStats=function(e){},i}();ServerActions$1.ServerActions=ServerActions;Object.defineProperty(PersistentConnection$1,"__esModule",{value:!0});var tslib_1$1=tslib.exports,app_1=require$$0,util_1$4=cjs$1,util_2$3=cjs$1,util_3$2=cjs$1,util_4$1=util,Path_1$1=Path$2,VisibilityMonitor_1=VisibilityMonitor$1,OnlineMonitor_1=OnlineMonitor$1,util_5$1=cjs$1,Connection_1$1=Connection$1,util_6=cjs$1,util_7=cjs$1,ServerActions_1$1=ServerActions$1,RECONNECT_MIN_DELAY=1e3,RECONNECT_MAX_DELAY_DEFAULT=60*5*1e3,RECONNECT_MAX_DELAY_FOR_ADMINS=30*1e3,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4,SERVER_KILL_INTERRUPT_REASON="server_kill",INVALID_AUTH_TOKEN_THRESHOLD=3,PersistentConnection=function(i){tslib_1$1.__extends(e,i);function e(o,s,f,d,m,_){var $=i.call(this)||this;if($.repoInfo_=o,$.onDataUpdate_=s,$.onConnectStatus_=f,$.onServerInfoUpdate_=d,$.authTokenProvider_=m,$.authOverride_=_,$.id=e.nextPersistentConnectionId_++,$.log_=util_4$1.logWrapper("p:"+$.id+":"),$.interruptReasons_={},$.listens_={},$.outstandingPuts_=[],$.outstandingPutCount_=0,$.onDisconnectRequestQueue_=[],$.connected_=!1,$.reconnectDelay_=RECONNECT_MIN_DELAY,$.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,$.securityDebugCallback_=null,$.lastSessionId=null,$.establishConnectionTimer_=null,$.visible_=!1,$.requestCBHash_={},$.requestNumber_=0,$.realtime_=null,$.authToken_=null,$.forceTokenRefresh_=!1,$.invalidAuthTokenCount_=0,$.firstConnection_=!0,$.lastConnectionAttemptTime_=null,$.lastConnectionEstablishedTime_=null,_&&!util_7.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return $.scheduleConnect_(0),VisibilityMonitor_1.VisibilityMonitor.getInstance().on("visible",$.onVisible_,$),o.host.indexOf("fblocal")===-1&&OnlineMonitor_1.OnlineMonitor.getInstance().on("online",$.onOnline_,$),$}return e.prototype.sendRequest=function(o,s,f){var d=++this.requestNumber_,m={r:d,a:o,b:s};this.log_(util_2$3.stringify(m)),util_3$2.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(m),f&&(this.requestCBHash_[d]=f)},e.prototype.listen=function(o,s,f,d){var m=o.queryIdentifier(),_=o.path.toString();this.log_("Listen called for "+_+" "+m),this.listens_[_]=this.listens_[_]||{},util_3$2.assert(o.getQueryParams().isDefault()||!o.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),util_3$2.assert(!this.listens_[_][m],"listen() called twice for same path/queryId.");var $={onComplete:d,hashFn:s,query:o,tag:f};this.listens_[_][m]=$,this.connected_&&this.sendListen_($)},e.prototype.sendListen_=function(o){var s=this,f=o.query,d=f.path.toString(),m=f.queryIdentifier();this.log_("Listen on "+d+" for "+m);var _={p:d},$="q";o.tag&&(_.q=f.queryObject(),_.t=o.tag),_.h=o.hashFn(),this.sendRequest($,_,function(G){var Z=G.d,et=G.s;e.warnOnListenWarnings_(Z,f);var tt=s.listens_[d]&&s.listens_[d][m];tt===o&&(s.log_("listen response",G),et!=="ok"&&s.removeListen_(d,m),o.onComplete&&o.onComplete(et,Z))})},e.warnOnListenWarnings_=function(o,s){if(o&&typeof o=="object"&&util_1$4.contains(o,"w")){var f=util_1$4.safeGet(o,"w");if(Array.isArray(f)&&~f.indexOf("no_index")){var d='".indexOn": "'+s.getQueryParams().getIndex().toString()+'"',m=s.path.toString();util_4$1.warn("Using an unspecified index. Your data will be downloaded and "+("filtered on the client. Consider adding "+d+" at ")+(m+" to your security rules for better performance."))}}},e.prototype.refreshAuthToken=function(o){this.authToken_=o,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(o)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(o){var s=o&&o.length===40;(s||util_5$1.isAdmin(o))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)},e.prototype.tryAuth=function(){var o=this;if(this.connected_&&this.authToken_){var s=this.authToken_,f=util_5$1.isValidFormat(s)?"auth":"gauth",d={cred:s};this.authOverride_===null?d.noauth=!0:typeof this.authOverride_=="object"&&(d.authvar=this.authOverride_),this.sendRequest(f,d,function(m){var _=m.s,$=m.d||"error";o.authToken_===s&&(_==="ok"?o.invalidAuthTokenCount_=0:o.onAuthRevoked_(_,$))})}},e.prototype.unlisten=function(o,s){var f=o.path.toString(),d=o.queryIdentifier();this.log_("Unlisten called for "+f+" "+d),util_3$2.assert(o.getQueryParams().isDefault()||!o.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query");var m=this.removeListen_(f,d);m&&this.connected_&&this.sendUnlisten_(f,d,o.queryObject(),s)},e.prototype.sendUnlisten_=function(o,s,f,d){this.log_("Unlisten on "+o+" for "+s);var m={p:o},_="n";d&&(m.q=f,m.t=d),this.sendRequest(_,m)},e.prototype.onDisconnectPut=function(o,s,f){this.connected_?this.sendOnDisconnect_("o",o,s,f):this.onDisconnectRequestQueue_.push({pathString:o,action:"o",data:s,onComplete:f})},e.prototype.onDisconnectMerge=function(o,s,f){this.connected_?this.sendOnDisconnect_("om",o,s,f):this.onDisconnectRequestQueue_.push({pathString:o,action:"om",data:s,onComplete:f})},e.prototype.onDisconnectCancel=function(o,s){this.connected_?this.sendOnDisconnect_("oc",o,null,s):this.onDisconnectRequestQueue_.push({pathString:o,action:"oc",data:null,onComplete:s})},e.prototype.sendOnDisconnect_=function(o,s,f,d){var m={p:s,d:f};this.log_("onDisconnect "+o,m),this.sendRequest(o,m,function(_){d&&setTimeout(function(){d(_.s,_.d)},Math.floor(0))})},e.prototype.put=function(o,s,f,d){this.putInternal("p",o,s,f,d)},e.prototype.merge=function(o,s,f,d){this.putInternal("m",o,s,f,d)},e.prototype.putInternal=function(o,s,f,d,m){var _={p:s,d:f};m!==void 0&&(_.h=m),this.outstandingPuts_.push({action:o,request:_,onComplete:d}),this.outstandingPutCount_++;var $=this.outstandingPuts_.length-1;this.connected_?this.sendPut_($):this.log_("Buffering put: "+s)},e.prototype.sendPut_=function(o){var s=this,f=this.outstandingPuts_[o].action,d=this.outstandingPuts_[o].request,m=this.outstandingPuts_[o].onComplete;this.outstandingPuts_[o].queued=this.connected_,this.sendRequest(f,d,function(_){s.log_(f+" response",_),delete s.outstandingPuts_[o],s.outstandingPutCount_--,s.outstandingPutCount_===0&&(s.outstandingPuts_=[]),m&&m(_.s,_.d)})},e.prototype.reportStats=function(o){var s=this;if(this.connected_){var f={c:o};this.log_("reportStats",f),this.sendRequest("s",f,function(d){var m=d.s;if(m!=="ok"){var _=d.d;s.log_("reportStats","Error sending stats: "+_)}})}},e.prototype.onDataMessage_=function(o){if("r"in o){this.log_("from server: "+util_2$3.stringify(o));var s=o.r,f=this.requestCBHash_[s];f&&(delete this.requestCBHash_[s],f(o.b))}else{if("error"in o)throw"A server-side error has occurred: "+o.error;"a"in o&&this.onDataPush_(o.a,o.b)}},e.prototype.onDataPush_=function(o,s){this.log_("handleServerMessage",o,s),o==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):o==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):o==="c"?this.onListenRevoked_(s.p,s.q):o==="ac"?this.onAuthRevoked_(s.s,s.d):o==="sd"?this.onSecurityDebugPacket_(s):util_4$1.error("Unrecognized action received from server: "+util_2$3.stringify(o)+`
Are you using the latest client?`)},e.prototype.onReady_=function(o,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(o),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(o){var s=this;util_3$2.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){s.establishConnectionTimer_=null,s.establishConnection_()},Math.floor(o))},e.prototype.onVisible_=function(o){o&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=o},e.prototype.onOnline_=function(o){o?(this.log_("Browser went online."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(!this.visible_)this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime();else if(this.lastConnectionEstablishedTime_){var o=new Date().getTime()-this.lastConnectionEstablishedTime_;o>RECONNECT_DELAY_RESET_TIMEOUT&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null}var s=new Date().getTime()-this.lastConnectionAttemptTime_,f=Math.max(0,this.reconnectDelay_-s);f=Math.random()*f,this.log_("Trying to reconnect in "+f+"ms"),this.scheduleConnect_(f),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;var o=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),f=this.onRealtimeDisconnect_.bind(this),d=this.id+":"+e.nextConnectionId_++,m=this,_=this.lastSessionId,$=!1,G=null,Z=function(){G?G.close():($=!0,f())},et=function(nt){util_3$2.assert(G,"sendRequest call when we're not connected not allowed."),G.sendRequest(nt)};this.realtime_={close:Z,sendRequest:et};var tt=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(tt).then(function(nt){$?util_4$1.log("getToken() completed but was canceled"):(util_4$1.log("getToken() completed. Creating connection."),m.authToken_=nt&&nt.accessToken,G=new Connection_1$1.Connection(d,m.repoInfo_,o,s,f,function(st){util_4$1.warn(st+" ("+m.repoInfo_.toString()+")"),m.interrupt(SERVER_KILL_INTERRUPT_REASON)},_))}).then(null,function(nt){m.log_("Failed to get token: "+nt),$||(util_6.CONSTANTS.NODE_ADMIN&&util_4$1.warn(nt),Z())})}},e.prototype.interrupt=function(o){util_4$1.log("Interrupting connection for reason: "+o),this.interruptReasons_[o]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(o){util_4$1.log("Resuming connection for reason: "+o),delete this.interruptReasons_[o],util_1$4.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(o){var s=o-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})},e.prototype.cancelSentTransactions_=function(){for(var o=0;o<this.outstandingPuts_.length;o++){var s=this.outstandingPuts_[o];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[o],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(o,s){var f;s?f=s.map(function(m){return util_4$1.ObjectToUniqueKey(m)}).join("$"):f="default";var d=this.removeListen_(o,f);d&&d.onComplete&&d.onComplete("permission_denied")},e.prototype.removeListen_=function(o,s){var f=new Path_1$1.Path(o).toString(),d;return this.listens_[f]!==void 0?(d=this.listens_[f][s],delete this.listens_[f][s],util_1$4.getCount(this.listens_[f])===0&&delete this.listens_[f]):d=void 0,d},e.prototype.onAuthRevoked_=function(o,s){util_4$1.log("Auth token revoked: "+o+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(o==="invalid_token"||o==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=INVALID_AUTH_TOKEN_THRESHOLD&&(this.reconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(o){this.securityDebugCallback_?this.securityDebugCallback_(o):"msg"in o&&console.log("FIREBASE: "+o.msg.replace(`
`,`
FIREBASE: `))},e.prototype.restoreState_=function(){var o=this;this.tryAuth(),util_1$4.forEach(this.listens_,function(d,m){util_1$4.forEach(m,function(_,$){o.sendListen_($)})});for(var s=0;s<this.outstandingPuts_.length;s++)this.outstandingPuts_[s]&&this.sendPut_(s);for(;this.onDisconnectRequestQueue_.length;){var f=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(f.action,f.pathString,f.data,f.onComplete)}},e.prototype.sendConnectStats_=function(){var o={},s="js";util_6.CONSTANTS.NODE_ADMIN?s="admin_node":util_6.CONSTANTS.NODE_CLIENT&&(s="node"),o["sdk."+s+"."+app_1.default.SDK_VERSION.replace(/\./g,"-")]=1,util_7.isMobileCordova()?o["framework.cordova"]=1:util_7.isReactNative()&&(o["framework.reactnative"]=1),this.reportStats(o)},e.prototype.shouldReconnect_=function(){var o=OnlineMonitor_1.OnlineMonitor.getInstance().currentlyOnline();return util_1$4.isEmpty(this.interruptReasons_)&&o},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(ServerActions_1$1.ServerActions);PersistentConnection$1.PersistentConnection=PersistentConnection;var ReadonlyRestClient$1={};Object.defineProperty(ReadonlyRestClient$1,"__esModule",{value:!0});var tslib_1=tslib.exports,util_1$3=cjs$1,util_2$2=util,util_3$1=cjs$1,util_4=cjs$1,util_5=cjs$1,ServerActions_1=ServerActions$1,ReadonlyRestClient=function(i){tslib_1.__extends(e,i);function e(o,s,f){var d=i.call(this)||this;return d.repoInfo_=o,d.onDataUpdate_=s,d.authTokenProvider_=f,d.log_=util_2$2.logWrapper("p:rest:"),d.listens_={},d}return e.prototype.reportStats=function(o){throw new Error("Method not implemented.")},e.getListenId_=function(o,s){return s!==void 0?"tag$"+s:(util_1$3.assert(o.getQueryParams().isDefault(),"should have a tag if it's not a default query."),o.path.toString())},e.prototype.listen=function(o,s,f,d){var m=this,_=o.path.toString();this.log_("Listen called for "+_+" "+o.queryIdentifier());var $=e.getListenId_(o,f),G={};this.listens_[$]=G;var Z=o.getQueryParams().toRestQueryStringParameters();this.restRequest_(_+".json",Z,function(et,tt){var nt=tt;if(et===404&&(nt=null,et=null),et===null&&m.onDataUpdate_(_,nt,!1,f),util_4.safeGet(m.listens_,$)===G){var st;et?et==401?st="permission_denied":st="rest_error:"+et:st="ok",d(st,null)}})},e.prototype.unlisten=function(o,s){var f=e.getListenId_(o,s);delete this.listens_[f]},e.prototype.refreshAuthToken=function(o){},e.prototype.restRequest_=function(o,s,f){var d=this;s===void 0&&(s={}),s.format="export",this.authTokenProvider_.getToken(!1).then(function(m){var _=m&&m.accessToken;_&&(s.auth=_);var $=(d.repoInfo_.secure?"https://":"http://")+d.repoInfo_.host+o+"?"+util_5.querystring(s);d.log_("Sending REST request for "+$);var G=new XMLHttpRequest;G.onreadystatechange=function(){if(f&&G.readyState===4){d.log_("REST Response for "+$+" received. status:",G.status,"response:",G.responseText);var Z=null;if(G.status>=200&&G.status<300){try{Z=util_3$1.jsonEval(G.responseText)}catch{util_2$2.warn("Failed to parse JSON response for "+$+": "+G.responseText)}f(null,Z)}else G.status!==401&&G.status!==404&&util_2$2.warn("Got unsuccessful REST response for "+$+" Status: "+G.status),f(G.status);f=null}},G.open("GET",$,!0),G.send()})},e}(ServerActions_1.ServerActions);ReadonlyRestClient$1.ReadonlyRestClient=ReadonlyRestClient;var hasRequiredRepo;function requireRepo(){if(hasRequiredRepo)return Repo;hasRequiredRepo=1,Object.defineProperty(Repo,"__esModule",{value:!0});var i=ServerValues,e=nodeFromJSON$1,o=Path$2,s=SparseSnapshotTree$1,f=SyncTree$1,d=SnapshotHolder$1,m=cjs$1,_=util,$=cjs$1,G=AuthTokenProvider$1,Z=StatsManager$1,et=StatsReporter$1,tt=StatsListener$1,nt=EventQueue$1,st=PersistentConnection$1,rt=ReadonlyRestClient$1,it=requireDatabase(),ot="repo_interrupt",lt=function(){function ft(ct,pt,gt){var Tt=this;this.repoInfo_=ct,this.app=gt,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new nt.EventQueue,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new s.SparseSnapshotTree,this.persistentConnection_=null;var Et=new G.AuthTokenProvider(gt);if(this.stats_=Z.StatsManager.getCollection(ct),pt||_.beingCrawled())this.server_=new rt.ReadonlyRestClient(this.repoInfo_,this.onDataUpdate_.bind(this),Et),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var Mt=gt.options.databaseAuthVariableOverride;if(typeof Mt<"u"&&Mt!==null){if(typeof Mt!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{m.stringify(Mt)}catch(vt){throw new Error("Invalid authOverride provided: "+vt)}}this.persistentConnection_=new st.PersistentConnection(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),Et,Mt),this.server_=this.persistentConnection_}Et.addTokenChangeListener(function(vt){Tt.server_.refreshAuthToken(vt)}),this.statsReporter_=Z.StatsManager.getOrCreateReporter(ct,function(){return new et.StatsReporter(Tt.stats_,Tt.server_)}),this.transactions_init_(),this.infoData_=new d.SnapshotHolder,this.infoSyncTree_=new f.SyncTree({startListening:function(vt,yt,bt,Pt){var wt=[],At=Tt.infoData_.getNode(vt.path);return At.isEmpty()||(wt=Tt.infoSyncTree_.applyServerOverwrite(vt.path,At),setTimeout(function(){Pt("ok")},0)),wt},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new f.SyncTree({startListening:function(vt,yt,bt,Pt){return Tt.server_.listen(vt,bt,yt,function(wt,At){var Ft=Pt(wt,At);Tt.eventQueue_.raiseEventsForChangedPath(vt.path,Ft)}),[]},stopListening:function(vt,yt){Tt.server_.unlisten(vt,yt)}})}return ft.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},ft.prototype.name=function(){return this.repoInfo_.namespace},ft.prototype.serverTime=function(){var ct=this.infoData_.getNode(new o.Path(".info/serverTimeOffset")),pt=ct.val()||0;return new Date().getTime()+pt},ft.prototype.generateServerValues=function(){return i.generateWithValues({timestamp:this.serverTime()})},ft.prototype.onDataUpdate_=function(ct,pt,gt,Tt){this.dataUpdateCount++;var Et=new o.Path(ct);pt=this.interceptServerDataCallback_?this.interceptServerDataCallback_(ct,pt):pt;var Mt=[];if(Tt)if(gt){var vt=$.map(pt,function(At){return e.nodeFromJSON(At)});Mt=this.serverSyncTree_.applyTaggedQueryMerge(Et,vt,Tt)}else{var yt=e.nodeFromJSON(pt);Mt=this.serverSyncTree_.applyTaggedQueryOverwrite(Et,yt,Tt)}else if(gt){var bt=$.map(pt,function(At){return e.nodeFromJSON(At)});Mt=this.serverSyncTree_.applyServerMerge(Et,bt)}else{var Pt=e.nodeFromJSON(pt);Mt=this.serverSyncTree_.applyServerOverwrite(Et,Pt)}var wt=Et;Mt.length>0&&(wt=this.rerunTransactions_(Et)),this.eventQueue_.raiseEventsForChangedPath(wt,Mt)},ft.prototype.interceptServerData_=function(ct){this.interceptServerDataCallback_=ct},ft.prototype.onConnectStatus_=function(ct){this.updateInfo_("connected",ct),ct===!1&&this.runOnDisconnectEvents_()},ft.prototype.onServerInfoUpdate_=function(ct){var pt=this;_.each(ct,function(gt,Tt){pt.updateInfo_(Tt,gt)})},ft.prototype.updateInfo_=function(ct,pt){var gt=new o.Path("/.info/"+ct),Tt=e.nodeFromJSON(pt);this.infoData_.updateSnapshot(gt,Tt);var Et=this.infoSyncTree_.applyServerOverwrite(gt,Tt);this.eventQueue_.raiseEventsForChangedPath(gt,Et)},ft.prototype.getNextWriteId_=function(){return this.nextWriteId_++},ft.prototype.setWithPriority=function(ct,pt,gt,Tt){var Et=this;this.log_("set",{path:ct.toString(),value:pt,priority:gt});var Mt=this.generateServerValues(),vt=e.nodeFromJSON(pt,gt),yt=i.resolveDeferredValueSnapshot(vt,Mt),bt=this.getNextWriteId_(),Pt=this.serverSyncTree_.applyUserOverwrite(ct,yt,bt,!0);this.eventQueue_.queueEvents(Pt),this.server_.put(ct.toString(),vt.val(!0),function(At,Ft){var Bt=At==="ok";Bt||_.warn("set at "+ct+" failed: "+At);var zt=Et.serverSyncTree_.ackUserWrite(bt,!Bt);Et.eventQueue_.raiseEventsForChangedPath(ct,zt),Et.callOnCompleteCallback(Tt,At,Ft)});var wt=this.abortTransactions_(ct);this.rerunTransactions_(wt),this.eventQueue_.raiseEventsForChangedPath(wt,[])},ft.prototype.update=function(ct,pt,gt){var Tt=this;this.log_("update",{path:ct.toString(),value:pt});var Et=!0,Mt=this.generateServerValues(),vt={};if($.forEach(pt,function(Pt,wt){Et=!1;var At=e.nodeFromJSON(wt);vt[Pt]=i.resolveDeferredValueSnapshot(At,Mt)}),Et)_.log("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(gt,"ok");else{var yt=this.getNextWriteId_(),bt=this.serverSyncTree_.applyUserMerge(ct,vt,yt);this.eventQueue_.queueEvents(bt),this.server_.merge(ct.toString(),pt,function(Pt,wt){var At=Pt==="ok";At||_.warn("update at "+ct+" failed: "+Pt);var Ft=Tt.serverSyncTree_.ackUserWrite(yt,!At),Bt=Ft.length>0?Tt.rerunTransactions_(ct):ct;Tt.eventQueue_.raiseEventsForChangedPath(Bt,Ft),Tt.callOnCompleteCallback(gt,Pt,wt)}),$.forEach(pt,function(Pt){var wt=Tt.abortTransactions_(ct.child(Pt));Tt.rerunTransactions_(wt)}),this.eventQueue_.raiseEventsForChangedPath(ct,[])}},ft.prototype.runOnDisconnectEvents_=function(){var ct=this;this.log_("onDisconnectEvents");var pt=this.generateServerValues(),gt=i.resolveDeferredValueTree(this.onDisconnect_,pt),Tt=[];gt.forEachTree(o.Path.Empty,function(Et,Mt){Tt=Tt.concat(ct.serverSyncTree_.applyServerOverwrite(Et,Mt));var vt=ct.abortTransactions_(Et);ct.rerunTransactions_(vt)}),this.onDisconnect_=new s.SparseSnapshotTree,this.eventQueue_.raiseEventsForChangedPath(o.Path.Empty,Tt)},ft.prototype.onDisconnectCancel=function(ct,pt){var gt=this;this.server_.onDisconnectCancel(ct.toString(),function(Tt,Et){Tt==="ok"&&gt.onDisconnect_.forget(ct),gt.callOnCompleteCallback(pt,Tt,Et)})},ft.prototype.onDisconnectSet=function(ct,pt,gt){var Tt=this,Et=e.nodeFromJSON(pt);this.server_.onDisconnectPut(ct.toString(),Et.val(!0),function(Mt,vt){Mt==="ok"&&Tt.onDisconnect_.remember(ct,Et),Tt.callOnCompleteCallback(gt,Mt,vt)})},ft.prototype.onDisconnectSetWithPriority=function(ct,pt,gt,Tt){var Et=this,Mt=e.nodeFromJSON(pt,gt);this.server_.onDisconnectPut(ct.toString(),Mt.val(!0),function(vt,yt){vt==="ok"&&Et.onDisconnect_.remember(ct,Mt),Et.callOnCompleteCallback(Tt,vt,yt)})},ft.prototype.onDisconnectUpdate=function(ct,pt,gt){var Tt=this;if($.isEmpty(pt)){_.log("onDisconnect().update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(gt,"ok");return}this.server_.onDisconnectMerge(ct.toString(),pt,function(Et,Mt){Et==="ok"&&$.forEach(pt,function(vt,yt){var bt=e.nodeFromJSON(yt);Tt.onDisconnect_.remember(ct.child(vt),bt)}),Tt.callOnCompleteCallback(gt,Et,Mt)})},ft.prototype.addEventCallbackForQuery=function(ct,pt){var gt;ct.path.getFront()===".info"?gt=this.infoSyncTree_.addEventRegistration(ct,pt):gt=this.serverSyncTree_.addEventRegistration(ct,pt),this.eventQueue_.raiseEventsAtPath(ct.path,gt)},ft.prototype.removeEventCallbackForQuery=function(ct,pt){var gt;ct.path.getFront()===".info"?gt=this.infoSyncTree_.removeEventRegistration(ct,pt):gt=this.serverSyncTree_.removeEventRegistration(ct,pt),this.eventQueue_.raiseEventsAtPath(ct.path,gt)},ft.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(ot)},ft.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(ot)},ft.prototype.stats=function(ct){if(ct===void 0&&(ct=!1),!(typeof console>"u")){var pt;ct?(this.statsListener_||(this.statsListener_=new tt.StatsListener(this.stats_)),pt=this.statsListener_.get()):pt=this.stats_.get();var gt=Object.keys(pt).reduce(function(Tt,Et){return Math.max(Et.length,Tt)},0);$.forEach(pt,function(Tt,Et){for(var Mt=Tt.length;Mt<gt+2;Mt++)Tt+=" ";console.log(Tt+Et)})}},ft.prototype.statsIncrementCounter=function(ct){this.stats_.incrementCounter(ct),this.statsReporter_.includeStat(ct)},ft.prototype.log_=function(){for(var ct=[],pt=0;pt<arguments.length;pt++)ct[pt]=arguments[pt];var gt="";this.persistentConnection_&&(gt=this.persistentConnection_.id+":"),_.log.apply(void 0,[gt].concat(ct))},ft.prototype.callOnCompleteCallback=function(ct,pt,gt){ct&&_.exceptionGuard(function(){if(pt=="ok")ct(null);else{var Tt=(pt||"error").toUpperCase(),Et=Tt;gt&&(Et+=": "+gt);var Mt=new Error(Et);Mt.code=Tt,ct(Mt)}})},Object.defineProperty(ft.prototype,"database",{get:function(){return this.__database||(this.__database=new it.Database(this))},enumerable:!0,configurable:!0}),ft}();return Repo.Repo=lt,Repo}var QueryParams$1={},LimitedFilter$1={},RangedFilter$1={};Object.defineProperty(RangedFilter$1,"__esModule",{value:!0});var IndexedFilter_1$1=IndexedFilter$1,PriorityIndex_1$1=PriorityIndex$1,Node_1$1=Node,ChildrenNode_1$1=ChildrenNode,RangedFilter=function(){function i(e){this.indexedFilter_=new IndexedFilter_1$1.IndexedFilter(e.getIndex()),this.index_=e.getIndex(),this.startPost_=i.getStartPost_(e),this.endPost_=i.getEndPost_(e)}return i.prototype.getStartPost=function(){return this.startPost_},i.prototype.getEndPost=function(){return this.endPost_},i.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},i.prototype.updateChild=function(e,o,s,f,d,m){return this.matches(new Node_1$1.NamedNode(o,s))||(s=ChildrenNode_1$1.ChildrenNode.EMPTY_NODE),this.indexedFilter_.updateChild(e,o,s,f,d,m)},i.prototype.updateFullNode=function(e,o,s){o.isLeafNode()&&(o=ChildrenNode_1$1.ChildrenNode.EMPTY_NODE);var f=o.withIndex(this.index_);f=f.updatePriority(ChildrenNode_1$1.ChildrenNode.EMPTY_NODE);var d=this;return o.forEachChild(PriorityIndex_1$1.PRIORITY_INDEX,function(m,_){d.matches(new Node_1$1.NamedNode(m,_))||(f=f.updateImmediateChild(m,ChildrenNode_1$1.ChildrenNode.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,f,s)},i.prototype.updatePriority=function(e,o){return e},i.prototype.filtersNodes=function(){return!0},i.prototype.getIndexedFilter=function(){return this.indexedFilter_},i.prototype.getIndex=function(){return this.index_},i.getStartPost_=function(e){if(e.hasStart()){var o=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),o)}else return e.getIndex().minPost()},i.getEndPost_=function(e){if(e.hasEnd()){var o=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),o)}else return e.getIndex().maxPost()},i}();RangedFilter$1.RangedFilter=RangedFilter;Object.defineProperty(LimitedFilter$1,"__esModule",{value:!0});var RangedFilter_1$1=RangedFilter$1,ChildrenNode_1=ChildrenNode,Node_1=Node,util_1$2=cjs$1,Change_1=Change$1,LimitedFilter=function(){function i(e){this.rangedFilter_=new RangedFilter_1$1.RangedFilter(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return i.prototype.updateChild=function(e,o,s,f,d,m){return this.rangedFilter_.matches(new Node_1.NamedNode(o,s))||(s=ChildrenNode_1.ChildrenNode.EMPTY_NODE),e.getImmediateChild(o).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,o,s,f,d,m):this.fullLimitUpdateChild_(e,o,s,d,m)},i.prototype.updateFullNode=function(e,o,s){var f;if(o.isLeafNode()||o.isEmpty())f=ChildrenNode_1.ChildrenNode.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<o.numChildren()&&o.isIndexed(this.index_)){f=ChildrenNode_1.ChildrenNode.EMPTY_NODE.withIndex(this.index_);var d=void 0;this.reverse_?d=o.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):d=o.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var m=0;d.hasNext()&&m<this.limit_;){var _=d.getNext(),$=void 0;if(this.reverse_?$=this.index_.compare(this.rangedFilter_.getStartPost(),_)<=0:$=this.index_.compare(_,this.rangedFilter_.getEndPost())<=0,$)f=f.updateImmediateChild(_.name,_.node),m++;else break}}else{f=o.withIndex(this.index_),f=f.updatePriority(ChildrenNode_1.ChildrenNode.EMPTY_NODE);var G=void 0,Z=void 0,et=void 0,d=void 0;if(this.reverse_){d=f.getReverseIterator(this.index_),G=this.rangedFilter_.getEndPost(),Z=this.rangedFilter_.getStartPost();var tt=this.index_.getCompare();et=function(it,ot){return tt(ot,it)}}else d=f.getIterator(this.index_),G=this.rangedFilter_.getStartPost(),Z=this.rangedFilter_.getEndPost(),et=this.index_.getCompare();for(var m=0,nt=!1;d.hasNext();){var _=d.getNext();!nt&&et(G,_)<=0&&(nt=!0);var $=nt&&m<this.limit_&&et(_,Z)<=0;$?m++:f=f.updateImmediateChild(_.name,ChildrenNode_1.ChildrenNode.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,f,s)},i.prototype.updatePriority=function(e,o){return e},i.prototype.filtersNodes=function(){return!0},i.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},i.prototype.getIndex=function(){return this.index_},i.prototype.fullLimitUpdateChild_=function(e,o,s,f,d){var m;if(this.reverse_){var _=this.index_.getCompare();m=function(lt,ft){return _(ft,lt)}}else m=this.index_.getCompare();var $=e;util_1$2.assert($.numChildren()==this.limit_,"");var G=new Node_1.NamedNode(o,s),Z=this.reverse_?$.getFirstChild(this.index_):$.getLastChild(this.index_),et=this.rangedFilter_.matches(G);if($.hasChild(o)){for(var tt=$.getImmediateChild(o),nt=f.getChildAfterChild(this.index_,Z,this.reverse_);nt!=null&&(nt.name==o||$.hasChild(nt.name));)nt=f.getChildAfterChild(this.index_,nt,this.reverse_);var st=nt==null?1:m(nt,G),rt=et&&!s.isEmpty()&&st>=0;if(rt)return d!=null&&d.trackChildChange(Change_1.Change.childChangedChange(o,s,tt)),$.updateImmediateChild(o,s);d!=null&&d.trackChildChange(Change_1.Change.childRemovedChange(o,tt));var it=$.updateImmediateChild(o,ChildrenNode_1.ChildrenNode.EMPTY_NODE),ot=nt!=null&&this.rangedFilter_.matches(nt);return ot?(d!=null&&d.trackChildChange(Change_1.Change.childAddedChange(nt.name,nt.node)),it.updateImmediateChild(nt.name,nt.node)):it}else return s.isEmpty()?e:et&&m(Z,G)>=0?(d!=null&&(d.trackChildChange(Change_1.Change.childRemovedChange(Z.name,Z.node)),d.trackChildChange(Change_1.Change.childAddedChange(o,s))),$.updateImmediateChild(o,s).updateImmediateChild(Z.name,ChildrenNode_1.ChildrenNode.EMPTY_NODE)):e},i}();LimitedFilter$1.LimitedFilter=LimitedFilter;Object.defineProperty(QueryParams$1,"__esModule",{value:!0});var util_1$1=cjs$1,util_2$1=util,KeyIndex_1=KeyIndex$1,PriorityIndex_1=PriorityIndex$1,ValueIndex_1=ValueIndex$1,PathIndex_1=PathIndex$1,IndexedFilter_1=IndexedFilter$1,LimitedFilter_1=LimitedFilter$1,RangedFilter_1=RangedFilter$1,util_3=cjs$1,QueryParams=function(){function i(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=PriorityIndex_1.PRIORITY_INDEX}return i.prototype.hasStart=function(){return this.startSet_},i.prototype.isViewFromLeft=function(){return this.viewFrom_===""?this.startSet_:this.viewFrom_===i.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},i.prototype.getIndexStartValue=function(){return util_1$1.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},i.prototype.getIndexStartName=function(){return util_1$1.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:util_2$1.MIN_NAME},i.prototype.hasEnd=function(){return this.endSet_},i.prototype.getIndexEndValue=function(){return util_1$1.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},i.prototype.getIndexEndName=function(){return util_1$1.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:util_2$1.MAX_NAME},i.prototype.hasLimit=function(){return this.limitSet_},i.prototype.hasAnchoredLimit=function(){return this.limitSet_&&this.viewFrom_!==""},i.prototype.getLimit=function(){return util_1$1.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},i.prototype.getIndex=function(){return this.index_},i.prototype.copy_=function(){var e=new i;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},i.prototype.limit=function(e){var o=this.copy_();return o.limitSet_=!0,o.limit_=e,o.viewFrom_="",o},i.prototype.limitToFirst=function(e){var o=this.copy_();return o.limitSet_=!0,o.limit_=e,o.viewFrom_=i.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,o},i.prototype.limitToLast=function(e){var o=this.copy_();return o.limitSet_=!0,o.limit_=e,o.viewFrom_=i.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,o},i.prototype.startAt=function(e,o){var s=this.copy_();return s.startSet_=!0,e===void 0&&(e=null),s.indexStartValue_=e,o!=null?(s.startNameSet_=!0,s.indexStartName_=o):(s.startNameSet_=!1,s.indexStartName_=""),s},i.prototype.endAt=function(e,o){var s=this.copy_();return s.endSet_=!0,e===void 0&&(e=null),s.indexEndValue_=e,o!==void 0?(s.endNameSet_=!0,s.indexEndName_=o):(s.endNameSet_=!1,s.indexEndName_=""),s},i.prototype.orderBy=function(e){var o=this.copy_();return o.index_=e,o},i.prototype.getQueryObject=function(){var e=i.WIRE_PROTOCOL_CONSTANTS_,o={};if(this.startSet_&&(o[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(o[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(o[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(o[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){o[e.LIMIT]=this.limit_;var s=this.viewFrom_;s===""&&(this.isViewFromLeft()?s=e.VIEW_FROM_LEFT:s=e.VIEW_FROM_RIGHT),o[e.VIEW_FROM]=s}return this.index_!==PriorityIndex_1.PRIORITY_INDEX&&(o[e.INDEX]=this.index_.toString()),o},i.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},i.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==PriorityIndex_1.PRIORITY_INDEX},i.prototype.getNodeFilter=function(){return this.loadsAllData()?new IndexedFilter_1.IndexedFilter(this.getIndex()):this.hasLimit()?new LimitedFilter_1.LimitedFilter(this):new RangedFilter_1.RangedFilter(this)},i.prototype.toRestQueryStringParameters=function(){var e=i.REST_QUERY_CONSTANTS_,o={};if(this.isDefault())return o;var s;return this.index_===PriorityIndex_1.PRIORITY_INDEX?s=e.PRIORITY_INDEX:this.index_===ValueIndex_1.VALUE_INDEX?s=e.VALUE_INDEX:this.index_===KeyIndex_1.KEY_INDEX?s=e.KEY_INDEX:(util_1$1.assert(this.index_ instanceof PathIndex_1.PathIndex,"Unrecognized index type!"),s=this.index_.toString()),o[e.ORDER_BY]=util_3.stringify(s),this.startSet_&&(o[e.START_AT]=util_3.stringify(this.indexStartValue_),this.startNameSet_&&(o[e.START_AT]+=","+util_3.stringify(this.indexStartName_))),this.endSet_&&(o[e.END_AT]=util_3.stringify(this.indexEndValue_),this.endNameSet_&&(o[e.END_AT]+=","+util_3.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?o[e.LIMIT_TO_FIRST]=this.limit_:o[e.LIMIT_TO_LAST]=this.limit_),o},i.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},i.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},i.DEFAULT=new i,i}();QueryParams$1.QueryParams=QueryParams;var hasRequiredReference;function requireReference(){if(hasRequiredReference)return Reference$1;hasRequiredReference=1,Object.defineProperty(Reference$1,"__esModule",{value:!0});var i=tslib.exports,e=onDisconnect,o=TransactionResult$1,s=util,f=NextPushId,d=Query$3,m=requireRepo(),_=Path$2,$=QueryParams$1,G=validation,Z=cjs$1,et=cjs$1,tt=SyncPoint$1,nt=function(st){i.__extends(rt,st);function rt(it,ot){var lt=this;if(!(it instanceof m.Repo))throw new Error("new Reference() no longer supported - use app.database().");return lt=st.call(this,it,ot,$.QueryParams.DEFAULT,!1)||this,lt}return rt.prototype.getKey=function(){return Z.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},rt.prototype.child=function(it){return Z.validateArgCount("Reference.child",1,1,arguments.length),typeof it=="number"?it=String(it):it instanceof _.Path||(this.path.getFront()===null?G.validateRootPathString("Reference.child",1,it,!1):G.validatePathString("Reference.child",1,it,!1)),new rt(this.repo,this.path.child(it))},rt.prototype.getParent=function(){Z.validateArgCount("Reference.parent",0,0,arguments.length);var it=this.path.parent();return it===null?null:new rt(this.repo,it)},rt.prototype.getRoot=function(){Z.validateArgCount("Reference.root",0,0,arguments.length);for(var it=this;it.getParent()!==null;)it=it.getParent();return it},rt.prototype.databaseProp=function(){return this.repo.database},rt.prototype.set=function(it,ot){Z.validateArgCount("Reference.set",1,2,arguments.length),G.validateWritablePath("Reference.set",this.path),G.validateFirebaseDataArg("Reference.set",1,it,this.path,!1),Z.validateCallback("Reference.set",2,ot,!0);var lt=new et.Deferred;return this.repo.setWithPriority(this.path,it,null,lt.wrapCallback(ot)),lt.promise},rt.prototype.update=function(it,ot){if(Z.validateArgCount("Reference.update",1,2,arguments.length),G.validateWritablePath("Reference.update",this.path),Array.isArray(it)){for(var lt={},ft=0;ft<it.length;++ft)lt[""+ft]=it[ft];it=lt,s.warn("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}G.validateFirebaseMergeDataArg("Reference.update",1,it,this.path,!1),Z.validateCallback("Reference.update",2,ot,!0);var ct=new et.Deferred;return this.repo.update(this.path,it,ct.wrapCallback(ot)),ct.promise},rt.prototype.setWithPriority=function(it,ot,lt){if(Z.validateArgCount("Reference.setWithPriority",2,3,arguments.length),G.validateWritablePath("Reference.setWithPriority",this.path),G.validateFirebaseDataArg("Reference.setWithPriority",1,it,this.path,!1),G.validatePriority("Reference.setWithPriority",2,ot,!1),Z.validateCallback("Reference.setWithPriority",3,lt,!0),this.getKey()===".length"||this.getKey()===".keys")throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var ft=new et.Deferred;return this.repo.setWithPriority(this.path,it,ot,ft.wrapCallback(lt)),ft.promise},rt.prototype.remove=function(it){return Z.validateArgCount("Reference.remove",0,1,arguments.length),G.validateWritablePath("Reference.remove",this.path),Z.validateCallback("Reference.remove",1,it,!0),this.set(null,it)},rt.prototype.transaction=function(it,ot,lt){if(Z.validateArgCount("Reference.transaction",1,3,arguments.length),G.validateWritablePath("Reference.transaction",this.path),Z.validateCallback("Reference.transaction",1,it,!1),Z.validateCallback("Reference.transaction",2,ot,!0),G.validateBoolean("Reference.transaction",3,lt,!0),this.getKey()===".length"||this.getKey()===".keys")throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";lt===void 0&&(lt=!0);var ft=new et.Deferred;typeof ot=="function"&&ft.promise.catch(function(){});var ct=function(pt,gt,Tt){pt?ft.reject(pt):ft.resolve(new o.TransactionResult(gt,Tt)),typeof ot=="function"&&ot(pt,gt,Tt)};return this.repo.startTransaction(this.path,it,ct,lt),ft.promise},rt.prototype.setPriority=function(it,ot){Z.validateArgCount("Reference.setPriority",1,2,arguments.length),G.validateWritablePath("Reference.setPriority",this.path),G.validatePriority("Reference.setPriority",1,it,!1),Z.validateCallback("Reference.setPriority",2,ot,!0);var lt=new et.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),it,null,lt.wrapCallback(ot)),lt.promise},rt.prototype.push=function(it,ot){Z.validateArgCount("Reference.push",0,2,arguments.length),G.validateWritablePath("Reference.push",this.path),G.validateFirebaseDataArg("Reference.push",1,it,this.path,!0),Z.validateCallback("Reference.push",2,ot,!0);var lt=this.repo.serverTime(),ft=f.nextPushId(lt),ct=this.child(ft),pt=this.child(ft),gt;return it!=null?gt=ct.set(it,ot).then(function(){return pt}):gt=Promise.resolve(pt),ct.then=gt.then.bind(gt),ct.catch=gt.then.bind(gt,void 0),typeof ot=="function"&&gt.catch(function(){}),ct},rt.prototype.onDisconnect=function(){return G.validateWritablePath("Reference.onDisconnect",this.path),new e.OnDisconnect(this.repo,this.path)},Object.defineProperty(rt.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(rt.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(rt.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(rt.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),rt}(d.Query);return Reference$1.Reference=nt,d.Query.__referenceConstructor=nt,tt.SyncPoint.__referenceConstructor=nt,Reference$1}var RepoManager={},Repo_transaction={},Tree$1={};Object.defineProperty(Tree$1,"__esModule",{value:!0});var util_1=cjs$1,Path_1=Path$2,util_2=cjs$1,TreeNode=function(){function i(){this.children={},this.childCount=0,this.value=null}return i}();Tree$1.TreeNode=TreeNode;var Tree=function(){function i(e,o,s){e===void 0&&(e=""),o===void 0&&(o=null),s===void 0&&(s=new TreeNode),this.name_=e,this.parent_=o,this.node_=s}return i.prototype.subTree=function(e){for(var o=e instanceof Path_1.Path?e:new Path_1.Path(e),s=this,f;(f=o.getFront())!==null;){var d=util_2.safeGet(s.node_.children,f)||new TreeNode;s=new i(f,s,d),o=o.popFront()}return s},i.prototype.getValue=function(){return this.node_.value},i.prototype.setValue=function(e){util_1.assert(typeof e<"u","Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},i.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},i.prototype.hasChildren=function(){return this.node_.childCount>0},i.prototype.isEmpty=function(){return this.getValue()===null&&!this.hasChildren()},i.prototype.forEachChild=function(e){var o=this;util_2.forEach(this.node_.children,function(s,f){e(new i(s,o,f))})},i.prototype.forEachDescendant=function(e,o,s){o&&!s&&e(this),this.forEachChild(function(f){f.forEachDescendant(e,!0,s)}),o&&s&&e(this)},i.prototype.forEachAncestor=function(e,o){for(var s=o?this:this.parent();s!==null;){if(e(s))return!0;s=s.parent()}return!1},i.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(o){o.getValue()!==null?e(o):o.forEachImmediateDescendantWithValue(e)})},i.prototype.path=function(){return new Path_1.Path(this.parent_===null?this.name_:this.parent_.path()+"/"+this.name_)},i.prototype.name=function(){return this.name_},i.prototype.parent=function(){return this.parent_},i.prototype.updateParents_=function(){this.parent_!==null&&this.parent_.updateChild_(this.name_,this)},i.prototype.updateChild_=function(e,o){var s=o.isEmpty(),f=util_2.contains(this.node_.children,e);s&&f?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):!s&&!f&&(this.node_.children[e]=o.node_,this.node_.childCount++,this.updateParents_())},i}();Tree$1.Tree=Tree;var hasRequiredRepo_transaction;function requireRepo_transaction(){return hasRequiredRepo_transaction||(hasRequiredRepo_transaction=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=cjs$1,o=requireReference(),s=requireDataSnapshot(),f=Path$2,d=Tree$1,m=PriorityIndex$1,_=util,$=ServerValues,G=validation,Z=cjs$1,et=nodeFromJSON$1,tt=ChildrenNode,nt=requireRepo(),st;(function(rt){rt[rt.RUN=0]="RUN",rt[rt.SENT=1]="SENT",rt[rt.COMPLETED=2]="COMPLETED",rt[rt.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",rt[rt.NEEDS_ABORT=4]="NEEDS_ABORT"})(st=i.TransactionStatus||(i.TransactionStatus={})),nt.Repo.MAX_TRANSACTION_RETRIES_=25,nt.Repo.prototype.transactions_init_=function(){this.transactionQueueTree_=new d.Tree},nt.Repo.prototype.startTransaction=function(rt,it,ot,lt){this.log_("transaction on "+rt);var ft=function(){},ct=new o.Reference(this,rt);ct.on("value",ft);var pt=function(){ct.off("value",ft)},gt={path:rt,update:it,onComplete:ot,status:null,order:_.LUIDGenerator(),applyLocally:lt,retryCount:0,unwatcher:pt,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},Tt=this.getLatestState_(rt);gt.currentInputSnapshot=Tt;var Et=gt.update(Tt.val());if(Et===void 0){if(gt.unwatcher(),gt.currentOutputSnapshotRaw=null,gt.currentOutputSnapshotResolved=null,gt.onComplete){var Mt=new s.DataSnapshot(gt.currentInputSnapshot,new o.Reference(this,gt.path),m.PRIORITY_INDEX);gt.onComplete(null,!1,Mt)}}else{G.validateFirebaseData("transaction failed: Data returned ",Et,gt.path),gt.status=st.RUN;var vt=this.transactionQueueTree_.subTree(rt),yt=vt.getValue()||[];yt.push(gt),vt.setValue(yt);var bt=void 0;if(typeof Et=="object"&&Et!==null&&Z.contains(Et,".priority"))bt=Z.safeGet(Et,".priority"),e.assert(G.isValidPriority(bt),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{var Pt=this.serverSyncTree_.calcCompleteEventCache(rt)||tt.ChildrenNode.EMPTY_NODE;bt=Pt.getPriority().val()}bt=bt;var wt=this.generateServerValues(),At=et.nodeFromJSON(Et,bt),Ft=$.resolveDeferredValueSnapshot(At,wt);gt.currentOutputSnapshotRaw=At,gt.currentOutputSnapshotResolved=Ft,gt.currentWriteId=this.getNextWriteId_();var Bt=this.serverSyncTree_.applyUserOverwrite(rt,Ft,gt.currentWriteId,gt.applyLocally);this.eventQueue_.raiseEventsForChangedPath(rt,Bt),this.sendReadyTransactions_()}},nt.Repo.prototype.getLatestState_=function(rt,it){return this.serverSyncTree_.calcCompleteEventCache(rt,it)||tt.ChildrenNode.EMPTY_NODE},nt.Repo.prototype.sendReadyTransactions_=function(rt){var it=this;if(rt===void 0&&(rt=this.transactionQueueTree_),rt||this.pruneCompletedTransactionsBelowNode_(rt),rt.getValue()!==null){var ot=this.buildTransactionQueue_(rt);e.assert(ot.length>0,"Sending zero length transaction queue");var lt=ot.every(function(ft){return ft.status===st.RUN});lt&&this.sendTransactionQueue_(rt.path(),ot)}else rt.hasChildren()&&rt.forEachChild(function(ft){it.sendReadyTransactions_(ft)})},nt.Repo.prototype.sendTransactionQueue_=function(rt,it){for(var ot=this,lt=it.map(function(yt){return yt.currentWriteId}),ft=this.getLatestState_(rt,lt),ct=ft,pt=ft.hash(),gt=0;gt<it.length;gt++){var Tt=it[gt];e.assert(Tt.status===st.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),Tt.status=st.SENT,Tt.retryCount++;var Et=f.Path.relativePath(rt,Tt.path);ct=ct.updateChild(Et,Tt.currentOutputSnapshotRaw)}var Mt=ct.val(!0),vt=rt;this.server_.put(vt.toString(),Mt,function(yt){ot.log_("transaction put response",{path:vt.toString(),status:yt});var bt=[];if(yt==="ok"){for(var Pt=[],wt=0;wt<it.length;wt++){if(it[wt].status=st.COMPLETED,bt=bt.concat(ot.serverSyncTree_.ackUserWrite(it[wt].currentWriteId)),it[wt].onComplete){var At=it[wt].currentOutputSnapshotResolved,Ft=new o.Reference(ot,it[wt].path),Bt=new s.DataSnapshot(At,Ft,m.PRIORITY_INDEX);Pt.push(it[wt].onComplete.bind(null,null,!0,Bt))}it[wt].unwatcher()}ot.pruneCompletedTransactionsBelowNode_(ot.transactionQueueTree_.subTree(rt)),ot.sendReadyTransactions_(),ot.eventQueue_.raiseEventsForChangedPath(rt,bt);for(var wt=0;wt<Pt.length;wt++)_.exceptionGuard(Pt[wt])}else{if(yt==="datastale")for(var wt=0;wt<it.length;wt++)it[wt].status===st.SENT_NEEDS_ABORT?it[wt].status=st.NEEDS_ABORT:it[wt].status=st.RUN;else{_.warn("transaction at "+vt.toString()+" failed: "+yt);for(var wt=0;wt<it.length;wt++)it[wt].status=st.NEEDS_ABORT,it[wt].abortReason=yt}ot.rerunTransactions_(rt)}},pt)},nt.Repo.prototype.rerunTransactions_=function(rt){var it=this.getAncestorTransactionNode_(rt),ot=it.path(),lt=this.buildTransactionQueue_(it);return this.rerunTransactionQueue_(lt,ot),ot},nt.Repo.prototype.rerunTransactionQueue_=function(rt,it){if(rt.length!==0){for(var ot=[],lt=[],ft=rt.filter(function(ln){return ln.status===st.RUN}),ct=ft.map(function(ln){return ln.currentWriteId}),pt=0;pt<rt.length;pt++){var gt=rt[pt],Tt=f.Path.relativePath(it,gt.path),Et=!1,Mt=void 0;if(e.assert(Tt!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),gt.status===st.NEEDS_ABORT)Et=!0,Mt=gt.abortReason,lt=lt.concat(this.serverSyncTree_.ackUserWrite(gt.currentWriteId,!0));else if(gt.status===st.RUN)if(gt.retryCount>=nt.Repo.MAX_TRANSACTION_RETRIES_)Et=!0,Mt="maxretry",lt=lt.concat(this.serverSyncTree_.ackUserWrite(gt.currentWriteId,!0));else{var vt=this.getLatestState_(gt.path,ct);gt.currentInputSnapshot=vt;var yt=rt[pt].update(vt.val());if(yt!==void 0){G.validateFirebaseData("transaction failed: Data returned ",yt,gt.path);var bt=et.nodeFromJSON(yt),Pt=typeof yt=="object"&&yt!=null&&Z.contains(yt,".priority");Pt||(bt=bt.updatePriority(vt.getPriority()));var wt=gt.currentWriteId,At=this.generateServerValues(),Ft=$.resolveDeferredValueSnapshot(bt,At);gt.currentOutputSnapshotRaw=bt,gt.currentOutputSnapshotResolved=Ft,gt.currentWriteId=this.getNextWriteId_(),ct.splice(ct.indexOf(wt),1),lt=lt.concat(this.serverSyncTree_.applyUserOverwrite(gt.path,Ft,gt.currentWriteId,gt.applyLocally)),lt=lt.concat(this.serverSyncTree_.ackUserWrite(wt,!0))}else Et=!0,Mt="nodata",lt=lt.concat(this.serverSyncTree_.ackUserWrite(gt.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(it,lt),lt=[],Et&&(rt[pt].status=st.COMPLETED,function(ln){setTimeout(ln,Math.floor(0))}(rt[pt].unwatcher),rt[pt].onComplete))if(Mt==="nodata"){var Bt=new o.Reference(this,rt[pt].path),zt=rt[pt].currentInputSnapshot,Ht=new s.DataSnapshot(zt,Bt,m.PRIORITY_INDEX);ot.push(rt[pt].onComplete.bind(null,null,!1,Ht))}else ot.push(rt[pt].onComplete.bind(null,new Error(Mt),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(var pt=0;pt<ot.length;pt++)_.exceptionGuard(ot[pt]);this.sendReadyTransactions_()}},nt.Repo.prototype.getAncestorTransactionNode_=function(rt){for(var it,ot=this.transactionQueueTree_;(it=rt.getFront())!==null&&ot.getValue()===null;)ot=ot.subTree(it),rt=rt.popFront();return ot},nt.Repo.prototype.buildTransactionQueue_=function(rt){var it=[];return this.aggregateTransactionQueuesForNode_(rt,it),it.sort(function(ot,lt){return ot.order-lt.order}),it},nt.Repo.prototype.aggregateTransactionQueuesForNode_=function(rt,it){var ot=this,lt=rt.getValue();if(lt!==null)for(var ft=0;ft<lt.length;ft++)it.push(lt[ft]);rt.forEachChild(function(ct){ot.aggregateTransactionQueuesForNode_(ct,it)})},nt.Repo.prototype.pruneCompletedTransactionsBelowNode_=function(rt){var it=this,ot=rt.getValue();if(ot){for(var lt=0,ft=0;ft<ot.length;ft++)ot[ft].status!==st.COMPLETED&&(ot[lt]=ot[ft],lt++);ot.length=lt,rt.setValue(ot.length>0?ot:null)}rt.forEachChild(function(ct){it.pruneCompletedTransactionsBelowNode_(ct)})},nt.Repo.prototype.abortTransactions_=function(rt){var it=this,ot=this.getAncestorTransactionNode_(rt).path(),lt=this.transactionQueueTree_.subTree(rt);return lt.forEachAncestor(function(ft){it.abortTransactionsOnNode_(ft)}),this.abortTransactionsOnNode_(lt),lt.forEachDescendant(function(ft){it.abortTransactionsOnNode_(ft)}),ot},nt.Repo.prototype.abortTransactionsOnNode_=function(rt){var it=rt.getValue();if(it!==null){for(var ot=[],lt=[],ft=-1,ct=0;ct<it.length;ct++)if(it[ct].status!==st.SENT_NEEDS_ABORT){if(it[ct].status===st.SENT)e.assert(ft===ct-1,"All SENT items should be at beginning of queue."),ft=ct,it[ct].status=st.SENT_NEEDS_ABORT,it[ct].abortReason="set";else if(e.assert(it[ct].status===st.RUN,"Unexpected transaction status in abort"),it[ct].unwatcher(),lt=lt.concat(this.serverSyncTree_.ackUserWrite(it[ct].currentWriteId,!0)),it[ct].onComplete){var pt=null;ot.push(it[ct].onComplete.bind(null,new Error("set"),!1,pt))}}ft===-1?rt.setValue(null):it.length=ft+1,this.eventQueue_.raiseEventsForChangedPath(rt.path(),lt);for(var ct=0;ct<ot.length;ct++)_.exceptionGuard(ot[ct])}}}(Repo_transaction)),Repo_transaction}var hasRequiredRepoManager;function requireRepoManager(){if(hasRequiredRepoManager)return RepoManager;hasRequiredRepoManager=1,Object.defineProperty(RepoManager,"__esModule",{value:!0});var i=cjs$1,e=requireRepo(),o=util,s=parser,f=validation;requireRepo_transaction();var d="databaseURL",m,_=function(){function $(){this.repos_={},this.useRestClient_=!1}return $.getInstance=function(){return m||(m=new $),m},$.prototype.interrupt=function(){for(var G in this.repos_)for(var Z in this.repos_[G])this.repos_[G][Z].interrupt()},$.prototype.resume=function(){for(var G in this.repos_)for(var Z in this.repos_[G])this.repos_[G][Z].resume()},$.prototype.databaseFromApp=function(G,Z){var et=Z||G.options[d];et===void 0&&o.fatal("Can't determine Firebase Database URL.  Be sure to include "+d+" option when calling firebase.initializeApp().");var tt=s.parseRepoInfo(et),nt=tt.repoInfo;f.validateUrl("Invalid Firebase Database URL",1,tt),tt.path.isEmpty()||o.fatal("Database URL must point to the root of a Firebase Database (not including a child path).");var st=this.createRepo(nt,G);return st.database},$.prototype.deleteRepo=function(G){var Z=i.safeGet(this.repos_,G.app.name);(!Z||i.safeGet(Z,G.repoInfo_.toURLString())!==G)&&o.fatal("Database "+G.app.name+"("+G.repoInfo_+") has already been deleted."),G.interrupt(),delete Z[G.repoInfo_.toURLString()]},$.prototype.createRepo=function(G,Z){var et=i.safeGet(this.repos_,Z.name);et||(et={},this.repos_[Z.name]=et);var tt=i.safeGet(et,G.toURLString());return tt&&o.fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),tt=new e.Repo(G,this.useRestClient_,Z),et[G.toURLString()]=tt,tt},$.prototype.forceRestClient=function(G){this.useRestClient_=G},$}();return RepoManager.RepoManager=_,RepoManager}var hasRequiredDatabase;function requireDatabase(){if(hasRequiredDatabase)return Database;hasRequiredDatabase=1,Object.defineProperty(Database,"__esModule",{value:!0});var i=tslib.exports,e=util,o=parser,s=Path$2,f=requireReference(),d=requireRepo(),m=requireRepoManager(),_=cjs$1,$=validation,G=function(){function et(tt){this.repo_=tt,tt instanceof d.Repo||e.fatal("Don't call new Database() directly - please use firebase.database()."),this.root_=new f.Reference(tt,s.Path.Empty),this.INTERNAL=new Z(this)}return Object.defineProperty(et.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),et.prototype.ref=function(tt){return this.checkDeleted_("ref"),_.validateArgCount("database.ref",0,1,arguments.length),tt instanceof f.Reference?this.refFromURL(tt.toString()):tt!==void 0?this.root_.child(tt):this.root_},et.prototype.refFromURL=function(tt){var nt="database.refFromURL";this.checkDeleted_(nt),_.validateArgCount(nt,1,1,arguments.length);var st=o.parseRepoInfo(tt);$.validateUrl(nt,1,st);var rt=st.repoInfo;return rt.host!==this.repo_.repoInfo_.host&&e.fatal(nt+": Host name does not match the current database: (found "+rt.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(st.path.toString())},et.prototype.checkDeleted_=function(tt){this.repo_===null&&e.fatal("Cannot call "+tt+" on a deleted database.")},et.prototype.goOffline=function(){_.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},et.prototype.goOnline=function(){_.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},et.ServerValue={TIMESTAMP:{".sv":"timestamp"}},et}();Database.Database=G;var Z=function(){function et(tt){this.database=tt}return et.prototype.delete=function(){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(tt){return this.database.checkDeleted_("delete"),m.RepoManager.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},et}();return Database.DatabaseInternals=Z,Database}var internal={};Object.defineProperty(internal,"__esModule",{value:!0});var WebSocketConnection_1=WebSocketConnection$1,BrowserPollConnection_1=BrowserPollConnection;internal.forceLongPolling=function(){WebSocketConnection_1.WebSocketConnection.forceDisallow(),BrowserPollConnection_1.BrowserPollConnection.forceAllow()};internal.forceWebSockets=function(){BrowserPollConnection_1.BrowserPollConnection.forceDisallow()};internal.isWebSocketsAvailable=function(){return WebSocketConnection_1.WebSocketConnection.isAvailable()};internal.setSecurityDebugCallback=function(i,e){i.repo.persistentConnection_.securityDebugCallback_=e};internal.stats=function(i,e){i.repo.stats(e)};internal.statsIncrementCounter=function(i,e){i.repo.statsIncrementCounter(e)};internal.dataUpdateCount=function(i){return i.repo.dataUpdateCount};internal.interceptServerData=function(i,e){return i.repo.interceptServerData_(e)};var test_access={};Object.defineProperty(test_access,"__esModule",{value:!0});var RepoInfo_1=RepoInfo$1,PersistentConnection_1=PersistentConnection$1,RepoManager_1=requireRepoManager(),Connection_1=Connection$1;test_access.DataConnection=PersistentConnection_1.PersistentConnection;PersistentConnection_1.PersistentConnection.prototype.simpleListen=function(i,e){this.sendRequest("q",{p:i},e)};PersistentConnection_1.PersistentConnection.prototype.echo=function(i,e){this.sendRequest("echo",{d:i},e)};test_access.RealTimeConnection=Connection_1.Connection;test_access.hijackHash=function(i){var e=PersistentConnection_1.PersistentConnection.prototype.put;return PersistentConnection_1.PersistentConnection.prototype.put=function(o,s,f,d){d!==void 0&&(d=i()),e.call(this,o,s,f,d)},function(){PersistentConnection_1.PersistentConnection.prototype.put=e}};test_access.ConnectionTarget=RepoInfo_1.RepoInfo;test_access.queryIdentifier=function(i){return i.queryIdentifier()};test_access.listens=function(i){return i.repo.persistentConnection_.listens_};test_access.forceRestClient=function(i){RepoManager_1.RepoManager.getInstance().forceRestClient(i)};(function(i,e){Object.defineProperty(e,"__esModule",{value:!0});var o=require$$0,s=requireDatabase();e.Database=s.Database;var f=Query$3;e.Query=f.Query;var d=requireReference();e.Reference=d.Reference;var m=util;e.enableLogging=m.enableLogging;var _=requireRepoManager(),$=internal,G=test_access,Z=cjs$1,et=s.Database.ServerValue;e.ServerValue=et;function tt(rt){var it=rt.INTERNAL.registerService("database",function(ot,lt,ft){return _.RepoManager.getInstance().databaseFromApp(ot,ft)},{Reference:d.Reference,Query:f.Query,Database:s.Database,enableLogging:m.enableLogging,INTERNAL:$,ServerValue:et,TEST_ACCESS:G},null,!0);Z.isNodeSdk()&&(i.exports=it)}e.registerDatabase=tt,tt(o.default);var nt=requireDataSnapshot();e.DataSnapshot=nt.DataSnapshot;var st=onDisconnect;e.OnDisconnect=st.OnDisconnect})(cjs,cjs.exports);(function(i){i.exports=cjs.exports})(database);var CODES={AVAILABLE_IN_WINDOW:"only-available-in-window",AVAILABLE_IN_SW:"only-available-in-sw",SHOULD_BE_INHERITED:"should-be-overriden",BAD_SENDER_ID:"bad-sender-id",INCORRECT_GCM_SENDER_ID:"incorrect-gcm-sender-id",PERMISSION_DEFAULT:"permission-default",PERMISSION_BLOCKED:"permission-blocked",UNSUPPORTED_BROWSER:"unsupported-browser",NOTIFICATIONS_BLOCKED:"notifications-blocked",FAILED_DEFAULT_REGISTRATION:"failed-serviceworker-registration",SW_REGISTRATION_EXPECTED:"sw-registration-expected",GET_SUBSCRIPTION_FAILED:"get-subscription-failed",INVALID_SAVED_TOKEN:"invalid-saved-token",SW_REG_REDUNDANT:"sw-reg-redundant",TOKEN_SUBSCRIBE_FAILED:"token-subscribe-failed",TOKEN_SUBSCRIBE_NO_TOKEN:"token-subscribe-no-token",TOKEN_SUBSCRIBE_NO_PUSH_SET:"token-subscribe-no-push-set",TOKEN_UNSUBSCRIBE_FAILED:"token-unsubscribe-failed",TOKEN_UPDATE_FAILED:"token-update-failed",TOKEN_UPDATE_NO_TOKEN:"token-update-no-token",USE_SW_BEFORE_GET_TOKEN:"use-sw-before-get-token",INVALID_DELETE_TOKEN:"invalid-delete-token",DELETE_TOKEN_NOT_FOUND:"delete-token-not-found",DELETE_SCOPE_NOT_FOUND:"delete-scope-not-found",BG_HANDLER_FUNCTION_EXPECTED:"bg-handler-function-expected",NO_WINDOW_CLIENT_TO_MSG:"no-window-client-to-msg",UNABLE_TO_RESUBSCRIBE:"unable-to-resubscribe",NO_FCM_TOKEN_FOR_RESUBSCRIBE:"no-fcm-token-for-resubscribe",FAILED_TO_DELETE_TOKEN:"failed-to-delete-token",NO_SW_IN_REG:"no-sw-in-reg",BAD_SCOPE:"bad-scope",BAD_VAPID_KEY:"bad-vapid-key",BAD_SUBSCRIPTION:"bad-subscription",BAD_TOKEN:"bad-token",BAD_PUSH_SET:"bad-push-set",FAILED_DELETE_VAPID_KEY:"failed-delete-vapid-key",INVALID_PUBLIC_VAPID_KEY:"invalid-public-vapid-key",USE_PUBLIC_KEY_BEFORE_GET_TOKEN:"use-public-key-before-get-token",PUBLIC_KEY_DECRYPTION_FAILED:"public-vapid-key-decryption-failed"},ERROR_MAP=(_a={},_a[CODES.AVAILABLE_IN_WINDOW]="This method is available in a Window context.",_a[CODES.AVAILABLE_IN_SW]="This method is available in a service worker context.",_a[CODES.SHOULD_BE_INHERITED]="This method should be overriden by extended classes.",_a[CODES.BAD_SENDER_ID]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",_a[CODES.PERMISSION_DEFAULT]="The required permissions were not granted and dismissed instead.",_a[CODES.PERMISSION_BLOCKED]="The required permissions were not granted and blocked instead.",_a[CODES.UNSUPPORTED_BROWSER]="This browser doesn't support the API's required to use the firebase SDK.",_a[CODES.NOTIFICATIONS_BLOCKED]="Notifications have been blocked.",_a[CODES.FAILED_DEFAULT_REGISTRATION]="We are unable to register the default service worker. {$browserErrorMessage}",_a[CODES.SW_REGISTRATION_EXPECTED]="A service worker registration was the expected input.",_a[CODES.GET_SUBSCRIPTION_FAILED]="There was an error when trying to get any existing Push Subscriptions.",_a[CODES.INVALID_SAVED_TOKEN]="Unable to access details of the saved token.",_a[CODES.SW_REG_REDUNDANT]="The service worker being used for push was made redundant.",_a[CODES.TOKEN_SUBSCRIBE_FAILED]="A problem occured while subscribing the user to FCM: {$message}",_a[CODES.TOKEN_SUBSCRIBE_NO_TOKEN]="FCM returned no token when subscribing the user to push.",_a[CODES.TOKEN_SUBSCRIBE_NO_PUSH_SET]="FCM returned an invalid response when getting an FCM token.",_a[CODES.TOKEN_UNSUBSCRIBE_FAILED]="A problem occured while unsubscribing the user from FCM: {$message}",_a[CODES.TOKEN_UPDATE_FAILED]="A problem occured while updating the user from FCM: {$message}",_a[CODES.TOKEN_UPDATE_NO_TOKEN]="FCM returned no token when updating the user to push.",_a[CODES.USE_SW_BEFORE_GET_TOKEN]="You must call useServiceWorker() before calling getToken() to ensure your service worker is used.",_a[CODES.INVALID_DELETE_TOKEN]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",_a[CODES.DELETE_TOKEN_NOT_FOUND]="The deletion attempt for token could not be performed as the token was not found.",_a[CODES.DELETE_SCOPE_NOT_FOUND]="The deletion attempt for service worker scope could not be performed as the scope was not found.",_a[CODES.BG_HANDLER_FUNCTION_EXPECTED]="The input to setBackgroundMessageHandler() must be a function.",_a[CODES.NO_WINDOW_CLIENT_TO_MSG]="An attempt was made to message a non-existant window client.",_a[CODES.UNABLE_TO_RESUBSCRIBE]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",_a[CODES.NO_FCM_TOKEN_FOR_RESUBSCRIBE]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",_a[CODES.FAILED_TO_DELETE_TOKEN]="Unable to delete the currently saved token.",_a[CODES.NO_SW_IN_REG]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",_a[CODES.INCORRECT_GCM_SENDER_ID]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",_a[CODES.BAD_SCOPE]="The service worker scope must be a string with at least one character.",_a[CODES.BAD_VAPID_KEY]="The public VAPID key is not a Uint8Array with 65 bytes.",_a[CODES.BAD_SUBSCRIPTION]="The subscription must be a valid PushSubscription.",_a[CODES.BAD_TOKEN]="The FCM Token used for storage / lookup was not a valid token string.",_a[CODES.BAD_PUSH_SET]="The FCM push set used for storage / lookup was not not a valid push set string.",_a[CODES.FAILED_DELETE_VAPID_KEY]="The VAPID key could not be deleted.",_a[CODES.INVALID_PUBLIC_VAPID_KEY]="The public VAPID key must be a string.",_a[CODES.PUBLIC_KEY_DECRYPTION_FAILED]="The public VAPID key did not equal 65 bytes when decrypted.",_a);const Errors={codes:CODES,map:ERROR_MAP};var _a,DBInterface=function(){function i(e,o){this.errorFactory_=new ErrorFactory("messaging","Messaging",Errors.map),this.DB_NAME_=e,this.dbVersion_=o,this.openDbPromise_=null,this.TRANSACTION_READ_WRITE="readwrite"}return i.prototype.openDatabase=function(){var e=this;return this.openDbPromise_?this.openDbPromise_:(this.openDbPromise_=new Promise(function(o,s){var f=indexedDB.open(e.DB_NAME_,e.dbVersion_);f.onerror=function(d){s(d.target.error)},f.onsuccess=function(d){o(d.target.result)},f.onupgradeneeded=function(d){try{var m=d.target.result;e.onDBUpgrade(m,d)}catch(_){m.close(),s(_)}}}),this.openDbPromise_)},i.prototype.closeDatabase=function(){var e=this;return Promise.resolve().then(function(){if(e.openDbPromise_)return e.openDbPromise_.then(function(o){o.close(),e.openDbPromise_=null})})},i.prototype.onDBUpgrade=function(e,o){throw this.errorFactory_.create(Errors.codes.SHOULD_BE_INHERITED)},i}();function toBase64(i){var e=new Uint8Array(i);return window.btoa(String.fromCharCode.apply(null,e))}const arrayBufferToBase64=function(i){var e=toBase64(i);return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};var DEFAULT_PUBLIC_VAPID_KEY=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),SUBSCRIPTION_DETAILS={userVisibleOnly:!0,applicationServerKey:DEFAULT_PUBLIC_VAPID_KEY};const FCMDetails={DEFAULT_PUBLIC_VAPID_KEY,SUBSCRIPTION_DETAILS,ENDPOINT:"https://fcm.googleapis.com"};var IIDModel=function(){function i(){this.errorFactory_=new ErrorFactory("messaging","Messaging",Errors.map)}return i.prototype.getToken=function(e,o,s){var f=this,d=arrayBufferToBase64(o.getKey("p256dh")),m=arrayBufferToBase64(o.getKey("auth")),_="authorized_entity="+e+"&"+("endpoint="+o.endpoint+"&")+("encryption_key="+d+"&")+("encryption_auth="+m);if(s!==FCMDetails.DEFAULT_PUBLIC_VAPID_KEY){var $=arrayBufferToBase64(s);_+="&application_pub_key="+$}var G=new Headers;G.append("Content-Type","application/x-www-form-urlencoded");var Z={method:"POST",headers:G,body:_};return fetch(FCMDetails.ENDPOINT+"/fcm/connect/subscribe",Z).then(function(et){return et.json()}).catch(function(){throw f.errorFactory_.create(Errors.codes.TOKEN_SUBSCRIBE_FAILED)}).then(function(et){var tt=et;if(tt.error){var nt=tt.error.message;throw f.errorFactory_.create(Errors.codes.TOKEN_SUBSCRIBE_FAILED,{message:nt})}if(!tt.token)throw f.errorFactory_.create(Errors.codes.TOKEN_SUBSCRIBE_NO_TOKEN);if(!tt.pushSet)throw f.errorFactory_.create(Errors.codes.TOKEN_SUBSCRIBE_NO_PUSH_SET);return{token:tt.token,pushSet:tt.pushSet}})},i.prototype.updateToken=function(e,o,s,f,d){var m=this,_=arrayBufferToBase64(f.getKey("p256dh")),$=arrayBufferToBase64(f.getKey("auth")),G="push_set="+s+"&"+("token="+o+"&")+("authorized_entity="+e+"&")+("endpoint="+f.endpoint+"&")+("encryption_key="+_+"&")+("encryption_auth="+$);if(d!==FCMDetails.DEFAULT_PUBLIC_VAPID_KEY){var Z=arrayBufferToBase64(d);G+="&application_pub_key="+Z}var et=new Headers;et.append("Content-Type","application/x-www-form-urlencoded");var tt={method:"POST",headers:et,body:G},nt;return fetch(FCMDetails.ENDPOINT+"/fcm/connect/subscribe",tt).then(function(st){return nt=st,st.json()}).catch(function(){throw m.errorFactory_.create(Errors.codes.TOKEN_UPDATE_FAILED)}).then(function(st){if(!nt.ok){var rt=st.error.message;throw m.errorFactory_.create(Errors.codes.TOKEN_UPDATE_FAILED,{message:rt})}if(!st.token)throw m.errorFactory_.create(Errors.codes.TOKEN_UPDATE_NO_TOKEN);return st.token})},i.prototype.deleteToken=function(e,o,s){var f=this,d="authorized_entity="+e+"&"+("token="+o+"&")+("pushSet="+s),m=new Headers;m.append("Content-Type","application/x-www-form-urlencoded");var _={method:"POST",headers:m,body:d};return fetch(FCMDetails.ENDPOINT+"/fcm/connect/unsubscribe",_).then(function($){if(!$.ok)return $.json().then(function(G){if(G.error){var Z=G.error.message;throw f.errorFactory_.create(Errors.codes.TOKEN_UNSUBSCRIBE_FAILED,{message:Z})}},function(G){throw f.errorFactory_.create(Errors.codes.TOKEN_UNSUBSCRIBE_FAILED)})})},i}(),OLD_DB_NAME="undefined",OLD_OBJECT_STORE_NAME="fcm_token_object_Store";function handleDb(i){if(!!i.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)){var e=i.transaction(OLD_OBJECT_STORE_NAME),o=e.objectStore(OLD_OBJECT_STORE_NAME),s=new IIDModel,f=o.openCursor();f.onerror=function(d){console.warn("Unable to cleanup old IDB.",d)},f.onsuccess=function(){var d=f.result;if(d){var m=d.value;s.deleteToken(m.fcmSenderId,m.fcmToken,m.fcmPushSet),d.continue()}else i.close(),indexedDB.deleteDatabase(OLD_DB_NAME)}}}function cleanV1(){var i=indexedDB.open(OLD_DB_NAME);i.onerror=function(e){},i.onsuccess=function(e){var o=i.result;handleDb(o)}}var FCM_TOKEN_OBJ_STORE="fcm_token_object_Store",DB_NAME$1="fcm_token_details_db",DB_VERSION$1=2,TokenDetailsModel=function(i){tslib.exports.__extends(e,i);function e(){return i.call(this,DB_NAME$1,DB_VERSION$1)||this}return e.prototype.onDBUpgrade=function(o,s){if(s.oldVersion<1){var f=o.createObjectStore(FCM_TOKEN_OBJ_STORE,{keyPath:"swScope"});f.createIndex("fcmSenderId","fcmSenderId",{unique:!1}),f.createIndex("fcmToken","fcmToken",{unique:!0})}s.oldVersion<2&&cleanV1()},e.prototype.validateInputs_=function(o){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(s){return o.fcmToken&&(typeof o.fcmToken!="string"||o.fcmToken.length===0)?[2,Promise.reject(this.errorFactory_.create(Errors.codes.BAD_TOKEN))]:o.swScope&&(typeof o.swScope!="string"||o.swScope.length===0)?[2,Promise.reject(this.errorFactory_.create(Errors.codes.BAD_SCOPE))]:o.vapidKey&&(!(o.vapidKey instanceof Uint8Array)||o.vapidKey.length!==65)?[2,Promise.reject(this.errorFactory_.create(Errors.codes.BAD_VAPID_KEY))]:o.subscription&&!(o.subscription instanceof PushSubscription)?[2,Promise.reject(this.errorFactory_.create(Errors.codes.BAD_SUBSCRIPTION))]:o.fcmSenderId&&(typeof o.fcmSenderId!="string"||o.fcmSenderId.length===0)?[2,Promise.reject(this.errorFactory_.create(Errors.codes.BAD_SENDER_ID))]:o.fcmPushSet&&(typeof o.fcmPushSet!="string"||o.fcmPushSet.length===0)?[2,Promise.reject(this.errorFactory_.create(Errors.codes.BAD_PUSH_SET))]:[2]})})},e.prototype.getTokenDetailsFromToken=function(o){var s=this;return o?this.validateInputs_({fcmToken:o}).then(function(){return s.openDatabase()}).then(function(f){return new Promise(function(d,m){var _=f.transaction([FCM_TOKEN_OBJ_STORE]),$=_.objectStore(FCM_TOKEN_OBJ_STORE),G=$.index("fcmToken"),Z=G.get(o);Z.onerror=function(et){m(et.target.error)},Z.onsuccess=function(et){var tt=et.target.result?et.target.result:null;d(tt)}})}):Promise.reject(this.errorFactory_.create(Errors.codes.BAD_TOKEN))},e.prototype.getTokenDetailsFromSWScope=function(o){var s=this;return o?this.validateInputs_({swScope:o}).then(function(){return s.openDatabase()}).then(function(f){return new Promise(function(d,m){var _=f.transaction([FCM_TOKEN_OBJ_STORE]),$=_.objectStore(FCM_TOKEN_OBJ_STORE),G=$.get(o);G.onerror=function(Z){m(Z.target.error)},G.onsuccess=function(Z){var et=Z.target.result?Z.target.result:null;d(et)}})}):Promise.reject(this.errorFactory_.create(Errors.codes.BAD_SCOPE))},e.prototype.saveTokenDetails=function(o){var s=this,f=o.swScope,d=o.vapidKey,m=o.subscription,_=o.fcmSenderId,$=o.fcmToken,G=o.fcmPushSet;return f?d?m?_?$?G?this.validateInputs_({swScope:f,vapidKey:d,subscription:m,fcmSenderId:_,fcmToken:$,fcmPushSet:G}).then(function(){return s.openDatabase()}).then(function(Z){var et={swScope:f,vapidKey:arrayBufferToBase64(d),endpoint:m.endpoint,auth:arrayBufferToBase64(m.getKey("auth")),p256dh:arrayBufferToBase64(m.getKey("p256dh")),fcmSenderId:_,fcmToken:$,fcmPushSet:G,createTime:Date.now()};return new Promise(function(tt,nt){var st=Z.transaction([FCM_TOKEN_OBJ_STORE],s.TRANSACTION_READ_WRITE),rt=st.objectStore(FCM_TOKEN_OBJ_STORE),it=rt.put(et);it.onerror=function(ot){nt(ot.target.error)},it.onsuccess=function(ot){tt()}})}):Promise.reject(this.errorFactory_.create(Errors.codes.BAD_PUSH_SET)):Promise.reject(this.errorFactory_.create(Errors.codes.BAD_TOKEN)):Promise.reject(this.errorFactory_.create(Errors.codes.BAD_SENDER_ID)):Promise.reject(this.errorFactory_.create(Errors.codes.BAD_SUBSCRIPTION)):Promise.reject(this.errorFactory_.create(Errors.codes.BAD_VAPID_KEY)):Promise.reject(this.errorFactory_.create(Errors.codes.BAD_SCOPE))},e.prototype.deleteToken=function(o){var s=this;return typeof o!="string"||o.length===0?Promise.reject(this.errorFactory_.create(Errors.codes.INVALID_DELETE_TOKEN)):this.getTokenDetailsFromToken(o).then(function(f){if(!f)throw s.errorFactory_.create(Errors.codes.DELETE_TOKEN_NOT_FOUND);return s.openDatabase().then(function(d){return new Promise(function(m,_){var $=d.transaction([FCM_TOKEN_OBJ_STORE],s.TRANSACTION_READ_WRITE),G=$.objectStore(FCM_TOKEN_OBJ_STORE),Z=G.delete(f.swScope);Z.onerror=function(et){_(et.target.error)},Z.onsuccess=function(et){if(et.target.result===0){_(s.errorFactory_.create(Errors.codes.FAILED_TO_DELETE_TOKEN));return}m(f)}})})})},e}(DBInterface),FCM_VAPID_OBJ_STORE="fcm_vapid_object_Store",DB_NAME="fcm_vapid_details_db",DB_VERSION=1,UNCOMPRESSED_PUBLIC_KEY_SIZE=65,VapidDetailsModel=function(i){tslib.exports.__extends(e,i);function e(){return i.call(this,DB_NAME,DB_VERSION)||this}return e.prototype.onDBUpgrade=function(o){o.createObjectStore(FCM_VAPID_OBJ_STORE,{keyPath:"swScope"})},e.prototype.getVapidFromSWScope=function(o){return typeof o!="string"||o.length===0?Promise.reject(this.errorFactory_.create(Errors.codes.BAD_SCOPE)):this.openDatabase().then(function(s){return new Promise(function(f,d){var m=s.transaction([FCM_VAPID_OBJ_STORE]),_=m.objectStore(FCM_VAPID_OBJ_STORE),$=_.get(o);$.onerror=function(){d($.error)},$.onsuccess=function(){var G=$.result,Z=null;G&&(Z=G.vapidKey),f(Z)}})})},e.prototype.saveVapidDetails=function(o,s){var f=this;if(typeof o!="string"||o.length===0)return Promise.reject(this.errorFactory_.create(Errors.codes.BAD_SCOPE));if(s===null||s.length!==UNCOMPRESSED_PUBLIC_KEY_SIZE)return Promise.reject(this.errorFactory_.create(Errors.codes.BAD_VAPID_KEY));var d={swScope:o,vapidKey:s};return this.openDatabase().then(function(m){return new Promise(function(_,$){var G=m.transaction([FCM_VAPID_OBJ_STORE],f.TRANSACTION_READ_WRITE),Z=G.objectStore(FCM_VAPID_OBJ_STORE),et=Z.put(d);et.onerror=function(){$(et.error)},et.onsuccess=function(){_()}})})},e.prototype.deleteVapidDetails=function(o){var s=this;return this.getVapidFromSWScope(o).then(function(f){if(!f)throw s.errorFactory_.create(Errors.codes.DELETE_SCOPE_NOT_FOUND);return s.openDatabase().then(function(d){return new Promise(function(m,_){var $=d.transaction([FCM_VAPID_OBJ_STORE],s.TRANSACTION_READ_WRITE),G=$.objectStore(FCM_VAPID_OBJ_STORE),Z=G.delete(o);Z.onerror=function(){_(Z.error)},Z.onsuccess=function(){if(Z.result===0){_(s.errorFactory_.create(Errors.codes.FAILED_DELETE_VAPID_KEY));return}m(f)}})})})},e}(DBInterface);const NOTIFICATION_PERMISSION={granted:"granted",default:"default",denied:"denied"};var SENDER_ID_OPTION_NAME="messagingSenderId",TOKEN_EXPIRATION_MILLIS=7*24*60*60*1e3,ControllerInterface=function(){function i(e){var o=this;if(this.errorFactory_=new ErrorFactory("messaging","Messaging",Errors.map),!e.options[SENDER_ID_OPTION_NAME]||typeof e.options[SENDER_ID_OPTION_NAME]!="string")throw this.errorFactory_.create(Errors.codes.BAD_SENDER_ID);this.messagingSenderId_=e.options[SENDER_ID_OPTION_NAME],this.tokenDetailsModel_=new TokenDetailsModel,this.vapidDetailsModel_=new VapidDetailsModel,this.iidModel_=new IIDModel,this.app=e,this.INTERNAL={},this.INTERNAL.delete=function(){return o.delete()}}return i.prototype.getToken=function(){var e=this,o=this.getNotificationPermission_();if(o!==NOTIFICATION_PERMISSION.granted)return o===NOTIFICATION_PERMISSION.denied?Promise.reject(this.errorFactory_.create(Errors.codes.NOTIFICATIONS_BLOCKED)):Promise.resolve(null);var s;return this.getSWRegistration_().then(function(f){return s=f,e.tokenDetailsModel_.getTokenDetailsFromSWScope(s.scope)}).then(function(f){return f?e.manageExistingToken(f,s):e.getNewToken(s)})},i.prototype.manageExistingToken=function(e,o){var s=this;return this.isTokenStillValid(e).then(function(f){if(f){var d=Date.now();return d<e.createTime+TOKEN_EXPIRATION_MILLIS?e.fcmToken:s.updateToken(e,o)}else return s.deleteToken(e.fcmToken).then(function(){return s.getNewToken(o)})})},i.prototype.isTokenStillValid=function(e){return this.getPublicVapidKey_().then(function(o){return arrayBufferToBase64(o)===e.vapidKey})},i.prototype.updateToken=function(e,o){var s=this,f,d,m;return this.getPublicVapidKey_().then(function(_){return f=_,s.getPushSubscription_(o,f)}).then(function(_){return m=_,s.iidModel_.updateToken(s.messagingSenderId_,e.fcmToken,e.fcmPushSet,m,f)}).catch(function(_){return s.deleteToken(e.fcmToken).then(function(){throw _})}).then(function(_){d=_;var $={swScope:o.scope,vapidKey:f,subscription:m,fcmSenderId:s.messagingSenderId_,fcmToken:d,fcmPushSet:e.fcmPushSet};return s.tokenDetailsModel_.saveTokenDetails($)}).then(function(){return s.vapidDetailsModel_.saveVapidDetails(o.scope,f)}).then(function(){return d})},i.prototype.getNewToken=function(e){var o=this,s,f,d;return this.getPublicVapidKey_().then(function(m){return s=m,o.getPushSubscription_(e,s)}).then(function(m){return f=m,o.iidModel_.getToken(o.messagingSenderId_,f,s)}).then(function(m){d=m;var _={swScope:e.scope,vapidKey:s,subscription:f,fcmSenderId:o.messagingSenderId_,fcmToken:d.token,fcmPushSet:d.pushSet};return o.tokenDetailsModel_.saveTokenDetails(_)}).then(function(){return o.vapidDetailsModel_.saveVapidDetails(e.scope,s)}).then(function(){return d.token})},i.prototype.deleteToken=function(e){var o=this;return this.tokenDetailsModel_.deleteToken(e).then(function(s){return o.iidModel_.deleteToken(s.fcmSenderId,s.fcmToken,s.fcmPushSet)}).then(function(){return o.getSWRegistration_().then(function(s){if(s)return s.pushManager.getSubscription()}).then(function(s){if(s)return s.unsubscribe()})})},i.prototype.getSWRegistration_=function(){throw this.errorFactory_.create(Errors.codes.SHOULD_BE_INHERITED)},i.prototype.getPublicVapidKey_=function(){throw this.errorFactory_.create(Errors.codes.SHOULD_BE_INHERITED)},i.prototype.requestPermission=function(){throw this.errorFactory_.create(Errors.codes.AVAILABLE_IN_WINDOW)},i.prototype.getPushSubscription_=function(e,o){throw this.errorFactory_.create(Errors.codes.AVAILABLE_IN_WINDOW)},i.prototype.useServiceWorker=function(e){throw this.errorFactory_.create(Errors.codes.AVAILABLE_IN_WINDOW)},i.prototype.usePublicVapidKey=function(e){throw this.errorFactory_.create(Errors.codes.AVAILABLE_IN_WINDOW)},i.prototype.onMessage=function(e,o,s){throw this.errorFactory_.create(Errors.codes.AVAILABLE_IN_WINDOW)},i.prototype.onTokenRefresh=function(e,o,s){throw this.errorFactory_.create(Errors.codes.AVAILABLE_IN_WINDOW)},i.prototype.setBackgroundMessageHandler=function(e){throw this.errorFactory_.create(Errors.codes.AVAILABLE_IN_SW)},i.prototype.delete=function(){return Promise.all([this.tokenDetailsModel_.closeDatabase(),this.vapidDetailsModel_.closeDatabase()])},i.prototype.getNotificationPermission_=function(){return Notification.permission},i.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel_},i.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel_},i.prototype.getIIDModel=function(){return this.iidModel_},i}(),PARAMS={TYPE_OF_MSG:"firebase-messaging-msg-type",DATA:"firebase-messaging-msg-data"},msgType={PUSH_MSG_RECEIVED:"push-msg-received",NOTIFICATION_CLICKED:"notification-clicked"},createNewMsg=function(i,e){var o=(s={},s[PARAMS.TYPE_OF_MSG]=i,s[PARAMS.DATA]=e,s);return o;var s};const WorkerPageMessage={PARAMS,TYPES_OF_MSG:msgType,createNewMsg},DefaultSW={path:"/firebase-messaging-sw.js",scope:"/firebase-cloud-messaging-push-scope"},base64ToArrayBuffer=function(i){for(var e="=".repeat((4-i.length%4)%4),o=(i+e).replace(/\-/g,"+").replace(/_/g,"/"),s=window.atob(o),f=new Uint8Array(s.length),d=0;d<s.length;++d)f[d]=s.charCodeAt(d);return f};var WindowController=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this,o)||this;return s.messageObserver_=null,s.onMessage_=createSubscribe(function(f){s.messageObserver_=f}),s.tokenRefreshObserver_=null,s.onTokenRefresh_=createSubscribe(function(f){s.tokenRefreshObserver_=f}),s.registrationToUse_,s.manifestCheckPromise_,s.messageObserver_=null,s.onMessage_=createSubscribe(function(f){s.messageObserver_=f}),s.tokenRefreshObserver_=null,s.onTokenRefresh_=createSubscribe(function(f){s.tokenRefreshObserver_=f}),s.setupSWMessageListener_(),s}return e.prototype.getToken=function(){var o=this;return this.isSupported_()?this.manifestCheck_().then(function(){return i.prototype.getToken.call(o)}):Promise.reject(this.errorFactory_.create(Errors.codes.UNSUPPORTED_BROWSER))},e.prototype.manifestCheck_=function(){var o=this;if(this.manifestCheckPromise_)return this.manifestCheckPromise_;var s=document.querySelector('link[rel="manifest"]');return s?this.manifestCheckPromise_=fetch(s.href).then(function(f){return f.json()}).catch(function(){}).then(function(f){if(!!f&&!!f.gcm_sender_id&&f.gcm_sender_id!=="103953800507")throw o.errorFactory_.create(Errors.codes.INCORRECT_GCM_SENDER_ID)}):this.manifestCheckPromise_=Promise.resolve(),this.manifestCheckPromise_},e.prototype.requestPermission=function(){return tslib.exports.__awaiter(this,void 0,void 0,function(){var o=this;return tslib.exports.__generator(this,function(s){return Notification.permission===NOTIFICATION_PERMISSION.granted?[2]:[2,new Promise(function(f,d){var m=function($){return $===NOTIFICATION_PERMISSION.granted?f():$===NOTIFICATION_PERMISSION.denied?d(o.errorFactory_.create(Errors.codes.PERMISSION_BLOCKED)):d(o.errorFactory_.create(Errors.codes.PERMISSION_DEFAULT))},_=Notification.requestPermission(m);_&&_.then(m)})]})})},e.prototype.useServiceWorker=function(o){if(!(o instanceof ServiceWorkerRegistration))throw this.errorFactory_.create(Errors.codes.SW_REGISTRATION_EXPECTED);if(typeof this.registrationToUse_<"u")throw this.errorFactory_.create(Errors.codes.USE_SW_BEFORE_GET_TOKEN);this.registrationToUse_=o},e.prototype.usePublicVapidKey=function(o){if(typeof o!="string")throw this.errorFactory_.create(Errors.codes.INVALID_PUBLIC_VAPID_KEY);if(typeof this.publicVapidKeyToUse_<"u")throw this.errorFactory_.create(Errors.codes.USE_PUBLIC_KEY_BEFORE_GET_TOKEN);var s=base64ToArrayBuffer(o);if(s.length!==65)throw this.errorFactory_.create(Errors.codes.PUBLIC_KEY_DECRYPTION_FAILED);this.publicVapidKeyToUse_=s},e.prototype.onMessage=function(o,s,f){return this.onMessage_(o,s,f)},e.prototype.onTokenRefresh=function(o,s,f){return this.onTokenRefresh_(o,s,f)},e.prototype.waitForRegistrationToActivate_=function(o){var s=this,f=o.installing||o.waiting||o.active;return new Promise(function(d,m){if(!f){m(s.errorFactory_.create(Errors.codes.NO_SW_IN_REG));return}if(f.state==="activated"){d(o);return}if(f.state==="redundant"){m(s.errorFactory_.create(Errors.codes.SW_REG_REDUNDANT));return}var _=function(){if(f.state==="activated")d(o);else if(f.state==="redundant")m(s.errorFactory_.create(Errors.codes.SW_REG_REDUNDANT));else return;f.removeEventListener("statechange",_)};f.addEventListener("statechange",_)})},e.prototype.getSWRegistration_=function(){var o=this;return this.registrationToUse_?this.waitForRegistrationToActivate_(this.registrationToUse_):(this.registrationToUse_=null,navigator.serviceWorker.register(DefaultSW.path,{scope:DefaultSW.scope}).catch(function(s){throw o.errorFactory_.create(Errors.codes.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:s.message})}).then(function(s){return o.waitForRegistrationToActivate_(s).then(function(){return o.registrationToUse_=s,s.update(),s})}))},e.prototype.getPublicVapidKey_=function(){return this.publicVapidKeyToUse_?Promise.resolve(this.publicVapidKeyToUse_):Promise.resolve(FCMDetails.DEFAULT_PUBLIC_VAPID_KEY)},e.prototype.getPushSubscription_=function(o,s){return o.pushManager.getSubscription().then(function(f){return f||o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:s})})},e.prototype.setupSWMessageListener_=function(){var o=this;"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",function(s){if(!(!s.data||!s.data[WorkerPageMessage.PARAMS.TYPE_OF_MSG])){var f=s.data;switch(f[WorkerPageMessage.PARAMS.TYPE_OF_MSG]){case WorkerPageMessage.TYPES_OF_MSG.PUSH_MSG_RECEIVED:case WorkerPageMessage.TYPES_OF_MSG.NOTIFICATION_CLICKED:var d=f[WorkerPageMessage.PARAMS.DATA];o.messageObserver_&&o.messageObserver_.next(d);break}}},!1)},e.prototype.isSupported_=function(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")},e}(ControllerInterface),FCM_MSG="FCM_MSG",SWController=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this,o)||this;return self.addEventListener("push",function(f){return s.onPush_(f)},!1),self.addEventListener("pushsubscriptionchange",function(f){return s.onSubChange_(f)},!1),self.addEventListener("notificationclick",function(f){return s.onNotificationClick_(f)},!1),s.bgMessageHandler_=null,s}return e.prototype.onPush_=function(o){var s=this,f;try{f=o.data.json()}catch{return}var d=this.hasVisibleClients_().then(function(m){if(m)return f.notification||s.bgMessageHandler_?s.sendMessageToWindowClients_(f):void 0;var _=s.getNotificationData_(f);if(_){var $=_.title||"";return s.getSWRegistration_().then(function(G){return G.showNotification($,_)})}else if(s.bgMessageHandler_)return s.bgMessageHandler_(f)});o.waitUntil(d)},e.prototype.onSubChange_=function(o){var s=this,f=this.getSWRegistration_().then(function(d){return d.pushManager.getSubscription().then(function(m){}).catch(function(m){var _=s.getTokenDetailsModel();return _.getTokenDetailsFromSWScope(d.scope).then(function($){if(!$)throw m;return s.deleteToken($.fcmToken).then(function(){throw m})})})}).catch(function(d){throw s.errorFactory_.create(Errors.codes.UNABLE_TO_RESUBSCRIBE,{message:d})});o.waitUntil(f)},e.prototype.onNotificationClick_=function(o){var s=this;if(!!(o.notification&&o.notification.data&&o.notification.data[FCM_MSG])){o.stopImmediatePropagation(),o.notification.close();var f=o.notification.data[FCM_MSG];if(!!f.notification){var d=f.notification.click_action;if(!!d){var m=this.getWindowClient_(d).then(function(_){return _?_.focus():self.clients.openWindow(d)}).then(function(_){if(!!_){f.notification,delete f.notification;var $=WorkerPageMessage.createNewMsg(WorkerPageMessage.TYPES_OF_MSG.NOTIFICATION_CLICKED,f);return s.attemptToMessageClient_(_,$)}});o.waitUntil(m)}}}},e.prototype.getNotificationData_=function(o){if(!!o&&typeof o.notification=="object"){var s=Object.assign({},o.notification);return s.data=(f={},f[FCM_MSG]=o,f),s;var f}},e.prototype.setBackgroundMessageHandler=function(o){if(!o||typeof o!="function")throw this.errorFactory_.create(Errors.codes.BG_HANDLER_FUNCTION_EXPECTED);this.bgMessageHandler_=o},e.prototype.getWindowClient_=function(o){var s=new URL(o,self.location).href;return self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(f){for(var d=null,m=0;m<f.length;m++){var _=new URL(f[m].url,self.location).href;if(_===s){d=f[m];break}}return d||null})},e.prototype.attemptToMessageClient_=function(o,s){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(f){return o?(o.postMessage(s),[2]):[2,Promise.reject(this.errorFactory_.create(Errors.codes.NO_WINDOW_CLIENT_TO_MSG))]})})},e.prototype.hasVisibleClients_=function(){return self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(o){return o.some(function(s){return s.visibilityState==="visible"})})},e.prototype.sendMessageToWindowClients_=function(o){var s=this;return self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(f){var d=WorkerPageMessage.createNewMsg(WorkerPageMessage.TYPES_OF_MSG.PUSH_MSG_RECEIVED,o);return Promise.all(f.map(function(m){return s.attemptToMessageClient_(m,d)}))})},e.prototype.getSWRegistration_=function(){return Promise.resolve(self.registration)},e.prototype.getPublicVapidKey_=function(){var o=this;return this.getSWRegistration_().then(function(s){return o.getVapidDetailsModel().getVapidFromSWScope(s.scope)}).then(function(s){return s===null?FCMDetails.DEFAULT_PUBLIC_VAPID_KEY:s})},e}(ControllerInterface);function registerMessaging(i){var e="messaging",o=function(f){return self&&"ServiceWorkerGlobalScope"in self?new SWController(f):new WindowController(f)},s={Messaging:WindowController};i.INTERNAL.registerService(e,o,s)}registerMessaging(firebase$1);var domainBase="https://firebasestorage.googleapis.com",downloadBase="https://firebasestorage.googleapis.com",apiBaseUrl="/v0",apiUploadBaseUrl="/v0",configOption="storageBucket",defaultMaxOperationRetryTime=2*60*1e3,defaultMaxUploadRetryTime=10*60*100,minSafeInteger=-9007199254740991,FirebaseStorageError=function(){function i(e,o){this.code_=prependCode(e),this.message_="Firebase Storage: "+o,this.serverResponse_=null,this.name_="FirebaseError"}return i.prototype.codeProp=function(){return this.code},i.prototype.codeEquals=function(e){return prependCode(e)===this.codeProp()},i.prototype.serverResponseProp=function(){return this.serverResponse_},i.prototype.setServerResponseProp=function(e){this.serverResponse_=e},Object.defineProperty(i.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),i}(),Code$1={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function prependCode(i){return"storage/"+i}function unknown(){var i="An unknown error occurred, please check the error payload for server response.";return new FirebaseStorageError(Code$1.UNKNOWN,i)}function objectNotFound(i){return new FirebaseStorageError(Code$1.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")}function quotaExceeded(i){return new FirebaseStorageError(Code$1.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function unauthenticated(){var i="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new FirebaseStorageError(Code$1.UNAUTHENTICATED,i)}function unauthorized(i){return new FirebaseStorageError(Code$1.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")}function retryLimitExceeded(){return new FirebaseStorageError(Code$1.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function canceled(){return new FirebaseStorageError(Code$1.CANCELED,"User canceled the upload/download.")}function invalidUrl(i){return new FirebaseStorageError(Code$1.INVALID_URL,"Invalid URL '"+i+"'.")}function invalidDefaultBucket(i){return new FirebaseStorageError(Code$1.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.")}function cannotSliceBlob(){return new FirebaseStorageError(Code$1.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function serverFileWrongSize(){return new FirebaseStorageError(Code$1.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function noDownloadURL(){return new FirebaseStorageError(Code$1.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function invalidArgument(i,e,o){return new FirebaseStorageError(Code$1.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+i+": "+o)}function invalidArgumentCount(i,e,o,s){var f,d;return i===e?(f=i,d=i===1?"argument":"arguments"):(f="between "+i+" and "+e,d="arguments"),new FirebaseStorageError(Code$1.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+o+"`: Expected "+f+" "+d+", received "+s+".")}function appDeleted(){return new FirebaseStorageError(Code$1.APP_DELETED,"The Firebase app was deleted.")}function invalidRootOperation(i){return new FirebaseStorageError(Code$1.INVALID_ROOT_OPERATION,"The operation '"+i+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function invalidFormat(i,e){return new FirebaseStorageError(Code$1.INVALID_FORMAT,"String does not match format '"+i+"': "+e)}function internalError(i){throw new FirebaseStorageError(Code$1.INTERNAL_ERROR,"Internal error: "+i)}var StringFormat={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function formatValidator(i){switch(i){case StringFormat.RAW:case StringFormat.BASE64:case StringFormat.BASE64URL:case StringFormat.DATA_URL:return;default:throw"Expected one of the event types: ["+StringFormat.RAW+", "+StringFormat.BASE64+", "+StringFormat.BASE64URL+", "+StringFormat.DATA_URL+"]."}}var StringData=function(){function i(e,o){this.data=e,this.contentType=o||null}return i}();function dataFromString(i,e){switch(i){case StringFormat.RAW:return new StringData(utf8Bytes_(e));case StringFormat.BASE64:case StringFormat.BASE64URL:return new StringData(base64Bytes_(i,e));case StringFormat.DATA_URL:return new StringData(dataURLBytes_(e),dataURLContentType_(e))}throw unknown()}function utf8Bytes_(i){for(var e=[],o=0;o<i.length;o++){var s=i.charCodeAt(o);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)==55296){var f=o<i.length-1&&(i.charCodeAt(o+1)&64512)==56320;if(!f)e.push(239,191,189);else{var d=s,m=i.charCodeAt(++o);s=65536|(d&1023)<<10|m&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}}else(s&64512)==56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function percentEncodedBytes_(i){var e;try{e=decodeURIComponent(i)}catch{throw invalidFormat(StringFormat.DATA_URL,"Malformed data URL.")}return utf8Bytes_(e)}function base64Bytes_(i,e){switch(i){case StringFormat.BASE64:{var o=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(o||s){var f=o?"-":"_";throw invalidFormat(i,"Invalid character '"+f+"' found: is it base64url encoded?")}break}case StringFormat.BASE64URL:{var d=e.indexOf("+")!==-1,m=e.indexOf("/")!==-1;if(d||m){var f=d?"+":"/";throw invalidFormat(i,"Invalid character '"+f+"' found: is it base64 encoded?")}e=e.replace(/-/g,"+").replace(/_/g,"/");break}}var _;try{_=atob(e)}catch{throw invalidFormat(i,"Invalid character found")}for(var $=new Uint8Array(_.length),G=0;G<_.length;G++)$[G]=_.charCodeAt(G);return $}var DataURLParts=function(){function i(e){this.base64=!1,this.contentType=null;var o=e.match(/^data:([^,]+)?,/);if(o===null)throw invalidFormat(StringFormat.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var s=o[1]||null;s!=null&&(this.base64=endsWith(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}return i}();function dataURLBytes_(i){var e=new DataURLParts(i);return e.base64?base64Bytes_(StringFormat.BASE64,e.rest):percentEncodedBytes_(e.rest)}function dataURLContentType_(i){var e=new DataURLParts(i);return e.contentType}function endsWith(i,e){var o=i.length>=e.length;return o?i.substring(i.length-e.length)===e:!1}var TaskEvent={STATE_CHANGED:"state_changed"},InternalTaskState={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},TaskState={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function taskStateFromInternalTaskState(i){switch(i){case InternalTaskState.RUNNING:case InternalTaskState.PAUSING:case InternalTaskState.CANCELING:return TaskState.RUNNING;case InternalTaskState.PAUSED:return TaskState.PAUSED;case InternalTaskState.SUCCESS:return TaskState.SUCCESS;case InternalTaskState.CANCELED:return TaskState.CANCELED;case InternalTaskState.ERROR:return TaskState.ERROR;default:return TaskState.ERROR}}function contains$2(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function forEach$1(i,e){for(var o in i)contains$2(i,o)&&e(o,i[o])}function clone$1(i){if(i==null)return{};var e={};return forEach$1(i,function(o,s){e[o]=s}),e}function make(i){return new Promise(i)}function resolve(i){return Promise.resolve(i)}function reject(i){return Promise.reject(i)}function isDef(i){return i!=null}function isJustDef(i){return i!==void 0}function isFunction(i){return typeof i=="function"}function isObject(i){return typeof i=="object"}function isNonNullObject(i){return isObject(i)&&i!==null}function isNonArrayObject(i){return isObject(i)&&!Array.isArray(i)}function isString(i){return typeof i=="string"||i instanceof String}function isNumber(i){return typeof i=="number"||i instanceof Number}function isNativeBlob(i){return isNativeBlobDefined()&&i instanceof Blob}function isNativeBlobDefined(){return typeof Blob<"u"}var ErrorCode;(function(i){i[i.NO_ERROR=0]="NO_ERROR",i[i.NETWORK_ERROR=1]="NETWORK_ERROR",i[i.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));var NetworkXhrIo=function(){function i(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=ErrorCode.NO_ERROR,this.sendPromise_=make(function(o,s){e.xhr_.addEventListener("abort",function(f){e.errorCode_=ErrorCode.ABORT,o(e)}),e.xhr_.addEventListener("error",function(f){e.errorCode_=ErrorCode.NETWORK_ERROR,o(e)}),e.xhr_.addEventListener("load",function(f){o(e)})})}return i.prototype.send=function(e,o,s,f){var d=this;if(this.sent_)throw internalError("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(o,e,!0),isDef(f)){var m=f;forEach$1(m,function(_,$){d.xhr_.setRequestHeader(_,$.toString())})}return isDef(s)?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_},i.prototype.getErrorCode=function(){if(!this.sent_)throw internalError("cannot .getErrorCode() before sending");return this.errorCode_},i.prototype.getStatus=function(){if(!this.sent_)throw internalError("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}},i.prototype.getResponseText=function(){if(!this.sent_)throw internalError("cannot .getResponseText() before sending");return this.xhr_.responseText},i.prototype.abort=function(){this.xhr_.abort()},i.prototype.getResponseHeader=function(e){return this.xhr_.getResponseHeader(e)},i.prototype.addUploadProgressListener=function(e){isDef(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",e)},i.prototype.removeUploadProgressListener=function(e){isDef(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",e)},i}(),XhrIoPool=function(){function i(){}return i.prototype.createXhrIo=function(){return new NetworkXhrIo},i}();function jsonObjectOrNull(i){var e;try{e=JSON.parse(i)}catch{return null}return isNonArrayObject(e)?e:null}var Location=function(){function i(e,o){this.bucket=e,this.path_=o}return Object.defineProperty(i.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),i.prototype.fullServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)},i.prototype.bucketOnlyServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"},i.makeFromBucketSpec=function(e){var o;try{o=i.makeFromUrl(e)}catch{return new i(e,"")}if(o.path==="")return o;throw invalidDefaultBucket(e)},i.makeFromUrl=function(e){var o=null,s="([A-Za-z0-9.\\-]+)";function f(ft){ft.path.charAt(ft.path.length-1)==="/"&&(ft.path_=ft.path_.slice(0,-1))}var d="(/(.*))?$",m="(/([^?#]*).*)?$",_=new RegExp("^gs://"+s+d,"i"),$={bucket:1,path:3};function G(ft){ft.path_=decodeURIComponent(ft.path)}for(var Z="v[A-Za-z0-9_]+",et=new RegExp("^https?://firebasestorage\\.googleapis\\.com/"+Z+"/b/"+s+"/o"+m,"i"),tt={bucket:1,path:3},nt=[{regex:_,indices:$,postModify:f},{regex:et,indices:tt,postModify:G}],st=0;st<nt.length;st++){var rt=nt[st],it=rt.regex.exec(e);if(it){var ot=it[rt.indices.bucket],lt=it[rt.indices.path];lt||(lt=""),o=new i(ot,lt),rt.postModify(o);break}}if(o==null)throw invalidUrl(e);return o},i}();function parent(i){if(i.length==0)return null;var e=i.lastIndexOf("/");if(e===-1)return"";var o=i.slice(0,e);return o}function child(i,e){var o=e.split("/").filter(function(s){return s.length>0}).join("/");return i.length===0?o:i+"/"+o}function lastComponent(i){var e=i.lastIndexOf("/",i.length-2);return e===-1?i:i.slice(e+1)}function makeNormalUrl(i){return domainBase+apiBaseUrl+i}function makeDownloadUrl(i){return downloadBase+apiBaseUrl+i}function makeUploadUrl(i){return domainBase+apiUploadBaseUrl+i}function makeQueryString(i){var e=encodeURIComponent,o="?";return forEach$1(i,function(s,f){var d=e(s)+"="+e(f);o=o+d+"&"}),o=o.slice(0,-1),o}function noXform_(i,e){return e}var Mapping=function(){function i(e,o,s,f){this.server=e,this.local=o||e,this.writable=!!s,this.xform=f||noXform_}return i}(),mappings_=null;function xformPath(i){var e=isString(i);return!e||i.length<2?i:(i=i,lastComponent(i))}function getMappings(){if(mappings_)return mappings_;var i=[];i.push(new Mapping("bucket")),i.push(new Mapping("generation")),i.push(new Mapping("metageneration")),i.push(new Mapping("name","fullPath",!0));function e(m,_){return xformPath(_)}var o=new Mapping("name");o.xform=e,i.push(o);function s(m,_){return isDef(_)?+_:_}var f=new Mapping("size");f.xform=s,i.push(f),i.push(new Mapping("timeCreated")),i.push(new Mapping("updated")),i.push(new Mapping("md5Hash",null,!0)),i.push(new Mapping("cacheControl",null,!0)),i.push(new Mapping("contentDisposition",null,!0)),i.push(new Mapping("contentEncoding",null,!0)),i.push(new Mapping("contentLanguage",null,!0)),i.push(new Mapping("contentType",null,!0)),i.push(new Mapping("metadata","customMetadata",!0));function d(m,_){var $=isString(_)&&_.length>0;if(!$)return[];var G=encodeURIComponent,Z=_.split(","),et=Z.map(function(tt){var nt=m.bucket,st=m.fullPath,rt="/b/"+G(nt)+"/o/"+G(st),it=makeDownloadUrl(rt),ot=makeQueryString({alt:"media",token:tt});return it+ot});return et}return i.push(new Mapping("downloadTokens","downloadURLs",!1,d)),mappings_=i,mappings_}function addRef(i,e){function o(){var s=i.bucket,f=i.fullPath,d=new Location(s,f);return e.makeStorageReference(d)}Object.defineProperty(i,"ref",{get:o})}function fromResource(i,e,o){var s={};s.type="file";for(var f=o.length,d=0;d<f;d++){var m=o[d];s[m.local]=m.xform(s,e[m.server])}return addRef(s,i),s}function fromResourceString(i,e,o){var s=jsonObjectOrNull(e);if(s===null)return null;var f=s;return fromResource(i,f,o)}function toResourceString(i,e){for(var o={},s=e.length,f=0;f<s;f++){var d=e[f];d.writable&&(o[d.server]=i[d.local])}return JSON.stringify(o)}function metadataValidator(i){var e=i&&isObject(i);if(!e)throw"Expected Metadata object.";for(var o in i){var s=i[o];if(o==="customMetadata"){if(!isObject(s))throw"Expected object for 'customMetadata' mapping."}else if(isNonNullObject(s))throw"Mapping for '"+o+"' cannot be an object."}}function validate(i,e,o){for(var s=e.length,f=e.length,d=0;d<e.length;d++)if(e[d].optional){s=d;break}var m=s<=o.length&&o.length<=f;if(!m)throw invalidArgumentCount(s,f,i,o.length);for(var d=0;d<o.length;d++)try{e[d].validator(o[d])}catch($){throw $ instanceof Error?invalidArgument(d,i,$.message):invalidArgument(d,i,$)}}var ArgSpec=function(){function i(e,o){var s=this;this.validator=function(f){s.optional&&!isJustDef(f)||e(f)},this.optional=!!o}return i}();function and_(i,e){return function(o){i(o),e(o)}}function stringSpec(i,e){function o(f){if(!isString(f))throw"Expected string."}var s;return i?s=and_(o,i):s=o,new ArgSpec(s,e)}function uploadDataSpec(){function i(e){var o=e instanceof Uint8Array||e instanceof ArrayBuffer||isNativeBlobDefined()&&e instanceof Blob;if(!o)throw"Expected Blob or File."}return new ArgSpec(i)}function metadataSpec(i){return new ArgSpec(metadataValidator,i)}function nonNegativeNumberSpec(){function i(e){var o=isNumber(e)&&e>=0;if(!o)throw"Expected a number 0 or greater."}return new ArgSpec(i)}function looseObjectSpec(i,e){function o(s){var f=s===null||isDef(s)&&s instanceof Object;if(!f)throw"Expected an Object.";i!=null&&i(s)}return new ArgSpec(o,e)}function nullFunctionSpec(i){function e(o){var s=o===null||isFunction(o);if(!s)throw"Expected a Function."}return new ArgSpec(e,i)}function getBlobBuilder(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function getBlob(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var o=getBlobBuilder();if(o!==void 0){for(var s=new o,f=0;f<i.length;f++)s.append(i[f]);return s.getBlob()}else{if(isNativeBlobDefined())return new Blob(i);throw Error("This browser doesn't seem to support creating Blobs")}}function sliceBlob(i,e,o){return i.webkitSlice?i.webkitSlice(e,o):i.mozSlice?i.mozSlice(e,o):i.slice?i.slice(e,o):null}var FbsBlob=function(){function i(e,o){var s=0,f="";isNativeBlob(e)?(this.data_=e,s=e.size,f=e.type):e instanceof ArrayBuffer?(o?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(o?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=f}return i.prototype.size=function(){return this.size_},i.prototype.type=function(){return this.type_},i.prototype.slice=function(e,o){if(isNativeBlob(this.data_)){var s=this.data_,f=sliceBlob(s,e,o);return f===null?null:new i(f)}else{var d=new Uint8Array(this.data_.buffer,e,o-e);return new i(d,!0)}},i.getBlob=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];if(isNativeBlobDefined()){var s=e.map(function($){return $ instanceof i?$.data_:$});return new i(getBlob.apply(null,s))}else{var f=e.map(function($){return isString($)?dataFromString(StringFormat.RAW,$).data:$.data_}),d=0;f.forEach(function($){d+=$.byteLength});var m=new Uint8Array(d),_=0;return f.forEach(function($){for(var G=0;G<$.length;G++)m[_++]=$[G]}),new i(m,!0)}},i.prototype.uploadData=function(){return this.data_},i}();function contains$1(i,e){return i.indexOf(e)!==-1}function clone(i){return Array.prototype.slice.call(i)}function remove(i,e){var o=i.indexOf(e);o!==-1&&i.splice(o,1)}var RequestInfo=function(){function i(e,o,s,f){this.url=e,this.method=o,this.handler=s,this.timeout=f,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}return i}();function handlerCheck(i){if(!i)throw unknown()}function metadataHandler(i,e){function o(s,f){var d=fromResourceString(i,f,e);return handlerCheck(d!==null),d}return o}function sharedErrorHandler(i){function e(o,s){var f;return o.getStatus()===401?f=unauthenticated():o.getStatus()===402?f=quotaExceeded(i.bucket):o.getStatus()===403?f=unauthorized(i.path):f=s,f.setServerResponseProp(s.serverResponseProp()),f}return e}function objectErrorHandler(i){var e=sharedErrorHandler(i);function o(s,f){var d=e(s,f);return s.getStatus()===404&&(d=objectNotFound(i.path)),d.setServerResponseProp(f.serverResponseProp()),d}return o}function getMetadata(i,e,o){var s=e.fullServerUrl(),f=makeNormalUrl(s),d="GET",m=i.maxOperationRetryTime(),_=new RequestInfo(f,d,metadataHandler(i,o),m);return _.errorHandler=objectErrorHandler(e),_}function updateMetadata(i,e,o,s){var f=e.fullServerUrl(),d=makeNormalUrl(f),m="PATCH",_=toResourceString(o,s),$={"Content-Type":"application/json; charset=utf-8"},G=i.maxOperationRetryTime(),Z=new RequestInfo(d,m,metadataHandler(i,s),G);return Z.headers=$,Z.body=_,Z.errorHandler=objectErrorHandler(e),Z}function deleteObject(i,e){var o=e.fullServerUrl(),s=makeNormalUrl(o),f="DELETE",d=i.maxOperationRetryTime();function m($,G){}var _=new RequestInfo(s,f,m,d);return _.successCodes=[200,204],_.errorHandler=objectErrorHandler(e),_}function determineContentType_(i,e){return i&&i.contentType||e&&e.type()||"application/octet-stream"}function metadataForUpload_(i,e,o){var s=clone$1(o);return s.fullPath=i.path,s.size=e.size(),s.contentType||(s.contentType=determineContentType_(null,e)),s}function multipartUpload(i,e,o,s,f){var d=e.bucketOnlyServerUrl(),m={"X-Goog-Upload-Protocol":"multipart"};function _(){for(var ft="",ct=0;ct<2;ct++)ft=ft+Math.random().toString().slice(2);return ft}var $=_();m["Content-Type"]="multipart/related; boundary="+$;var G=metadataForUpload_(e,s,f),Z=toResourceString(G,o),et="--"+$+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+Z+`\r
--`+$+`\r
Content-Type: `+G.contentType+`\r
\r
`,tt=`\r
--`+$+"--",nt=FbsBlob.getBlob(et,s,tt);if(nt===null)throw cannotSliceBlob();var st={name:G.fullPath},rt=makeUploadUrl(d),it="POST",ot=i.maxUploadRetryTime(),lt=new RequestInfo(rt,it,metadataHandler(i,o),ot);return lt.urlParams=st,lt.headers=m,lt.body=nt.uploadData(),lt.errorHandler=sharedErrorHandler(e),lt}var ResumableUploadStatus=function(){function i(e,o,s,f){this.current=e,this.total=o,this.finalized=!!s,this.metadata=f||null}return i}();function checkResumeHeader_(i,e){var o;try{o=i.getResponseHeader("X-Goog-Upload-Status")}catch{handlerCheck(!1)}var s=e||["active"];return handlerCheck(contains$1(s,o)),o}function createResumableUpload(i,e,o,s,f){var d=e.bucketOnlyServerUrl(),m=metadataForUpload_(e,s,f),_={name:m.fullPath},$=makeUploadUrl(d),G="POST",Z={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":s.size(),"X-Goog-Upload-Header-Content-Type":m.contentType,"Content-Type":"application/json; charset=utf-8"},et=toResourceString(m,o),tt=i.maxUploadRetryTime();function nt(rt,it){checkResumeHeader_(rt);var ot;try{ot=rt.getResponseHeader("X-Goog-Upload-URL")}catch{handlerCheck(!1)}return handlerCheck(isString(ot)),ot}var st=new RequestInfo($,G,nt,tt);return st.urlParams=_,st.headers=Z,st.body=et,st.errorHandler=sharedErrorHandler(e),st}function getResumableUploadStatus(i,e,o,s){var f={"X-Goog-Upload-Command":"query"};function d(G,Z){var et=checkResumeHeader_(G,["active","final"]),tt;try{tt=G.getResponseHeader("X-Goog-Upload-Size-Received")}catch{handlerCheck(!1)}var nt=parseInt(tt,10);return handlerCheck(!isNaN(nt)),new ResumableUploadStatus(nt,s.size(),et==="final")}var m="POST",_=i.maxUploadRetryTime(),$=new RequestInfo(o,m,d,_);return $.headers=f,$.errorHandler=sharedErrorHandler(e),$}var resumableUploadChunkSize=256*1024;function continueResumableUpload(i,e,o,s,f,d,m,_){var $=new ResumableUploadStatus(0,0);if(m?($.current=m.current,$.total=m.total):($.current=0,$.total=s.size()),s.size()!==$.total)throw serverFileWrongSize();var G=$.total-$.current,Z=G;f>0&&(Z=Math.min(Z,f));var et=$.current,tt=et+Z,nt=Z===G?"upload, finalize":"upload",st={"X-Goog-Upload-Command":nt,"X-Goog-Upload-Offset":$.current},rt=s.slice(et,tt);if(rt===null)throw cannotSliceBlob();function it(ct,pt){var gt=checkResumeHeader_(ct,["active","final"]),Tt=$.current+Z,Et=s.size(),Mt;return gt==="final"?Mt=metadataHandler(e,d)(ct,pt):Mt=null,new ResumableUploadStatus(Tt,Et,gt==="final",Mt)}var ot="POST",lt=e.maxUploadRetryTime(),ft=new RequestInfo(o,ot,it,lt);return ft.headers=st,ft.body=rt.uploadData(),ft.progressCallback=_||null,ft.errorHandler=sharedErrorHandler(i),ft}var Observer=function(){function i(e,o,s){var f=isFunction(e)||isDef(o)||isDef(s);if(f)this.next=e,this.error=o||null,this.complete=s||null;else{var d=e;this.next=d.next||null,this.error=d.error||null,this.complete=d.complete||null}}return i}(),UploadTaskSnapshot=function(){function i(e,o,s,f,d,m){this.bytesTransferred=e,this.totalBytes=o,this.state=s,this.metadata=f,this.task=d,this.ref=m}return Object.defineProperty(i.prototype,"downloadURL",{get:function(){if(this.metadata!==null){var e=this.metadata.downloadURLs;return e!=null&&e[0]!=null?e[0]:null}else return null},enumerable:!0,configurable:!0}),i}();function async(i){return function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];resolve(!0).then(function(){i.apply(null,e)})}}var UploadTask=function(){function i(e,o,s,f,d,m){m===void 0&&(m=null);var _=this;this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=e,this.authWrapper_=o,this.location_=s,this.blob_=d,this.metadata_=m,this.mappings_=f,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=InternalTaskState.RUNNING,this.errorHandler_=function($){_.request_=null,_.chunkMultiplier_=1,$.codeEquals(Code$1.CANCELED)?(_.needToFetchStatus_=!0,_.completeTransitions_()):(_.error_=$,_.transition_(InternalTaskState.ERROR))},this.metadataErrorHandler_=function($){_.request_=null,$.codeEquals(Code$1.CANCELED)?_.completeTransitions_():(_.error_=$,_.transition_(InternalTaskState.ERROR))},this.promise_=make(function($,G){_.resolve_=$,_.reject_=G,_.start_()}),this.promise_.then(null,function(){})}return i.prototype.makeProgressCallback_=function(){var e=this,o=this.transferred_;return function(s,f){e.updateProgress_(o+s)}},i.prototype.shouldDoResumable_=function(e){return e.size()>256*1024},i.prototype.start_=function(){this.state_===InternalTaskState.RUNNING&&this.request_===null&&(this.resumable_?this.uploadUrl_===null?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},i.prototype.resolveToken_=function(e){var o=this;this.authWrapper_.getAuthToken().then(function(s){switch(o.state_){case InternalTaskState.RUNNING:e(s);break;case InternalTaskState.CANCELING:o.transition_(InternalTaskState.CANCELED);break;case InternalTaskState.PAUSING:o.transition_(InternalTaskState.PAUSED);break}})},i.prototype.createResumable_=function(){var e=this;this.resolveToken_(function(o){var s=createResumableUpload(e.authWrapper_,e.location_,e.mappings_,e.blob_,e.metadata_),f=e.authWrapper_.makeRequest(s,o);e.request_=f,f.getPromise().then(function(d){e.request_=null,e.uploadUrl_=d,e.needToFetchStatus_=!1,e.completeTransitions_()},e.errorHandler_)})},i.prototype.fetchStatus_=function(){var e=this,o=this.uploadUrl_;this.resolveToken_(function(s){var f=getResumableUploadStatus(e.authWrapper_,e.location_,o,e.blob_),d=e.authWrapper_.makeRequest(f,s);e.request_=d,d.getPromise().then(function(m){m=m,e.request_=null,e.updateProgress_(m.current),e.needToFetchStatus_=!1,m.finalized&&(e.needToFetchMetadata_=!0),e.completeTransitions_()},e.errorHandler_)})},i.prototype.continueUpload_=function(){var e=this,o=resumableUploadChunkSize*this.chunkMultiplier_,s=new ResumableUploadStatus(this.transferred_,this.blob_.size()),f=this.uploadUrl_;this.resolveToken_(function(d){var m;try{m=continueResumableUpload(e.location_,e.authWrapper_,f,e.blob_,o,e.mappings_,s,e.makeProgressCallback_())}catch($){e.error_=$,e.transition_(InternalTaskState.ERROR);return}var _=e.authWrapper_.makeRequest(m,d);e.request_=_,_.getPromise().then(function($){e.increaseMultiplier_(),e.request_=null,e.updateProgress_($.current),$.finalized?(e.metadata_=$.metadata,e.transition_(InternalTaskState.SUCCESS)):e.completeTransitions_()},e.errorHandler_)})},i.prototype.increaseMultiplier_=function(){var e=resumableUploadChunkSize*this.chunkMultiplier_;e<32*1024*1024&&(this.chunkMultiplier_*=2)},i.prototype.fetchMetadata_=function(){var e=this;this.resolveToken_(function(o){var s=getMetadata(e.authWrapper_,e.location_,e.mappings_),f=e.authWrapper_.makeRequest(s,o);e.request_=f,f.getPromise().then(function(d){e.request_=null,e.metadata_=d,e.transition_(InternalTaskState.SUCCESS)},e.metadataErrorHandler_)})},i.prototype.oneShotUpload_=function(){var e=this;this.resolveToken_(function(o){var s=multipartUpload(e.authWrapper_,e.location_,e.mappings_,e.blob_,e.metadata_),f=e.authWrapper_.makeRequest(s,o);e.request_=f,f.getPromise().then(function(d){e.request_=null,e.metadata_=d,e.updateProgress_(e.blob_.size()),e.transition_(InternalTaskState.SUCCESS)},e.errorHandler_)})},i.prototype.updateProgress_=function(e){var o=this.transferred_;this.transferred_=e,this.transferred_!==o&&this.notifyObservers_()},i.prototype.transition_=function(e){if(this.state_!==e)switch(e){case InternalTaskState.CANCELING:this.state_=e,this.request_!==null&&this.request_.cancel();break;case InternalTaskState.PAUSING:this.state_=e,this.request_!==null&&this.request_.cancel();break;case InternalTaskState.RUNNING:var o=this.state_===InternalTaskState.PAUSED;this.state_=e,o&&(this.notifyObservers_(),this.start_());break;case InternalTaskState.PAUSED:this.state_=e,this.notifyObservers_();break;case InternalTaskState.CANCELED:this.error_=canceled(),this.state_=e,this.notifyObservers_();break;case InternalTaskState.ERROR:this.state_=e,this.notifyObservers_();break;case InternalTaskState.SUCCESS:this.state_=e,this.notifyObservers_();break}},i.prototype.completeTransitions_=function(){switch(this.state_){case InternalTaskState.PAUSING:this.transition_(InternalTaskState.PAUSED);break;case InternalTaskState.CANCELING:this.transition_(InternalTaskState.CANCELED);break;case InternalTaskState.RUNNING:this.start_();break}},Object.defineProperty(i.prototype,"snapshot",{get:function(){var e=taskStateFromInternalTaskState(this.state_);return new UploadTaskSnapshot(this.transferred_,this.blob_.size(),e,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),i.prototype.on=function(e,o,s,f){o===void 0&&(o=void 0),s===void 0&&(s=void 0),f===void 0&&(f=void 0);function d(it){if(e!==TaskEvent.STATE_CHANGED)throw"Expected one of the event types: ["+TaskEvent.STATE_CHANGED+"]."}var m="Expected a function or an Object with one of `next`, `error`, `complete` properties.",_=nullFunctionSpec(!0).validator,$=looseObjectSpec(null,!0).validator;function G(it){try{_(it);return}catch{}try{$(it);var ot=isJustDef(it.next)||isJustDef(it.error)||isJustDef(it.complete);if(!ot)throw"";return}catch{throw m}}var Z=[stringSpec(d),looseObjectSpec(G,!0),nullFunctionSpec(!0),nullFunctionSpec(!0)];validate("on",Z,arguments);var et=this;function tt(it){function ot(lt,ft,ct){it!==null&&validate("on",it,arguments);var pt=new Observer(lt,ft,f);return et.addObserver_(pt),function(){et.removeObserver_(pt)}}return ot}function nt(it){if(it===null)throw m;G(it)}var st=[looseObjectSpec(nt),nullFunctionSpec(!0),nullFunctionSpec(!0)],rt=!(isJustDef(o)||isJustDef(s)||isJustDef(f));return rt?tt(st):tt(null)(o,s,f)},i.prototype.then=function(e,o){return this.promise_.then(e,o)},i.prototype.catch=function(e){return this.then(null,e)},i.prototype.addObserver_=function(e){this.observers_.push(e),this.notifyObserver_(e)},i.prototype.removeObserver_=function(e){remove(this.observers_,e)},i.prototype.notifyObservers_=function(){var e=this;this.finishPromise_();var o=clone(this.observers_);o.forEach(function(s){e.notifyObserver_(s)})},i.prototype.finishPromise_=function(){if(this.resolve_!==null){var e=!0;switch(taskStateFromInternalTaskState(this.state_)){case TaskState.SUCCESS:async(this.resolve_.bind(null,this.snapshot))();break;case TaskState.CANCELED:case TaskState.ERROR:var o=this.reject_;async(o.bind(null,this.error_))();break;default:e=!1;break}e&&(this.resolve_=null,this.reject_=null)}},i.prototype.notifyObserver_=function(e){var o=taskStateFromInternalTaskState(this.state_);switch(o){case TaskState.RUNNING:case TaskState.PAUSED:e.next!==null&&async(e.next.bind(e,this.snapshot))();break;case TaskState.SUCCESS:e.complete!==null&&async(e.complete.bind(e))();break;case TaskState.CANCELED:case TaskState.ERROR:e.error!==null&&async(e.error.bind(e,this.error_))();break;default:e.error!==null&&async(e.error.bind(e,this.error_))()}},i.prototype.resume=function(){validate("resume",[],arguments);var e=this.state_===InternalTaskState.PAUSED||this.state_===InternalTaskState.PAUSING;return e&&this.transition_(InternalTaskState.RUNNING),e},i.prototype.pause=function(){validate("pause",[],arguments);var e=this.state_===InternalTaskState.RUNNING;return e&&this.transition_(InternalTaskState.PAUSING),e},i.prototype.cancel=function(){validate("cancel",[],arguments);var e=this.state_===InternalTaskState.RUNNING||this.state_===InternalTaskState.PAUSING;return e&&this.transition_(InternalTaskState.CANCELING),e},i}(),Reference=function(){function i(e,o){this.authWrapper=e,o instanceof Location?this.location=o:this.location=Location.makeFromUrl(o)}return i.prototype.toString=function(){return validate("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},i.prototype.newRef=function(e,o){return new i(e,o)},i.prototype.mappings=function(){return getMappings()},i.prototype.child=function(e){validate("child",[stringSpec()],arguments);var o=child(this.location.path,e),s=new Location(this.location.bucket,o);return this.newRef(this.authWrapper,s)},Object.defineProperty(i.prototype,"parent",{get:function(){var e=parent(this.location.path);if(e===null)return null;var o=new Location(this.location.bucket,e);return this.newRef(this.authWrapper,o)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"root",{get:function(){var e=new Location(this.location.bucket,"");return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return lastComponent(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),i.prototype.put=function(e,o){return o===void 0&&(o=null),validate("put",[uploadDataSpec(),metadataSpec(!0)],arguments),this.throwIfRoot_("put"),new UploadTask(this,this.authWrapper,this.location,this.mappings(),new FbsBlob(e),o)},i.prototype.putString=function(e,o,s){o===void 0&&(o=StringFormat.RAW),validate("putString",[stringSpec(),stringSpec(formatValidator,!0),metadataSpec(!0)],arguments),this.throwIfRoot_("putString");var f=dataFromString(o,e),d=clone$1(s);return!isDef(d.contentType)&&isDef(f.contentType)&&(d.contentType=f.contentType),new UploadTask(this,this.authWrapper,this.location,this.mappings(),new FbsBlob(f.data,!0),d)},i.prototype.delete=function(){validate("delete",[],arguments),this.throwIfRoot_("delete");var e=this;return this.authWrapper.getAuthToken().then(function(o){var s=deleteObject(e.authWrapper,e.location);return e.authWrapper.makeRequest(s,o).getPromise()})},i.prototype.getMetadata=function(){validate("getMetadata",[],arguments),this.throwIfRoot_("getMetadata");var e=this;return this.authWrapper.getAuthToken().then(function(o){var s=getMetadata(e.authWrapper,e.location,e.mappings());return e.authWrapper.makeRequest(s,o).getPromise()})},i.prototype.updateMetadata=function(e){validate("updateMetadata",[metadataSpec()],arguments),this.throwIfRoot_("updateMetadata");var o=this;return this.authWrapper.getAuthToken().then(function(s){var f=updateMetadata(o.authWrapper,o.location,e,o.mappings());return o.authWrapper.makeRequest(f,s).getPromise()})},i.prototype.getDownloadURL=function(){return validate("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.getMetadata().then(function(e){var o=e.downloadURLs[0];if(isDef(o))return o;throw noDownloadURL()})},i.prototype.throwIfRoot_=function(e){if(this.location.path==="")throw invalidRootOperation(e)},i}(),FailRequest=function(){function i(e){this.promise_=reject(e)}return i.prototype.getPromise=function(){return this.promise_},i.prototype.cancel=function(e){},i}(),RequestMap=function(){function i(){this.map_={},this.id_=minSafeInteger}return i.prototype.addRequest=function(e){var o=this.id_;this.id_++,this.map_[o]=e;var s=this;function f(){delete s.map_[o]}e.getPromise().then(f,f)},i.prototype.clear=function(){forEach$1(this.map_,function(e,o){o&&o.cancel(!0)}),this.map_={}},i}(),AuthWrapper=function(){function i(e,o,s,f,d){if(this.bucket_=null,this.deleted_=!1,this.app_=e,this.app_!==null){var m=this.app_.options;isDef(m)&&(this.bucket_=i.extractBucket_(m))}this.storageRefMaker_=o,this.requestMaker_=s,this.pool_=d,this.service_=f,this.maxOperationRetryTime_=defaultMaxOperationRetryTime,this.maxUploadRetryTime_=defaultMaxUploadRetryTime,this.requestMap_=new RequestMap}return i.extractBucket_=function(e){var o=e[configOption]||null;if(o==null)return null;var s=Location.makeFromBucketSpec(o);return s.bucket},i.prototype.getAuthToken=function(){return this.app_!==null&&isDef(this.app_.INTERNAL)&&isDef(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(e){return e!==null?e.accessToken:null},function(e){return null}):resolve(null)},i.prototype.bucket=function(){if(this.deleted_)throw appDeleted();return this.bucket_},i.prototype.service=function(){return this.service_},i.prototype.makeStorageReference=function(e){return this.storageRefMaker_(this,e)},i.prototype.makeRequest=function(e,o){if(this.deleted_)return new FailRequest(appDeleted());var s=this.requestMaker_(e,o,this.pool_);return this.requestMap_.addRequest(s),s},i.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},i.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},i.prototype.setMaxUploadRetryTime=function(e){this.maxUploadRetryTime_=e},i.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},i.prototype.setMaxOperationRetryTime=function(e){this.maxOperationRetryTime_=e},i}();function start(i,e,o){var s=1,f=null,d=!1,m=0;function _(){return m===2}var $=!1;function G(){$||($=!0,e.apply(null,arguments))}function Z(st){f=setTimeout(function(){f=null,i(et,_())},st)}function et(st){if(!$){if(st){G.apply(null,arguments);return}var rt=_()||d;if(rt){G.apply(null,arguments);return}s<64&&(s*=2);var it;m===1?(m=2,it=0):it=(s+Math.random())*1e3,Z(it)}}var tt=!1;function nt(st){tt||(tt=!0,!$&&(f!==null?(st||(m=2),clearTimeout(f),Z(0)):st||(m=1)))}return Z(0),setTimeout(function(){d=!0,nt(!0)},o),nt}function stop(i){i(!1)}var NetworkRequest=function(){function i(e,o,s,f,d,m,_,$,G,Z,et){this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=o,this.headers_=s,this.body_=f,this.successCodes_=d.slice(),this.additionalRetryCodes_=m.slice(),this.callback_=_,this.errorCallback_=$,this.progressCallback_=Z,this.timeout_=G,this.pool_=et;var tt=this;this.promise_=make(function(nt,st){tt.resolve_=nt,tt.reject_=st,tt.start_()})}return i.prototype.start_=function(){var e=this;function o(f,d){if(d){f(!1,new RequestEndStatus(!1,null,!0));return}var m=e.pool_.createXhrIo();e.pendingXhr_=m;function _($){var G=$.loaded,Z=$.lengthComputable?$.total:-1;e.progressCallback_!==null&&e.progressCallback_(G,Z)}e.progressCallback_!==null&&m.addUploadProgressListener(_),m.send(e.url_,e.method_,e.body_,e.headers_).then(function($){e.progressCallback_!==null&&$.removeUploadProgressListener(_),e.pendingXhr_=null,$=$;var G=$.getErrorCode()===ErrorCode.NO_ERROR,Z=$.getStatus();if(!G||e.isRetryStatusCode_(Z)){var et=$.getErrorCode()===ErrorCode.ABORT;f(!1,new RequestEndStatus(!1,null,et));return}var tt=contains$1(e.successCodes_,Z);f(!0,new RequestEndStatus(tt,$))})}function s(f,d){var m=e.resolve_,_=e.reject_,$=d.xhr;if(d.wasSuccessCode)try{var G=e.callback_($,$.getResponseText());isJustDef(G)?m(G):m()}catch(et){_(et)}else if($!==null){var Z=unknown();Z.setServerResponseProp($.getResponseText()),e.errorCallback_?_(e.errorCallback_($,Z)):_(Z)}else if(d.canceled){var Z=e.appDelete_?appDeleted():canceled();_(Z)}else{var Z=retryLimitExceeded();_(Z)}}this.canceled_?s(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(o,s,this.timeout_)},i.prototype.getPromise=function(){return this.promise_},i.prototype.cancel=function(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingXhr_!==null&&this.pendingXhr_.abort()},i.prototype.isRetryStatusCode_=function(e){var o=e>=500&&e<600,s=[408,429],f=contains$1(s,e),d=contains$1(this.additionalRetryCodes_,e);return o||f||d},i}(),RequestEndStatus=function(){function i(e,o,s){this.wasSuccessCode=e,this.xhr=o,this.canceled=!!s}return i}();function addAuthHeader_(i,e){e!==null&&e.length>0&&(i.Authorization="Firebase "+e)}function addVersionHeader_(i){var e=typeof firebase$1<"u"?firebase$1.SDK_VERSION:"AppManager";i["X-Firebase-Storage-Version"]="webjs/"+e}function makeRequest(i,e,o){var s=makeQueryString(i.urlParams),f=i.url+s,d=clone$1(i.headers);return addAuthHeader_(d,e),addVersionHeader_(d),new NetworkRequest(f,i.method,d,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,o)}var Service=function(){function i(e,o,s){this.bucket_=null;function f(m,_){return new Reference(m,_)}if(this.authWrapper_=new AuthWrapper(e,f,makeRequest,this,o),this.app_=e,s!=null)this.bucket_=Location.makeFromBucketSpec(s);else{var d=this.authWrapper_.bucket();d!=null&&(this.bucket_=new Location(d,""))}this.internals_=new ServiceInternals(this)}return i.prototype.ref=function(e){function o(f){if(/^[A-Za-z]+:\/\//.test(f))throw"Expected child path but got a URL, use refFromURL instead."}if(validate("ref",[stringSpec(o,!0)],arguments),this.bucket_==null)throw new Error("No Storage Bucket defined in Firebase Options.");var s=new Reference(this.authWrapper_,this.bucket_);return e!=null?s.child(e):s},i.prototype.refFromURL=function(e){function o(s){if(!/^[A-Za-z]+:\/\//.test(s))throw"Expected full URL but got a child path, use ref instead.";try{Location.makeFromUrl(s)}catch{throw"Expected valid full URL but got an invalid one."}}return validate("refFromURL",[stringSpec(o,!1)],arguments),new Reference(this.authWrapper_,e)},Object.defineProperty(i.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),i.prototype.setMaxUploadRetryTime=function(e){validate("setMaxUploadRetryTime",[nonNegativeNumberSpec()],arguments),this.authWrapper_.setMaxUploadRetryTime(e)},Object.defineProperty(i.prototype,"maxOperationRetryTime",{get:function(){return this.authWrapper_.maxOperationRetryTime()},enumerable:!0,configurable:!0}),i.prototype.setMaxOperationRetryTime=function(e){validate("setMaxOperationRetryTime",[nonNegativeNumberSpec()],arguments),this.authWrapper_.setMaxOperationRetryTime(e)},Object.defineProperty(i.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),i}(),ServiceInternals=function(){function i(e){this.service_=e}return i.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),resolve(void 0)},i}(),STORAGE_TYPE="storage";function factory(i,e,o){return new Service(i,new XhrIoPool,o)}function registerStorage(i){var e={TaskState,TaskEvent,StringFormat,Storage:Service,Reference};i.INTERNAL.registerService(STORAGE_TYPE,factory,e,void 0,!0)}registerStorage(firebase$1);var firebase=app$1,firebase_1=firebase,SDK_VERSION=firebase$1.SDK_VERSION,logClient=new Logger("@firebase/firestore"),LogLevel;(function(i){i[i.DEBUG=0]="DEBUG",i[i.ERROR=1]="ERROR",i[i.SILENT=2]="SILENT"})(LogLevel||(LogLevel={}));function getLogLevel(){return logClient.logLevel===LogLevel$1.DEBUG?LogLevel.DEBUG:logClient.logLevel===LogLevel$1.SILENT?LogLevel.SILENT:LogLevel.ERROR}function setLogLevel(i){switch(i){case LogLevel.DEBUG:logClient.logLevel=LogLevel$1.DEBUG;break;case LogLevel.ERROR:logClient.logLevel=LogLevel$1.ERROR;break;case LogLevel.SILENT:logClient.logLevel=LogLevel$1.SILENT;break;default:logClient.error("Firestore ("+SDK_VERSION+"): Invalid value passed to `setLogLevel`")}}function debug(i,e){for(var o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(logClient.logLevel<=LogLevel$1.DEBUG){var f=o.map(argToString);logClient.debug.apply(logClient,["Firestore ("+SDK_VERSION+") ["+i+"]: "+e].concat(f))}}function error(i){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];if(logClient.logLevel<=LogLevel$1.ERROR){var s=e.map(argToString);logClient.error.apply(logClient,["Firestore ("+SDK_VERSION+"): "+i].concat(s))}}function argToString(i){if(typeof i=="string")return i;var e=PlatformSupport.getPlatform();try{return e.formatJSON(i)}catch{return i}}function fail(i){var e="FIRESTORE ("+SDK_VERSION+") INTERNAL ASSERTION FAILED: "+i;throw error(e),new Error(e)}function assert(i,e){i||fail(e)}var PlatformSupport=function(){function i(){}return i.setPlatform=function(e){i.platform&&fail("Platform already defined"),i.platform=e},i.getPlatform=function(){return i.platform||fail("Platform not set"),i.platform},i}();function emptyByteString(){return PlatformSupport.getPlatform().emptyByteString}var Code={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},FirestoreError=function(i){tslib.exports.__extends(e,i);function e(o,s){var f=i.call(this,s)||this;return f.code=o,f.message=s,f.name="FirebaseError",f.toString=function(){return f.name+": [code="+f.code+"]: "+f.message},f}return e}(Error);function makeConstructorPrivate(i,e){function o(){var f="This constructor is private.";throw e&&(f+=" ",f+=e),new FirestoreError(Code.INVALID_ARGUMENT,f)}o.prototype=i.prototype;for(var s in i)i.hasOwnProperty(s)&&(o[s]=i[s]);return o}function contains(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function defaulted(i,e){return i!==void 0?i:e}function forEachNumber(i,e){for(var o in i)if(Object.prototype.hasOwnProperty.call(i,o)){var s=Number(o);isNaN(s)||e(s,i[o])}}function forEach(i,e){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&e(o,i[o])}function isEmpty(i){assert(i!=null&&typeof i=="object","isEmpty() expects object parameter.");for(var e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}function shallowCopy(i){assert(i&&typeof i=="object","shallowCopy() expects object parameter.");var e={};for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o]);return e}function validateExactNumberOfArgs(i,e,o){if(e.length!==o)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+i+"() requires "+formatPlural(o,"argument")+", but was called with "+formatPlural(e.length,"argument")+".")}function validateAtLeastNumberOfArgs(i,e,o){if(e.length<o)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+i+"() requires at least "+formatPlural(o,"argument")+", but was called with "+formatPlural(e.length,"argument")+".")}function validateBetweenNumberOfArgs(i,e,o,s){if(e.length<o||e.length>s)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+i+"() requires between "+o+" and "+(s+" arguments, but was called with ")+formatPlural(e.length,"argument")+".")}function validateNamedArrayAtLeastNumberOfElements(i,e,o,s){if(!(e instanceof Array)||e.length<s)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+i+"() requires its "+o+" argument to be an array with at least "+(formatPlural(s,"element")+"."))}function validateArgType(i,e,o,s){validateType(i,e,ordinal(o)+" argument",s)}function validateOptionalArgType(i,e,o,s){s!==void 0&&validateArgType(i,e,o,s)}function validateNamedType(i,e,o,s){validateType(i,e,o+" option",s)}function validateNamedOptionalType(i,e,o,s){s!==void 0&&validateNamedType(i,e,o,s)}function validateNamedPropertyEquals(i,e,o,s,f){for(var d=[],m=0,_=f;m<_.length;m++){var $=_[m];if($===s)return;d.push(valueDescription($))}var G=valueDescription(s);throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid value "+G+" provided to function "+i+'() for option "'+o+'". Acceptable values: '+d.join(", "))}function validateNamedOptionalPropertyEquals(i,e,o,s,f){s!==void 0&&validateNamedPropertyEquals(i,e,o,s,f)}function validateType(i,e,o,s){if(typeof s!==e||e==="object"&&!isPlainObject(s)){var f=valueDescription(s);throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+i+"() requires its "+o+" "+("to be of type "+e+", but it was: "+f))}}function isPlainObject(i){return typeof i=="object"&&i!==null&&Object.getPrototypeOf(i)===Object.prototype}function valueDescription(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=i.substring(0,20)+"..."),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";var e=tryGetCustomObjectType(i);return e?"a custom "+e+" object":"an object"}else return typeof i=="function"?"a function":fail("Unknown wrong type: "+typeof i)}function tryGetCustomObjectType(i){if(i.constructor){var e=/function\s+([^\s(]+)\s*\(/,o=e.exec(i.constructor.toString());if(o&&o.length>1)return o[1]}return null}function validateDefined(i,e,o){if(o===void 0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+i+"() requires a valid "+ordinal(e)+" argument, but it was undefined.")}function validateOptionNames(i,e,o){forEach(e,function(s,f){if(o.indexOf(s)<0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Unknown option '"+s+"' passed to function "+i+"(). Available options: "+o.join(", "))})}function invalidClassError(i,e,o,s){var f=valueDescription(s);return new FirestoreError(Code.INVALID_ARGUMENT,"Function "+i+"() requires its "+ordinal(o)+" "+("argument to be a "+e+", but it was: "+f))}function ordinal(i){switch(i){case 1:return"first";case 2:return"second";case 3:return"third";default:return i+"th"}}function formatPlural(i,e){return i+" "+e+(i===1?"":"s")}var AutoId=function(){function i(){}return i.newId=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o="",s=0;s<20;s++)o+=e.charAt(Math.floor(Math.random()*e.length));return assert(o.length===20,"Invalid auto ID: "+o),o},i}();function primitiveComparator(i,e){return i<e?-1:i>e?1:0}function equals(i,e){return i!=null?!!(e&&i.isEqual(e)):i===e}function arrayEquals(i,e){if(i.length!==e.length)return!1;for(var o=0;o<i.length;o++)if(!i[o].isEqual(e[o]))return!1;return!0}function immediatePredecessor(i){var e=i.length-1;return i.length===0?"":i.charAt(e)==="\0"?i.substring(0,e):i.substring(0,e)+String.fromCharCode(i.charCodeAt(e)-1)}function immediateSuccessor(i){return i+"\0"}function assertUint8ArrayAvailable(){if(typeof Uint8Array>"u")throw new FirestoreError(Code.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function assertBase64Available(){if(!PlatformSupport.getPlatform().base64Available)throw new FirestoreError(Code.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Blob$1=function(){function i(e){assertBase64Available(),this._binaryString=e}return i.fromBase64String=function(e){validateExactNumberOfArgs("Blob.fromBase64String",arguments,1),validateArgType("Blob.fromBase64String","string",1,e),assertBase64Available();try{var o=PlatformSupport.getPlatform().atob(e);return new i(o)}catch(s){throw new FirestoreError(Code.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+s)}},i.fromUint8Array=function(e){if(validateExactNumberOfArgs("Blob.fromUint8Array",arguments,1),assertUint8ArrayAvailable(),!(e instanceof Uint8Array))throw invalidClassError("Blob.fromUint8Array","Uint8Array",1,e);var o=Array.prototype.map.call(e,function(s){return String.fromCharCode(s)}).join("");return new i(o)},i.prototype.toBase64=function(){return validateExactNumberOfArgs("Blob.toBase64",arguments,0),assertBase64Available(),PlatformSupport.getPlatform().btoa(this._binaryString)},i.prototype.toUint8Array=function(){validateExactNumberOfArgs("Blob.toUint8Array",arguments,0),assertUint8ArrayAvailable();for(var e=new Uint8Array(this._binaryString.length),o=0;o<this._binaryString.length;o++)e[o]=this._binaryString.charCodeAt(o);return e},i.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},i.prototype.isEqual=function(e){return this._binaryString===e._binaryString},i.prototype._compareTo=function(e){return primitiveComparator(this._binaryString,e._binaryString)},i}(),PublicBlob=makeConstructorPrivate(Blob$1,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),GeoPoint=function(){function i(e,o){if(validateExactNumberOfArgs("GeoPoint",arguments,2),validateArgType("GeoPoint","number",1,e),validateArgType("GeoPoint","number",2,o),!isFinite(e)||e<-90||e>90)throw new FirestoreError(Code.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(o)||o<-180||o>180)throw new FirestoreError(Code.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+o);this._lat=e,this._long=o}return Object.defineProperty(i.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),i.prototype.isEqual=function(e){return this._lat===e._lat&&this._long===e._long},i.prototype._compareTo=function(e){return primitiveComparator(this._lat,e._lat)||primitiveComparator(this._long,e._long)},i}(),DatabaseInfo=function(){function i(e,o,s,f){this.databaseId=e,this.persistenceKey=o,this.host=s,this.ssl=f}return i}(),DEFAULT_DATABASE_NAME="(default)",DatabaseId=function(){function i(e,o){this.projectId=e,this.database=o||DEFAULT_DATABASE_NAME}return Object.defineProperty(i.prototype,"isDefaultDatabase",{get:function(){return this.database===DEFAULT_DATABASE_NAME},enumerable:!0,configurable:!0}),i.prototype.isEqual=function(e){return e instanceof i&&e.projectId===this.projectId&&e.database===this.database},i.prototype.compareTo=function(e){return primitiveComparator(this.projectId,e.projectId)||primitiveComparator(this.database,e.database)},i}(),DOCUMENT_KEY_NAME="__name__",Path=function(){function i(e,o,s){this.init(e,o,s)}return i.prototype.init=function(e,o,s){o===void 0?o=0:o>e.length&&fail("offset "+o+" out of range "+e.length),s===void 0?s=e.length-o:s>e.length-o&&fail("length "+s+" out of range "+(e.length-o)),this.segments=e,this.offset=o,this.len=s},i.prototype.construct=function(e,o,s){var f=Object.create(Object.getPrototypeOf(this));return f.init(e,o,s),f},Object.defineProperty(i.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),i.prototype.isEqual=function(e){return i.comparator(this,e)===0},i.prototype.child=function(e){var o=this.segments.slice(this.offset,this.limit());return e instanceof i?e.forEach(function(s){o.push(s)}):typeof e=="string"?o.push(e):fail("Unknown parameter type for Path.child(): "+e),this.construct(o)},i.prototype.limit=function(){return this.offset+this.length},i.prototype.popFirst=function(e){return e=e===void 0?1:e,assert(this.length>=e,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+e,this.length-e)},i.prototype.popLast=function(){return assert(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},i.prototype.firstSegment=function(){return assert(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},i.prototype.lastSegment=function(){return assert(!this.isEmpty(),"Can't call lastSegment() on empty path"),this.segments[this.limit()-1]},i.prototype.get=function(e){return assert(e<this.length,"Index out of range"),this.segments[this.offset+e]},i.prototype.isEmpty=function(){return this.length===0},i.prototype.isPrefixOf=function(e){if(e.length<this.length)return!1;for(var o=0;o<this.length;o++)if(this.get(o)!==e.get(o))return!1;return!0},i.prototype.forEach=function(e){for(var o=this.offset,s=this.limit();o<s;o++)e(this.segments[o])},i.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},i.comparator=function(e,o){for(var s=Math.min(e.length,o.length),f=0;f<s;f++){var d=e.get(f),m=o.get(f);if(d<m)return-1;if(d>m)return 1}return e.length<o.length?-1:e.length>o.length?1:0},i}(),ResourcePath=function(i){tslib.exports.__extends(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(o){if(o.indexOf("//")>=0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid path ("+o+"). Paths must not contain // in them.");var s=o.split("/").filter(function(f){return f.length>0});return new e(s)},e.EMPTY_PATH=new e([]),e}(Path),identifierRegExp=/^[_a-zA-Z][_a-zA-Z0-9]*$/,FieldPath$1=function(i){tslib.exports.__extends(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.isValidIdentifier=function(o){return identifierRegExp.test(o)},e.prototype.canonicalString=function(){return this.toArray().map(function(o){return o=o.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(o)||(o="`"+o+"`"),o}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return this.length===1&&this.get(0)===DOCUMENT_KEY_NAME},e.keyField=function(){return new e([DOCUMENT_KEY_NAME])},e.fromServerFormat=function(o){for(var s=[],f="",d=0,m=function(){if(f.length===0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid field path ("+o+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");s.push(f),f=""},_=!1;d<o.length;){var $=o[d];if($==="\\"){if(d+1===o.length)throw new FirestoreError(Code.INVALID_ARGUMENT,"Path has trailing escape character: "+o);var G=o[d+1];if(!(G==="\\"||G==="."||G==="`"))throw new FirestoreError(Code.INVALID_ARGUMENT,"Path has invalid escape sequence: "+o);f+=G,d+=2}else $==="`"?(_=!_,d++):$==="."&&!_?(m(),d++):(f+=$,d++)}if(m(),_)throw new FirestoreError(Code.INVALID_ARGUMENT,"Unterminated ` in path: "+o);return new e(s)},e.EMPTY_PATH=new e([]),e}(Path),DocumentKey=function(){function i(e){this.path=e,assert(i.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return i.prototype.isEqual=function(e){return e!==null&&ResourcePath.comparator(this.path,e.path)===0},i.prototype.toString=function(){return this.path.toString()},i.comparator=function(e,o){return ResourcePath.comparator(e.path,o.path)},i.isDocumentKey=function(e){return e.length%2===0},i.fromSegments=function(e){return new i(new ResourcePath(e.slice()))},i.fromPathString=function(e){return new i(ResourcePath.fromString(e))},i.EMPTY=new i(new ResourcePath([])),i}(),Document=function(){function i(e,o,s,f){this.key=e,this.version=o,this.data=s,this.hasLocalMutations=f.hasLocalMutations}return i.prototype.field=function(e){return this.data.field(e)},i.prototype.fieldValue=function(e){var o=this.field(e);return o?o.value():void 0},i.prototype.value=function(){return this.data.value()},i.prototype.isEqual=function(e){return e instanceof i&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.data.isEqual(e.data)&&this.hasLocalMutations===e.hasLocalMutations},i.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", "+("{hasLocalMutations: "+this.hasLocalMutations+"})")},i.compareByKey=function(e,o){return DocumentKey.comparator(e.key,o.key)},i.compareByField=function(e,o,s){var f=o.field(e),d=s.field(e);return f!==void 0&&d!==void 0?f.compareTo(d):fail("Trying to compare documents on fields that don't exist")},i}(),NoDocument=function(){function i(e,o){this.key=e,this.version=o}return i.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},i.prototype.isEqual=function(e){return e&&e.version.isEqual(this.version)&&e.key.isEqual(this.key)},i.compareByKey=function(e,o){return DocumentKey.comparator(e.key,o.key)},i}(),SortedMap=function(){function i(e,o){this.comparator=e,this.root=o||LLRBNode.EMPTY}return i.prototype.insert=function(e,o){return new i(this.comparator,this.root.insert(e,o,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))},i.prototype.remove=function(e){return new i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))},i.prototype.get=function(e){for(var o=this.root;!o.isEmpty();){var s=this.comparator(e,o.key);if(s===0)return o.value;s<0?o=o.left:s>0&&(o=o.right)}return null},i.prototype.indexOf=function(e){for(var o=0,s=this.root;!s.isEmpty();){var f=this.comparator(e,s.key);if(f===0)return o+s.left.size;f<0?s=s.left:(o+=s.left.size+1,s=s.right)}return-1},i.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(i.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),i.prototype.minKey=function(){return this.root.minKey()},i.prototype.maxKey=function(){return this.root.maxKey()},i.prototype.inorderTraversal=function(e){return this.root.inorderTraversal(e)},i.prototype.forEach=function(e){this.inorderTraversal(function(o,s){return e(o,s),!1})},i.prototype.reverseTraversal=function(e){return this.root.reverseTraversal(e)},i.prototype.getIterator=function(){return new SortedMapIterator(this.root,null,this.comparator,!1)},i.prototype.getIteratorFrom=function(e){return new SortedMapIterator(this.root,e,this.comparator,!1)},i.prototype.getReverseIterator=function(){return new SortedMapIterator(this.root,null,this.comparator,!0)},i.prototype.getReverseIteratorFrom=function(e){return new SortedMapIterator(this.root,e,this.comparator,!0)},i}(),SortedMapIterator=function(){function i(e,o,s,f){this.isReverse=f,this.nodeStack=[];for(var d=1;!e.isEmpty();)if(d=o?s(e.key,o):1,f&&(d*=-1),d<0)this.isReverse?e=e.left:e=e.right;else if(d===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}return i.prototype.getNext=function(){assert(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var e=this.nodeStack.pop(),o={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return o},i.prototype.hasNext=function(){return this.nodeStack.length>0},i.prototype.peek=function(){if(this.nodeStack.length===0)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}},i}(),LLRBNode=function(){function i(e,o,s,f,d){this.key=e,this.value=o,this.color=s!=null?s:i.RED,this.left=f!=null?f:i.EMPTY,this.right=d!=null?d:i.EMPTY,this.size=this.left.size+1+this.right.size}return i.prototype.copy=function(e,o,s,f,d){return new i(e!=null?e:this.key,o!=null?o:this.value,s!=null?s:this.color,f!=null?f:this.left,d!=null?d:this.right)},i.prototype.isEmpty=function(){return!1},i.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},i.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},i.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},i.prototype.minKey=function(){return this.min().key},i.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},i.prototype.insert=function(e,o,s){var f=this,d=s(e,f.key);return d<0?f=f.copy(null,null,null,f.left.insert(e,o,s),null):d===0?f=f.copy(null,o,null,null,null):f=f.copy(null,null,null,null,f.right.insert(e,o,s)),f.fixUp()},i.prototype.removeMin=function(){if(this.left.isEmpty())return i.EMPTY;var e=this;return!e.left.isRed()&&!e.left.left.isRed()&&(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()},i.prototype.remove=function(e,o){var s,f=this;if(o(e,f.key)<0)!f.left.isEmpty()&&!f.left.isRed()&&!f.left.left.isRed()&&(f=f.moveRedLeft()),f=f.copy(null,null,null,f.left.remove(e,o),null);else{if(f.left.isRed()&&(f=f.rotateRight()),!f.right.isEmpty()&&!f.right.isRed()&&!f.right.left.isRed()&&(f=f.moveRedRight()),o(e,f.key)===0){if(f.right.isEmpty())return i.EMPTY;s=f.right.min(),f=f.copy(s.key,s.value,null,null,f.right.removeMin())}f=f.copy(null,null,null,null,f.right.remove(e,o))}return f.fixUp()},i.prototype.isRed=function(){return this.color},i.prototype.fixUp=function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e},i.prototype.moveRedLeft=function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e},i.prototype.moveRedRight=function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e},i.prototype.rotateLeft=function(){var e=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},i.prototype.rotateRight=function(){var e=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},i.prototype.colorFlip=function(){var e=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,o)},i.prototype.checkMaxDepth=function(){var e=this.check();return Math.pow(2,e)<=this.size+1},i.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw fail("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw fail("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check();if(e!==this.right.check())throw fail("Black depths differ");return e+(this.isRed()?0:1)},i.EMPTY=null,i.RED=!0,i.BLACK=!1,i}(),LLRBEmptyNode=function(){function i(){this.size=0}return i.prototype.copy=function(e,o,s,f,d){return this},i.prototype.insert=function(e,o,s){return new LLRBNode(e,o)},i.prototype.remove=function(e,o){return this},i.prototype.isEmpty=function(){return!0},i.prototype.inorderTraversal=function(e){return!1},i.prototype.reverseTraversal=function(e){return!1},i.prototype.minKey=function(){return null},i.prototype.maxKey=function(){return null},i.prototype.isRed=function(){return!1},i.prototype.checkMaxDepth=function(){return!0},i.prototype.check=function(){return 0},i}();LLRBNode.EMPTY=new LLRBEmptyNode;var TypeOrder;(function(i){i[i.NullValue=0]="NullValue",i[i.BooleanValue=1]="BooleanValue",i[i.NumberValue=2]="NumberValue",i[i.TimestampValue=3]="TimestampValue",i[i.StringValue=4]="StringValue",i[i.BlobValue=5]="BlobValue",i[i.RefValue=6]="RefValue",i[i.GeoPointValue=7]="GeoPointValue",i[i.ArrayValue=8]="ArrayValue",i[i.ObjectValue=9]="ObjectValue"})(TypeOrder||(TypeOrder={}));var ServerTimestampBehavior;(function(i){i[i.Default=0]="Default",i[i.Estimate=1]="Estimate",i[i.Previous=2]="Previous"})(ServerTimestampBehavior||(ServerTimestampBehavior={}));var FieldValueOptions=function(){function i(e){this.serverTimestampBehavior=e}return i.fromSnapshotOptions=function(e){switch(e.serverTimestamps){case"estimate":return new i(ServerTimestampBehavior.Estimate);case"previous":return new i(ServerTimestampBehavior.Previous);case"none":case void 0:return i.defaultOptions;default:return fail("fromSnapshotOptions() called with invalid options.")}},i.defaultOptions=new i(ServerTimestampBehavior.Default),i}(),FieldValue=function(){function i(){}return i.prototype.toString=function(){var e=this.value();return e===null?"null":e.toString()},i.prototype.defaultCompareTo=function(e){assert(this.typeOrder!==e.typeOrder,"Default compareTo should not be used for values of same type.");var o=primitiveComparator(this.typeOrder,e.typeOrder);return o},i}(),NullValue=function(i){tslib.exports.__extends(e,i);function e(){var o=i.call(this)||this;return o.typeOrder=TypeOrder.NullValue,o.internalValue=null,o}return e.prototype.value=function(o){return null},e.prototype.isEqual=function(o){return o instanceof e},e.prototype.compareTo=function(o){return o instanceof e?0:this.defaultCompareTo(o)},e.INSTANCE=new e,e}(FieldValue),BooleanValue=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this)||this;return s.internalValue=o,s.typeOrder=TypeOrder.BooleanValue,s}return e.prototype.value=function(o){return this.internalValue},e.prototype.isEqual=function(o){return o instanceof e&&this.internalValue===o.internalValue},e.prototype.compareTo=function(o){return o instanceof e?primitiveComparator(this,o):this.defaultCompareTo(o)},e.of=function(o){return o?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(FieldValue),NumberValue=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this)||this;return s.internalValue=o,s.typeOrder=TypeOrder.NumberValue,s}return e.prototype.value=function(o){return this.internalValue},e.prototype.compareTo=function(o){return o instanceof e?numericComparator(this.internalValue,o.internalValue):this.defaultCompareTo(o)},e}(FieldValue);function numericComparator(i,e){return i<e?-1:i>e?1:i===e?0:isNaN(i)?isNaN(e)?0:-1:1}function numericEquals(i,e){return i===e?i!==0||1/i===1/e:i!==i&&e!==e}var IntegerValue=function(i){tslib.exports.__extends(e,i);function e(o){return i.call(this,o)||this}return e.prototype.isEqual=function(o){return o instanceof e?numericEquals(this.internalValue,o.internalValue):!1},e}(NumberValue),DoubleValue=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this,o)||this;return s.internalValue=o,s}return e.prototype.isEqual=function(o){return o instanceof e?numericEquals(this.internalValue,o.internalValue):!1},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(NumberValue),StringValue=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this)||this;return s.internalValue=o,s.typeOrder=TypeOrder.StringValue,s}return e.prototype.value=function(o){return this.internalValue},e.prototype.isEqual=function(o){return o instanceof e&&this.internalValue===o.internalValue},e.prototype.compareTo=function(o){return o instanceof e?primitiveComparator(this.internalValue,o.internalValue):this.defaultCompareTo(o)},e}(FieldValue),TimestampValue=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this)||this;return s.internalValue=o,s.typeOrder=TypeOrder.TimestampValue,s}return e.prototype.value=function(o){return this.internalValue.toDate()},e.prototype.isEqual=function(o){return o instanceof e&&this.internalValue.isEqual(o.internalValue)},e.prototype.compareTo=function(o){return o instanceof e?this.internalValue.compareTo(o.internalValue):o instanceof ServerTimestampValue?-1:this.defaultCompareTo(o)},e}(FieldValue),ServerTimestampValue=function(i){tslib.exports.__extends(e,i);function e(o,s){var f=i.call(this)||this;return f.localWriteTime=o,f.previousValue=s,f.typeOrder=TypeOrder.TimestampValue,f}return e.prototype.value=function(o){return o&&o.serverTimestampBehavior===ServerTimestampBehavior.Estimate?this.localWriteTime.toDate():o&&o.serverTimestampBehavior===ServerTimestampBehavior.Previous&&this.previousValue?this.previousValue.value(o):null},e.prototype.isEqual=function(o){return o instanceof e&&this.localWriteTime.isEqual(o.localWriteTime)},e.prototype.compareTo=function(o){return o instanceof e?this.localWriteTime.compareTo(o.localWriteTime):o instanceof TimestampValue?1:this.defaultCompareTo(o)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(FieldValue),BlobValue=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this)||this;return s.internalValue=o,s.typeOrder=TypeOrder.BlobValue,s}return e.prototype.value=function(o){return this.internalValue},e.prototype.isEqual=function(o){return o instanceof e&&this.internalValue.isEqual(o.internalValue)},e.prototype.compareTo=function(o){return o instanceof e?this.internalValue._compareTo(o.internalValue):this.defaultCompareTo(o)},e}(FieldValue),RefValue=function(i){tslib.exports.__extends(e,i);function e(o,s){var f=i.call(this)||this;return f.databaseId=o,f.key=s,f.typeOrder=TypeOrder.RefValue,f}return e.prototype.value=function(o){return this.key},e.prototype.isEqual=function(o){return o instanceof e?this.key.isEqual(o.key)&&this.databaseId.isEqual(o.databaseId):!1},e.prototype.compareTo=function(o){if(o instanceof e){var s=this.databaseId.compareTo(o.databaseId);return s!==0?s:DocumentKey.comparator(this.key,o.key)}return this.defaultCompareTo(o)},e}(FieldValue),GeoPointValue=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this)||this;return s.internalValue=o,s.typeOrder=TypeOrder.GeoPointValue,s}return e.prototype.value=function(o){return this.internalValue},e.prototype.isEqual=function(o){return o instanceof e&&this.internalValue.isEqual(o.internalValue)},e.prototype.compareTo=function(o){return o instanceof e?this.internalValue._compareTo(o.internalValue):this.defaultCompareTo(o)},e}(FieldValue),ObjectValue=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this)||this;return s.internalValue=o,s.typeOrder=TypeOrder.ObjectValue,s}return e.prototype.value=function(o){var s={};return this.internalValue.inorderTraversal(function(f,d){s[f]=d.value(o)}),s},e.prototype.forEach=function(o){this.internalValue.inorderTraversal(o)},e.prototype.isEqual=function(o){if(o instanceof e){for(var s=this.internalValue.getIterator(),f=o.internalValue.getIterator();s.hasNext()&&f.hasNext();){var d=s.getNext(),m=f.getNext();if(d.key!==m.key||!d.value.isEqual(m.value))return!1}return!s.hasNext()&&!f.hasNext()}return!1},e.prototype.compareTo=function(o){if(o instanceof e){for(var s=this.internalValue.getIterator(),f=o.internalValue.getIterator();s.hasNext()&&f.hasNext();){var d=s.getNext(),m=f.getNext(),_=primitiveComparator(d.key,m.key)||d.value.compareTo(m.value);if(_)return _}return primitiveComparator(s.hasNext(),f.hasNext())}else return this.defaultCompareTo(o)},e.prototype.set=function(o,s){if(assert(!o.isEmpty(),"Cannot set field for empty path on ObjectValue"),o.length===1)return this.setChild(o.firstSegment(),s);var f=this.child(o.firstSegment());f instanceof e||(f=e.EMPTY);var d=f.set(o.popFirst(),s);return this.setChild(o.firstSegment(),d)},e.prototype.delete=function(o){if(assert(!o.isEmpty(),"Cannot delete field for empty path on ObjectValue"),o.length===1)return new e(this.internalValue.remove(o.firstSegment()));var s=this.child(o.firstSegment());if(s instanceof e){var f=s.delete(o.popFirst());return new e(this.internalValue.insert(o.firstSegment(),f))}else return this},e.prototype.contains=function(o){return this.field(o)!==void 0},e.prototype.field=function(o){assert(!o.isEmpty(),"Can't get field of empty path");var s=this;return o.forEach(function(f){s instanceof e?s=s.internalValue.get(f)||void 0:s=void 0}),s},e.prototype.toString=function(){return JSON.stringify(this.value())},e.prototype.child=function(o){return this.internalValue.get(o)||void 0},e.prototype.setChild=function(o,s){return new e(this.internalValue.insert(o,s))},e.EMPTY=new e(new SortedMap(primitiveComparator)),e}(FieldValue),ArrayValue=function(i){tslib.exports.__extends(e,i);function e(o){var s=i.call(this)||this;return s.internalValue=o,s.typeOrder=TypeOrder.ArrayValue,s}return e.prototype.value=function(o){return this.internalValue.map(function(s){return s.value(o)})},e.prototype.forEach=function(o){this.internalValue.forEach(o)},e.prototype.isEqual=function(o){if(o instanceof e){if(this.internalValue.length!==o.internalValue.length)return!1;for(var s=0;s<this.internalValue.length;s++)if(!this.internalValue[s].isEqual(o.internalValue[s]))return!1;return!0}return!1},e.prototype.compareTo=function(o){if(o instanceof e){for(var s=Math.min(this.internalValue.length,o.internalValue.length),f=0;f<s;f++){var d=this.internalValue[f].compareTo(o.internalValue[f]);if(d)return d}return primitiveComparator(this.internalValue.length,o.internalValue.length)}else return this.defaultCompareTo(o)},e.prototype.toString=function(){return JSON.stringify(this.value())},e}(FieldValue),NumberAsAny=Number,MIN_SAFE_INTEGER=NumberAsAny.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),MAX_SAFE_INTEGER=NumberAsAny.MAX_SAFE_INTEGER||Math.pow(2,53)-1,isInteger=NumberAsAny.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i};function isNullOrUndefined(i){return i==null}function isSafeInteger(i){return isInteger(i)&&i<=MAX_SAFE_INTEGER&&i>=MIN_SAFE_INTEGER}var Query$1=function(){function i(e,o,s,f,d,m){o===void 0&&(o=[]),s===void 0&&(s=[]),f===void 0&&(f=null),d===void 0&&(d=null),m===void 0&&(m=null),this.path=e,this.explicitOrderBy=o,this.filters=s,this.limit=f,this.startAt=d,this.endAt=m,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return i.atPath=function(e){return new i(e)},Object.defineProperty(i.prototype,"orderBy",{get:function(){if(this.memoizedOrderBy===null){var e=this.getInequalityFilterField(),o=this.getFirstOrderByField();if(e!==null&&o===null)e.isKeyField()?this.memoizedOrderBy=[KEY_ORDERING_ASC]:this.memoizedOrderBy=[new OrderBy(e),KEY_ORDERING_ASC];else{assert(e===null||o!==null&&e.isEqual(o),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var s=!1,f=0,d=this.explicitOrderBy;f<d.length;f++){var m=d[f];this.memoizedOrderBy.push(m),m.field.isKeyField()&&(s=!0)}if(!s){var _=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Direction.ASCENDING;this.memoizedOrderBy.push(_===Direction.ASCENDING?KEY_ORDERING_ASC:KEY_ORDERING_DESC)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),i.prototype.addFilter=function(e){assert(this.getInequalityFilterField()==null||!(e instanceof RelationFilter)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),assert(!DocumentKey.isDocumentKey(this.path),"No filtering allowed for document query");var o=this.filters.concat([e]);return new i(this.path,this.explicitOrderBy.slice(),o,this.limit,this.startAt,this.endAt)},i.prototype.addOrderBy=function(e){assert(!DocumentKey.isDocumentKey(this.path),"No ordering allowed for document query"),assert(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var o=this.explicitOrderBy.concat([e]);return new i(this.path,o,this.filters.slice(),this.limit,this.startAt,this.endAt)},i.prototype.withLimit=function(e){return new i(this.path,this.explicitOrderBy.slice(),this.filters.slice(),e,this.startAt,this.endAt)},i.prototype.withStartAt=function(e){return new i(this.path,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,e,this.endAt)},i.prototype.withEndAt=function(e){return new i(this.path,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,e)},i.prototype.canonicalId=function(){if(this.memoizedCanonicalId===null){var e=this.path.canonicalString();e+="|f:";for(var o=0,s=this.filters;o<s.length;o++){var f=s[o];e+=f.canonicalId(),e+=","}e+="|ob:";for(var d=0,m=this.orderBy;d<m.length;d++){var _=m[d];e+=_.canonicalId(),e+=","}isNullOrUndefined(this.limit)||(e+="|l:",e+=this.limit),this.startAt&&(e+="|lb:",e+=this.startAt.canonicalId()),this.endAt&&(e+="|ub:",e+=this.endAt.canonicalId()),this.memoizedCanonicalId=e}return this.memoizedCanonicalId},i.prototype.toString=function(){var e="Query("+this.path.canonicalString();return this.filters.length>0&&(e+=", filters: ["+this.filters.join(", ")+"]"),isNullOrUndefined(this.limit)||(e+=", limit: "+this.limit),this.explicitOrderBy.length>0&&(e+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(e+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(e+=", endAt: "+this.endAt.canonicalId()),e+")"},i.prototype.isEqual=function(e){if(this.limit!==e.limit||this.orderBy.length!==e.orderBy.length)return!1;for(var o=0;o<this.orderBy.length;o++)if(!this.orderBy[o].isEqual(e.orderBy[o]))return!1;if(this.filters.length!==e.filters.length)return!1;for(var o=0;o<this.filters.length;o++)if(!this.filters[o].isEqual(e.filters[o]))return!1;return!this.path.isEqual(e.path)||(this.startAt!==null?!this.startAt.isEqual(e.startAt):e.startAt!==null)?!1:this.endAt!==null?this.endAt.isEqual(e.endAt):e.endAt===null},i.prototype.docComparator=function(e,o){for(var s=!1,f=0,d=this.orderBy;f<d.length;f++){var m=d[f],_=m.compare(e,o);if(_!==0)return _;s=s||m.field.isKeyField()}return assert(s,"orderBy used that doesn't compare on key field"),0},i.prototype.matches=function(e){return this.matchesAncestor(e)&&this.matchesOrderBy(e)&&this.matchesFilters(e)&&this.matchesBounds(e)},i.prototype.hasLimit=function(){return!isNullOrUndefined(this.limit)},i.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},i.prototype.getInequalityFilterField=function(){for(var e=0,o=this.filters;e<o.length;e++){var s=o[e];if(s instanceof RelationFilter&&s.isInequality())return s.field}return null},i.prototype.isDocumentQuery=function(){return DocumentKey.isDocumentKey(this.path)&&this.filters.length===0},i.prototype.matchesAncestor=function(e){var o=e.key.path;return DocumentKey.isDocumentKey(this.path)?this.path.isEqual(o):this.path.isPrefixOf(o)&&this.path.length===o.length-1},i.prototype.matchesOrderBy=function(e){for(var o=0,s=this.explicitOrderBy;o<s.length;o++){var f=s[o];if(!f.field.isKeyField()&&e.field(f.field)===void 0)return!1}return!0},i.prototype.matchesFilters=function(e){for(var o=0,s=this.filters;o<s.length;o++){var f=s[o];if(!f.matches(e))return!1}return!0},i.prototype.matchesBounds=function(e){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,e)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,e))},i.prototype.assertValidBound=function(e){assert(e.position.length<=this.orderBy.length,"Bound is longer than orderBy")},i}(),RelationOp=function(){function i(e){this.name=e}return i.fromString=function(e){switch(e){case"<":return i.LESS_THAN;case"<=":return i.LESS_THAN_OR_EQUAL;case"==":return i.EQUAL;case">=":return i.GREATER_THAN_OR_EQUAL;case">":return i.GREATER_THAN;default:return fail("Unknown relation: "+e)}},i.prototype.toString=function(){return this.name},i.prototype.isEqual=function(e){return this.name===e.name},i.LESS_THAN=new i("<"),i.LESS_THAN_OR_EQUAL=new i("<="),i.EQUAL=new i("=="),i.GREATER_THAN=new i(">"),i.GREATER_THAN_OR_EQUAL=new i(">="),i}(),RelationFilter=function(){function i(e,o,s){this.field=e,this.op=o,this.value=s}return i.prototype.matches=function(e){if(this.field.isKeyField()){assert(this.value instanceof RefValue,"Comparing on key, but filter value not a RefValue");var o=this.value,s=DocumentKey.comparator(e.key,o.key);return this.matchesComparison(s)}else{var f=e.field(this.field);return f!==void 0&&this.matchesValue(f)}},i.prototype.matchesValue=function(e){return this.value.typeOrder!==e.typeOrder?!1:this.matchesComparison(e.compareTo(this.value))},i.prototype.matchesComparison=function(e){switch(this.op){case RelationOp.LESS_THAN:return e<0;case RelationOp.LESS_THAN_OR_EQUAL:return e<=0;case RelationOp.EQUAL:return e===0;case RelationOp.GREATER_THAN:return e>0;case RelationOp.GREATER_THAN_OR_EQUAL:return e>=0;default:return fail("Unknown relation op"+this.op)}},i.prototype.isInequality=function(){return this.op!==RelationOp.EQUAL},i.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},i.prototype.isEqual=function(e){return e instanceof i?this.op.isEqual(e.op)&&this.field.isEqual(e.field)&&this.value.isEqual(e.value):!1},i.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},i}(),NullFilter=function(){function i(e){this.field=e}return i.prototype.matches=function(e){var o=e.field(this.field);return o!==void 0&&o.value()===null},i.prototype.canonicalId=function(){return this.field.canonicalString()+" IS null"},i.prototype.toString=function(){return this.field.canonicalString()+" IS null"},i.prototype.isEqual=function(e){return e instanceof i?this.field.isEqual(e.field):!1},i}(),NanFilter=function(){function i(e){this.field=e}return i.prototype.matches=function(e){var o=e.field(this.field).value();return typeof o=="number"&&isNaN(o)},i.prototype.canonicalId=function(){return this.field.canonicalString()+" IS NaN"},i.prototype.toString=function(){return this.field.canonicalString()+" IS NaN"},i.prototype.isEqual=function(e){return e instanceof i?this.field.isEqual(e.field):!1},i}();function fieldFilter(i,e,o){if(o.isEqual(NullValue.INSTANCE)){if(e!==RelationOp.EQUAL)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on null.");return new NullFilter(i)}else if(o.isEqual(DoubleValue.NAN)){if(e!==RelationOp.EQUAL)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on NaN.");return new NanFilter(i)}else return new RelationFilter(i,e,o)}var Direction=function(){function i(e){this.name=e}return i.prototype.toString=function(){return this.name},i.ASCENDING=new i("asc"),i.DESCENDING=new i("desc"),i}(),Bound=function(){function i(e,o){this.position=e,this.before=o}return i.prototype.canonicalId=function(){for(var e=this.before?"b:":"a:",o=0,s=this.position;o<s.length;o++){var f=s[o];e+=f.toString()}return e},i.prototype.sortsBeforeDocument=function(e,o){assert(this.position.length<=e.length,"Bound has more components than query's orderBy");for(var s=0,f=0;f<this.position.length;f++){var d=e[f],m=this.position[f];if(d.field.isKeyField())assert(m instanceof RefValue,"Bound has a non-key value where the key path is being used."),s=DocumentKey.comparator(m.key,o.key);else{var _=o.field(d.field);assert(_!==void 0,"Field should exist since document matched the orderBy already."),s=m.compareTo(_)}if(d.dir===Direction.DESCENDING&&(s=s*-1),s!==0)break}return this.before?s<=0:s<0},i.prototype.isEqual=function(e){if(e===null||this.before!==e.before||this.position.length!==e.position.length)return!1;for(var o=0;o<this.position.length;o++){var s=this.position[o],f=e.position[o];return s.isEqual(f)}return!0},i}(),OrderBy=function(){function i(e,o){this.field=e,o===void 0&&(o=Direction.ASCENDING),this.dir=o,this.isKeyOrderBy=e.isKeyField()}return i.prototype.compare=function(e,o){var s=this.isKeyOrderBy?Document.compareByKey(e,o):Document.compareByField(this.field,e,o);switch(this.dir){case Direction.ASCENDING:return s;case Direction.DESCENDING:return-1*s;default:return fail("Unknown direction: "+this.dir)}},i.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},i.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},i.prototype.isEqual=function(e){return this.dir===e.dir&&this.field.isEqual(e.field)},i}(),KEY_ORDERING_ASC=new OrderBy(FieldPath$1.keyField(),Direction.ASCENDING),KEY_ORDERING_DESC=new OrderBy(FieldPath$1.keyField(),Direction.DESCENDING),isoRegExp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/),Timestamp=function(){function i(e,o){this.seconds=e,this.nanos=o,assert(o>=0,"timestamp nanoseconds out of range: "+o),assert(o<1e9,"timestamp nanoseconds out of range"+o),assert(e>=-62135596800,"timestamp seconds out of range: "+e),assert(e<253402300800,"timestamp seconds out of range"+e)}return i.now=function(){return i.fromEpochMilliseconds(Date.now())},i.fromDate=function(e){return i.fromEpochMilliseconds(e.getTime())},i.fromEpochMilliseconds=function(e){var o=Math.floor(e/1e3),s=(e-o*1e3)*1e6;return new i(o,s)},i.fromISOString=function(e){var o=0,s=isoRegExp.exec(e);if(assert(!!s,"invalid timestamp: "+e),s[1]){var f=s[1];f=(f+"000000000").substr(0,9),o=Number(f)}var d=new Date(e),m=Math.floor(d.getTime()/1e3);return new i(m,o)},i.prototype.toDate=function(){return new Date(this.toEpochMilliseconds())},i.prototype.toEpochMilliseconds=function(){return this.seconds*1e3+this.nanos/1e6},i.prototype.compareTo=function(e){return this.seconds===e.seconds?primitiveComparator(this.nanos,e.nanos):primitiveComparator(this.seconds,e.seconds)},i.prototype.isEqual=function(e){return e.seconds===this.seconds&&e.nanos===this.nanos},i.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanos="+this.nanos+")"},i}(),SnapshotVersion=function(){function i(e){this.timestamp=e}return i.fromMicroseconds=function(e){var o=Math.floor(e/1e6),s=e%1e6*1e3;return new i(new Timestamp(o,s))},i.fromTimestamp=function(e){return new i(e)},i.forDeletedDoc=function(){return i.MIN},i.prototype.compareTo=function(e){return this.timestamp.compareTo(e.timestamp)},i.prototype.isEqual=function(e){return this.timestamp.isEqual(e.timestamp)},i.prototype.toMicroseconds=function(){return this.timestamp.seconds*1e6+this.timestamp.nanos/1e3},i.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},i.prototype.toTimestamp=function(){return this.timestamp},i.MIN=new i(new Timestamp(0,0)),i}(),QueryPurpose;(function(i){i[i.Listen=0]="Listen",i[i.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",i[i.LimboResolution=2]="LimboResolution"})(QueryPurpose||(QueryPurpose={}));var QueryData=function(){function i(e,o,s,f,d){f===void 0&&(f=SnapshotVersion.MIN),d===void 0&&(d=emptyByteString()),this.query=e,this.targetId=o,this.purpose=s,this.snapshotVersion=f,this.resumeToken=d}return i.prototype.update=function(e){return new i(this.query,this.targetId,this.purpose,e.snapshotVersion,e.resumeToken)},i.prototype.isEqual=function(e){return this.targetId===e.targetId&&this.purpose===e.purpose&&this.snapshotVersion.isEqual(e.snapshotVersion)&&this.resumeToken===e.resumeToken&&this.query.isEqual(e.query)},i}(),FieldMask=function(){function i(e){this.fields=e}return i.prototype.isEqual=function(e){return arrayEquals(this.fields,e.fields)},i}(),ServerTimestampTransform=function(){function i(){}return i.prototype.isEqual=function(e){return e instanceof i},i.instance=new i,i}(),FieldTransform=function(){function i(e,o){this.field=e,this.transform=o}return i.prototype.isEqual=function(e){return this.field.isEqual(e.field)&&this.transform.isEqual(e.transform)},i}(),MutationResult=function(){function i(e,o){this.version=e,this.transformResults=o}return i}(),MutationType;(function(i){i[i.Set=0]="Set",i[i.Patch=1]="Patch",i[i.Transform=2]="Transform",i[i.Delete=3]="Delete"})(MutationType||(MutationType={}));var Precondition=function(){function i(e,o){this.updateTime=e,this.exists=o,assert(e===void 0||o===void 0,'Precondition can specify "exists" or "updateTime" but not both')}return i.exists=function(e){return new i(void 0,e)},i.updateTime=function(e){return new i(e)},Object.defineProperty(i.prototype,"isNone",{get:function(){return this.updateTime===void 0&&this.exists===void 0},enumerable:!0,configurable:!0}),i.prototype.isValidFor=function(e){return this.updateTime!==void 0?e instanceof Document&&e.version.isEqual(this.updateTime):this.exists!==void 0?this.exists?e instanceof Document:e===null||e instanceof NoDocument:(assert(this.isNone,"Precondition should be empty"),!0)},i.prototype.isEqual=function(e){return equals(this.updateTime,e.updateTime)&&this.exists===e.exists},i.NONE=new i,i}(),Mutation=function(){function i(){}return i.prototype.verifyKeyMatches=function(e){e!=null&&assert(e.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},i.getPostMutationVersion=function(e){return e instanceof Document?e.version:SnapshotVersion.MIN},i}(),SetMutation=function(i){tslib.exports.__extends(e,i);function e(o,s,f){var d=i.call(this)||this;return d.key=o,d.value=s,d.precondition=f,d.type=MutationType.Set,d}return e.prototype.applyToRemoteDocument=function(o,s){this.verifyKeyMatches(o),assert(s.transformResults==null,"Transform results received by SetMutation.");var f=Mutation.getPostMutationVersion(o);return new Document(this.key,f,this.value,{hasLocalMutations:!1})},e.prototype.applyToLocalView=function(o,s,f){if(this.verifyKeyMatches(o),!this.precondition.isValidFor(o))return o;var d=Mutation.getPostMutationVersion(o);return new Document(this.key,d,this.value,{hasLocalMutations:!0})},e.prototype.isEqual=function(o){return o instanceof e&&this.key.isEqual(o.key)&&this.value.isEqual(o.value)&&this.precondition.isEqual(o.precondition)},e}(Mutation),PatchMutation=function(i){tslib.exports.__extends(e,i);function e(o,s,f,d){var m=i.call(this)||this;return m.key=o,m.data=s,m.fieldMask=f,m.precondition=d,m.type=MutationType.Patch,m}return e.prototype.applyToRemoteDocument=function(o,s){if(this.verifyKeyMatches(o),assert(s.transformResults==null,"Transform results received by PatchMutation."),!this.precondition.isValidFor(o))return o;var f=Mutation.getPostMutationVersion(o),d=this.patchDocument(o);return new Document(this.key,f,d,{hasLocalMutations:!1})},e.prototype.applyToLocalView=function(o,s,f){if(this.verifyKeyMatches(o),!this.precondition.isValidFor(o))return o;var d=Mutation.getPostMutationVersion(o),m=this.patchDocument(o);return new Document(this.key,d,m,{hasLocalMutations:!0})},e.prototype.isEqual=function(o){return o instanceof e&&this.key.isEqual(o.key)&&this.fieldMask.isEqual(o.fieldMask)&&this.precondition.isEqual(o.precondition)},e.prototype.patchDocument=function(o){var s;return o instanceof Document?s=o.data:s=ObjectValue.EMPTY,this.patchObject(s)},e.prototype.patchObject=function(o){for(var s=0,f=this.fieldMask.fields;s<f.length;s++){var d=f[s],m=this.data.field(d);m!==void 0?o=o.set(d,m):o=o.delete(d)}return o},e}(Mutation),TransformMutation=function(i){tslib.exports.__extends(e,i);function e(o,s){var f=i.call(this)||this;return f.key=o,f.fieldTransforms=s,f.type=MutationType.Transform,f.precondition=Precondition.exists(!0),f}return e.prototype.applyToRemoteDocument=function(o,s){this.verifyKeyMatches(o),assert(s.transformResults!=null,"Transform results missing for TransformMutation.");var f=s.transformResults;if(!this.precondition.isValidFor(o))return o;var d=this.requireDocument(o),m=this.transformObject(d.data,f);return new Document(this.key,d.version,m,{hasLocalMutations:!1})},e.prototype.applyToLocalView=function(o,s,f){if(this.verifyKeyMatches(o),!this.precondition.isValidFor(o))return o;var d=this.requireDocument(o),m=this.localTransformResults(f,s),_=this.transformObject(d.data,m);return new Document(this.key,d.version,_,{hasLocalMutations:!0})},e.prototype.isEqual=function(o){return o instanceof e&&this.key.isEqual(o.key)&&arrayEquals(this.fieldTransforms,o.fieldTransforms)&&this.precondition.isEqual(o.precondition)},e.prototype.requireDocument=function(o){assert(o instanceof Document,"Unknown MaybeDocument type "+o);var s=o;return assert(s.key.isEqual(this.key),"Can only transform a document with the same key"),s},e.prototype.localTransformResults=function(o,s){for(var f=[],d=0,m=this.fieldTransforms;d<m.length;d++){var _=m[d],$=_.transform;if($ instanceof ServerTimestampTransform){var G=null;s instanceof Document&&(G=s.field(_.field)||null),f.push(new ServerTimestampValue(o,G))}else return fail("Encountered unknown transform: "+$)}return f},e.prototype.transformObject=function(o,s){assert(s.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var f=0;f<this.fieldTransforms.length;f++){var d=this.fieldTransforms[f],m=d.transform,_=d.field;if(m instanceof ServerTimestampTransform)o=o.set(_,s[f]);else return fail("Encountered unknown transform: "+m)}return o},e}(Mutation),DeleteMutation=function(i){tslib.exports.__extends(e,i);function e(o,s){var f=i.call(this)||this;return f.key=o,f.precondition=s,f.type=MutationType.Delete,f}return e.prototype.applyToRemoteDocument=function(o,s){return this.verifyKeyMatches(o),assert(s.transformResults==null,"Transform results received by DeleteMutation."),new NoDocument(this.key,SnapshotVersion.MIN)},e.prototype.applyToLocalView=function(o,s,f){return this.verifyKeyMatches(o),this.precondition.isValidFor(o)?(o&&assert(o.key.isEqual(this.key),"Can only apply mutation to document with same key"),new NoDocument(this.key,SnapshotVersion.forDeletedDoc())):o},e.prototype.isEqual=function(o){return o instanceof e&&this.key.isEqual(o.key)&&this.precondition.isEqual(o.precondition)},e}(Mutation),ExistenceFilter=function(){function i(e){this.count=e}return i.prototype.isEqual=function(e){return e&&e.count===this.count},i}(),RpcCode;(function(i){i[i.OK=0]="OK",i[i.CANCELLED=1]="CANCELLED",i[i.UNKNOWN=2]="UNKNOWN",i[i.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",i[i.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",i[i.NOT_FOUND=5]="NOT_FOUND",i[i.ALREADY_EXISTS=6]="ALREADY_EXISTS",i[i.PERMISSION_DENIED=7]="PERMISSION_DENIED",i[i.UNAUTHENTICATED=16]="UNAUTHENTICATED",i[i.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",i[i.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",i[i.ABORTED=10]="ABORTED",i[i.OUT_OF_RANGE=11]="OUT_OF_RANGE",i[i.UNIMPLEMENTED=12]="UNIMPLEMENTED",i[i.INTERNAL=13]="INTERNAL",i[i.UNAVAILABLE=14]="UNAVAILABLE",i[i.DATA_LOSS=15]="DATA_LOSS"})(RpcCode||(RpcCode={}));function isPermanentError(i){switch(i){case Code.OK:return fail("Treated status OK as error");case Code.CANCELLED:case Code.UNKNOWN:case Code.DEADLINE_EXCEEDED:case Code.RESOURCE_EXHAUSTED:case Code.INTERNAL:case Code.UNAVAILABLE:case Code.UNAUTHENTICATED:return!1;case Code.INVALID_ARGUMENT:case Code.NOT_FOUND:case Code.ALREADY_EXISTS:case Code.PERMISSION_DENIED:case Code.FAILED_PRECONDITION:case Code.ABORTED:case Code.OUT_OF_RANGE:case Code.UNIMPLEMENTED:case Code.DATA_LOSS:return!0;default:return fail("Unknown status code: "+i)}}function mapCodeFromRpcStatus(i){var e=RpcCode[i];if(e!==void 0)return mapCodeFromRpcCode(e)}function mapCodeFromRpcCode(i){if(i===void 0)return error("GRPC error has no .code"),Code.UNKNOWN;switch(i){case RpcCode.OK:return Code.OK;case RpcCode.CANCELLED:return Code.CANCELLED;case RpcCode.UNKNOWN:return Code.UNKNOWN;case RpcCode.DEADLINE_EXCEEDED:return Code.DEADLINE_EXCEEDED;case RpcCode.RESOURCE_EXHAUSTED:return Code.RESOURCE_EXHAUSTED;case RpcCode.INTERNAL:return Code.INTERNAL;case RpcCode.UNAVAILABLE:return Code.UNAVAILABLE;case RpcCode.UNAUTHENTICATED:return Code.UNAUTHENTICATED;case RpcCode.INVALID_ARGUMENT:return Code.INVALID_ARGUMENT;case RpcCode.NOT_FOUND:return Code.NOT_FOUND;case RpcCode.ALREADY_EXISTS:return Code.ALREADY_EXISTS;case RpcCode.PERMISSION_DENIED:return Code.PERMISSION_DENIED;case RpcCode.FAILED_PRECONDITION:return Code.FAILED_PRECONDITION;case RpcCode.ABORTED:return Code.ABORTED;case RpcCode.OUT_OF_RANGE:return Code.OUT_OF_RANGE;case RpcCode.UNIMPLEMENTED:return Code.UNIMPLEMENTED;case RpcCode.DATA_LOSS:return Code.DATA_LOSS;default:return fail("Unknown status code: "+i)}}function mapRpcCodeFromCode(i){if(i===void 0)return RpcCode.OK;switch(i){case Code.OK:return RpcCode.OK;case Code.CANCELLED:return RpcCode.CANCELLED;case Code.UNKNOWN:return RpcCode.UNKNOWN;case Code.DEADLINE_EXCEEDED:return RpcCode.DEADLINE_EXCEEDED;case Code.RESOURCE_EXHAUSTED:return RpcCode.RESOURCE_EXHAUSTED;case Code.INTERNAL:return RpcCode.INTERNAL;case Code.UNAVAILABLE:return RpcCode.UNAVAILABLE;case Code.UNAUTHENTICATED:return RpcCode.UNAUTHENTICATED;case Code.INVALID_ARGUMENT:return RpcCode.INVALID_ARGUMENT;case Code.NOT_FOUND:return RpcCode.NOT_FOUND;case Code.ALREADY_EXISTS:return RpcCode.ALREADY_EXISTS;case Code.PERMISSION_DENIED:return RpcCode.PERMISSION_DENIED;case Code.FAILED_PRECONDITION:return RpcCode.FAILED_PRECONDITION;case Code.ABORTED:return RpcCode.ABORTED;case Code.OUT_OF_RANGE:return RpcCode.OUT_OF_RANGE;case Code.UNIMPLEMENTED:return RpcCode.UNIMPLEMENTED;case Code.DATA_LOSS:return RpcCode.DATA_LOSS;default:return fail("Unknown status code: "+i)}}function mapCodeFromHttpStatus(i){switch(i){case 200:return Code.OK;case 400:return Code.INVALID_ARGUMENT;case 401:return Code.UNAUTHENTICATED;case 403:return Code.PERMISSION_DENIED;case 404:return Code.NOT_FOUND;case 409:return Code.ABORTED;case 416:return Code.OUT_OF_RANGE;case 429:return Code.RESOURCE_EXHAUSTED;case 499:return Code.CANCELLED;case 500:return Code.UNKNOWN;case 501:return Code.UNIMPLEMENTED;case 503:return Code.UNAVAILABLE;case 504:return Code.DEADLINE_EXCEEDED;default:return i>=200&&i<300?Code.OK:i>=400&&i<500?Code.FAILED_PRECONDITION:i>=500&&i<600?Code.INTERNAL:Code.UNKNOWN}}var SortedSet=function(){function i(e){this.comparator=e,this.data=new SortedMap(this.comparator)}return i.fromMapKeys=function(e){var o=new i(e.comparator);return e.forEach(function(s){o=o.add(s)}),o},i.prototype.has=function(e){return this.data.get(e)!==null},i.prototype.first=function(){return this.data.minKey()},i.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(i.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),i.prototype.indexOf=function(e){return this.data.indexOf(e)},i.prototype.forEach=function(e){this.data.inorderTraversal(function(o,s){return e(o),!1})},i.prototype.forEachInRange=function(e,o){for(var s=this.data.getIteratorFrom(e[0]);s.hasNext();){var f=s.getNext();if(this.comparator(f.key,e[1])>=0)return;o(f.key)}},i.prototype.forEachWhile=function(e,o){var s;for(o!==void 0?s=this.data.getIteratorFrom(o):s=this.data.getIterator();s.hasNext();){var f=s.getNext(),d=e(f.key);if(!d)return}},i.prototype.firstAfterOrEqual=function(e){var o=this.data.getIteratorFrom(e);return o.hasNext()?o.getNext().key:null},i.prototype.add=function(e){return this.copy(this.data.remove(e).insert(e,!0))},i.prototype.delete=function(e){return this.has(e)?this.copy(this.data.remove(e)):this},i.prototype.isEmpty=function(){return this.data.isEmpty()},i.prototype.unionWith=function(e){var o=this;return e.forEach(function(s){o=o.add(s)}),o},i.prototype.isEqual=function(e){if(!(e instanceof i)||this.size!==e.size)return!1;for(var o=this.data.getIterator(),s=e.data.getIterator();o.hasNext();){var f=o.getNext().key,d=s.getNext().key;if(this.comparator(f,d)!==0)return!1}return!0},i.prototype.toString=function(){var e=[];return this.forEach(function(o){return e.push(o)}),"SortedSet("+e.toString()+")"},i.prototype.copy=function(e){var o=new i(this.comparator);return o.data=e,o},i}(),EMPTY_MAYBE_DOCUMENT_MAP=new SortedMap(DocumentKey.comparator);function maybeDocumentMap(){return EMPTY_MAYBE_DOCUMENT_MAP}var EMPTY_DOCUMENT_MAP=new SortedMap(DocumentKey.comparator);function documentMap(){return EMPTY_DOCUMENT_MAP}var EMPTY_DOCUMENT_VERSION_MAP=new SortedMap(DocumentKey.comparator);function documentVersionMap(){return EMPTY_DOCUMENT_VERSION_MAP}var EMPTY_DOCUMENT_KEY_SET=new SortedSet(DocumentKey.comparator);function documentKeySet(){return EMPTY_DOCUMENT_KEY_SET}var RemoteEvent=function(){function i(e,o,s){this.snapshotVersion=e,this.targetChanges=o,this.documentUpdates=s}return i.prototype.addDocumentUpdate=function(e){this.documentUpdates=this.documentUpdates.insert(e.key,e)},i.prototype.handleExistenceFilterMismatch=function(e){this.targetChanges[e]={mapping:new ResetMapping,snapshotVersion:SnapshotVersion.MIN,currentStatusUpdate:CurrentStatusUpdate.MarkNotCurrent,resumeToken:emptyByteString()}},i}(),CurrentStatusUpdate;(function(i){i[i.None=0]="None",i[i.MarkNotCurrent=1]="MarkNotCurrent",i[i.MarkCurrent=2]="MarkCurrent"})(CurrentStatusUpdate||(CurrentStatusUpdate={}));var EMPTY_KEY_SET=documentKeySet(),ResetMapping=function(){function i(){this.docs=EMPTY_KEY_SET}return Object.defineProperty(i.prototype,"documents",{get:function(){return this.docs},enumerable:!0,configurable:!0}),i.prototype.add=function(e){this.docs=this.docs.add(e)},i.prototype.delete=function(e){this.docs=this.docs.delete(e)},i.prototype.isEqual=function(e){return e!==null&&this.docs.isEqual(e.docs)},i}(),UpdateMapping=function(){function i(){this.addedDocuments=EMPTY_KEY_SET,this.removedDocuments=EMPTY_KEY_SET}return i.prototype.applyToKeySet=function(e){var o=e;return this.addedDocuments.forEach(function(s){return o=o.add(s)}),this.removedDocuments.forEach(function(s){return o=o.delete(s)}),o},i.prototype.add=function(e){this.addedDocuments=this.addedDocuments.add(e),this.removedDocuments=this.removedDocuments.delete(e)},i.prototype.delete=function(e){this.addedDocuments=this.addedDocuments.delete(e),this.removedDocuments=this.removedDocuments.add(e)},i.prototype.isEqual=function(e){return e!==null&&this.addedDocuments.isEqual(e.addedDocuments)&&this.removedDocuments.isEqual(e.removedDocuments)},i}(),DocumentWatchChange=function(){function i(e,o,s,f){this.updatedTargetIds=e,this.removedTargetIds=o,this.key=s,this.newDoc=f}return i}(),ExistenceFilterChange=function(){function i(e,o){this.targetId=e,this.existenceFilter=o}return i}(),WatchTargetChangeState;(function(i){i[i.NoChange=0]="NoChange",i[i.Added=1]="Added",i[i.Removed=2]="Removed",i[i.Current=3]="Current",i[i.Reset=4]="Reset"})(WatchTargetChangeState||(WatchTargetChangeState={}));var WatchTargetChange=function(){function i(e,o,s,f){s===void 0&&(s=emptyByteString()),f===void 0&&(f=null),this.state=e,this.targetIds=o,this.resumeToken=s,this.cause=f}return i}(),WatchChangeAggregator=function(){function i(e,o,s){this.snapshotVersion=e,this.listenTargets=o,this.existenceFilters={},this.targetChanges={},this.documentUpdates=maybeDocumentMap(),this.frozen=!1,this.pendingTargetResponses=shallowCopy(s)}return i.prototype.add=function(e){assert(!this.frozen,"Trying to modify frozen WatchChangeAggregator."),e instanceof DocumentWatchChange?this.addDocumentChange(e):e instanceof WatchTargetChange?this.addTargetChange(e):e instanceof ExistenceFilterChange?this.addExistenceFilterChange(e):fail("Unknown watch change: "+e)},i.prototype.addChanges=function(e){var o=this;assert(!this.frozen,"Trying to modify frozen WatchChangeAggregator."),e.forEach(function(s){return o.add(s)})},i.prototype.createRemoteEvent=function(){var e=this,o=this.targetChanges;return forEachNumber(this.targetChanges,function(s){e.isActiveTarget(s)||delete o[s]}),this.frozen=!0,new RemoteEvent(this.snapshotVersion,o,this.documentUpdates)},i.prototype.ensureTargetChange=function(e){var o=this.targetChanges[e];return o||(o={currentStatusUpdate:CurrentStatusUpdate.None,snapshotVersion:this.snapshotVersion,mapping:new UpdateMapping,resumeToken:emptyByteString()},this.targetChanges[e]=o),o},i.prototype.isActiveTarget=function(e){return!contains(this.pendingTargetResponses,e)&&contains(this.listenTargets,e)},i.prototype.addDocumentChange=function(e){for(var o=!1,s=0,f=e.updatedTargetIds;s<f.length;s++){var d=f[s];if(this.isActiveTarget(d)){var m=this.ensureTargetChange(d);m.mapping.add(e.key),o=!0}}for(var _=0,$=e.removedTargetIds;_<$.length;_++){var d=$[_];if(this.isActiveTarget(d)){var m=this.ensureTargetChange(d);m.mapping.delete(e.key),o=!0}}e.newDoc&&o&&(this.documentUpdates=this.documentUpdates.insert(e.key,e.newDoc))},i.prototype.addTargetChange=function(e){var o=this;e.targetIds.forEach(function(s){var f=o.ensureTargetChange(s);switch(e.state){case WatchTargetChangeState.NoChange:o.isActiveTarget(s)&&applyResumeToken(f,e.resumeToken);break;case WatchTargetChangeState.Added:o.recordTargetResponse(s),contains(o.pendingTargetResponses,s)||(f.mapping=new UpdateMapping,f.currentStatusUpdate=CurrentStatusUpdate.None,delete o.existenceFilters[s]),applyResumeToken(f,e.resumeToken);break;case WatchTargetChangeState.Removed:o.recordTargetResponse(s),assert(!e.cause,"WatchChangeAggregator does not handle errored targets");break;case WatchTargetChangeState.Current:o.isActiveTarget(s)&&(f.currentStatusUpdate=CurrentStatusUpdate.MarkCurrent,applyResumeToken(f,e.resumeToken));break;case WatchTargetChangeState.Reset:o.isActiveTarget(s)&&(f.mapping=new ResetMapping,applyResumeToken(f,e.resumeToken));break;default:fail("Unknown target watch change state: "+e.state)}})},i.prototype.recordTargetResponse=function(e){var o=(this.pendingTargetResponses[e]||0)-1;o===0?delete this.pendingTargetResponses[e]:this.pendingTargetResponses[e]=o},i.prototype.addExistenceFilterChange=function(e){this.isActiveTarget(e.targetId)&&(this.existenceFilters[e.targetId]=e.existenceFilter)},i}();function applyResumeToken(i,e){e.length>0&&(i.resumeToken=e)}var DIRECTIONS=function(){var i={};return i[Direction.ASCENDING.name]="ASCENDING",i[Direction.DESCENDING.name]="DESCENDING",i}(),OPERATORS=function(){var i={};return i[RelationOp.LESS_THAN.name]="LESS_THAN",i[RelationOp.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",i[RelationOp.GREATER_THAN.name]="GREATER_THAN",i[RelationOp.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",i[RelationOp.EQUAL.name]="EQUAL",i}();function assertPresent(i,e){assert(!isNullOrUndefined(i),e+" is missing")}function parseInt64(i){return typeof i=="number"?i:typeof i=="string"?Number(i):fail("can't parse "+i)}var JsonProtoSerializer=function(){function i(e,o){this.databaseId=e,this.options=o}return i.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},i.prototype.unsafeCastProtoByteString=function(e){return e},i.prototype.fromRpcStatus=function(e){var o=e.code===void 0?Code.UNKNOWN:mapCodeFromRpcCode(e.code);return new FirestoreError(o,e.message||"")},i.prototype.toInt32Value=function(e){if(!isNullOrUndefined(e))return{value:e}},i.prototype.fromInt32Value=function(e){var o;return typeof e=="object"?o=e.value:o=e,isNullOrUndefined(o)?null:o},i.prototype.toTimestamp=function(e){return{seconds:e.seconds,nanos:e.nanos}},i.prototype.fromTimestamp=function(e){if(typeof e=="string")return Timestamp.fromISOString(e);assert(!!e,"Cannot deserialize null or undefined timestamp.");var o=parseInt64(e.seconds||"0"),s=e.nanos||0;return new Timestamp(o,s)},i.prototype.toBytes=function(e){return this.options.useProto3Json?e.toBase64():this.unsafeCastProtoByteString(e.toUint8Array())},i.prototype.fromBlob=function(e){return typeof e=="string"?(assert(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Blob$1.fromBase64String(e)):(assert(!this.options.useProto3Json,"Expected bytes to be passed in as string, but got something else instead."),Blob$1.fromUint8Array(e))},i.prototype.toVersion=function(e){return this.toTimestamp(e.toTimestamp())},i.prototype.fromVersion=function(e){return assert(!!e,"Trying to deserialize version that isn't set"),SnapshotVersion.fromTimestamp(this.fromTimestamp(e))},i.prototype.toResourceName=function(e,o){return this.fullyQualifiedPrefixPath(e).child("documents").child(o).canonicalString()},i.prototype.fromResourceName=function(e){var o=ResourcePath.fromString(e);return assert(this.isValidResourceName(o),"Tried to deserialize invalid key "+o.toString()),o},i.prototype.toName=function(e){return this.toResourceName(this.databaseId,e.path)},i.prototype.fromName=function(e){var o=this.fromResourceName(e);return assert(o.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+o.get(1)+" vs "+this.databaseId.projectId),assert(!o.get(3)&&!this.databaseId.database||o.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+o.get(3)+" vs "+this.databaseId.database),new DocumentKey(this.extractLocalPathFromResourceName(o))},i.prototype.toQueryPath=function(e){return e.length===0?this.encodedDatabaseId:this.toResourceName(this.databaseId,e)},i.prototype.fromQueryPath=function(e){var o=this.fromResourceName(e);return o.length===4?ResourcePath.EMPTY_PATH:this.extractLocalPathFromResourceName(o)},Object.defineProperty(i.prototype,"encodedDatabaseId",{get:function(){var e=new ResourcePath(["projects",this.databaseId.projectId,"databases",this.databaseId.database]);return e.canonicalString()},enumerable:!0,configurable:!0}),i.prototype.fullyQualifiedPrefixPath=function(e){return new ResourcePath(["projects",e.projectId,"databases",e.database])},i.prototype.extractLocalPathFromResourceName=function(e){return assert(e.length>4&&e.get(4)==="documents","tried to deserialize invalid key "+e.toString()),e.popFirst(5)},i.prototype.isValidResourceName=function(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"},i.prototype.toValue=function(e){if(e instanceof NullValue)return{nullValue:"NULL_VALUE"};if(e instanceof BooleanValue)return{booleanValue:e.value()};if(e instanceof IntegerValue)return{integerValue:""+e.value()};if(e instanceof DoubleValue){var o=e.value();if(this.options.useProto3Json){if(isNaN(o))return{doubleValue:"NaN"};if(o===1/0)return{doubleValue:"Infinity"};if(o===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:e.value()}}else return e instanceof StringValue?{stringValue:e.value()}:e instanceof ObjectValue?{mapValue:this.toMapValue(e)}:e instanceof ArrayValue?{arrayValue:this.toArrayValue(e)}:e instanceof TimestampValue?{timestampValue:this.toTimestamp(e.internalValue)}:e instanceof GeoPointValue?{geoPointValue:{latitude:e.value().latitude,longitude:e.value().longitude}}:e instanceof BlobValue?{bytesValue:this.toBytes(e.value())}:e instanceof RefValue?{referenceValue:this.toResourceName(e.databaseId,e.key.path)}:fail("Unknown FieldValue "+JSON.stringify(e))},i.prototype.fromValue=function(e){var o=this,s=e.value_type;if(hasTag(e,s,"nullValue"))return NullValue.INSTANCE;if(hasTag(e,s,"booleanValue"))return BooleanValue.of(e.booleanValue);if(hasTag(e,s,"integerValue"))return new IntegerValue(parseInt64(e.integerValue));if(hasTag(e,s,"doubleValue")){if(this.options.useProto3Json){if(e.doubleValue==="NaN")return DoubleValue.NAN;if(e.doubleValue==="Infinity")return DoubleValue.POSITIVE_INFINITY;if(e.doubleValue==="-Infinity")return DoubleValue.NEGATIVE_INFINITY}return new DoubleValue(e.doubleValue)}else{if(hasTag(e,s,"stringValue"))return new StringValue(e.stringValue);if(hasTag(e,s,"mapValue"))return this.fromFields(e.mapValue.fields||{});if(hasTag(e,s,"arrayValue")){assertPresent(e.arrayValue,"arrayValue");var f=e.arrayValue.values||[];return new ArrayValue(f.map(function(et){return o.fromValue(et)}))}else{if(hasTag(e,s,"timestampValue"))return assertPresent(e.timestampValue,"timestampValue"),new TimestampValue(this.fromTimestamp(e.timestampValue));if(hasTag(e,s,"geoPointValue")){assertPresent(e.geoPointValue,"geoPointValue");var d=e.geoPointValue.latitude||0,m=e.geoPointValue.longitude||0;return new GeoPointValue(new GeoPoint(d,m))}else if(hasTag(e,s,"bytesValue")){assertPresent(e.bytesValue,"bytesValue");var _=this.fromBlob(e.bytesValue);return new BlobValue(_)}else if(hasTag(e,s,"referenceValue")){assertPresent(e.referenceValue,"referenceValue");var $=this.fromResourceName(e.referenceValue),G=new DatabaseId($.get(1),$.get(3)),Z=new DocumentKey(this.extractLocalPathFromResourceName($));return new RefValue(G,Z)}else return fail("Unknown Value proto "+JSON.stringify(e))}}},i.prototype.toMutationDocument=function(e,o){return{name:this.toName(e),fields:this.toFields(o)}},i.prototype.toDocument=function(e){return assert(!e.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toTimestamp(e.version.toTimestamp())}},i.prototype.fromDocument=function(e){return new Document(this.fromName(e.name),this.fromVersion(e.updateTime),this.fromFields(e.fields||{}),{hasLocalMutations:!1})},i.prototype.toFields=function(e){var o=this,s={};return e.forEach(function(f,d){s[f]=o.toValue(d)}),s},i.prototype.fromFields=function(e){var o=this,s=e,f=ObjectValue.EMPTY;return forEach(s,function(d,m){f=f.set(new FieldPath$1([d]),o.fromValue(m))}),f},i.prototype.toMapValue=function(e){return{fields:this.toFields(e)}},i.prototype.toArrayValue=function(e){var o=this,s=[];return e.forEach(function(f){s.push(o.toValue(f))}),{values:s}},i.prototype.fromFound=function(e){assert(!!e.found,"Tried to deserialize a found document from a missing document."),assertPresent(e.found.name,"doc.found.name"),assertPresent(e.found.updateTime,"doc.found.updateTime");var o=this.fromName(e.found.name),s=this.fromVersion(e.found.updateTime),f=this.fromFields(e.found.fields||{});return new Document(o,s,f,{hasLocalMutations:!1})},i.prototype.fromMissing=function(e){assert(!!e.missing,"Tried to deserialize a missing document from a found document."),assert(!!e.readTime,"Tried to deserialize a missing document without a read time.");var o=this.fromName(e.missing),s=this.fromVersion(e.readTime);return new NoDocument(o,s)},i.prototype.fromMaybeDocument=function(e){var o=e.result;return hasTag(e,o,"found")?this.fromFound(e):hasTag(e,o,"missing")?this.fromMissing(e):fail("invalid batch get response: "+JSON.stringify(e))},i.prototype.toWatchTargetChangeState=function(e){switch(e){case WatchTargetChangeState.Added:return"ADD";case WatchTargetChangeState.Current:return"CURRENT";case WatchTargetChangeState.NoChange:return"NO_CHANGE";case WatchTargetChangeState.Removed:return"REMOVE";case WatchTargetChangeState.Reset:return"RESET";default:return fail("Unknown WatchTargetChangeState: "+e)}},i.prototype.toTestWatchChange=function(e){if(e instanceof ExistenceFilterChange)return{filter:{count:e.existenceFilter.count,targetId:e.targetId}};if(e instanceof DocumentWatchChange){if(e.newDoc instanceof Document){var o=e.newDoc;return{documentChange:{document:{name:this.toName(o.key),fields:this.toFields(o.data),updateTime:this.toVersion(o.version)},targetIds:e.updatedTargetIds,removedTargetIds:e.removedTargetIds}}}else if(e.newDoc instanceof NoDocument){var o=e.newDoc;return{documentDelete:{document:this.toName(o.key),readTime:this.toVersion(o.version),removedTargetIds:e.removedTargetIds}}}else if(e.newDoc===null)return{documentRemove:{document:this.toName(e.key),removedTargetIds:e.removedTargetIds}}}if(e instanceof WatchTargetChange){var s=void 0;return e.cause&&(s={code:mapRpcCodeFromCode(e.cause.code),message:e.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(e.state),targetIds:e.targetIds,resumeToken:this.unsafeCastProtoByteString(e.resumeToken),cause:s}}}return fail("Unrecognized watch change: "+JSON.stringify(e))},i.prototype.fromWatchChange=function(e){var o=e.response_type,s;if(hasTag(e,o,"targetChange")){assertPresent(e.targetChange,"targetChange");var f=this.fromWatchTargetChangeState(e.targetChange.targetChangeType||"NO_CHANGE"),d=e.targetChange.targetIds||[],m=e.targetChange.resumeToken||this.emptyByteString(),_=e.targetChange.cause,$=_&&this.fromRpcStatus(_);s=new WatchTargetChange(f,d,m,$||null)}else if(hasTag(e,o,"documentChange")){assertPresent(e.documentChange,"documentChange"),assertPresent(e.documentChange.document,"documentChange.name"),assertPresent(e.documentChange.document.name,"documentChange.document.name"),assertPresent(e.documentChange.document.updateTime,"documentChange.document.updateTime");var G=e.documentChange,Z=this.fromName(G.document.name),et=this.fromVersion(G.document.updateTime),tt=this.fromFields(G.document.fields||{}),nt=new Document(Z,et,tt,{hasLocalMutations:!1}),st=G.targetIds||[],rt=G.removedTargetIds||[];s=new DocumentWatchChange(st,rt,nt.key,nt)}else if(hasTag(e,o,"documentDelete")){assertPresent(e.documentDelete,"documentDelete"),assertPresent(e.documentDelete.document,"documentDelete.document");var it=e.documentDelete,Z=this.fromName(it.document),et=it.readTime?this.fromVersion(it.readTime):SnapshotVersion.forDeletedDoc(),nt=new NoDocument(Z,et),rt=it.removedTargetIds||[];s=new DocumentWatchChange([],rt,nt.key,nt)}else if(hasTag(e,o,"documentRemove")){assertPresent(e.documentRemove,"documentRemove"),assertPresent(e.documentRemove.document,"documentRemove");var ot=e.documentRemove,Z=this.fromName(ot.document),rt=ot.removedTargetIds||[];s=new DocumentWatchChange([],rt,Z,null)}else if(hasTag(e,o,"filter")){assertPresent(e.filter,"filter"),assertPresent(e.filter.targetId,"filter.targetId");var lt=e.filter,ft=lt.count||0,ct=new ExistenceFilter(ft),pt=lt.targetId;s=new ExistenceFilterChange(pt,ct)}else return fail("Unknown change type "+JSON.stringify(e));return s},i.prototype.fromWatchTargetChangeState=function(e){return e==="NO_CHANGE"?WatchTargetChangeState.NoChange:e==="ADD"?WatchTargetChangeState.Added:e==="REMOVE"?WatchTargetChangeState.Removed:e==="CURRENT"?WatchTargetChangeState.Current:e==="RESET"?WatchTargetChangeState.Reset:fail("Got unexpected TargetChange.state: "+e)},i.prototype.versionFromListenResponse=function(e){var o=e.response_type;if(!hasTag(e,o,"targetChange"))return SnapshotVersion.MIN;var s=e.targetChange;return s.targetIds&&s.targetIds.length||!s.readTime?SnapshotVersion.MIN:this.fromVersion(s.readTime)},i.prototype.toMutation=function(e){var o=this,s;if(e instanceof SetMutation)s={update:this.toMutationDocument(e.key,e.value)};else if(e instanceof DeleteMutation)s={delete:this.toName(e.key)};else if(e instanceof PatchMutation)s={update:this.toMutationDocument(e.key,e.data),updateMask:this.toDocumentMask(e.fieldMask)};else if(e instanceof TransformMutation)s={transform:{document:this.toName(e.key),fieldTransforms:e.fieldTransforms.map(function(f){return o.toFieldTransform(f)})}};else return fail("Unknown mutation type "+e.type);return e.precondition.isNone||(s.currentDocument=this.toPrecondition(e.precondition)),s},i.prototype.fromMutation=function(e){var o=this,s=e.currentDocument?this.fromPrecondition(e.currentDocument):Precondition.NONE;if(e.update){assertPresent(e.update.name,"name");var f=this.fromName(e.update.name),d=this.fromFields(e.update.fields||{});if(e.updateMask){var m=this.fromDocumentMask(e.updateMask);return new PatchMutation(f,d,m,s)}else return new SetMutation(f,d,s)}else if(e.delete){var f=this.fromName(e.delete);return new DeleteMutation(f,s)}else if(e.transform){var f=this.fromName(e.transform.document),_=e.transform.fieldTransforms.map(function(G){return o.fromFieldTransform(G)});return assert(s.exists===!0,'Transforms only support precondition "exists == true"'),new TransformMutation(f,_)}else return fail("unknown mutation proto: "+JSON.stringify(e))},i.prototype.toPrecondition=function(e){return assert(!e.isNone,"Can't serialize an empty precondition"),e.updateTime!==void 0?{updateTime:this.toVersion(e.updateTime)}:e.exists!==void 0?{exists:e.exists}:fail("Unknown precondition")},i.prototype.fromPrecondition=function(e){return e.updateTime!==void 0?Precondition.updateTime(this.fromVersion(e.updateTime)):e.exists!==void 0?Precondition.exists(e.exists):Precondition.NONE},i.prototype.fromWriteResult=function(e){var o=this,s=e.updateTime?this.fromVersion(e.updateTime):null,f=null;return e.transformResults&&e.transformResults.length>0&&(f=e.transformResults.map(function(d){return o.fromValue(d)})),new MutationResult(s,f)},i.prototype.fromWriteResults=function(e){var o=this;return(e||[]).map(function(s){return o.fromWriteResult(s)})},i.prototype.toFieldTransform=function(e){return assert(e.transform instanceof ServerTimestampTransform,"Unknown transform: "+e.transform),{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"}},i.prototype.fromFieldTransform=function(e){assert(e.setToServerValue==="REQUEST_TIME","Unknown transform proto: "+JSON.stringify(e));var o=FieldPath$1.fromServerFormat(e.fieldPath);return new FieldTransform(o,ServerTimestampTransform.instance)},i.prototype.toDocumentsTarget=function(e){return{documents:[this.toQueryPath(e.path)]}},i.prototype.fromDocumentsTarget=function(e){var o=e.documents.length;assert(o===1,"DocumentsTarget contained other than 1 document: "+o);var s=e.documents[0];return Query$1.atPath(this.fromQueryPath(s))},i.prototype.toQueryTarget=function(e){var o={structuredQuery:{}};if(e.path.isEmpty())o.parent=this.toQueryPath(ResourcePath.EMPTY_PATH);else{var s=e.path;assert(s.length%2!==0,"Document queries with filters are not supported."),o.parent=this.toQueryPath(s.popLast()),o.structuredQuery.from=[{collectionId:s.lastSegment()}]}var f=this.toFilter(e.filters);f&&(o.structuredQuery.where=f);var d=this.toOrder(e.orderBy);d&&(o.structuredQuery.orderBy=d);var m=this.toInt32Value(e.limit);return m!==void 0&&(o.structuredQuery.limit=m),e.startAt&&(o.structuredQuery.startAt=this.toCursor(e.startAt)),e.endAt&&(o.structuredQuery.endAt=this.toCursor(e.endAt)),o},i.prototype.fromQueryTarget=function(e){var o=this.fromQueryPath(e.parent),s=e.structuredQuery,f=s.from?s.from.length:0;if(f>0){assert(f===1,"StructuredQuery.from with more than one collection is not supported.");var d=s.from[0];o=o.child(d.collectionId)}var m=[];s.where&&(m=this.fromFilter(s.where));var _=[];s.orderBy&&(_=this.fromOrder(s.orderBy));var $=null;s.limit&&($=this.fromInt32Value(s.limit));var G=null;s.startAt&&(G=this.fromCursor(s.startAt));var Z=null;return s.endAt&&(Z=this.fromCursor(s.endAt)),new Query$1(o,_,m,$,G,Z)},i.prototype.toListenRequestLabels=function(e){var o=this.toLabel(e.purpose);return o==null?null:{"goog-listen-tags":o}},i.prototype.toLabel=function(e){switch(e){case QueryPurpose.Listen:return null;case QueryPurpose.ExistenceFilterMismatch:return"existence-filter-mismatch";case QueryPurpose.LimboResolution:return"limbo-document";default:return fail("Unrecognized query purpose: "+e)}},i.prototype.toTarget=function(e){var o,s=e.query;return s.isDocumentQuery()?o={documents:this.toDocumentsTarget(s)}:o={query:this.toQueryTarget(s)},o.targetId=e.targetId,e.resumeToken.length>0&&(o.resumeToken=this.unsafeCastProtoByteString(e.resumeToken)),o},i.prototype.toFilter=function(e){var o=this;if(e.length!==0){var s=e.map(function(f){return f instanceof RelationFilter?o.toRelationFilter(f):o.toUnaryFilter(f)});return s.length===1?s[0]:{compositeFilter:{op:"AND",filters:s}}}},i.prototype.fromFilter=function(e){var o=this;return e?e.unaryFilter!==void 0?[this.fromUnaryFilter(e)]:e.fieldFilter!==void 0?[this.fromRelationFilter(e)]:e.compositeFilter!==void 0?e.compositeFilter.filters.map(function(s){return o.fromFilter(s)}).reduce(function(s,f){return s.concat(f)}):fail("Unknown filter: "+JSON.stringify(e)):[]},i.prototype.toOrder=function(e){var o=this;if(e.length!==0)return e.map(function(s){return o.toPropertyOrder(s)})},i.prototype.fromOrder=function(e){var o=this;return e.map(function(s){return o.fromPropertyOrder(s)})},i.prototype.toCursor=function(e){var o=this;return{before:e.before,values:e.position.map(function(s){return o.toValue(s)})}},i.prototype.fromCursor=function(e){var o=this,s=!!e.before,f=e.values.map(function(d){return o.fromValue(d)});return new Bound(f,s)},i.prototype.toDirection=function(e){return DIRECTIONS[e.name]},i.prototype.fromDirection=function(e){switch(e){case"ASCENDING":return Direction.ASCENDING;case"DESCENDING":return Direction.DESCENDING;default:return}},i.prototype.toOperatorName=function(e){return OPERATORS[e.name]},i.prototype.fromOperatorName=function(e){switch(e){case"EQUAL":return RelationOp.EQUAL;case"GREATER_THAN":return RelationOp.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return RelationOp.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return RelationOp.LESS_THAN;case"LESS_THAN_OR_EQUAL":return RelationOp.LESS_THAN_OR_EQUAL;case"OPERATOR_UNSPECIFIED":return fail("Unspecified relation");default:return fail("Unknown relation")}},i.prototype.toFieldPathReference=function(e){return{fieldPath:e.canonicalString()}},i.prototype.fromFieldPathReference=function(e){return FieldPath$1.fromServerFormat(e.fieldPath)},i.prototype.toPropertyOrder=function(e){return{field:this.toFieldPathReference(e.field),direction:this.toDirection(e.dir)}},i.prototype.fromPropertyOrder=function(e){return new OrderBy(this.fromFieldPathReference(e.field),this.fromDirection(e.direction))},i.prototype.toRelationFilter=function(e){return e instanceof RelationFilter?{fieldFilter:{field:this.toFieldPathReference(e.field),op:this.toOperatorName(e.op),value:this.toValue(e.value)}}:fail("Unrecognized filter: "+JSON.stringify(e))},i.prototype.fromRelationFilter=function(e){return new RelationFilter(this.fromFieldPathReference(e.fieldFilter.field),this.fromOperatorName(e.fieldFilter.op),this.fromValue(e.fieldFilter.value))},i.prototype.toUnaryFilter=function(e){return e instanceof NanFilter?{unaryFilter:{field:this.toFieldPathReference(e.field),op:"IS_NAN"}}:e instanceof NullFilter?{unaryFilter:{field:this.toFieldPathReference(e.field),op:"IS_NULL"}}:fail("Unrecognized filter: "+JSON.stringify(e))},i.prototype.fromUnaryFilter=function(e){switch(e.unaryFilter.op){case"IS_NAN":var o=this.fromFieldPathReference(e.unaryFilter.field);return new NanFilter(o);case"IS_NULL":var s=this.fromFieldPathReference(e.unaryFilter.field);return new NullFilter(s);case"OPERATOR_UNSPECIFIED":return fail("Unspecified filter");default:return fail("Unknown filter")}},i.prototype.toDocumentMask=function(e){return{fieldPaths:e.fields.map(function(o){return o.canonicalString()})}},i.prototype.fromDocumentMask=function(e){var o=e.fieldPaths||[],s=o.map(function(f){return FieldPath$1.fromServerFormat(f)});return new FieldMask(s)},i}();function hasTag(i,e,o){return e===o||!e&&o in i}var dist={exports:{}};(function(){var g,goog=goog||{},k=this;function l(i){return typeof i=="string"}function aa(){}function ba(i){var e=typeof i;if(e=="object")if(i){if(i instanceof Array)return"array";if(i instanceof Object)return e;var o=Object.prototype.toString.call(i);if(o=="[object Window]")return"object";if(o=="[object Array]"||typeof i.length=="number"&&typeof i.splice<"u"&&typeof i.propertyIsEnumerable<"u"&&!i.propertyIsEnumerable("splice"))return"array";if(o=="[object Function]"||typeof i.call<"u"&&typeof i.propertyIsEnumerable<"u"&&!i.propertyIsEnumerable("call"))return"function"}else return"null";else if(e=="function"&&typeof i.call>"u")return"object";return e}function n(i){return ba(i)=="array"}function ca(i){var e=ba(i);return e=="array"||e=="object"&&typeof i.length=="number"}function da(i){return ba(i)=="function"}function p(i){var e=typeof i;return e=="object"&&i!=null||e=="function"}var q="closure_uid_"+(1e9*Math.random()>>>0),ea=0;function fa(i,e,o){return i.call.apply(i.bind,arguments)}function ha(i,e,o){if(!i)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var f=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(f,s),i.apply(e,f)}}return function(){return i.apply(e,arguments)}}function r(i,e,o){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?r=fa:r=ha,r.apply(null,arguments)}function ia(i,e){var o=Array.prototype.slice.call(arguments,1);return function(){var s=o.slice();return s.push.apply(s,arguments),i.apply(this,s)}}var t=Date.now||function(){return+new Date};function u(i,e){function o(){}o.prototype=e.prototype,i.H=e.prototype,i.prototype=new o,i.prototype.constructor=i,i.Cb=function(s,f,d){for(var m=Array(arguments.length-2),_=2;_<arguments.length;_++)m[_-2]=arguments[_];return e.prototype[f].apply(s,m)}}function ja(i){if(Error.captureStackTrace)Error.captureStackTrace(this,ja);else{var e=Error().stack;e&&(this.stack=e)}i&&(this.message=String(i))}u(ja,Error),ja.prototype.name="CustomError";function ka(i,e){for(var o=i.split("%s"),s="",f=Array.prototype.slice.call(arguments,1);f.length&&1<o.length;)s+=o.shift()+f.shift();return s+o.join("%s")}var la=String.prototype.trim?function(i){return i.trim()}:function(i){return i.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};function ma(i,e){return i<e?-1:i>e?1:0}function na(i,e){e.unshift(i),ja.call(this,ka.apply(null,e)),e.shift()}u(na,ja),na.prototype.name="AssertionError";function oa(i,e){throw new na("Failure"+(i?": "+i:""),Array.prototype.slice.call(arguments,1))}function w(){this.i=this.i,this.w=this.w}var qa=0;w.prototype.i=!1,w.prototype.Z=function(){!this.i&&(this.i=!0,this.A(),qa!=0)&&(this[q]||(this[q]=++ea))},w.prototype.A=function(){if(this.w)for(;this.w.length;)this.w.shift()()};var sa=Array.prototype.indexOf?function(i,e){return Array.prototype.indexOf.call(i,e,void 0)}:function(i,e){if(l(i))return l(e)&&e.length==1?i.indexOf(e,0):-1;for(var o=0;o<i.length;o++)if(o in i&&i[o]===e)return o;return-1},ta=Array.prototype.forEach?function(i,e,o){Array.prototype.forEach.call(i,e,o)}:function(i,e,o){for(var s=i.length,f=l(i)?i.split(""):i,d=0;d<s;d++)d in f&&e.call(o,f[d],d,i)};function ua(i){e:{for(var e=va,o=i.length,s=l(i)?i.split(""):i,f=0;f<o;f++)if(f in s&&e.call(void 0,s[f],f,i)){e=f;break e}e=-1}return 0>e?null:l(i)?i.charAt(e):i[e]}function wa(i){if(!n(i))for(var e=i.length-1;0<=e;e--)delete i[e];i.length=0}function xa(i){return Array.prototype.concat.apply([],arguments)}function ya(i){var e=i.length;if(0<e){for(var o=Array(e),s=0;s<e;s++)o[s]=i[s];return o}return[]}var x;e:{var za=k.navigator;if(za){var Aa=za.userAgent;if(Aa){x=Aa;break e}}x=""}function y(i){return x.indexOf(i)!=-1}function Ba(i,e,o){for(var s in i)e.call(o,i[s],s,i)}function Ca(i){var e=[],o=0,s;for(s in i)e[o++]=i[s];return e}function Da(i){var e=[],o=0,s;for(s in i)e[o++]=s;return e}function Ea(i){var e={},o;for(o in i)e[o]=i[o];return e}var Fa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ga(i,e){for(var o,s,f=1;f<arguments.length;f++){s=arguments[f];for(o in s)i[o]=s[o];for(var d=0;d<Fa.length;d++)o=Fa[d],Object.prototype.hasOwnProperty.call(s,o)&&(i[o]=s[o])}}function Ha(i){return Ha[" "](i),i}Ha[" "]=aa;function Ia(i,e){var o=Ja;return Object.prototype.hasOwnProperty.call(o,i)?o[i]:o[i]=e(i)}var Ka=y("Opera"),z=y("Trident")||y("MSIE"),La=y("Edge"),Ma=y("Gecko")&&!(x.toLowerCase().indexOf("webkit")!=-1&&!y("Edge"))&&!(y("Trident")||y("MSIE"))&&!y("Edge"),Na=x.toLowerCase().indexOf("webkit")!=-1&&!y("Edge");function Oa(){var i=k.document;return i?i.documentMode:void 0}var Pa;e:{var Qa="",Ra=function(){var i=x;if(Ma)return/rv:([^\);]+)(\)|;)/.exec(i);if(La)return/Edge\/([\d\.]+)/.exec(i);if(z)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(i);if(Na)return/WebKit\/(\S+)/.exec(i);if(Ka)return/(?:Version)[ \/]?(\S+)/.exec(i)}();if(Ra&&(Qa=Ra?Ra[1]:""),z){var Sa=Oa();if(Sa!=null&&Sa>parseFloat(Qa)){Pa=String(Sa);break e}}Pa=Qa}var Ja={};function Ta(i){return Ia(i,function(){for(var e=0,o=la(String(Pa)).split("."),s=la(String(i)).split("."),f=Math.max(o.length,s.length),d=0;e==0&&d<f;d++){var m=o[d]||"",_=s[d]||"";do{if(m=/(\d*)(\D*)(.*)/.exec(m)||["","","",""],_=/(\d*)(\D*)(.*)/.exec(_)||["","","",""],m[0].length==0&&_[0].length==0)break;e=ma(m[1].length==0?0:parseInt(m[1],10),_[1].length==0?0:parseInt(_[1],10))||ma(m[2].length==0,_[2].length==0)||ma(m[2],_[2]),m=m[3],_=_[3]}while(e==0)}return 0<=e})}var Ua,Va=k.document;Ua=Va&&z?Oa()||(Va.compatMode=="CSS1Compat"?parseInt(Pa,10):5):void 0;var Wa=Object.freeze||function(i){return i},Xa=!z||9<=Number(Ua),Ya=z&&!Ta("9"),Za=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var i=!1,e=Object.defineProperty({},"passive",{get:function(){i=!0}});return k.addEventListener("test",aa,e),k.removeEventListener("test",aa,e),i}();function A(i,e){this.type=i,this.a=this.target=e,this.Pa=!0}A.prototype.b=function(){this.Pa=!1};function $a(i,e){if(A.call(this,i?i.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,i){var o=this.type=i.type,s=i.changedTouches?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.a=e,e=i.relatedTarget){if(Ma){e:{try{Ha(e.nodeName);var f=!0;break e}catch{}f=!1}f||(e=null)}}else o=="mouseover"?e=i.fromElement:o=="mouseout"&&(e=i.toElement);this.relatedTarget=e,s===null?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=l(i.pointerType)?i.pointerType:ab[i.pointerType]||"",this.c=i,i.defaultPrevented&&this.b()}}u($a,A);var ab=Wa({2:"touch",3:"pen",4:"mouse"});$a.prototype.b=function(){$a.H.b.call(this);var i=this.c;if(i.preventDefault)i.preventDefault();else if(i.returnValue=!1,Ya)try{(i.ctrlKey||112<=i.keyCode&&123>=i.keyCode)&&(i.keyCode=-1)}catch{}};var bb="closure_listenable_"+(1e6*Math.random()|0);function cb(i){return!(!i||!i[bb])}var db=0;function eb(i,e,o,s,f){this.listener=i,this.a=null,this.src=e,this.type=o,this.capture=!!s,this.ga=f,this.key=++db,this.Y=this.ca=!1}function fb(i){i.Y=!0,i.listener=null,i.a=null,i.src=null,i.ga=null}function gb(i){this.src=i,this.a={},this.b=0}gb.prototype.add=function(i,e,o,s,f){var d=i.toString();i=this.a[d],i||(i=this.a[d]=[],this.b++);var m=hb(i,e,s,f);return-1<m?(e=i[m],o||(e.ca=!1)):(e=new eb(e,this.src,d,!!s,f),e.ca=o,i.push(e)),e};function ib(i,e){var o=e.type;if(o in i.a){var s=i.a[o],f=sa(s,e),d;(d=0<=f)&&Array.prototype.splice.call(s,f,1),d&&(fb(e),i.a[o].length==0&&(delete i.a[o],i.b--))}}function jb(i,e,o,s,f){return i=i.a[e.toString()],e=-1,i&&(e=hb(i,o,s,f)),-1<e?i[e]:null}function hb(i,e,o,s){for(var f=0;f<i.length;++f){var d=i[f];if(!d.Y&&d.listener==e&&d.capture==!!o&&d.ga==s)return f}return-1}var kb="closure_lm_"+(1e6*Math.random()|0),lb={};function nb(i,e,o,s,f){if(s&&s.once)return ob(i,e,o,s,f);if(n(e)){for(var d=0;d<e.length;d++)nb(i,e[d],o,s,f);return null}return o=pb(o),cb(i)?i.aa(e,o,p(s)?!!s.capture:!!s,f):qb(i,e,o,!1,s,f)}function qb(i,e,o,s,f,d){if(!e)throw Error("Invalid event type");var m=p(f)?!!f.capture:!!f,_=rb(i);if(_||(i[kb]=_=new gb(i)),o=_.add(e,o,s,m,d),o.a)return o;if(s=sb(),o.a=s,s.src=i,s.listener=o,i.addEventListener)Za||(f=m),f===void 0&&(f=!1),i.addEventListener(e.toString(),s,f);else if(i.attachEvent)i.attachEvent(tb(e.toString()),s);else if(i.addListener&&i.removeListener)i.addListener(s);else throw Error("addEventListener and attachEvent are unavailable.");return o}function sb(){var i=ub,e=Xa?function(o){return i.call(e.src,e.listener,o)}:function(o){if(o=i.call(e.src,e.listener,o),!o)return o};return e}function ob(i,e,o,s,f){if(n(e)){for(var d=0;d<e.length;d++)ob(i,e[d],o,s,f);return null}return o=pb(o),cb(i)?i.Ha(e,o,p(s)?!!s.capture:!!s,f):qb(i,e,o,!0,s,f)}function vb(i,e,o,s,f){if(n(e))for(var d=0;d<e.length;d++)vb(i,e[d],o,s,f);else s=p(s)?!!s.capture:!!s,o=pb(o),cb(i)?i.va(e,o,s,f):i&&(i=rb(i))&&(e=jb(i,e,o,s,f))&&wb(e)}function wb(i){if(typeof i!="number"&&i&&!i.Y){var e=i.src;if(cb(e))ib(e.c,i);else{var o=i.type,s=i.a;e.removeEventListener?e.removeEventListener(o,s,i.capture):e.detachEvent?e.detachEvent(tb(o),s):e.addListener&&e.removeListener&&e.removeListener(s),(o=rb(e))?(ib(o,i),o.b==0&&(o.src=null,e[kb]=null)):fb(i)}}}function tb(i){return i in lb?lb[i]:lb[i]="on"+i}function xb(i,e,o,s){var f=!0;if((i=rb(i))&&(e=i.a[e.toString()]))for(e=e.concat(),i=0;i<e.length;i++){var d=e[i];d&&d.capture==o&&!d.Y&&(d=yb(d,s),f=f&&d!==!1)}return f}function yb(i,e){var o=i.listener,s=i.ga||i.src;return i.ca&&wb(i),o.call(s,e)}function ub(i,e){if(i.Y)return!0;if(!Xa){if(!e)e:{e=["window","event"];for(var o=k,s=0;s<e.length;s++)if(o=o[e[s]],o==null){e=null;break e}e=o}if(s=e,e=new $a(s,this),o=!0,!(0>s.keyCode||s.returnValue!=null)){e:{var f=!1;if(s.keyCode==0)try{s.keyCode=-1;break e}catch{f=!0}(f||s.returnValue==null)&&(s.returnValue=!0)}for(s=[],f=e.a;f;f=f.parentNode)s.push(f);for(i=i.type,f=s.length-1;0<=f;f--){e.a=s[f];var d=xb(s[f],i,!0,e);o=o&&d}for(f=0;f<s.length;f++)e.a=s[f],d=xb(s[f],i,!1,e),o=o&&d}return o}return yb(i,new $a(e,this))}function rb(i){return i=i[kb],i instanceof gb?i:null}var zb="__closure_events_fn_"+(1e9*Math.random()>>>0);function pb(i){return da(i)?i:(i[zb]||(i[zb]=function(e){return i.handleEvent(e)}),i[zb])}function B(){w.call(this),this.c=new gb(this),this.P=this,this.K=null}u(B,w),B.prototype[bb]=!0,g=B.prototype,g.addEventListener=function(i,e,o,s){nb(this,i,e,o,s)},g.removeEventListener=function(i,e,o,s){vb(this,i,e,o,s)},g.dispatchEvent=function(i){var e,o=this.K;if(o)for(e=[];o;o=o.K)e.push(o);o=this.P;var s=i.type||i;if(l(i))i=new A(i,o);else if(i instanceof A)i.target=i.target||o;else{var f=i;i=new A(s,o),Ga(i,f)}if(f=!0,e)for(var d=e.length-1;0<=d;d--){var m=i.a=e[d];f=Ab(m,s,!0,i)&&f}if(m=i.a=o,f=Ab(m,s,!0,i)&&f,f=Ab(m,s,!1,i)&&f,e)for(d=0;d<e.length;d++)m=i.a=e[d],f=Ab(m,s,!1,i)&&f;return f},g.A=function(){if(B.H.A.call(this),this.c){var i=this.c,e;for(e in i.a){for(var o=i.a[e],s=0;s<o.length;s++)fb(o[s]);delete i.a[e],i.b--}}this.K=null},g.aa=function(i,e,o,s){return this.c.add(String(i),e,!1,o,s)},g.Ha=function(i,e,o,s){return this.c.add(String(i),e,!0,o,s)},g.va=function(i,e,o,s){var f=this.c;if(i=String(i).toString(),i in f.a){var d=f.a[i];e=hb(d,e,o,s),-1<e&&(fb(d[e]),Array.prototype.splice.call(d,e,1),d.length==0&&(delete f.a[i],f.b--))}};function Ab(i,e,o,s){if(e=i.c.a[String(e)],!e)return!0;e=e.concat();for(var f=!0,d=0;d<e.length;++d){var m=e[d];if(m&&!m.Y&&m.capture==o){var _=m.listener,$=m.ga||m.src;m.ca&&ib(i.c,m),f=_.call($,s)!==!1&&f}}return f&&s.Pa!=0}function Bb(i){return/^\s*$/.test(i)?!1:/^[\],:{}\s\u2028\u2029]*$/.test(i.replace(/\\["\\\/bfnrtu]/g,"@").replace(/(?:"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)[\s\u2028\u2029]*(?=:|,|]|}|$)/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,""))}function Cb(a){if(a=String(a),Bb(a))try{return eval("("+a+")")}catch(i){}throw Error("Invalid JSON string: "+a)}function Db(i){var e=[];return Eb(new Fb,i,e),e.join("")}function Fb(){}function Eb(i,e,o){if(e==null)o.push("null");else{if(typeof e=="object"){if(n(e)){var s=e;e=s.length,o.push("[");for(var f="",d=0;d<e;d++)o.push(f),Eb(i,s[d],o),f=",";o.push("]");return}if(e instanceof String||e instanceof Number||e instanceof Boolean)e=e.valueOf();else{o.push("{"),f="";for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&(d=e[s],typeof d!="function"&&(o.push(f),Gb(s,o),o.push(":"),Eb(i,d,o),f=","));o.push("}");return}}switch(typeof e){case"string":Gb(e,o);break;case"number":o.push(isFinite(e)&&!isNaN(e)?String(e):"null");break;case"boolean":o.push(String(e));break;case"function":o.push("null");break;default:throw Error("Unknown type: "+typeof e)}}}var Hb={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\u000b"},Ib=/\uffff/.test("\uFFFF")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Gb(i,e){e.push('"',i.replace(Ib,function(o){var s=Hb[o];return s||(s="\\u"+(o.charCodeAt(0)|65536).toString(16).substr(1),Hb[o]=s),s}),'"')}function Jb(i,e){this.c=i,this.f=e,this.b=0,this.a=null}Jb.prototype.get=function(){if(0<this.b){this.b--;var i=this.a;this.a=i.next,i.next=null}else i=this.c();return i};function Kb(){this.b=this.a=null}var Nb=new Jb(function(){return new Lb},function(i){i.reset()});Kb.prototype.add=function(i,e){var o=Nb.get();o.set(i,e),this.b?this.b.next=o:this.a=o,this.b=o};function Ob(){var i=Pb,e=null;return i.a&&(e=i.a,i.a=i.a.next,i.a||(i.b=null),e.next=null),e}function Lb(){this.next=this.b=this.a=null}Lb.prototype.set=function(i,e){this.a=i,this.b=e,this.next=null},Lb.prototype.reset=function(){this.next=this.b=this.a=null};function Qb(i){k.setTimeout(function(){throw i},0)}var Rb;function Sb(){var i=k.MessageChannel;if(typeof i>"u"&&typeof window<"u"&&window.postMessage&&window.addEventListener&&!y("Presto")&&(i=function(){var f=document.createElement("IFRAME");f.style.display="none",f.src="",document.documentElement.appendChild(f);var d=f.contentWindow;f=d.document,f.open(),f.write(""),f.close();var m="callImmediate"+Math.random(),_=d.location.protocol=="file:"?"*":d.location.protocol+"//"+d.location.host;f=r(function($){(_=="*"||$.origin==_)&&$.data==m&&this.port1.onmessage()},this),d.addEventListener("message",f,!1),this.port1={},this.port2={postMessage:function(){d.postMessage(m,_)}}}),typeof i<"u"&&!y("Trident")&&!y("MSIE")){var e=new i,o={},s=o;return e.port1.onmessage=function(){if(o.next!==void 0){o=o.next;var f=o.za;o.za=null,f()}},function(f){s.next={za:f},s=s.next,e.port2.postMessage(0)}}return typeof document<"u"&&"onreadystatechange"in document.createElement("SCRIPT")?function(f){var d=document.createElement("SCRIPT");d.onreadystatechange=function(){d.onreadystatechange=null,d.parentNode.removeChild(d),d=null,f(),f=null},document.documentElement.appendChild(d)}:function(f){k.setTimeout(f,0)}}var Tb;function Ub(){if(String(k.Promise).indexOf("[native code]")!=-1){var i=k.Promise.resolve(void 0);Tb=function(){i.then(Vb)}}else Tb=function(){var e=Vb;!da(k.setImmediate)||k.Window&&k.Window.prototype&&!y("Edge")&&k.Window.prototype.setImmediate==k.setImmediate?(Rb||(Rb=Sb()),Rb(e)):k.setImmediate(e)}}var Wb=!1,Pb=new Kb;function Vb(){for(var i;i=Ob();){try{i.a.call(i.b)}catch(o){Qb(o)}var e=Nb;e.f(i),100>e.b&&(e.b++,i.next=e.a,e.a=i)}Wb=!1}function Xb(i,e){B.call(this),this.b=i||1,this.a=e||k,this.f=r(this.kb,this),this.g=t()}u(Xb,B),g=Xb.prototype,g.$=!1,g.L=null,g.kb=function(){if(this.$){var i=t()-this.g;0<i&&i<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-i):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.$&&(this.L=this.a.setTimeout(this.f,this.b),this.g=t()))}},g.start=function(){this.$=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=t())};function Yb(i){i.$=!1,i.L&&(i.a.clearTimeout(i.L),i.L=null)}g.A=function(){Xb.H.A.call(this),Yb(this),delete this.a};function Zb(i,e,o){if(da(i))o&&(i=r(i,o));else if(i&&typeof i.handleEvent=="function")i=r(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:k.setTimeout(i,e||0)}function $b(i,e,o){w.call(this),this.f=o!=null?r(i,o):i,this.c=e,this.b=r(this.eb,this),this.a=[]}u($b,w),g=$b.prototype,g.ha=!1,g.X=null,g.Xa=function(i){this.a=arguments,this.X?this.ha=!0:ac(this)},g.A=function(){$b.H.A.call(this),this.X&&(k.clearTimeout(this.X),this.X=null,this.ha=!1,this.a=[])},g.eb=function(){this.X=null,this.ha&&(this.ha=!1,ac(this))};function ac(i){i.X=Zb(i.b,i.c),i.f.apply(null,i.a)}function C(i){w.call(this),this.b=i,this.a={}}u(C,w);var bc=[];C.prototype.aa=function(i,e,o,s){n(e)||(e&&(bc[0]=e.toString()),e=bc);for(var f=0;f<e.length;f++){var d=nb(i,e[f],o||this.handleEvent,s||!1,this.b||this);if(!d)break;this.a[d.key]=d}return this},C.prototype.va=function(i,e,o,s,f){if(n(e))for(var d=0;d<e.length;d++)this.va(i,e[d],o,s,f);else o=o||this.handleEvent,s=p(s)?!!s.capture:!!s,f=f||this.b||this,o=pb(o),s=!!s,e=cb(i)?jb(i.c,String(e),o,s,f):i&&(i=rb(i))?jb(i,e,o,s,f):null,e&&(wb(e),delete this.a[e.key])};function cc(i){Ba(i.a,function(e,o){this.a.hasOwnProperty(o)&&wb(e)},i),i.a={}}C.prototype.A=function(){C.H.A.call(this),cc(this)},C.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function dc(i,e,o){this.reset(i,e,o,void 0,void 0)}dc.prototype.a=null,dc.prototype.reset=function(i,e,o,s,f){delete this.a};function fc(i){this.f=i,this.b=this.c=this.a=null}function D(i,e){this.name=i,this.value=e}D.prototype.toString=function(){return this.name};var gc=new D("SEVERE",1e3),hc=new D("WARNING",900),ic=new D("INFO",800),jc=new D("CONFIG",700),kc=new D("FINE",500);function lc(i){return i.c?i.c:i.a?lc(i.a):(oa("Root logger has no level set."),null)}fc.prototype.log=function(i,e,o){if(i.value>=lc(this).value)for(da(e)&&(e=e()),i=new dc(i,String(e),this.f),o&&(i.a=o),o=this;o;)o=o.a};var mc={},nc=null;function oc(i){nc||(nc=new fc(""),mc[""]=nc,nc.c=jc);var e;if(!(e=mc[i])){e=new fc(i);var o=i.lastIndexOf("."),s=i.substr(o+1);o=oc(i.substr(0,o)),o.b||(o.b={}),o.b[s]=e,e.a=o,mc[i]=e}return e}function E(i,e){i&&i.log(hc,e,void 0)}function pc(i,e){i&&i.log(ic,e,void 0)}function F(i,e){i&&i.log(kc,e,void 0)}function qc(){this.a=oc("goog.labs.net.webChannel.WebChannelDebug"),this.b=!0}qc.prototype.Ea=function(){this.b=!1};function rc(i,e,o,s,f,d){H(i,function(){if(i.b)if(d)for(var m="",_=d.split("&"),$=0;$<_.length;$++){var G=_[$].split("=");if(1<G.length){var Z=G[0];G=G[1];var et=Z.split("_");m=2<=et.length&&et[1]=="type"?m+(Z+"="+G+"&"):m+(Z+"=redacted&")}}else m=null;else m=d;return"XMLHTTP REQ ("+s+") [attempt "+f+"]: "+e+`
`+o+`
`+m})}function sc(i,e,o,s,f,d,m){H(i,function(){return"XMLHTTP RESP ("+s+") [ attempt "+f+"]: "+e+`
`+o+`
`+d+" "+m})}function tc(i,e,o,s){H(i,function(){return"XMLHTTP TEXT ("+e+"): "+uc(i,o)+(s?" "+s:"")})}function vc(i,e){H(i,function(){return"TIMEOUT: "+e})}function I(i,e){F(i.a,e)}function wc(i,e,o){(i=i.a)&&i.log(gc,o||"Exception",e)}function H(i,e){pc(i.a,e)}function xc(i,e){(i=i.a)&&i.log(gc,e,void 0)}function uc(i,e){if(!i.b)return e;if(!e)return null;try{var o=JSON.parse(e);if(o){for(var s=0;s<o.length;s++)if(n(o[s])){var f=o[s];if(!(2>f.length)){var d=f[1];if(n(d)&&!(1>d.length)){var m=d[0];if(m!="noop"&&m!="stop"&&m!="close")for(var _=1;_<d.length;_++)d[_]=""}}}}return Db(o)}catch{return I(i,"Exception parsing expected JS array - probably was not JS"),e}}var yc=new B;function zc(i){A.call(this,"serverreachability",i)}u(zc,A);function Ac(i){yc.dispatchEvent(new zc(yc))}function Bc(i){A.call(this,"statevent",i)}u(Bc,A);function J(i){yc.dispatchEvent(new Bc(yc))}function Cc(i){A.call(this,"timingevent",i)}u(Cc,A);function Dc(i,e,o){yc.dispatchEvent(new Cc(yc))}function Ec(i,e){if(!da(i))throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){i()},e)}var Fc={NO_ERROR:0,lb:1,sb:2,rb:3,ob:4,qb:5,tb:6,Ra:7,TIMEOUT:8,wb:9},Gc={nb:"complete",Ab:"success",Sa:"error",Ra:"abort",yb:"ready",zb:"readystatechange",TIMEOUT:"timeout",ub:"incrementaldata",xb:"progress",pb:"downloadprogress",Bb:"uploadprogress"};function Hc(){}Hc.prototype.a=null;function Ic(i){var e;return(e=i.a)||(e={},Jc(i)&&(e[0]=!0,e[1]=!0),e=i.a=e),e}var Kc;function Lc(){}u(Lc,Hc);function Mc(i){return(i=Jc(i))?new ActiveXObject(i):new XMLHttpRequest}function Jc(i){if(!i.b&&typeof XMLHttpRequest>"u"&&typeof ActiveXObject<"u"){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],o=0;o<e.length;o++){var s=e[o];try{return new ActiveXObject(s),i.b=s}catch{}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return i.b}Kc=new Lc;function K(i,e,o,s){this.i=i,this.b=e,this.f=o,this.T=s||1,this.N=new C(this),this.S=Nc,i=this.I=new Xb,i.b=Oc,i.L&&i.$?(Yb(i),i.start()):i.L&&Yb(i),this.j=null,this.c=!1,this.m=this.g=this.h=this.K=this.D=this.U=this.w=null,this.u=[],this.a=null,this.F=0,this.l=this.o=null,this.C=-1,this.B=!1,this.P=0,this.J=null,this.M=!1}var Nc=45e3,Oc=250;function Pc(i,e){switch(i){case 0:return"Non-200 return code ("+e+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}var Qc={},Rc={};g=K.prototype,g.setTimeout=function(i){this.S=i};function Sc(i,e,o){i.K=1,i.h=Tc(L(e)),i.m=o,i.M=!0,Uc(i,null)}function Vc(i,e,o,s){i.K=1,i.h=Tc(L(e)),i.m=null,i.M=o,Uc(i,s)}function Uc(i,e){i.D=t(),Wc(i),i.g=L(i.h),Xc(i.g,"t",i.T),i.F=0,i.a=i.i.da(i.i.ia()?e:null),0<i.P&&(i.J=new $b(r(i.Qa,i,i.a),i.P)),i.N.aa(i.a,"readystatechange",i.hb),e=i.j?Ea(i.j):{},i.m?(i.o||(i.o="POST"),e["Content-Type"]="application/x-www-form-urlencoded",i.a.fa(i.g,i.o,i.m,e)):(i.o="GET",i.a.fa(i.g,i.o,null,e)),Ac(),rc(i.b,i.o,i.g,i.f,i.T,i.m)}g.hb=function(i){i=i.target;var e=this.J;e&&M(i)==3?(I(this.b,"Throttling readystatechange."),e.Xa()):this.Qa(i)},g.Qa=function(i){try{i==this.a?Yc(this):E(this.b.a,"Called back with an unexpected xmlhttp")}catch(o){if(I(this.b,"Failed call to OnXmlHttpReadyStateChanged_"),this.a&&this.a.V()){var e=this;wc(this.b,o,function(){return"ResponseText: "+e.a.V()})}else wc(this.b,o,"No response text")}finally{}};function Yc(i){var e=M(i.a),o=i.a.Fa(),s=i.a.W();if(!(3>e||e==3&&!Ka&&!i.a.V())){i.B||e!=4||o==7||(o==8||0>=s,Ac()),Zc(i);var f=i.a.W();i.C=f,(o=i.a.V())||I(i.b,function(){return"No response text for uri "+i.g+" status "+f}),i.c=f==200,sc(i.b,i.o,i.g,i.f,i.T,e,f),i.c?(i.M?($c(i,e,o),Ka&&i.c&&e==3&&ad(i)):(tc(i.b,i.f,o,null),bd(i,o)),e==4&&cd(i),i.c&&!i.B&&(e==4?i.i.ua(i):(i.c=!1,Wc(i)))):(f==400&&0<o.indexOf("Unknown SID")?(i.l=3,J(),E(i.b.a,"XMLHTTP Unknown SID ("+i.f+")")):(i.l=0,J(),E(i.b.a,"XMLHTTP Bad status "+f+" ("+i.f+")")),cd(i),dd(i))}}function $c(i,e,o){for(var s=!0;!i.B&&i.F<o.length;){var f=ed(i,o);if(f==Rc){e==4&&(i.l=4,J(),s=!1),tc(i.b,i.f,null,"[Incomplete Response]");break}else if(f==Qc){i.l=4,J(),tc(i.b,i.f,o,"[Invalid Chunk]"),s=!1;break}else tc(i.b,i.f,f,null),bd(i,f)}e==4&&o.length==0&&(i.l=1,J(),s=!1),i.c=i.c&&s,s||(tc(i.b,i.f,o,"[Invalid Chunked Response]"),cd(i),dd(i))}g.gb=function(){var i=M(this.a),e=this.a.V();this.F<e.length&&(Zc(this),$c(this,i,e),this.c&&i!=4&&Wc(this))};function ad(i){i.N.aa(i.I,"tick",i.gb),i.I.start()}function ed(i,e){var o=i.F,s=e.indexOf(`
`,o);return s==-1?Rc:(o=Number(e.substring(o,s)),isNaN(o)?Qc:(s+=1,s+o>e.length?Rc:(e=e.substr(s,o),i.F=s+o,e)))}g.cancel=function(){this.B=!0,cd(this)};function Wc(i){i.U=t()+i.S,fd(i,i.S)}function fd(i,e){if(i.w!=null)throw Error("WatchDog timer not null");i.w=Ec(r(i.fb,i),e)}function Zc(i){i.w&&(k.clearTimeout(i.w),i.w=null)}g.fb=function(){this.w=null;var i=t();0<=i-this.U?(this.c&&xc(this.b,"Received watchdog timeout even though request loaded successfully"),vc(this.b,this.g),this.K!=2&&(Ac(),J()),cd(this),this.l=2,dd(this)):(E(this.b.a,"WatchDog timer called too early"),fd(this,this.U-i))};function dd(i){i.i.Ja()||i.B||i.i.ua(i)}function cd(i){Zc(i);var e=i.J;e&&typeof e.Z=="function"&&e.Z(),i.J=null,Yb(i.I),cc(i.N),i.a&&(e=i.a,i.a=null,e.abort(),e.Z())}function bd(i,e){try{i.i.Ma(i,e),Ac(4)}catch(o){wc(i.b,o,"Error in httprequest callback")}}function gd(i){if(i.v&&typeof i.v=="function")return i.v();if(l(i))return i.split("");if(ca(i)){for(var e=[],o=i.length,s=0;s<o;s++)e.push(i[s]);return e}return Ca(i)}function hd(i,e){if(i.forEach&&typeof i.forEach=="function")i.forEach(e,void 0);else if(ca(i)||l(i))ta(i,e,void 0);else{if(i.O&&typeof i.O=="function")var o=i.O();else if(i.v&&typeof i.v=="function")o=void 0;else if(ca(i)||l(i)){o=[];for(var s=i.length,f=0;f<s;f++)o.push(f)}else o=Da(i);s=gd(i),f=s.length;for(var d=0;d<f;d++)e.call(void 0,s[d],o&&o[d],i)}}function N(i,e){this.b={},this.a=[],this.c=0;var o=arguments.length;if(1<o){if(o%2)throw Error("Uneven number of arguments");for(var s=0;s<o;s+=2)this.set(arguments[s],arguments[s+1])}else if(i){i instanceof N?(o=i.O(),s=i.v()):(o=Da(i),s=Ca(i));for(var f=0;f<o.length;f++)this.set(o[f],s[f])}}g=N.prototype,g.s=function(){return this.c},g.v=function(){id(this);for(var i=[],e=0;e<this.a.length;e++)i.push(this.b[this.a[e]]);return i},g.O=function(){return id(this),this.a.concat()};function jd(i){i.b={},i.a.length=0,i.c=0}function kd(i,e){return O(i.b,e)?(delete i.b[e],i.c--,i.a.length>2*i.c&&id(i),!0):!1}function id(i){if(i.c!=i.a.length){for(var e=0,o=0;e<i.a.length;){var s=i.a[e];O(i.b,s)&&(i.a[o++]=s),e++}i.a.length=o}if(i.c!=i.a.length){var f={};for(o=e=0;e<i.a.length;)s=i.a[e],O(f,s)||(i.a[o++]=s,f[s]=1),e++;i.a.length=o}}g.get=function(i,e){return O(this.b,i)?this.b[i]:e},g.set=function(i,e){O(this.b,i)||(this.c++,this.a.push(i)),this.b[i]=e},g.forEach=function(i,e){for(var o=this.O(),s=0;s<o.length;s++){var f=o[s],d=this.get(f);i.call(e,d,f,this)}};function O(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var ld=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function md(i,e){if(i){i=i.split("&");for(var o=0;o<i.length;o++){var s=i[o].indexOf("="),f=null;if(0<=s){var d=i[o].substring(0,s);f=i[o].substring(s+1)}else d=i[o];e(d,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}}function P(i,e){this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1;var o;i instanceof P?(this.h=e!==void 0?e:i.h,nd(this,i.f),this.j=i.j,od(this,i.b),pd(this,i.i),this.a=i.a,qd(this,rd(i.c)),this.g=i.g):i&&(o=String(i).match(ld))?(this.h=!!e,nd(this,o[1]||"",!0),this.j=sd(o[2]||""),od(this,o[3]||"",!0),pd(this,o[4]),this.a=sd(o[5]||"",!0),qd(this,o[6]||"",!0),this.g=sd(o[7]||"")):(this.h=!!e,this.c=new td(null,this.h))}P.prototype.toString=function(){var i=[],e=this.f;e&&i.push(ud(e,vd,!0),":");var o=this.b;return(o||e=="file")&&(i.push("//"),(e=this.j)&&i.push(ud(e,vd,!0),"@"),i.push(encodeURIComponent(String(o)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o=this.i,o!=null&&i.push(":",String(o))),(o=this.a)&&(this.b&&o.charAt(0)!="/"&&i.push("/"),i.push(ud(o,o.charAt(0)=="/"?wd:xd,!0))),(o=this.c.toString())&&i.push("?",o),(o=this.g)&&i.push("#",ud(o,yd)),i.join("")},P.prototype.resolve=function(i){var e=L(this),o=!!i.f;o?nd(e,i.f):o=!!i.j,o?e.j=i.j:o=!!i.b,o?od(e,i.b):o=i.i!=null;var s=i.a;if(o)pd(e,i.i);else if(o=!!i.a){if(s.charAt(0)!="/")if(this.b&&!this.a)s="/"+s;else{var f=e.a.lastIndexOf("/");f!=-1&&(s=e.a.substr(0,f+1)+s)}if(f=s,f==".."||f==".")s="";else if(f.indexOf("./")!=-1||f.indexOf("/.")!=-1){s=f.lastIndexOf("/",0)==0,f=f.split("/");for(var d=[],m=0;m<f.length;){var _=f[m++];_=="."?s&&m==f.length&&d.push(""):_==".."?((1<d.length||d.length==1&&d[0]!="")&&d.pop(),s&&m==f.length&&d.push("")):(d.push(_),s=!0)}s=d.join("/")}else s=f}return o?e.a=s:o=i.c.toString()!=="",o?qd(e,rd(i.c)):o=!!i.g,o&&(e.g=i.g),e};function L(i){return new P(i)}function nd(i,e,o){i.f=o?sd(e,!0):e,i.f&&(i.f=i.f.replace(/:$/,""))}function od(i,e,o){i.b=o?sd(e,!0):e}function pd(i,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);i.i=e}else i.i=null}function qd(i,e,o){e instanceof td?(i.c=e,zd(i.c,i.h)):(o||(e=ud(e,Ad)),i.c=new td(e,i.h))}function Q(i,e,o){i.c.set(e,o)}function Xc(i,e,o){n(o)||(o=[String(o)]),Bd(i.c,e,o)}function Tc(i){return Q(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^t()).toString(36)),i}function Cd(i){return i instanceof P?L(i):new P(i,void 0)}function Dd(i,e,o,s){var f=new P(null,void 0);return i&&nd(f,i),e&&od(f,e),o&&pd(f,o),s&&(f.a=s),f}function sd(i,e){return i?e?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function ud(i,e,o){return l(i)?(i=encodeURI(i).replace(e,Ed),o&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Ed(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var vd=/[#\/\?@]/g,xd=/[#\?:]/g,wd=/[#\?]/g,Ad=/[#\?@]/g,yd=/#/g;function td(i,e){this.b=this.a=null,this.c=i||null,this.f=!!e}function R(i){i.a||(i.a=new N,i.b=0,i.c&&md(i.c,function(e,o){i.add(decodeURIComponent(e.replace(/\+/g," ")),o)}))}g=td.prototype,g.s=function(){return R(this),this.b},g.add=function(i,e){R(this),this.c=null,i=Fd(this,i);var o=this.a.get(i);return o||this.a.set(i,o=[]),o.push(e),this.b+=1,this};function Gd(i,e){R(i),e=Fd(i,e),O(i.a.b,e)&&(i.c=null,i.b-=i.a.get(e).length,kd(i.a,e))}function Hd(i,e){return R(i),e=Fd(i,e),O(i.a.b,e)}g.forEach=function(i,e){R(this),this.a.forEach(function(o,s){ta(o,function(f){i.call(e,f,s,this)},this)},this)},g.O=function(){R(this);for(var i=this.a.v(),e=this.a.O(),o=[],s=0;s<e.length;s++)for(var f=i[s],d=0;d<f.length;d++)o.push(e[s]);return o},g.v=function(i){R(this);var e=[];if(l(i))Hd(this,i)&&(e=xa(e,this.a.get(Fd(this,i))));else{i=this.a.v();for(var o=0;o<i.length;o++)e=xa(e,i[o])}return e},g.set=function(i,e){return R(this),this.c=null,i=Fd(this,i),Hd(this,i)&&(this.b-=this.a.get(i).length),this.a.set(i,[e]),this.b+=1,this},g.get=function(i,e){return i=i?this.v(i):[],0<i.length?String(i[0]):e};function Bd(i,e,o){Gd(i,e),0<o.length&&(i.c=null,i.a.set(Fd(i,e),ya(o)),i.b+=o.length)}g.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var i=[],e=this.a.O(),o=0;o<e.length;o++){var s=e[o],f=encodeURIComponent(String(s));s=this.v(s);for(var d=0;d<s.length;d++){var m=f;s[d]!==""&&(m+="="+encodeURIComponent(String(s[d]))),i.push(m)}}return this.c=i.join("&")};function rd(i){var e=new td;return e.c=i.c,i.a&&(e.a=new N(i.a),e.b=i.b),e}function Fd(i,e){return e=String(e),i.f&&(e=e.toLowerCase()),e}function zd(i,e){e&&!i.f&&(R(i),i.c=null,i.a.forEach(function(o,s){var f=s.toLowerCase();s!=f&&(Gd(this,s),Bd(this,f,o))},i)),i.f=e}function Kd(){}function Ld(){}u(Ld,Kd);function Md(){}var Nd={OPEN:"a",mb:"b",Sa:"c",vb:"d"};function Od(){A.call(this,"d")}u(Od,A);function Pd(){A.call(this,"c")}u(Pd,A);function Qd(i,e){this.a=i,this.b=e,this.c=this.i=null,this.h=!1,this.l=null,this.f=-1,this.m=this.g=null}g=Qd.prototype,g.R=null;function Rd(i){I(i.b,"TestConnection: starting stage 2");var e=i.a.I.a;if(e!=null)I(i.b,function(){return"TestConnection: skipping stage 2, precomputed result is "+e?"Buffered":"Unbuffered"}),J(),e?(J(),Sd(i.a,i,!1)):(J(),Sd(i.a,i,!0));else{i.c=new K(i,i.b,void 0,void 0),i.c.j=i.i;var o=Td(i.a,i.g,i.l);J(),Xc(o,"TYPE","xmlhttp");var s=i.a.j,f=i.a.K;s&&f&&Q(o,s,f),Vc(i.c,o,!1,i.g)}}g.da=function(i){return this.a.da(i)},g.abort=function(){this.c&&(this.c.cancel(),this.c=null),this.f=-1},g.Ja=function(){return!1},g.Ma=function(i,e){if(this.f=i.C,this.R==0){if(I(this.b,"TestConnection: Got data for stage 1"),!this.a.D&&(i=i.a)){var o=i.a?i.a.getResponseHeader("X-Client-Wire-Protocol"):null;this.m=o||null,this.a.j&&((i=i.a?i.a.getResponseHeader("X-HTTP-Session-Id"):null)?this.a.K=i:E(this.b.a,"Missing X_HTTP_SESSION_ID in the handshake response"))}if(e){try{var s=this.a.ma.a.parse(e)}catch(f){wc(this.b,f),Ud(this.a,this);return}this.g=s[0]}else I(this.b,"TestConnection: Null responseText"),Ud(this.a,this)}else this.R==1&&(this.h?J():e=="11111"?(J(),this.h=!0,(!z||10<=Number(Ua))&&(this.f=200,this.c.cancel(),I(this.b,"Test connection succeeded; using streaming connection"),J(),Sd(this.a,this,!0))):(J(),this.h=!1))},g.ua=function(){this.f=this.c.C,this.c.c?this.R==0?(this.R=1,I(this.b,"TestConnection: request complete for initial check"),Rd(this)):this.R==1&&(I(this.b,"TestConnection: request complete for stage 2"),this.h?(I(this.b,"Test connection succeeded; using streaming connection"),J(),Sd(this.a,this,!0)):(I(this.b,"Test connection failed; not using streaming"),J(),Sd(this.a,this,!1))):(I(this.b,"TestConnection: request failed, in state "+this.R),(this.R==0||this.R==1)&&J(),Ud(this.a,this))},g.ia=function(){return this.a.ia()},g.ra=function(){return this.a.ra()};function Vd(){this.a=this.b=null}function S(){this.a=new N}function Wd(i){var e=typeof i;return e=="object"&&i||e=="function"?"o"+(i[q]||(i[q]=++ea)):e.charAt(0)+i}S.prototype.s=function(){return this.a.s()},S.prototype.add=function(i){this.a.set(Wd(i),i)},S.prototype.contains=function(i){return i=Wd(i),O(this.a.b,i)},S.prototype.v=function(){return this.a.v()};function Xd(i,e){this.a=i,this.b=e}function Yd(i){this.g=i||Zd,this.f=k.pa&&k.pa.Ka&&k.pa.Ka()&&k.pa.Ka().Db?this.g:1,this.a=null,1<this.f&&(this.a=new S),this.b=null,this.c=[]}var Zd=10;function $d(i,e){i.a||e.indexOf("spdy")==-1&&e.indexOf("quic")==-1&&e.indexOf("h2")==-1||(i.f=i.g,i.a=new S,i.b&&(ae(i,i.b),i.b=null))}function be(i){return i.b?!0:i.a?i.a.s()>=i.f:!1}function ce(i,e){return i.b?i.b==e:i.a?i.a.contains(e):!1}function ae(i,e){i.a?i.a.add(e):i.b=e}function de(i,e){i.b&&i.b==e?i.b=null:i.a&&i.a.contains(e)&&kd(i.a.a,Wd(e))}Yd.prototype.cancel=function(){this.c=ee(this),this.b?(this.b.cancel(),this.b=null):this.a&&this.a.a.c!=0&&(ta(this.a.v(),function(i){i.cancel()}),jd(this.a.a))};function ee(i){if(i.b!=null)return i.c.concat(i.b.u);if(i.a!=null&&i.a.a.c!=0){var e=i.c;return ta(i.a.v(),function(o){e=e.concat(o.u)}),e}return ya(i.c)}function fe(i,e){i.c=i.c.concat(e)}function ge(){}ge.prototype.stringify=function(i){return k.JSON.stringify(i,void 0)},ge.prototype.parse=function(i){return k.JSON.parse(i,void 0)};function he(){this.a=new ge}function ie(i,e,o){var s=o||"";try{hd(i,function(f,d){var m=f;p(f)&&(m=Db(f)),e.push(s+d+"="+encodeURIComponent(m))})}catch(f){throw e.push(s+"type="+encodeURIComponent("_badmap")),f}}function je(i,e){var o=new qc;I(o,"TestLoadImage: loading "+i);var s=new Image;s.onload=ia(ke,o,s,"TestLoadImage: loaded",!0,e),s.onerror=ia(ke,o,s,"TestLoadImage: error",!1,e),s.onabort=ia(ke,o,s,"TestLoadImage: abort",!1,e),s.ontimeout=ia(ke,o,s,"TestLoadImage: timeout",!1,e),k.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i}function ke(i,e,o,s,f){try{I(i,o),e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,f(s)}catch(d){wc(i,d)}}function T(i){B.call(this),this.headers=new N,this.F=i||null,this.f=!1,this.D=this.a=null,this.M=this.u="",this.j=0,this.g="",this.h=this.J=this.o=this.I=!1,this.l=0,this.B=null,this.N=le,this.C=this.m=!1}u(T,B);var le="";T.prototype.b=oc("goog.net.XhrIo");var me=/^https?$/i,ne=["POST","PUT"];g=T.prototype,g.fa=function(i,e,o,s){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.u+"; newUri="+i);e=e?e.toUpperCase():"GET",this.u=i,this.g="",this.j=0,this.M=e,this.I=!1,this.f=!0,this.a=this.F?Mc(this.F):Mc(Kc),this.D=this.F?Ic(this.F):Ic(Kc),this.a.onreadystatechange=r(this.La,this);try{F(this.b,U(this,"Opening Xhr")),this.J=!0,this.a.open(e,String(i),!0),this.J=!1}catch(d){F(this.b,U(this,"Error opening Xhr: "+d.message)),oe(this,d);return}i=o||"";var f=new N(this.headers);s&&hd(s,function(d,m){f.set(m,d)}),s=ua(f.O()),o=k.FormData&&i instanceof k.FormData,!(0<=sa(ne,e))||s||o||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),f.forEach(function(d,m){this.a.setRequestHeader(m,d)},this),this.N&&(this.a.responseType=this.N),"withCredentials"in this.a&&this.a.withCredentials!==this.m&&(this.a.withCredentials=this.m);try{pe(this),0<this.l&&(this.C=qe(this.a),F(this.b,U(this,"Will abort after "+this.l+"ms if incomplete, xhr2 "+this.C)),this.C?(this.a.timeout=this.l,this.a.ontimeout=r(this.Ia,this)):this.B=Zb(this.Ia,this.l,this)),F(this.b,U(this,"Sending request")),this.o=!0,this.a.send(i),this.o=!1}catch(d){F(this.b,U(this,"Send error: "+d.message)),oe(this,d)}};function qe(i){return z&&Ta(9)&&typeof i.timeout=="number"&&i.ontimeout!==void 0}function va(i){return i.toLowerCase()=="content-type"}g.Ia=function(){typeof goog<"u"&&this.a&&(this.g="Timed out after "+this.l+"ms, aborting",this.j=8,F(this.b,U(this,this.g)),this.dispatchEvent("timeout"),this.abort(8))};function oe(i,e){i.f=!1,i.a&&(i.h=!0,i.a.abort(),i.h=!1),i.g=e,i.j=5,re(i),se(i)}function re(i){i.I||(i.I=!0,i.dispatchEvent("complete"),i.dispatchEvent("error"))}g.abort=function(i){this.a&&this.f&&(F(this.b,U(this,"Aborting")),this.f=!1,this.h=!0,this.a.abort(),this.h=!1,this.j=i||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),se(this))},g.A=function(){this.a&&(this.f&&(this.f=!1,this.h=!0,this.a.abort(),this.h=!1),se(this,!0)),T.H.A.call(this)},g.La=function(){this.i||(this.J||this.o||this.h?te(this):this.cb())},g.cb=function(){te(this)};function te(i){if(i.f&&typeof goog<"u"){if(i.D[1]&&M(i)==4&&i.W()==2)F(i.b,U(i,"Local request error detected and ignored"));else if(i.o&&M(i)==4)Zb(i.La,0,i);else if(i.dispatchEvent("readystatechange"),M(i)==4){F(i.b,U(i,"Request complete")),i.f=!1;try{var e=i.W();e:switch(e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}var s;if(!(s=o)){var f;if(f=e===0){var d=String(i.u).match(ld)[1]||null;if(!d&&k.self&&k.self.location){var m=k.self.location.protocol;d=m.substr(0,m.length-1)}f=!me.test(d?d.toLowerCase():"")}s=f}s?(i.dispatchEvent("complete"),i.dispatchEvent("success")):(i.j=6,i.g=i.Ga()+" ["+i.W()+"]",re(i))}finally{se(i)}}}}function se(i,e){if(i.a){pe(i);var o=i.a,s=i.D[0]?aa:null;i.a=null,i.D=null,e||i.dispatchEvent("ready");try{o.onreadystatechange=s}catch(f){(i=i.b)&&i.log(gc,"Problem encountered resetting onreadystatechange: "+f.message,void 0)}}}function pe(i){i.a&&i.C&&(i.a.ontimeout=null),i.B&&(k.clearTimeout(i.B),i.B=null)}function M(i){return i.a?i.a.readyState:0}g.W=function(){try{return 2<M(this)?this.a.status:-1}catch{return-1}},g.Ga=function(){try{return 2<M(this)?this.a.statusText:""}catch(i){return F(this.b,"Can not get status: "+i.message),""}},g.V=function(){try{return this.a?this.a.responseText:""}catch(i){return F(this.b,"Can not get responseText: "+i.message),""}},g.Ya=function(i){if(this.a){var e=this.a.responseText;i&&e.indexOf(i)==0&&(e=e.substring(i.length));e:{if(i=e,k.JSON)try{var o=k.JSON.parse(i);break e}catch{}o=Cb(i)}return o}},g.Fa=function(){return this.j},g.ab=function(){return l(this.g)?this.g:String(this.g)};function U(i,e){return e+" ["+i.M+" "+i.u+" "+i.W()+"]"}function ue(i){var e="";return Ba(i,function(o,s){e+=s,e+=":",e+=o,e+=`\r
`}),e}function ve(i,e,o){e:{for(s in o){var s=!1;break e}s=!0}if(s)return i;if(o=ue(o),l(i)){if(e=encodeURIComponent(String(e)),o=o!=null?"="+encodeURIComponent(String(o)):"",e+=o){if(o=i.indexOf("#"),0>o&&(o=i.length),s=i.indexOf("?"),0>s||s>o){s=o;var f=""}else f=i.substring(s+1,o);i=[i.substr(0,s),f,i.substr(o)],o=i[1],i[1]=e?o?o+"&"+e:e:o,i=i[0]+(i[1]?"?"+i[1]:"")+i[2]}return i}return Q(i,e,o),i}function we(i){this.ya=0,this.g=[],this.a=new qc,this.I=new Vd,this.ja=this.wa=this.F=this.ka=this.b=this.K=this.j=this.U=this.h=this.M=this.i=null,this.Ua=this.P=0,this.la=this.B=this.o=this.m=this.l=this.f=null,this.u=this.xa=this.N=-1,this.T=this.w=this.C=0,this.S=i&&i.supportsCrossDomainXhr||!1,this.J="",this.c=new Yd(i&&i.concurrentRequestLimit),this.ma=new he,this.D=i&&i.backgroundChannelTest!==void 0?i.backgroundChannelTest:!0,this.Ta=i&&i.fastHandshake||!1,i&&i.Ea&&this.a.Ea()}g=we.prototype,g.oa=8,g.G=1;function xe(i){if(I(i.a,"disconnect()"),ye(i),i.G==3){var e=i.P++,o=L(i.F);Q(o,"SID",i.J),Q(o,"RID",e),Q(o,"TYPE","terminate"),ze(i,o),e=new K(i,i.a,e,void 0),e.K=2,e.h=Tc(L(o)),o=!1,k.navigator&&k.navigator.sendBeacon&&(o=k.navigator.sendBeacon(e.h.toString(),"")),!o&&k.Image&&(new Image().src=e.h,o=!0),o||(e.a=e.i.da(null),e.a.fa(e.h)),e.D=t(),Wc(e)}Ae(i)}function ye(i){i.B&&(i.B.abort(),i.B=null),i.b&&(i.b.cancel(),i.b=null),i.m&&(k.clearTimeout(i.m),i.m=null),Be(i),i.c.cancel(),i.l&&(k.clearTimeout(i.l),i.l=null)}function Ce(i,e){i.g.length==1e3&&xc(i.a,function(){return"Already have 1000 queued maps upon queueing "+Db(e)}),i.g.push(new Xd(i.Ua++,e)),i.G==3&&De(i)}g.Ja=function(){return this.G==0};function De(i){be(i.c)||i.l||(i.l=Ec(r(i.Oa,i),0),i.C=0)}function Ee(i,e){var o=i.c;return(o.b?1:o.a?o.a.s():0)>=i.c.f-(i.l?1:0)?(xc(i.a,"Unexpected retry request is scheduled."),!1):i.l?(I(i.a,"Use the retry request that is already scheduled."),i.g=e.u.concat(i.g),!0):i.G==1||i.G==2||2<=i.C?!1:(I(i.a,"Going to retry POST"),i.l=Ec(r(i.Oa,i,e),Fe(i,i.C)),i.C++,!0)}g.Oa=function(i){if(this.l=null,I(this.a,"startForwardChannel_"),this.G==1)if(i)xc(this.a,"Not supposed to retry the open");else{I(this.a,"open_()"),this.P=Math.floor(1e5*Math.random()),i=this.P++;var e=new K(this,this.a,i,void 0),o=this.i;this.M&&(o?(o=Ea(o),Ga(o,this.M)):o=this.M),this.h===null&&(e.j=o);var s=Ge(this,e),f=L(this.F);Q(f,"RID",i),Q(f,"CVER",21),this.D&&this.j&&Q(f,"X-HTTP-Session-Id",this.j),ze(this,f),this.h&&o&&ve(f,this.h,o),ae(this.c,e),this.Ta?(Q(f,"$req",s),Sc(e,f,null)):Sc(e,f,s),this.G=2}else this.G==3&&(i?He(this,i):this.g.length==0?I(this.a,"startForwardChannel_ returned: nothing to send"):be(this.c)?xc(this.a,"startForwardChannel_ returned: connection already in progress"):(He(this),I(this.a,"startForwardChannel_ finished, sent request")))};function He(i,e){var o;e?o=e.f:o=i.P++;var s=L(i.F);Q(s,"SID",i.J),Q(s,"RID",o),Q(s,"AID",i.N),ze(i,s),i.h&&i.i&&ve(s,i.h,i.i),o=new K(i,i.a,o,i.C+1),i.h===null&&(o.j=i.i),e&&(i.g=e.u.concat(i.g)),e=Ge(i,o),o.setTimeout(1e4+Math.round(1e4*Math.random())),ae(i.c,o),Sc(o,s,e)}function ze(i,e){i.f&&hd({},function(o,s){Q(e,s,o)})}function Ge(i,e){var o=Math.min(i.g.length,1e3),s=i.f?r(i.f.Va,i.f,i):null;e:for(var f=i.g,d=-1;;){var m=["count="+o];d==-1?0<o?(d=f[0].a,m.push("ofs="+d)):d=0:m.push("ofs="+d);for(var _=!0,$=0;$<o;$++){var G=f[$].a,Z=f[$].b;if(G-=d,0>G)d=Math.max(0,f[$].a-100),_=!1;else try{ie(Z,m,"req"+G+"_")}catch{s&&s(Z)}}if(_){s=m.join("&");break e}}return i=i.g.splice(0,o),e.u=i,s}function Ie(i){if(!i.b&&!i.m){i.T=1;var e=i.Na;Tb||Ub(),Wb||(Tb(),Wb=!0),Pb.add(e,i),i.w=0}}function Je(i){return i.b||i.m?(xc(i.a,"Request already in progress"),!1):3<=i.w?!1:(I(i.a,"Going to retry GET"),i.T++,i.m=Ec(r(i.Na,i),Fe(i,i.w)),i.w++,!0)}g.Na=function(){this.m=null,I(this.a,"Creating new HttpRequest"),this.b=new K(this,this.a,"rpc",this.T),this.h===null&&(this.b.j=this.i),this.b.P=0;var i=L(this.wa);Q(i,"RID","rpc"),Q(i,"SID",this.J),Q(i,"CI",this.la?"0":"1"),Q(i,"AID",this.N),ze(this,i),Q(i,"TYPE","xmlhttp"),this.h&&this.i&&ve(i,this.h,this.i),Vc(this.b,i,!0,this.ja),I(this.a,"New Request created")};function Sd(i,e,o){I(i.a,"Test Connection Finished");var s=e.m;s&&$d(i.c,s),i.la=o,i.u=e.f,I(i.a,"connectChannel_()"),i.F=Ke(i,i.ka),De(i)}function Ud(i,e){I(i.a,"Test Connection Failed"),i.u=e.f,V(i,2)}g.Ma=function(i,e){if(this.G!=0&&(this.b==i||ce(this.c,i))){if(this.u=i.C,ce(this.c,i)&&this.G==3){try{var o=this.ma.a.parse(e)}catch{o=null}if(n(o)&&o.length==3)if(e=o,e[0]==0)e:if(I(this.a,"Server claims our backchannel is missing."),this.m)I(this.a,"But we are currently starting the request.");else{if(this.b)if(this.b.D+3e3<i.D)Be(this),this.b.cancel(),this.b=null;else break e;else E(this.a.a,"We do not have a BackChannel established");Je(this),J()}else this.xa=e[1],i=this.xa-this.N,0<i&&(e=e[2],I(this.a,e+" bytes (in "+i+" arrays) are outstanding on the BackChannel"),37500>e&&this.la&&this.w==0&&!this.o&&(this.o=Ec(r(this.bb,this),6e3)));else I(this.a,"Bad POST response data returned"),V(this,11)}else if(this.b==i&&Be(this),!/^[\s\xa0]*$/.test(e))for(e=o=this.ma.a.parse(e),o=0;o<e.length;o++){var s=e[o];if(this.N=s[0],s=s[1],this.G==2)if(s[0]=="c"){this.J=s[1],this.ja=s[2];var f=s[3];f!=null&&(this.oa=f,H(this.a,"VER="+this.oa)),s=s[4],s!=null&&(this.ya=s,H(this.a,"SVER="+this.ya)),this.D&&(s=i.a)&&((f=s.a?s.a.getResponseHeader("X-Client-Wire-Protocol"):null)&&$d(this.c,f),this.j&&((s=s.a?s.a.getResponseHeader("X-HTTP-Session-Id"):null)?(this.K=s,Q(this.F,this.j,s)):E(this.a.a,"Missing X_HTTP_SESSION_ID in the handshake response"))),this.G=3,this.f&&this.f.Da(),this.wa=Td(this,this.ja,this.ka),Ie(this)}else s[0]!="stop"&&s[0]!="close"||V(this,7);else this.G==3&&(s[0]=="stop"||s[0]=="close"?s[0]=="stop"?V(this,7):xe(this):s[0]!="noop"&&this.f&&this.f.Ca(s),this.w=0)}}},g.bb=function(){this.o!=null&&(this.o=null,this.b.cancel(),this.b=null,Je(this),J())};function Be(i){i.o!=null&&(k.clearTimeout(i.o),i.o=null)}g.ua=function(i){I(this.a,"Request complete");var e=null;if(this.b==i){Be(this),this.b=null;var o=2}else if(ce(this.c,i))e=i.u,de(this.c,i),o=1;else return;if(this.u=i.C,this.G!=0)if(i.c)o==1?(Dc(i.m?i.m.length:0,t()-i.D,this.C),De(this)):Ie(this);else{var s=i.l;if(s==3||s==0&&0<this.u)I(this.a,"Not retrying due to error type");else{var f=this;if(I(this.a,function(){return"Maybe retrying, last error: "+Pc(s,f.u)}),o==1&&Ee(this,i)||o==2&&Je(this))return;I(this.a,"Exceeded max number of retries")}switch(e&&0<e.length&&fe(this.c,e),I(this.a,"Error: HTTP request failed"),s){case 1:V(this,5);break;case 4:V(this,10);break;case 3:V(this,6);break;default:V(this,2)}}};function Fe(i,e){var o=5e3+Math.floor(1e4*Math.random());return i.ra()||(I(i.a,"Inactive channel"),o*=2),o*e}function V(i,e){if(H(i.a,"Error code "+e),e==2){var o=null;i.f&&(o=null);var s=r(i.jb,i);o||(o=new P("//www.google.com/images/cleardot.gif"),k.location&&k.location.protocol=="http"||nd(o,"https"),Tc(o)),je(o.toString(),s)}else J();I(i.a,"HttpChannel: error - "+e),i.G=0,i.f&&i.f.Ba(e),Ae(i),ye(i)}g.jb=function(i){i?(H(this.a,"Successfully pinged google.com"),J()):(H(this.a,"Failed to ping google.com"),J())};function Ae(i){if(i.G=0,i.u=-1,i.f){var e=ee(i.c);(e.length!=0||i.g.length!=0)&&(I(i.a,function(){return"Number of undelivered maps, pending: "+e.length+", outgoing: "+i.g.length}),i.c.c.length=0,ya(i.g),i.g.length=0),i.f.Aa()}}function Ke(i,e){return e=Le(i,null,e),I(i.a,"GetForwardChannelUri: "+e),e}function Td(i,e,o){return e=Le(i,i.ia()?e:null,o),I(i.a,"GetBackChannelUri: "+e),e}function Le(i,e,o){var s=Cd(o);if(s.b!="")e&&od(s,e+"."+s.b),pd(s,s.i);else{var f=k.location,d;e?d=e+"."+f.hostname:d=f.hostname,s=Dd(f.protocol,d,f.port,o)}return i.U&&Ba(i.U,function(m,_){Q(s,_,m)}),e=i.j,o=i.K,e&&o&&Q(s,e,o),Q(s,"VER",i.oa),ze(i,s),s}g.da=function(i){if(i&&!this.S)throw Error("Can't create secondary domain capable XhrIo object.");return i=new T,i.m=this.S,i},g.ra=function(){return!!this.f&&!0},g.ia=function(){return this.S};function Me(){}g=Me.prototype,g.Da=function(){},g.Ca=function(){},g.Ba=function(){},g.Aa=function(){},g.Va=function(){};function Ne(i){for(var e=arguments[0],o=1;o<arguments.length;o++){var s=arguments[o];if(s.lastIndexOf("/",0)==0)e=s;else{var f;(f=e=="")||(f=e.length-1,f=0<=f&&e.indexOf("/",f)==f),f?e+=s:e+="/"+s}}return e}function Oe(){if(z&&!(10<=Number(Ua)))throw Error("Environmental error: no available transport.")}Oe.prototype.a=function(i,e){return new W(i,e)};function W(i,e){B.call(this),this.a=new we(e),this.b=i,this.m=e&&e.testUrl?e.testUrl:Ne(this.b,"test"),this.f=oc("goog.labs.net.webChannel.WebChannelBaseTransport"),this.g=e&&e.messageUrlParams||null,i=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.a.i=i,i=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(i?i["X-WebChannel-Content-Type"]=e.messageContentType:i={"X-WebChannel-Content-Type":e.messageContentType}),this.a.M=i,(i=e&&e.httpHeadersOverwriteParam)&&!/^[\s\xa0]*$/.test(i)&&(this.a.h=i),this.l=e&&e.supportsCrossDomainXhr||!1,this.j=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!/^[\s\xa0]*$/.test(e)&&(this.a.j=e,i=this.g,i!==null&&e in i&&(i=this.g,e in i&&delete i[e],E(this.f,"Ignore httpSessionIdParam also specified with messageUrlParams: "+e))),this.h=new Pe(this)}u(W,B),g=W.prototype,g.addEventListener=function(i,e,o,s){W.H.addEventListener.call(this,i,e,o,s)},g.removeEventListener=function(i,e,o,s){W.H.removeEventListener.call(this,i,e,o,s)},g.Za=function(){this.a.f=this.h,this.l&&(this.a.S=!0);var i=this.a,e=this.m,o=this.b,s=this.g||void 0;I(i.a,"connect()"),J(),i.ka=o,i.U=s||{},i.D&&(I(i.a,"connect() bypassed channel-test."),i.I.b=[],i.I.a=!1),I(i.a,"connectTest_()"),i.B=new Qd(i,i.a),i.h===null&&(i.B.i=i.i),o=e,i.h&&i.i&&(o=ve(e,i.h,i.i)),i=i.B,i.l=o,e=Ke(i.a,i.l),J(),o=i.a.I.b,o!=null?(i.g=o[0],i.R=1,Rd(i)):(Xc(e,"MODE","init"),!i.a.D&&i.a.j&&Xc(e,"X-HTTP-Session-Id",i.a.j),i.c=new K(i,i.b,void 0,void 0),i.c.j=i.i,Vc(i.c,e,!1,null),i.R=0)},g.close=function(){xe(this.a)},g.$a=function(i){if(l(i)){var e={};e.__data__=i,Ce(this.a,e)}else this.j?(e={},e.__data__=Db(i),Ce(this.a,e)):Ce(this.a,i)},g.A=function(){this.a.f=null,delete this.h,xe(this.a),delete this.a,W.H.A.call(this)};function Qe(i){Od.call(this);var e=i.__sm__;if(e){e:{for(var o in e){i=o;break e}i=void 0}(this.c=i)?(i=this.c,this.data=e!==null&&i in e?e[i]:void 0):this.data=e}else this.data=i}u(Qe,Od);function Re(){Pd.call(this),this.status=1}u(Re,Pd);function Pe(i){this.a=i}u(Pe,Me),Pe.prototype.Da=function(){pc(this.a.f,"WebChannel opened on "+this.a.b),this.a.dispatchEvent("a")},Pe.prototype.Ca=function(i){this.a.dispatchEvent(new Qe(i))},Pe.prototype.Ba=function(i){pc(this.a.f,"WebChannel aborted on "+this.a.b+" due to channel error: "+i),this.a.dispatchEvent(new Re)},Pe.prototype.Aa=function(){pc(this.a.f,"WebChannel closed on "+this.a.b),this.a.dispatchEvent("b")};var Se=ia(function(i,e){function o(){}o.prototype=i.prototype;var s=new o;return i.apply(s,Array.prototype.slice.call(arguments,1)),s},Oe);function Te(){this.b=[],this.a=[]}function Ue(i){return i.b.length==0&&(i.b=i.a,i.b.reverse(),i.a=[]),i.b.pop()}Te.prototype.s=function(){return this.b.length+this.a.length},Te.prototype.contains=function(i){return 0<=sa(this.b,i)||0<=sa(this.a,i)},Te.prototype.v=function(){for(var i=[],e=this.b.length-1;0<=e;--e)i.push(this.b[e]);var o=this.a.length;for(e=0;e<o;++e)i.push(this.a[e]);return i};function Ve(i,e){if(w.call(this),this.h=i||0,this.c=e||10,this.h>this.c)throw Error(We);this.a=new Te,this.b=new S,this.g=null,this.ba()}u(Ve,w);var We="[goog.structs.Pool] Min can not be greater than max";g=Ve.prototype,g.ea=function(){var i=t();if(!(this.g!=null&&0>i-this.g)){for(var e;0<this.a.s()&&(e=Ue(this.a),!this.ta(e));)this.ba();return!e&&this.s()<this.c&&(e=this.qa()),e&&(this.g=i,this.b.add(e)),e}},g.ib=function(i){return kd(this.b.a,Wd(i))?(this.na(i),!0):!1},g.na=function(i){kd(this.b.a,Wd(i)),this.ta(i)&&this.s()<this.c?this.a.a.push(i):Xe(i)},g.ba=function(){for(var i=this.a;this.s()<this.h;){var e=this.qa();i.a.push(e)}for(;this.s()>this.c&&0<this.a.s();)Xe(Ue(i))},g.qa=function(){return{}};function Xe(i){if(typeof i.Z=="function")i.Z();else for(var e in i)i[e]=null}g.ta=function(i){return typeof i.Wa=="function"?i.Wa():!0},g.contains=function(i){return this.a.contains(i)||this.b.contains(i)},g.s=function(){return this.a.s()+this.b.s()},g.A=function(){if(Ve.H.A.call(this),0<this.b.s())throw Error("[goog.structs.Pool] Objects not released");delete this.b;for(var i=this.a;i.b.length!=0||i.a.length!=0;)Xe(Ue(i));delete this.a};function Ye(i,e){this.a=i,this.b=e}function Ze(i){if(this.a=[],i)e:{if(i instanceof Ze){var e=i.O();if(i=i.v(),0>=this.s()){for(var o=this.a,s=0;s<e.length;s++)o.push(new Ye(e[s],i[s]));break e}}else e=Da(i),i=Ca(i);for(s=0;s<e.length;s++)$e(this,e[s],i[s])}}function $e(i,e,o){var s=i.a;for(s.push(new Ye(e,o)),e=s.length-1,i=i.a,o=i[e];0<e&&(s=e-1>>1,i[s].a>o.a);)i[e]=i[s],e=s;i[e]=o}Ze.prototype.v=function(){for(var i=this.a,e=[],o=i.length,s=0;s<o;s++)e.push(i[s].b);return e},Ze.prototype.O=function(){for(var i=this.a,e=[],o=i.length,s=0;s<o;s++)e.push(i[s].a);return e},Ze.prototype.s=function(){return this.a.length};function af(){Ze.call(this)}u(af,Ze);function X(i,e){this.f=new af,Ve.call(this,i,e)}u(X,Ve),g=X.prototype,g.ea=function(i,e){if(!i)return X.H.ea.call(this);$e(this.f,e!==void 0?e:100,i),this.sa()},g.sa=function(){for(var i=this.f;0<i.s();){var e=this.ea();if(e){var o=i,s=o.a,f=s.length,d=s[0];if(0>=f)d=void 0;else{if(f==1)wa(s);else{s[0]=s.pop(),s=0,o=o.a,f=o.length;for(var m=o[s];s<f>>1;){var _=2*s+1,$=2*s+2;if(_=$<f&&o[$].a<o[_].a?$:_,o[_].a>m.a)break;o[s]=o[_],s=_}o[s]=m}d=d.b}d.apply(this,[e])}else break}},g.na=function(i){X.H.na.call(this,i),this.sa()},g.ba=function(){X.H.ba.call(this),this.sa()},g.A=function(){X.H.A.call(this),k.clearTimeout(void 0),wa(this.f.a),this.f=null};function Y(i,e,o,s){this.l=i,this.j=!!s,X.call(this,e,o)}u(Y,X),Y.prototype.qa=function(){var i=new T,e=this.l;return e&&e.forEach(function(o,s){i.headers.set(s,o)}),this.j&&(i.m=!0),i},Y.prototype.ta=function(i){return!i.i&&!i.a},Oe.prototype.createWebChannel=Oe.prototype.a,W.prototype.send=W.prototype.$a,W.prototype.open=W.prototype.Za,W.prototype.close=W.prototype.close,Fc.NO_ERROR=0,Fc.TIMEOUT=8,Fc.HTTP_ERROR=6,Gc.COMPLETE="complete",Md.EventType=Nd,Nd.OPEN="a",Nd.CLOSE="b",Nd.ERROR="c",Nd.MESSAGE="d",B.prototype.listen=B.prototype.aa,Y.prototype.getObject=Y.prototype.ea,Y.prototype.releaseObject=Y.prototype.ib,T.prototype.listenOnce=T.prototype.Ha,T.prototype.getLastError=T.prototype.ab,T.prototype.getLastErrorCode=T.prototype.Fa,T.prototype.getStatus=T.prototype.W,T.prototype.getStatusText=T.prototype.Ga,T.prototype.getResponseJson=T.prototype.Ya,T.prototype.getResponseText=T.prototype.V,T.prototype.getResponseText=T.prototype.V,T.prototype.send=T.prototype.fa,dist.exports={createWebChannelTransport:Se,ErrorCode:Fc,EventType:Gc,WebChannel:Md,XhrIoPool:Y}}).call(typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{});var StreamBridge=function(){function i(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}return i.prototype.onOpen=function(e){assert(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=e},i.prototype.onClose=function(e){assert(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=e},i.prototype.onMessage=function(e){assert(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=e},i.prototype.close=function(){this.closeFn()},i.prototype.send=function(e){this.sendFn(e)},i.prototype.callOnOpen=function(){assert(this.wrappedOnOpen!==void 0,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},i.prototype.callOnClose=function(e){assert(this.wrappedOnClose!==void 0,"Cannot call onClose because no callback was set"),this.wrappedOnClose(e)},i.prototype.callOnMessage=function(e){assert(this.wrappedOnMessage!==void 0,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(e)},i}(),LOG_TAG$a="Connection",RPC_STREAM_SERVICE="google.firestore.v1beta1.Firestore",RPC_URL_VERSION="v1beta1",RPC_NAME_REST_MAPPING={BatchGetDocuments:"batchGet",Commit:"commit"},X_GOOG_API_CLIENT_VALUE="gl-js/ fire/"+SDK_VERSION,XHR_TIMEOUT_SECS=15,WebChannelConnection=function(){function i(e){this.databaseId=e.databaseId,this.pool=new dist.exports.XhrIoPool;var o=e.ssl?"https":"http";this.baseUrl=o+"://"+e.host}return i.prototype.modifyHeadersForRequest=function(e,o){if(o)for(var s in o.authHeaders)o.authHeaders.hasOwnProperty(s)&&(e[s]=o.authHeaders[s]);e["X-Goog-Api-Client"]=X_GOOG_API_CLIENT_VALUE},i.prototype.invokeRPC=function(e,o,s){var f=this,d=this.makeUrl(e);return new Promise(function(m,_){f.pool.getObject(function($){$.listenOnce(dist.exports.EventType.COMPLETE,function(){try{switch($.getLastErrorCode()){case dist.exports.ErrorCode.NO_ERROR:var et=$.getResponseJson();debug(LOG_TAG$a,"XHR received:",JSON.stringify(et)),m(et);break;case dist.exports.ErrorCode.TIMEOUT:debug(LOG_TAG$a,'RPC "'+e+'" timed out'),_(new FirestoreError(Code.DEADLINE_EXCEEDED,"Request time out"));break;case dist.exports.ErrorCode.HTTP_ERROR:var tt=$.getStatus();debug(LOG_TAG$a,'RPC "'+e+'" failed with status:',tt,"response text:",$.getResponseText()),tt>0?_(new FirestoreError(mapCodeFromHttpStatus(tt),"Server responded with status "+$.getStatusText())):(debug(LOG_TAG$a,'RPC "'+e+'" failed'),_(new FirestoreError(Code.UNAVAILABLE,"Connection failed.")));break;default:fail('RPC "'+e+'" failed with unanticipated webchannel error '+$.getLastErrorCode()+": "+$.getLastError()+", giving up.")}}finally{debug(LOG_TAG$a,'RPC "'+e+'" completed.'),f.pool.releaseObject($)}});var G=JSON.stringify(o);debug(LOG_TAG$a,"XHR sending: ",d+" "+G);var Z={"Content-Type":"text/plain"};f.modifyHeadersForRequest(Z,s),$.send(d,"POST",G,Z,XHR_TIMEOUT_SECS)})})},i.prototype.invokeStreamingRPC=function(e,o,s){return this.invokeRPC(e,o,s)},i.prototype.openStream=function(e,o){var s=[this.baseUrl,"/",RPC_STREAM_SERVICE,"/",e,"/channel"],f=dist.exports.createWebChannelTransport(),d={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},httpHeadersOverwriteParam:"$httpHeaders",messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0};this.modifyHeadersForRequest(d.initMessageHeaders,o);var m=s.join("");debug(LOG_TAG$a,"Creating WebChannel: "+m+" "+d);var _=f.createWebChannel(m,d),$=!1,G=!1,Z=new StreamBridge({sendFn:function(tt){G?debug(LOG_TAG$a,"Not sending because WebChannel is closed:",tt):($||(debug(LOG_TAG$a,"Opening WebChannel transport."),_.open(),$=!0),debug(LOG_TAG$a,"WebChannel sending:",tt),_.send(tt))},closeFn:function(){return _.close()}}),et=function(tt,nt){_.listen(tt,function(st){try{nt(st)}catch(rt){setTimeout(function(){throw rt},0)}})};return et(dist.exports.WebChannel.EventType.OPEN,function(){G||debug(LOG_TAG$a,"WebChannel transport opened.")}),et(dist.exports.WebChannel.EventType.CLOSE,function(){G||(G=!0,debug(LOG_TAG$a,"WebChannel transport closed"),Z.callOnClose())}),et(dist.exports.WebChannel.EventType.ERROR,function(tt){G||(G=!0,debug(LOG_TAG$a,"WebChannel transport errored:",tt),Z.callOnClose(new FirestoreError(Code.UNAVAILABLE,"The operation could not be completed")))}),et(dist.exports.WebChannel.EventType.MESSAGE,function(tt){if(!G){var nt=tt.data[0];assert(!!nt,"Got a webchannel message without data.");var st=nt.error||nt[0]&&nt[0].error;if(st){debug(LOG_TAG$a,"WebChannel received error:",st);var rt=st.status,it=mapCodeFromRpcStatus(rt),ot=st.message;it===void 0&&(it=Code.INTERNAL,ot="Unknown error status: "+rt+" with message "+st.message),G=!0,Z.callOnClose(new FirestoreError(it,ot)),_.close()}else debug(LOG_TAG$a,"WebChannel received:",nt),Z.callOnMessage(nt)}}),setTimeout(function(){Z.callOnOpen()},0),Z},i.prototype.makeUrl=function(e){var o=RPC_NAME_REST_MAPPING[e];assert(o!==void 0,"Unknown REST mapping for: "+e);var s=[this.baseUrl,"/",RPC_URL_VERSION];return s.push("/projects/"),s.push(this.databaseId.projectId),s.push("/databases/"),s.push(this.databaseId.database),s.push("/documents"),s.push(":"),s.push(o),s.join("")},i}(),BrowserPlatform=function(){function i(){this.emptyByteString="",this.base64Available=typeof atob<"u"}return i.prototype.loadConnection=function(e){return Promise.resolve(new WebChannelConnection(e))},i.prototype.newSerializer=function(e){return new JsonProtoSerializer(e,{useProto3Json:!0})},i.prototype.formatJSON=function(e){return JSON.stringify(e)},i.prototype.atob=function(e){return atob(e)},i.prototype.btoa=function(e){return btoa(e)},i}();PlatformSupport.setPlatform(new BrowserPlatform);var FieldPath=function(){function i(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];validateNamedArrayAtLeastNumberOfElements("FieldPath",e,"fieldNames",1);for(var s=0;s<e.length;++s)if(validateArgType("FieldPath","string",s,e[s]),e[s].length===0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1(e)}return i.documentId=function(){return i._DOCUMENT_ID},i.prototype.isEqual=function(e){if(!(e instanceof i))throw invalidClassError("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},i._DOCUMENT_ID=new i(FieldPath$1.keyField().canonicalString()),i}(),RESERVED=new RegExp("[~\\*/\\[\\]]");function fromDotSeparatedString(i){var e=i.search(RESERVED);if(e>=0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid field path ("+i+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(FieldPath.bind.apply(FieldPath,[void 0].concat(i.split("."))))}catch{throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid field path ("+i+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}var OnlineState;(function(i){i[i.Unknown=0]="Unknown",i[i.Online=1]="Online",i[i.Offline=2]="Offline"})(OnlineState||(OnlineState={}));var ChangeType;(function(i){i[i.Added=0]="Added",i[i.Removed=1]="Removed",i[i.Modified=2]="Modified",i[i.Metadata=3]="Metadata"})(ChangeType||(ChangeType={}));var SyncState;(function(i){i[i.Local=0]="Local",i[i.Synced=1]="Synced"})(SyncState||(SyncState={}));var DocumentChangeSet=function(){function i(){this.changeMap=new SortedMap(DocumentKey.comparator)}return i.prototype.track=function(e){var o=e.doc.key,s=this.changeMap.get(o);if(!s){this.changeMap=this.changeMap.insert(o,e);return}e.type!==ChangeType.Added&&s.type===ChangeType.Metadata?this.changeMap=this.changeMap.insert(o,e):e.type===ChangeType.Metadata&&s.type!==ChangeType.Removed?this.changeMap=this.changeMap.insert(o,{type:s.type,doc:e.doc}):e.type===ChangeType.Modified&&s.type===ChangeType.Modified?this.changeMap=this.changeMap.insert(o,{type:ChangeType.Modified,doc:e.doc}):e.type===ChangeType.Modified&&s.type===ChangeType.Added?this.changeMap=this.changeMap.insert(o,{type:ChangeType.Added,doc:e.doc}):e.type===ChangeType.Removed&&s.type===ChangeType.Added?this.changeMap=this.changeMap.remove(o):e.type===ChangeType.Removed&&s.type===ChangeType.Modified?this.changeMap=this.changeMap.insert(o,{type:ChangeType.Removed,doc:s.doc}):e.type===ChangeType.Added&&s.type===ChangeType.Removed?this.changeMap=this.changeMap.insert(o,{type:ChangeType.Modified,doc:e.doc}):fail("unsupported combination of changes: "+JSON.stringify(e)+" after "+JSON.stringify(s))},i.prototype.getChanges=function(){var e=[];return this.changeMap.inorderTraversal(function(o,s){e.push(s)}),e},i}(),ViewSnapshot=function(){function i(e,o,s,f,d,m,_){this.query=e,this.docs=o,this.oldDocs=s,this.docChanges=f,this.fromCache=d,this.hasPendingWrites=m,this.syncStateChanged=_}return i.prototype.isEqual=function(e){if(this.fromCache!==e.fromCache||this.hasPendingWrites!==e.hasPendingWrites||this.syncStateChanged!==e.syncStateChanged||!this.query.isEqual(e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;var o=this.docChanges,s=e.docChanges;if(o.length!==s.length)return!1;for(var f=0;f<o.length;f++)if(o[f].type!==s[f].type||!o[f].doc.isEqual(s[f].doc))return!1;return!0},i}(),DocumentSet=function(){function i(e){e?this.comparator=function(o,s){return e(o,s)||DocumentKey.comparator(o.key,s.key)}:this.comparator=function(o,s){return DocumentKey.comparator(o.key,s.key)},this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}return i.emptySet=function(e){return new i(e.comparator)},i.prototype.has=function(e){return this.keyedMap.get(e)!=null},i.prototype.get=function(e){return this.keyedMap.get(e)},i.prototype.first=function(){return this.sortedSet.minKey()},i.prototype.last=function(){return this.sortedSet.maxKey()},i.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},i.prototype.indexOf=function(e){var o=this.keyedMap.get(e);return o?this.sortedSet.indexOf(o):-1},Object.defineProperty(i.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),i.prototype.forEach=function(e){this.sortedSet.inorderTraversal(function(o,s){return e(o),!1})},i.prototype.add=function(e){var o=this.delete(e.key);return o.copy(o.keyedMap.insert(e.key,e),o.sortedSet.insert(e,null))},i.prototype.delete=function(e){var o=this.get(e);return o?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(o)):this},i.prototype.isEqual=function(e){if(!(e instanceof i)||this.size!==e.size)return!1;for(var o=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();o.hasNext();){var f=o.getNext().key,d=s.getNext().key;if(!f.isEqual(d))return!1}return!0},i.prototype.toString=function(){var e=[];return this.forEach(function(o){e.push(o.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`},i.prototype.copy=function(e,o){var s=new i;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=o,s},i}(),ObjectMap=function(){function i(e){this.mapKeyFn=e,this.inner={}}return i.prototype.get=function(e){var o=this.mapKeyFn(e),s=this.inner[o];if(s!==void 0)for(var f=0,d=s;f<d.length;f++){var m=d[f],_=m[0],$=m[1];if(_.isEqual(e))return $}},i.prototype.has=function(e){return this.get(e)!==void 0},i.prototype.set=function(e,o){var s=this.mapKeyFn(e),f=this.inner[s];if(f===void 0){this.inner[s]=[[e,o]];return}for(var d=0;d<f.length;d++)if(f[d][0].isEqual(e)){f[d]=[e,o];return}f.push([e,o])},i.prototype.delete=function(e){var o=this.mapKeyFn(e),s=this.inner[o];if(s===void 0)return!1;for(var f=0;f<s.length;f++)if(s[f][0].isEqual(e))return s.length===1?delete this.inner[o]:s.splice(f,1),!0;return!1},i.prototype.forEach=function(e){forEach(this.inner,function(o,s){for(var f=0,d=s;f<d.length;f++){var m=d[f],_=m[0],$=m[1];e(_,$)}})},i.prototype.isEmpty=function(){return isEmpty(this.inner)},i}(),QueryListenersInfo=function(){function i(){this.listeners=[]}return i}(),EventManager=function(){function i(e){this.syncEngine=e,this.queries=new ObjectMap(function(o){return o.canonicalId()}),this.onlineState=OnlineState.Unknown,this.syncEngine.subscribe(this.onChange.bind(this),this.onError.bind(this))}return i.prototype.listen=function(e){var o=e.query,s=!1,f=this.queries.get(o);return f||(s=!0,f=new QueryListenersInfo,this.queries.set(o,f)),f.listeners.push(e),e.applyOnlineStateChange(this.onlineState),f.viewSnap&&e.onViewSnapshot(f.viewSnap),s?this.syncEngine.listen(o).then(function(d){return f.targetId=d,d}):Promise.resolve(f.targetId)},i.prototype.unlisten=function(e){return tslib.exports.__awaiter(this,void 0,void 0,function(){var o,s,f,d;return tslib.exports.__generator(this,function(m){return o=e.query,s=!1,f=this.queries.get(o),f&&(d=f.listeners.indexOf(e),d>=0&&(f.listeners.splice(d,1),s=f.listeners.length===0)),s?(this.queries.delete(o),[2,this.syncEngine.unlisten(o)]):[2]})})},i.prototype.onChange=function(e){for(var o=0,s=e;o<s.length;o++){var f=s[o],d=f.query,m=this.queries.get(d);if(m){for(var _=0,$=m.listeners;_<$.length;_++){var G=$[_];G.onViewSnapshot(f)}m.viewSnap=f}}},i.prototype.onError=function(e,o){var s=this.queries.get(e);if(s)for(var f=0,d=s.listeners;f<d.length;f++){var m=d[f];m.onError(o)}this.queries.delete(e)},i.prototype.applyOnlineStateChange=function(e){this.onlineState=e,this.queries.forEach(function(o,s){for(var f=0,d=s.listeners;f<d.length;f++){var m=d[f];m.applyOnlineStateChange(e)}})},i}(),QueryListener=function(){function i(e,o,s){this.query=e,this.queryObserver=o,this.raisedInitialEvent=!1,this.onlineState=OnlineState.Unknown,this.options=s||{}}return i.prototype.onViewSnapshot=function(e){if(assert(e.docChanges.length>0||e.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeDocumentMetadataChanges){for(var o=[],s=0,f=e.docChanges;s<f.length;s++){var d=f[s];d.type!==ChangeType.Metadata&&o.push(d)}e=new ViewSnapshot(e.query,e.docs,e.oldDocs,o,e.fromCache,e.hasPendingWrites,e.syncStateChanged)}this.raisedInitialEvent?this.shouldRaiseEvent(e)&&this.queryObserver.next(e):this.shouldRaiseInitialEvent(e,this.onlineState)&&this.raiseInitialEvent(e),this.snap=e},i.prototype.onError=function(e){this.queryObserver.error(e)},i.prototype.applyOnlineStateChange=function(e){this.onlineState=e,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&this.raiseInitialEvent(this.snap)},i.prototype.shouldRaiseInitialEvent=function(e,o){if(assert(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!e.fromCache)return!0;var s=o!==OnlineState.Offline;return this.options.waitForSyncWhenOnline&&s?(assert(e.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!e.docs.isEmpty()||o===OnlineState.Offline},i.prototype.shouldRaiseEvent=function(e){if(e.docChanges.length>0)return!0;var o=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||o?this.options.includeQueryMetadataChanges===!0:!1},i.prototype.raiseInitialEvent=function(e){assert(!this.raisedInitialEvent,"Trying to raise initial events for second time"),e=new ViewSnapshot(e.query,e.docs,DocumentSet.emptySet(e.docs),i.getInitialViewChanges(e),e.fromCache,e.hasPendingWrites,!0),this.raisedInitialEvent=!0,this.queryObserver.next(e)},i.getInitialViewChanges=function(e){var o=[];return e.docs.forEach(function(s){o.push({type:ChangeType.Added,doc:s})}),o},i}(),PersistencePromise=function(){function i(e){var o=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(function(s){o.isDone=!0,o.result=s,o.nextCallback&&o.nextCallback(s)},function(s){o.isDone=!0,o.error=s,o.catchCallback&&o.catchCallback(s)})}return i.prototype.catch=function(e){return this.next(void 0,e)},i.prototype.next=function(e,o){var s=this;return this.callbackAttached&&fail("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(o,this.error):this.wrapSuccess(e,this.result):new i(function(f,d){s.nextCallback=function(m){s.wrapSuccess(e,m).next(f,d)},s.catchCallback=function(m){s.wrapFailure(o,m).next(f,d)}})},i.prototype.toPromise=function(){var e=this;return new Promise(function(o,s){e.next(o,s)})},i.prototype.wrapUserFunction=function(e){try{var o=e();return o instanceof i?o:i.resolve(o)}catch(s){return i.reject(s)}},i.prototype.wrapSuccess=function(e,o){return e?this.wrapUserFunction(function(){return e(o)}):i.resolve(o)},i.prototype.wrapFailure=function(e,o){return e?this.wrapUserFunction(function(){return e(o)}):i.reject(o)},i.resolve=function(e){return new i(function(o,s){o(e)})},i.reject=function(e){return new i(function(o,s){s(e)})},i.waitFor=function(e){return e.reduce(function(o,s,f){return o.next(function(){return s})},i.resolve())},i.map=function(e){var o=[],s=!0,f=i.resolve(null);return e.reduce(function(d,m){return d.next(function(_){return s||o.push(_),s=!1,m})},f).next(function(d){return o.push(d),o})},i}(),EagerGarbageCollector=function(){function i(){this.isEager=!0,this.sources=[],this.potentialGarbage=documentKeySet()}return i.prototype.addGarbageSource=function(e){this.sources.push(e),e.setGarbageCollector(this)},i.prototype.removeGarbageSource=function(e){this.sources.splice(this.sources.indexOf(e),1),e.setGarbageCollector(null)},i.prototype.addPotentialGarbageKey=function(e){this.potentialGarbage=this.potentialGarbage.add(e)},i.prototype.collectGarbage=function(e){var o=this,s=[],f=documentKeySet();return this.potentialGarbage.forEach(function(d){var m=o.documentHasAnyReferences(e,d);s.push(m.next(function(_){return _||(f=f.add(d)),PersistencePromise.resolve()}))}),this.potentialGarbage=documentKeySet(),PersistencePromise.waitFor(s).next(function(){return f})},i.prototype.documentHasAnyReferences=function(e,o){var s=PersistencePromise.resolve(!1);return this.sources.map(function(f){return function(){return f.containsKey(e,o)}}).reduce(function(f,d){return f.next(function(m){return m?PersistencePromise.resolve(!0):d()})},s)},i}(),LocalViewChanges=function(){function i(e,o,s){this.query=e,this.addedKeys=o,this.removedKeys=s}return i.fromSnapshot=function(e){for(var o=documentKeySet(),s=documentKeySet(),f=0,d=e.docChanges;f<d.length;f++){var m=d[f];switch(m.type){case ChangeType.Added:o=o.add(m.doc.key);break;case ChangeType.Removed:s=s.add(m.doc.key);break}}return new i(e.query,o,s)},i}(),ReferenceSet=function(){function i(){this.refsByKey=new SortedSet(DocReference.compareByKey),this.refsByTarget=new SortedSet(DocReference.compareByTargetId),this.garbageCollector=null}return i.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},i.prototype.addReference=function(e,o){var s=new DocReference(e,o);this.refsByKey=this.refsByKey.add(s),this.refsByTarget=this.refsByTarget.add(s)},i.prototype.addReferences=function(e,o){var s=this;e.forEach(function(f){return s.addReference(f,o)})},i.prototype.removeReference=function(e,o){this.removeRef(new DocReference(e,o))},i.prototype.removeReferences=function(e,o){var s=this;e.forEach(function(f){return s.removeReference(f,o)})},i.prototype.removeReferencesForId=function(e){var o=this,s=DocumentKey.EMPTY,f=new DocReference(s,e),d=new DocReference(s,e+1);this.refsByTarget.forEachInRange([f,d],function(m){o.removeRef(m)})},i.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(o){return e.removeRef(o)})},i.prototype.removeRef=function(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e),this.garbageCollector!==null&&this.garbageCollector.addPotentialGarbageKey(e.key)},i.prototype.referencesForId=function(e){var o=DocumentKey.EMPTY,s=new DocReference(o,e),f=new DocReference(o,e+1),d=documentKeySet();return this.refsByTarget.forEachInRange([s,f],function(m){d=d.add(m.key)}),d},i.prototype.setGarbageCollector=function(e){this.garbageCollector=e},i.prototype.containsKey=function(e,o){var s=new DocReference(o,0),f=this.refsByKey.firstAfterOrEqual(s);return PersistencePromise.resolve(f!==null&&o.isEqual(f.key))},i}(),DocReference=function(){function i(e,o){this.key=e,this.targetOrBatchId=o}return i.compareByKey=function(e,o){return DocumentKey.comparator(e.key,o.key)||primitiveComparator(e.targetOrBatchId,o.targetOrBatchId)},i.compareByTargetId=function(e,o){return primitiveComparator(e.targetOrBatchId,o.targetOrBatchId)||DocumentKey.comparator(e.key,o.key)},i}(),RESERVED_BITS=1,GeneratorIds;(function(i){i[i.LocalStore=0]="LocalStore",i[i.SyncEngine=1]="SyncEngine"})(GeneratorIds||(GeneratorIds={}));var TargetIdGenerator=function(){function i(e,o){o===void 0&&(o=0),this.generatorId=e;var s=o>>RESERVED_BITS<<RESERVED_BITS,f=o-s;f>=e?this.previousId=s|this.generatorId:this.previousId=(s|this.generatorId)-(1<<RESERVED_BITS)}return i.prototype.next=function(){return this.previousId+=1<<RESERVED_BITS,this.previousId},i.forLocalStore=function(e){return e===void 0&&(e=0),new i(GeneratorIds.LocalStore,e)},i.forSyncEngine=function(){return new i(GeneratorIds.SyncEngine)},i}(),AddedLimboDocument=function(){function i(e){this.key=e}return i}(),RemovedLimboDocument=function(){function i(e){this.key=e}return i}(),View=function(){function i(e,o){this.query=e,this.syncedDocuments=o,this.syncState=null,this.current=!1,this.limboDocuments=documentKeySet(),this.mutatedKeys=documentKeySet(),this.documentSet=new DocumentSet(e.docComparator.bind(e))}return i.prototype.computeDocChanges=function(e,o){var s=this,f=o?o.changeSet:new DocumentChangeSet,d=o?o.documentSet:this.documentSet,m=o?o.mutatedKeys:this.mutatedKeys,_=d,$=!1,G=this.query.hasLimit()&&d.size===this.query.limit?d.last():null;if(e.inorderTraversal(function(et,tt){var nt=d.get(et),st=tt instanceof Document?tt:null;if(st&&(assert(et.isEqual(st.key),"Mismatching keys found in document changes: "+et+" != "+st.key),st=s.query.matches(st)?st:null),st?(_=_.add(st),st.hasLocalMutations?m=m.add(et):m=m.delete(et)):(_=_.delete(et),m=m.delete(et)),nt&&st){var rt=nt.data.isEqual(st.data);(!rt||nt.hasLocalMutations!==st.hasLocalMutations)&&(rt?f.track({type:ChangeType.Metadata,doc:st}):f.track({type:ChangeType.Modified,doc:st}),G&&s.query.docComparator(st,G)>0&&($=!0))}else!nt&&st?f.track({type:ChangeType.Added,doc:st}):nt&&!st&&(f.track({type:ChangeType.Removed,doc:nt}),G&&($=!0))}),this.query.hasLimit())for(;_.size>this.query.limit;){var Z=_.last();_=_.delete(Z.key),f.track({type:ChangeType.Removed,doc:Z})}return assert(!$||!o,"View was refilled using docs that themselves needed refilling."),{documentSet:_,changeSet:f,needsRefill:$,mutatedKeys:m}},i.prototype.applyChanges=function(e,o){var s=this;assert(!e.needsRefill,"Cannot apply changes that need a refill");var f=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;var d=e.changeSet.getChanges();d.sort(function(et,tt){return compareChangeType(et.type,tt.type)||s.query.docComparator(et.doc,tt.doc)}),this.applyTargetChange(o);var m=this.updateLimboDocuments(),_=this.limboDocuments.size===0&&this.current,$=_?SyncState.Synced:SyncState.Local,G=$!==this.syncState;if(this.syncState=$,d.length===0&&!G)return{limboChanges:m};var Z=new ViewSnapshot(this.query,e.documentSet,f,d,$===SyncState.Local,!e.mutatedKeys.isEmpty(),G);return{snapshot:Z,limboChanges:m}},i.prototype.applyOnlineStateChange=function(e){return this.current&&e===OnlineState.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new DocumentChangeSet,mutatedKeys:this.mutatedKeys,needsRefill:!1})):{limboChanges:[]}},i.prototype.shouldBeInLimbo=function(e){return!(this.syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)},i.prototype.applyTargetChange=function(e){if(e){var o=e.mapping;switch(o instanceof ResetMapping?this.syncedDocuments=o.documents:o instanceof UpdateMapping&&(this.syncedDocuments=o.applyToKeySet(this.syncedDocuments)),e.currentStatusUpdate){case CurrentStatusUpdate.MarkCurrent:this.current=!0;break;case CurrentStatusUpdate.MarkNotCurrent:this.current=!1;break;case CurrentStatusUpdate.None:break;default:fail("Unknown current status update: "+e.currentStatusUpdate)}}},i.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var o=this.limboDocuments;this.limboDocuments=documentKeySet(),this.documentSet.forEach(function(f){e.shouldBeInLimbo(f.key)&&(e.limboDocuments=e.limboDocuments.add(f.key))});var s=[];return o.forEach(function(f){e.limboDocuments.has(f)||s.push(new RemovedLimboDocument(f))}),this.limboDocuments.forEach(function(f){o.has(f)||s.push(new AddedLimboDocument(f))}),s},i}();function compareChangeType(i,e){var o=function(s){switch(s){case ChangeType.Added:return 1;case ChangeType.Modified:return 2;case ChangeType.Metadata:return 2;case ChangeType.Removed:return 0;default:return fail("Unknown ChangeType: "+s)}};return o(i)-o(e)}var LOG_TAG$9="SyncEngine",QueryView=function(){function i(e,o,s,f){this.query=e,this.targetId=o,this.resumeToken=s,this.view=f}return i}(),SyncEngine=function(){function i(e,o,s){this.localStore=e,this.remoteStore=o,this.currentUser=s,this.viewHandler=null,this.errorHandler=null,this.queryViewsByQuery=new ObjectMap(function(f){return f.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new SortedMap(DocumentKey.comparator),this.limboKeysByTarget={},this.limboDocumentRefs=new ReferenceSet,this.limboCollector=new EagerGarbageCollector,this.mutationUserCallbacks={},this.targetIdGenerator=TargetIdGenerator.forSyncEngine()}return i.prototype.subscribe=function(e,o){assert(e!==null&&o!==null,"View and error handlers cannot be null"),assert(this.viewHandler===null&&this.errorHandler===null,"SyncEngine already has a subscriber."),this.viewHandler=e,this.errorHandler=o,this.limboCollector.addGarbageSource(this.limboDocumentRefs)},i.prototype.listen=function(e){var o=this;return this.assertSubscribed("listen()"),assert(!this.queryViewsByQuery.has(e),"We already listen to the query: "+e),this.localStore.allocateQuery(e).then(function(s){return o.localStore.executeQuery(e).then(function(f){return o.localStore.remoteDocumentKeys(s.targetId).then(function(d){var m=new View(e,d),_=m.computeDocChanges(f),$=m.applyChanges(_);assert($.limboChanges.length===0,"View returned limbo docs before target ack from the server."),assert(!!$.snapshot,"applyChanges for new view should always return a snapshot");var G=new QueryView(e,s.targetId,s.resumeToken,m);o.queryViewsByQuery.set(e,G),o.queryViewsByTarget[s.targetId]=G,o.viewHandler([$.snapshot]),o.remoteStore.listen(s)})}).then(function(){return s.targetId})})},i.prototype.unlisten=function(e){var o=this;this.assertSubscribed("unlisten()");var s=this.queryViewsByQuery.get(e);return assert(!!s,"Trying to unlisten on query not found:"+e),this.localStore.releaseQuery(e).then(function(){return o.remoteStore.unlisten(s.targetId),o.removeAndCleanupQuery(s).then(function(){return o.localStore.collectGarbage()})})},i.prototype.write=function(e,o){var s=this;return this.assertSubscribed("write()"),this.localStore.localWrite(e).then(function(f){return s.addMutationCallback(f.batchId,o),s.emitNewSnapsAndNotifyLocalStore(f.changes)}).then(function(){return s.remoteStore.fillWritePipeline()})},i.prototype.wrapUpdateFunctionError=function(e){return e},i.prototype.runTransaction=function(e,o){var s=this;o===void 0&&(o=5),assert(o>=0,"Got negative number of retries for transaction.");var f=this.remoteStore.createTransaction(),d=function(){try{var m=e(f);return isNullOrUndefined(m)||!m.catch||!m.then?Promise.reject(Error("Transaction callback must return a Promise")):m.catch(function(_){return Promise.reject(s.wrapUpdateFunctionError(_))})}catch(_){return Promise.reject(s.wrapUpdateFunctionError(_))}};return d().then(function(m){return f.commit().then(function(){return m}).catch(function(_){return o===0?Promise.reject(_):s.runTransaction(e,o-1)})})},i.prototype.applyRemoteEvent=function(e){var o=this;return this.assertSubscribed("applyRemoteEvent()"),forEachNumber(e.targetChanges,function(s,f){var d=o.limboKeysByTarget[s];d&&f.currentStatusUpdate===CurrentStatusUpdate.MarkCurrent&&!e.documentUpdates.get(d)&&e.addDocumentUpdate(new NoDocument(d,e.snapshotVersion))}),this.localStore.applyRemoteEvent(e).then(function(s){return o.emitNewSnapsAndNotifyLocalStore(s,e)})},i.prototype.applyOnlineStateChange=function(e){var o=[];this.queryViewsByQuery.forEach(function(s,f){var d=f.view.applyOnlineStateChange(e);assert(d.limboChanges.length===0,"OnlineState should not affect limbo documents."),d.snapshot&&o.push(d.snapshot)}),this.viewHandler(o)},i.prototype.rejectListen=function(e,o){var s=this;this.assertSubscribed("rejectListens()");var f=this.limboKeysByTarget[e];if(f){this.limboTargetsByKey=this.limboTargetsByKey.remove(f),delete this.limboKeysByTarget[e];var d=new SortedMap(DocumentKey.comparator);d=d.insert(f,new NoDocument(f,SnapshotVersion.forDeletedDoc()));var m=new RemoteEvent(SnapshotVersion.MIN,{},d);return this.applyRemoteEvent(m)}else{var _=this.queryViewsByTarget[e];return assert(!!_,"Unknown targetId: "+e),this.localStore.releaseQuery(_.query).then(function(){return s.removeAndCleanupQuery(_).then(function(){s.errorHandler(_.query,o)})})}},i.prototype.applySuccessfulWrite=function(e){var o=this;return this.assertSubscribed("applySuccessfulWrite()"),this.processUserCallback(e.batch.batchId,null),this.localStore.acknowledgeBatch(e).then(function(s){return o.emitNewSnapsAndNotifyLocalStore(s)})},i.prototype.rejectFailedWrite=function(e,o){var s=this;return this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(e,o),this.localStore.rejectBatch(e).then(function(f){return s.emitNewSnapsAndNotifyLocalStore(f)})},i.prototype.addMutationCallback=function(e,o){var s=this.mutationUserCallbacks[this.currentUser.toKey()];s||(s=new SortedMap(primitiveComparator)),s=s.insert(e,o),this.mutationUserCallbacks[this.currentUser.toKey()]=s},i.prototype.processUserCallback=function(e,o){var s=this.mutationUserCallbacks[this.currentUser.toKey()];if(s){var f=s.get(e);f&&(assert(e===s.minKey(),"Mutation callbacks processed out-of-order?"),o?f.reject(o):f.resolve(),s=s.remove(e)),this.mutationUserCallbacks[this.currentUser.toKey()]=s}},i.prototype.removeAndCleanupQuery=function(e){return this.queryViewsByQuery.delete(e.query),delete this.queryViewsByTarget[e.targetId],this.limboDocumentRefs.removeReferencesForId(e.targetId),this.gcLimboDocuments()},i.prototype.updateTrackedLimbos=function(e,o){for(var s=0,f=o;s<f.length;s++){var d=f[s];d instanceof AddedLimboDocument?(this.limboDocumentRefs.addReference(d.key,e),this.trackLimboChange(d)):d instanceof RemovedLimboDocument?(debug(LOG_TAG$9,"Document no longer in limbo: "+d.key),this.limboDocumentRefs.removeReference(d.key,e)):fail("Unknown limbo change: "+JSON.stringify(d))}return this.gcLimboDocuments()},i.prototype.trackLimboChange=function(e){var o=e.key;if(!this.limboTargetsByKey.get(o)){debug(LOG_TAG$9,"New document in limbo: "+o);var s=this.targetIdGenerator.next(),f=Query$1.atPath(o.path);this.limboKeysByTarget[s]=o,this.remoteStore.listen(new QueryData(f,s,QueryPurpose.Listen)),this.limboTargetsByKey=this.limboTargetsByKey.insert(o,s)}},i.prototype.gcLimboDocuments=function(){var e=this;return this.limboCollector.collectGarbage(null).next(function(o){o.forEach(function(s){var f=e.limboTargetsByKey.get(s);f!==null&&(e.remoteStore.unlisten(f),e.limboTargetsByKey=e.limboTargetsByKey.remove(s),delete e.limboKeysByTarget[f])})}).toPromise()},i.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},i.prototype.emitNewSnapsAndNotifyLocalStore=function(e,o){var s=this,f=[],d=[],m=[];return this.queryViewsByQuery.forEach(function(_,$){m.push(Promise.resolve().then(function(){var G=$.view.computeDocChanges(e);return G.needsRefill?s.localStore.executeQuery($.query).then(function(Z){return $.view.computeDocChanges(Z,G)}):G}).then(function(G){var Z=o&&o.targetChanges[$.targetId],et=$.view.applyChanges(G,Z);return s.updateTrackedLimbos($.targetId,et.limboChanges).then(function(){if(et.snapshot){f.push(et.snapshot);var tt=LocalViewChanges.fromSnapshot(et.snapshot);d.push(tt)}})}))}),Promise.all(m).then(function(){return s.viewHandler(f),s.localStore.notifyLocalViewChanges(d)}).then(function(){return s.localStore.collectGarbage()})},i.prototype.assertSubscribed=function(e){assert(this.viewHandler!==null&&this.errorHandler!==null,"Trying to call "+e+" before calling subscribe().")},i.prototype.handleUserChange=function(e){var o=this;return this.currentUser=e,this.localStore.handleUserChange(e).then(function(s){return o.emitNewSnapsAndNotifyLocalStore(s)}).then(function(){return o.remoteStore.handleUserChange(e)})},i}(),BATCHID_UNKNOWN=-1,MutationBatch=function(){function i(e,o,s){this.batchId=e,this.localWriteTime=o,this.mutations=s}return i.prototype.applyToRemoteDocument=function(e,o,s){o&&assert(o.key.isEqual(e),"applyToRemoteDocument: key "+e+` should match maybeDoc key
        `+o.key);var f=s.mutationResults;assert(f.length===this.mutations.length,`Mismatch between mutations length
      (`+this.mutations.length+`) and mutation results length
      (`+f.length+").");for(var d=0;d<this.mutations.length;d++){var m=this.mutations[d];if(m.key.isEqual(e)){var _=f[d];o=m.applyToRemoteDocument(o,_)}}return o},i.prototype.applyToLocalView=function(e,o){o&&assert(o.key.isEqual(e),"applyToLocalDocument: key "+e+` should match maybeDoc key
        `+o.key);for(var s=o,f=0;f<this.mutations.length;f++){var d=this.mutations[f];d.key.isEqual(e)&&(o=d.applyToLocalView(o,s,this.localWriteTime))}return o},i.prototype.keys=function(){for(var e=documentKeySet(),o=0,s=this.mutations;o<s.length;o++){var f=s[o];e=e.add(f.key)}return e},i.prototype.isEqual=function(e){return this.batchId===e.batchId&&arrayEquals(this.mutations,e.mutations)},i.prototype.isTombstone=function(){return this.mutations.length===0},i.prototype.toTombstone=function(){return new i(this.batchId,this.localWriteTime,[])},i}(),MutationBatchResult=function(){function i(e,o,s,f,d){this.batch=e,this.commitVersion=o,this.mutationResults=s,this.streamToken=f,this.docVersions=d}return i.from=function(e,o,s,f){assert(e.mutations.length===s.length,"Mutations sent "+e.mutations.length+" must equal results received "+s.length);for(var d=documentVersionMap(),m=e.mutations,_=0;_<m.length;_++){var $=s[_].version;$===null&&($=o),d=d.insert(m[_].key,$)}return new i(e,o,s,f,d)},i}(),escapeChar="",encodedSeparatorChar="",encodedNul="",encodedEscape="";function encode(i){for(var e="",o=0;o<i.length;o++)e.length>0&&(e=encodeSeparator(e)),e=encodeSegment(i.get(o),e);return encodeSeparator(e)}function encodeSegment(i,e){for(var o=e,s=i.length,f=0;f<s;f++){var d=i.charAt(f);switch(d){case"\0":o+=escapeChar+encodedNul;break;case escapeChar:o+=escapeChar+encodedEscape;break;default:o+=d}}return o}function encodeSeparator(i){return i+escapeChar+encodedSeparatorChar}function decode(i){var e=i.length;if(assert(e>=2,"Invalid path "+i),e===2)return assert(i.charAt(0)===escapeChar&&i.charAt(1)===encodedSeparatorChar,"Non-empty path "+i+" had length 2"),ResourcePath.EMPTY_PATH;for(var o=e-2,s=[],f="",d=0;d<e;){var m=i.indexOf(escapeChar,d);(m<0||m>o)&&fail('Invalid encoded resource path: "'+i+'"');var _=i.charAt(m+1);switch(_){case encodedSeparatorChar:var $=i.substring(d,m),G=void 0;f.length===0?G=$:(f+=$,G=f,f=""),s.push(G);break;case encodedNul:f+=i.substring(d,m),f+="\0";break;case encodedEscape:f+=i.substring(d,m+1);break;default:fail('Invalid encoded resource path: "'+i+'"')}d=m+2}return new ResourcePath(s)}var SCHEMA_VERSION=2;function createOrUpgradeDb(i,e,o,s){assert(o<s&&o>=0&&s<=2,"Unexpected schema upgrade from v${fromVersion} to v{toVersion}."),o<1&&s>=1&&(createOwnerStore(i),createMutationQueue(i),createQueryCache(i),createRemoteDocumentCache(i));var f=PersistencePromise.resolve();return o<2&&s>=2&&(f=ensureTargetGlobalExists(e).next(function(d){return saveTargetCount(e,d)})),f}var DbTimestamp=function(){function i(e,o){this.seconds=e,this.nanos=o}return i}(),DbOwner=function(){function i(e,o){this.ownerId=e,this.leaseTimestampMs=o}return i.store="owner",i}();function createOwnerStore(i){i.createObjectStore(DbOwner.store)}var DbMutationQueue=function(){function i(e,o,s){this.userId=e,this.lastAcknowledgedBatchId=o,this.lastStreamToken=s}return i.store="mutationQueues",i.keyPath="userId",i}(),DbMutationBatch=function(){function i(e,o,s,f){this.userId=e,this.batchId=o,this.localWriteTimeMs=s,this.mutations=f}return i.store="mutations",i.keyPath=["userId","batchId"],i}();function createMutationQueue(i){i.createObjectStore(DbMutationQueue.store,{keyPath:DbMutationQueue.keyPath}),i.createObjectStore(DbMutationBatch.store,{keyPath:DbMutationBatch.keyPath}),i.createObjectStore(DbDocumentMutation.store)}var DbDocumentMutation=function(){function i(){}return i.prefixForUser=function(e){return[e]},i.prefixForPath=function(e,o){return[e,encode(o)]},i.key=function(e,o,s){return[e,encode(o),s]},i.store="documentMutations",i.PLACEHOLDER=new i,i}();function createRemoteDocumentCache(i){i.createObjectStore(DbRemoteDocument.store)}var DbNoDocument=function(){function i(e,o){this.path=e,this.readTime=o}return i}(),DbRemoteDocument=function(){function i(e,o){this.noDocument=e,this.document=o}return i.store="remoteDocuments",i}(),DbTarget=function(){function i(e,o,s,f,d,m){this.targetId=e,this.canonicalId=o,this.readTime=s,this.resumeToken=f,this.lastListenSequenceNumber=d,this.query=m}return i.store="targets",i.keyPath="targetId",i.queryTargetsIndexName="queryTargetsIndex",i.queryTargetsKeyPath=["canonicalId","targetId"],i}(),DbTargetDocument=function(){function i(e,o){this.targetId=e,this.path=o}return i.store="targetDocuments",i.keyPath=["targetId","path"],i.documentTargetsIndex="documentTargetsIndex",i.documentTargetsKeyPath=["path","targetId"],i}(),DbTargetGlobal=function(){function i(e,o,s,f){this.highestTargetId=e,this.highestListenSequenceNumber=o,this.lastRemoteSnapshotVersion=s,this.targetCount=f}return i.key="targetGlobalKey",i.store="targetGlobal",i}();function createQueryCache(i){var e=i.createObjectStore(DbTargetDocument.store,{keyPath:DbTargetDocument.keyPath});e.createIndex(DbTargetDocument.documentTargetsIndex,DbTargetDocument.documentTargetsKeyPath,{unique:!0});var o=i.createObjectStore(DbTarget.store,{keyPath:DbTarget.keyPath});o.createIndex(DbTarget.queryTargetsIndexName,DbTarget.queryTargetsKeyPath,{unique:!0}),i.createObjectStore(DbTargetGlobal.store)}function saveTargetCount(i,e){var o=i.store(DbTargetGlobal.store),s=i.store(DbTarget.store);return s.count().next(function(f){return e.targetCount=f,o.put(DbTargetGlobal.key,e)})}function ensureTargetGlobalExists(i){var e=i.store(DbTargetGlobal.store);return e.get(DbTargetGlobal.key).next(function(o){return o!=null?PersistencePromise.resolve(o):(o=new DbTargetGlobal(0,0,SnapshotVersion.MIN.toTimestamp(),0),e.put(DbTargetGlobal.key,o).next(function(){return o}))})}var ALL_STORES=[DbMutationQueue.store,DbMutationBatch.store,DbDocumentMutation.store,DbRemoteDocument.store,DbTarget.store,DbOwner.store,DbTargetGlobal.store,DbTargetDocument.store],LOG_TAG$8="SimpleDb",SimpleDb=function(){function i(e){this.db=e}return i.openOrCreate=function(e,o,s){return assert(i.isAvailable(),"IndexedDB not supported in current environment."),debug(LOG_TAG$8,"Opening database:",e),new PersistencePromise(function(f,d){var m=window.indexedDB.open(e,o);m.onsuccess=function(_){var $=_.target.result;f(new i($))},m.onerror=function(_){d(_.target.error)},m.onupgradeneeded=function(_){debug(LOG_TAG$8,'Database "'+e+'" requires upgrade from version:',_.oldVersion);var $=_.target.result,G=new SimpleDbTransaction(m.transaction);s($,G,_.oldVersion,SCHEMA_VERSION).next(function(){debug(LOG_TAG$8,"Database upgrade to version "+SCHEMA_VERSION+" complete")})}}).toPromise()},i.delete=function(e){return debug(LOG_TAG$8,"Removing database:",e),wrapRequest(window.indexedDB.deleteDatabase(e)).toPromise()},i.isAvailable=function(){if(typeof window>"u"||window.indexedDB==null)return!1;var e=window.navigator.userAgent;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)},i.prototype.runTransaction=function(e,o,s){var f=SimpleDbTransaction.open(this.db,e,o),d=s(f).catch(function(m){return f.abort(),PersistencePromise.reject(m)}).toPromise();return f.completionPromise.then(function(){return d})},i.prototype.close=function(){this.db.close()},i}(),IterationController=function(){function i(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(i.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cursor",{set:function(e){this.dbCursor=e},enumerable:!0,configurable:!0}),i.prototype.done=function(){this.shouldStop=!0},i.prototype.skip=function(e){this.nextKey=e},i.prototype.delete=function(){return wrapRequest(this.dbCursor.delete())},i}(),SimpleDbTransaction=function(){function i(e){var o=this;this.transaction=e,this.aborted=!1,this.completionPromise=new Promise(function(s,f){o.transaction.onabort=o.transaction.oncomplete=function(d){s()},o.transaction.onerror=function(d){f(d.target.error)}})}return i.open=function(e,o,s){return new i(e.transaction(s,o))},i.prototype.abort=function(){this.aborted||(debug(LOG_TAG$8,"Aborting transaction."),this.aborted=!0,this.transaction.abort())},i.prototype.store=function(e){var o=this.transaction.objectStore(e);return assert(!!o,"Object store not part of transaction: "+e),new SimpleDbStore(o)},i}(),SimpleDbStore=function(){function i(e){this.store=e}return i.prototype.put=function(e,o){var s;return o!==void 0?(debug(LOG_TAG$8,"PUT",this.store.name,e,o),s=this.store.put(o,e)):(debug(LOG_TAG$8,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),wrapRequest(s)},i.prototype.get=function(e){var o=this,s=this.store.get(e);return wrapRequest(s).next(function(f){return f===void 0&&(f=null),debug(LOG_TAG$8,"GET",o.store.name,e,f),f})},i.prototype.delete=function(e){debug(LOG_TAG$8,"DELETE",this.store.name,e);var o=this.store.delete(e);return wrapRequest(o)},i.prototype.count=function(){debug(LOG_TAG$8,"COUNT",this.store.name);var e=this.store.count();return wrapRequest(e)},i.prototype.loadAll=function(e,o){var s=this.cursor(this.options(e,o)),f=[];return this.iterateCursor(s,function(d,m){f.push(m)}).next(function(){return f})},i.prototype.deleteAll=function(e,o){debug(LOG_TAG$8,"DELETE ALL",this.store.name);var s=this.options(e,o);s.keysOnly=!1;var f=this.cursor(s);return this.iterateCursor(f,function(d,m,_){return _.delete()})},i.prototype.iterate=function(e,o){var s;o?s=e:(s={},o=e);var f=this.cursor(s);return this.iterateCursor(f,o)},i.prototype.iterateCursor=function(e,o){var s=[];return new PersistencePromise(function(f,d){e.onerror=function(m){d(m.target.error)},e.onsuccess=function(m){var _=m.target.result;if(!_){f();return}var $=new IterationController(_),G=o(_.primaryKey,_.value,$);G instanceof PersistencePromise&&s.push(G),$.isDone?f():$.skipToKey===null?_.continue():_.continue($.skipToKey)}}).next(function(){return PersistencePromise.waitFor(s)})},i.prototype.options=function(e,o){var s=void 0;return e!==void 0&&(typeof e=="string"?s=e:(assert(o===void 0,"3rd argument must not be defined if 2nd is a range."),o=e)),{index:s,range:o}},i.prototype.cursor=function(e){var o="next";if(e.reverse&&(o="prev"),e.index){var s=this.store.index(e.index);return e.keysOnly?s.openKeyCursor(e.range,o):s.openCursor(e.range,o)}else return this.store.openCursor(e.range,o)},i}();function wrapRequest(i){return new PersistencePromise(function(e,o){i.onsuccess=function(s){var f=s.target.result;e(f)},i.onerror=function(s){o(s.target.error)}})}var IndexedDbMutationQueue=function(){function i(e,o){this.userId=e,this.serializer=o,this.garbageCollector=null}return i.forUser=function(e,o){assert(e.uid!=="","UserID must not be an empty string.");var s=e.isAuthenticated()?e.uid:"";return new i(s,o)},i.prototype.start=function(e){var o=this;return i.loadNextBatchIdFromDb(e).next(function(s){return o.nextBatchId=s,mutationQueuesStore(e).get(o.userId)}).next(function(s){return s||(s=new DbMutationQueue(o.userId,BATCHID_UNKNOWN,"")),o.metadata=s,o.metadata.lastAcknowledgedBatchId>=o.nextBatchId?o.checkEmpty(e).next(function(f){return assert(f,"Reset nextBatchID is only possible when the queue is empty"),o.metadata.lastAcknowledgedBatchId=BATCHID_UNKNOWN,mutationQueuesStore(e).put(o.metadata)}):PersistencePromise.resolve()})},i.loadNextBatchIdFromDb=function(e){var o=BATCHID_UNKNOWN;return mutationsStore(e).iterate({reverse:!0},function(s,f,d){var m=s[0],_=s[1];if(_>o&&(o=f.batchId),m==="")d.done();else{var $=immediatePredecessor(m);d.skip([$])}}).next(function(){return o+1})},i.prototype.checkEmpty=function(e){var o=!0,s=IDBKeyRange.bound(this.keyForBatchId(Number.NEGATIVE_INFINITY),this.keyForBatchId(Number.POSITIVE_INFINITY));return mutationsStore(e).iterate({range:s},function(f,d,m){o=!1,m.done()}).next(function(){return o})},i.prototype.getNextBatchId=function(e){return PersistencePromise.resolve(this.nextBatchId)},i.prototype.getHighestAcknowledgedBatchId=function(e){return PersistencePromise.resolve(this.metadata.lastAcknowledgedBatchId)},i.prototype.acknowledgeBatch=function(e,o,s){var f=o.batchId;return assert(f>this.metadata.lastAcknowledgedBatchId,"Mutation batchIDs must be acknowledged in order"),this.metadata.lastAcknowledgedBatchId=f,this.metadata.lastStreamToken=validateStreamToken(s),mutationQueuesStore(e).put(this.metadata)},i.prototype.getLastStreamToken=function(e){return PersistencePromise.resolve(this.metadata.lastStreamToken)},i.prototype.setLastStreamToken=function(e,o){return this.metadata.lastStreamToken=validateStreamToken(o),mutationQueuesStore(e).put(this.metadata)},i.prototype.addMutationBatch=function(e,o,s){var f=this,d=this.nextBatchId;this.nextBatchId++;var m=new MutationBatch(d,o,s),_=this.serializer.toDbMutationBatch(this.userId,m);return mutationsStore(e).put(_).next(function(){for(var $=[],G=0,Z=s;G<Z.length;G++){var et=Z[G],tt=DbDocumentMutation.key(f.userId,et.key.path,d);documentMutationsStore(e).put(tt,DbDocumentMutation.PLACEHOLDER)}return PersistencePromise.waitFor($)}).next(function(){return m})},i.prototype.lookupMutationBatch=function(e,o){var s=this;return mutationsStore(e).get(this.keyForBatchId(o)).next(function(f){return f?s.serializer.fromDbMutationBatch(f):null})},i.prototype.getNextMutationBatchAfterBatchId=function(e,o){var s=this,f=Math.max(o,this.metadata.lastAcknowledgedBatchId)+1,d=IDBKeyRange.lowerBound(this.keyForBatchId(f)),m=null;return mutationsStore(e).iterate({range:d},function(_,$,G){$.userId===s.userId&&(assert($.batchId>=f,"Should have found mutation after "+f),m=s.serializer.fromDbMutationBatch($)),G.done()}).next(function(){return m})},i.prototype.getAllMutationBatches=function(e){var o=this,s=IDBKeyRange.bound(this.keyForBatchId(BATCHID_UNKNOWN),this.keyForBatchId(Number.POSITIVE_INFINITY));return mutationsStore(e).loadAll(s).next(function(f){return f.map(function(d){return o.serializer.fromDbMutationBatch(d)})})},i.prototype.getAllMutationBatchesThroughBatchId=function(e,o){var s=this,f=IDBKeyRange.bound(this.keyForBatchId(BATCHID_UNKNOWN),this.keyForBatchId(o));return mutationsStore(e).loadAll(f).next(function(d){return d.map(function(m){return s.serializer.fromDbMutationBatch(m)})})},i.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,o){var s=this,f=DbDocumentMutation.prefixForPath(this.userId,o.path),d=IDBKeyRange.lowerBound(f),m=[];return documentMutationsStore(e).iterate({range:d},function(_,$,G){var Z=_[0],et=_[1],tt=_[2],nt=decode(et);if(Z!==s.userId||!o.path.isEqual(nt)){G.done();return}var st=s.keyForBatchId(tt);return mutationsStore(e).get(st).next(function(rt){rt===null&&fail("Dangling document-mutation reference found: "+_+" which points to "+st),m.push(s.serializer.fromDbMutationBatch(rt))})}).next(function(){return m})},i.prototype.getAllMutationBatchesAffectingQuery=function(e,o){var s=this;assert(!o.isDocumentQuery(),"Document queries shouldn't go down this path");var f=o.path,d=f.length+1,m=DbDocumentMutation.prefixForPath(this.userId,f),_=IDBKeyRange.lowerBound(m),$=new SortedSet(primitiveComparator);return documentMutationsStore(e).iterate({range:_},function(G,Z,et){var tt=G[0],nt=G[1],st=G[2],rt=decode(nt);if(tt!==s.userId||!f.isPrefixOf(rt)){et.done();return}rt.length===d&&($=$.add(st))}).next(function(){var G=[],Z=[];return $.forEach(function(et){var tt=s.keyForBatchId(et);Z.push(mutationsStore(e).get(tt).next(function(nt){nt===null&&fail("Dangling document-mutation reference found, which points to "+tt),G.push(s.serializer.fromDbMutationBatch(nt))}))}),PersistencePromise.waitFor(Z).next(function(){return G})})},i.prototype.removeMutationBatches=function(e,o){for(var s=mutationsStore(e),f=documentMutationsStore(e),d=[],m=function(et){var tt=IDBKeyRange.only(_.keyForBatchId(et.batchId)),nt=0,st=s.iterate({range:tt},function(ft,ct,pt){return nt++,pt.delete()});d.push(st.next(function(){assert(nt===1,"Dangling document-mutation reference found: Missing batch "+et.batchId)}));for(var rt=0,it=et.mutations;rt<it.length;rt++){var ot=it[rt],lt=DbDocumentMutation.key(_.userId,ot.key.path,et.batchId);d.push(f.delete(lt)),_.garbageCollector!==null&&_.garbageCollector.addPotentialGarbageKey(ot.key)}},_=this,$=0,G=o;$<G.length;$++){var Z=G[$];m(Z)}return PersistencePromise.waitFor(d)},i.prototype.performConsistencyCheck=function(e){var o=this;return this.checkEmpty(e).next(function(s){if(!s)return PersistencePromise.resolve();var f=IDBKeyRange.lowerBound(DbDocumentMutation.prefixForUser(o.userId)),d=[];return documentMutationsStore(e).iterate({range:f},function(m,_,$){var G=m[0];if(G!==o.userId){$.done();return}else{var Z=decode(m[1]);d.push(Z)}}).next(function(){assert(d.length===0,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+d.map(function(m){return m.canonicalString()}))})})},i.prototype.setGarbageCollector=function(e){this.garbageCollector=e},i.prototype.containsKey=function(e,o){var s=this,f=DbDocumentMutation.prefixForPath(this.userId,o.path),d=f[1],m=IDBKeyRange.lowerBound(f),_=!1;return documentMutationsStore(e).iterate({range:m,keysOnly:!0},function($,G,Z){var et=$[0],tt=$[1];$[2],et===s.userId&&tt===d&&(_=!0),Z.done()}).next(function(){return _})},i.prototype.keyForBatchId=function(e){return[this.userId,e]},i}();function validateStreamToken(i){return assert(typeof i=="string","Persisting non-string stream token not supported."),i}function mutationsStore(i){return getStore$1(i,DbMutationBatch.store)}function documentMutationsStore(i){return getStore$1(i,DbDocumentMutation.store)}function mutationQueuesStore(i){return getStore$1(i,DbMutationQueue.store)}function getStore$1(i,e){return i instanceof SimpleDbTransaction?i.store(e):fail("Invalid transaction object provided!")}var IndexedDbQueryCache=function(){function i(e){this.serializer=e,this.lastRemoteSnapshotVersion=SnapshotVersion.MIN,this.metadata=null,this.garbageCollector=null}return i.prototype.start=function(e){var o=this;return globalTargetStore(e).get(DbTargetGlobal.key).next(function(s){assert(s!==null,"Missing metadata row that should be added by schema migration."),o.metadata=s;var f=s.lastRemoteSnapshotVersion;return o.lastRemoteSnapshotVersion=SnapshotVersion.fromTimestamp(new Timestamp(f.seconds,f.nanos)),PersistencePromise.resolve()})},i.prototype.getHighestTargetId=function(){return this.metadata.highestTargetId},i.prototype.getLastRemoteSnapshotVersion=function(){return this.lastRemoteSnapshotVersion},i.prototype.setLastRemoteSnapshotVersion=function(e,o){return this.lastRemoteSnapshotVersion=o,this.metadata.lastRemoteSnapshotVersion=o.toTimestamp(),globalTargetStore(e).put(DbTargetGlobal.key,this.metadata)},i.prototype.addQueryData=function(e,o){var s=this;return this.saveQueryData(e,o).next(function(){return s.metadata.targetCount+=1,s.updateMetadataFromQueryData(o),s.saveMetadata(e)})},i.prototype.updateQueryData=function(e,o){var s=this;return this.saveQueryData(e,o).next(function(){return s.updateMetadataFromQueryData(o)?s.saveMetadata(e):PersistencePromise.resolve()})},i.prototype.removeQueryData=function(e,o){var s=this;return assert(this.metadata.targetCount>0,"Removing from an empty query cache"),this.removeMatchingKeysForTargetId(e,o.targetId).next(function(){return targetsStore(e).delete(o.targetId)}).next(function(){return s.metadata.targetCount-=1,s.saveMetadata(e)})},i.prototype.saveMetadata=function(e){return globalTargetStore(e).put(DbTargetGlobal.key,this.metadata)},i.prototype.saveQueryData=function(e,o){return targetsStore(e).put(this.serializer.toDbTarget(o))},i.prototype.updateMetadataFromQueryData=function(e){var o=!1;return e.targetId>this.metadata.highestTargetId&&(this.metadata.highestTargetId=e.targetId,o=!0),o},Object.defineProperty(i.prototype,"count",{get:function(){return this.metadata.targetCount},enumerable:!0,configurable:!0}),i.prototype.getQueryData=function(e,o){var s=this,f=o.canonicalId(),d=IDBKeyRange.bound([f,Number.NEGATIVE_INFINITY],[f,Number.POSITIVE_INFINITY]),m=null;return targetsStore(e).iterate({range:d,index:DbTarget.queryTargetsIndexName},function(_,$,G){var Z=s.serializer.fromDbTarget($);o.isEqual(Z.query)&&(m=Z,G.done())}).next(function(){return m})},i.prototype.addMatchingKeys=function(e,o,s){var f=[],d=documentTargetStore(e);return o.forEach(function(m){var _=encode(m.path);f.push(d.put(new DbTargetDocument(s,_)))}),PersistencePromise.waitFor(f)},i.prototype.removeMatchingKeys=function(e,o,s){var f=this,d=[],m=documentTargetStore(e);return o.forEach(function(_){var $=encode(_.path);d.push(m.delete([s,$])),f.garbageCollector!==null&&f.garbageCollector.addPotentialGarbageKey(_)}),PersistencePromise.waitFor(d)},i.prototype.removeMatchingKeysForTargetId=function(e,o){var s=documentTargetStore(e),f=IDBKeyRange.bound([o],[o+1],!1,!0);return this.notifyGCForRemovedKeys(e,f).next(function(){return s.delete(f)})},i.prototype.notifyGCForRemovedKeys=function(e,o){var s=this,f=documentTargetStore(e);return this.garbageCollector!==null&&this.garbageCollector.isEager?f.iterate({range:o,keysOnly:!0},function(d,m,_){var $=decode(d[1]),G=new DocumentKey($);assert(s.garbageCollector!==null,"GarbageCollector for query cache set to null during key removal."),s.garbageCollector.addPotentialGarbageKey(G)}):PersistencePromise.resolve()},i.prototype.getMatchingKeysForTargetId=function(e,o){var s=IDBKeyRange.bound([o],[o+1],!1,!0),f=documentTargetStore(e),d=documentKeySet();return f.iterate({range:s,keysOnly:!0},function(m,_,$){var G=decode(m[1]),Z=new DocumentKey(G);d=d.add(Z)}).next(function(){return d})},i.prototype.setGarbageCollector=function(e){this.garbageCollector=e},i.prototype.containsKey=function(e,o){assert(e!==null,"Persistence Transaction cannot be null for query cache containsKey");var s=encode(o.path),f=IDBKeyRange.bound([s],[immediateSuccessor(s)],!1,!0),d=0;return documentTargetStore(e).iterate({index:DbTargetDocument.documentTargetsIndex,keysOnly:!0,range:f},function(m,_,$){d++,$.done()}).next(function(){return d>0})},i}();function targetsStore(i){return getStore(i,DbTarget.store)}function globalTargetStore(i){return getStore(i,DbTargetGlobal.store)}function documentTargetStore(i){return getStore(i,DbTargetDocument.store)}function getStore(i,e){return i instanceof SimpleDbTransaction?i.store(e):fail("Invalid transaction object provided!")}var IndexedDbRemoteDocumentCache=function(){function i(e){this.serializer=e}return i.prototype.addEntry=function(e,o){return remoteDocumentsStore(e).put(dbKey(o.key),this.serializer.toDbRemoteDocument(o))},i.prototype.removeEntry=function(e,o){return remoteDocumentsStore(e).delete(dbKey(o))},i.prototype.getEntry=function(e,o){var s=this;return remoteDocumentsStore(e).get(dbKey(o)).next(function(f){return f?s.serializer.fromDbRemoteDocument(f):null})},i.prototype.getDocumentsMatchingQuery=function(e,o){var s=this,f=documentMap(),d=o.path.toArray(),m=IDBKeyRange.lowerBound(d);return remoteDocumentsStore(e).iterate({range:m},function(_,$,G){var Z=s.serializer.fromDbRemoteDocument($);o.path.isPrefixOf(Z.key.path)?Z instanceof Document&&o.matches(Z)&&(f=f.insert(Z.key,Z)):G.done()}).next(function(){return f})},i}();function remoteDocumentsStore(i){return i instanceof SimpleDbTransaction?i.store(DbRemoteDocument.store):fail("Invalid transaction object provided!")}function dbKey(i){return i.path.toArray()}var LocalSerializer=function(){function i(e){this.remoteSerializer=e}return i.prototype.fromDbRemoteDocument=function(e){if(e.document)return this.remoteSerializer.fromDocument(e.document);if(e.noDocument){var o=DocumentKey.fromSegments(e.noDocument.path),s=e.noDocument.readTime,f=new Timestamp(s.seconds,s.nanos);return new NoDocument(o,SnapshotVersion.fromTimestamp(f))}else return fail("Unexpected DbRemoteDocument")},i.prototype.toDbRemoteDocument=function(e){if(e instanceof Document){var o=this.remoteSerializer.toDocument(e);return new DbRemoteDocument(null,o)}else{var s=e.key.path.toArray(),f=e.version.toTimestamp(),d=new DbTimestamp(f.seconds,f.nanos);return new DbRemoteDocument(new DbNoDocument(s,d),null)}},i.prototype.toDbMutationBatch=function(e,o){var s=this,f=o.mutations.map(function(d){return s.remoteSerializer.toMutation(d)});return new DbMutationBatch(e,o.batchId,o.localWriteTime.toEpochMilliseconds(),f)},i.prototype.fromDbMutationBatch=function(e){var o=this,s=e.mutations.map(function(d){return o.remoteSerializer.fromMutation(d)}),f=Timestamp.fromEpochMilliseconds(e.localWriteTimeMs);return new MutationBatch(e.batchId,f,s)},i.prototype.fromDbTarget=function(e){var o=new Timestamp(e.readTime.seconds,e.readTime.nanos),s=SnapshotVersion.fromTimestamp(o),f;return isDocumentQuery(e.query)?f=this.remoteSerializer.fromDocumentsTarget(e.query):f=this.remoteSerializer.fromQueryTarget(e.query),new QueryData(f,e.targetId,QueryPurpose.Listen,s,e.resumeToken)},i.prototype.toDbTarget=function(e){assert(QueryPurpose.Listen===e.purpose,"Only queries with purpose "+QueryPurpose.Listen+" may be stored, got "+e.purpose);var o=e.snapshotVersion.toTimestamp(),s=new DbTimestamp(o.seconds,o.nanos),f;e.query.isDocumentQuery()?f=this.remoteSerializer.toDocumentsTarget(e.query):f=this.remoteSerializer.toQueryTarget(e.query),assert(typeof e.resumeToken=="string","Persisting non-string resume token not supported.");var d=e.resumeToken;return new DbTarget(e.targetId,e.query.canonicalId(),s,d,0,f)},i}();function isDocumentQuery(i){return i.documents!==void 0}var LOG_TAG$7="IndexedDbPersistence",OWNER_LEASE_MAX_AGE_MS=5e3,OWNER_LEASE_REFRESH_INTERVAL_MS=4e3,ZOMBIE_OWNER_LOCALSTORAGE_SUFFIX="zombiedOwnerId",EXISTING_OWNER_ERROR_MSG="There is another tab open with offline persistence enabled. Only one such tab is allowed at a time. The other tab must be closed or persistence must be disabled.",UNSUPPORTED_PLATFORM_ERROR_MSG="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",IndexedDbPersistence=function(){function i(e,o){this.ownerId=this.generateOwnerId(),this.dbName=e+i.MAIN_DATABASE,this.serializer=new LocalSerializer(o),this.localStoragePrefix=e}return i.prototype.start=function(){var e=this;return i.isAvailable()?(assert(!this.started,"IndexedDbPersistence double-started!"),this.started=!0,SimpleDb.openOrCreate(this.dbName,SCHEMA_VERSION,createOrUpgradeDb).then(function(o){e.simpleDb=o}).then(function(){return e.tryAcquireOwnerLease()}).then(function(){e.scheduleOwnerLeaseRefreshes(),e.attachWindowUnloadHook()})):(this.persistenceError=new FirestoreError(Code.UNIMPLEMENTED,UNSUPPORTED_PLATFORM_ERROR_MSG),Promise.reject(this.persistenceError))},i.prototype.shutdown=function(){var e=this;return assert(this.started,"IndexedDbPersistence shutdown without start!"),this.started=!1,this.detachWindowUnloadHook(),this.stopOwnerLeaseRefreshes(),this.releaseOwnerLease().then(function(){e.simpleDb.close()})},i.prototype.getMutationQueue=function(e){return IndexedDbMutationQueue.forUser(e,this.serializer)},i.prototype.getQueryCache=function(){return new IndexedDbQueryCache(this.serializer)},i.prototype.getRemoteDocumentCache=function(){return new IndexedDbRemoteDocumentCache(this.serializer)},i.prototype.runTransaction=function(e,o){var s=this;return this.persistenceError?Promise.reject(this.persistenceError):(debug(LOG_TAG$7,"Starting transaction:",e),this.simpleDb.runTransaction("readwrite",ALL_STORES,function(f){return s.ensureOwnerLease(f).next(function(){return o(f)})}))},i.isAvailable=function(){return SimpleDb.isAvailable()},i.buildStoragePrefix=function(e){var o=e.databaseId.projectId;return e.databaseId.isDefaultDatabase||(o+="."+e.databaseId.database),"firestore/"+e.persistenceKey+"/"+o+"/"},i.prototype.tryAcquireOwnerLease=function(){var e=this;return this.simpleDb.runTransaction("readwrite",[DbOwner.store],function(o){var s=o.store(DbOwner.store);return s.get("owner").next(function(f){if(e.validOwner(f))return debug(LOG_TAG$7,"Valid owner already. Failing. Current owner:",f),e.persistenceError=new FirestoreError(Code.FAILED_PRECONDITION,EXISTING_OWNER_ERROR_MSG),PersistencePromise.reject(e.persistenceError);var d=new DbOwner(e.ownerId,Date.now());return debug(LOG_TAG$7,"No valid owner. Acquiring owner lease. Current owner:",f,"New owner:",d),s.put("owner",d)})})},i.prototype.releaseOwnerLease=function(){var e=this;return this.simpleDb.runTransaction("readwrite",[DbOwner.store],function(o){var s=o.store(DbOwner.store);return s.get("owner").next(function(f){return f!==null&&f.ownerId===e.ownerId?(debug(LOG_TAG$7,"Releasing owner lease."),s.delete("owner")):PersistencePromise.resolve()})})},i.prototype.ensureOwnerLease=function(e){var o=this,s=e.store(DbOwner.store);return s.get("owner").next(function(f){return f===null||f.ownerId!==o.ownerId?(o.persistenceError=new FirestoreError(Code.FAILED_PRECONDITION,EXISTING_OWNER_ERROR_MSG),PersistencePromise.reject(o.persistenceError)):PersistencePromise.resolve()})},i.prototype.validOwner=function(e){var o=Date.now(),s=o-OWNER_LEASE_MAX_AGE_MS,f=o;return e===null||e.leaseTimestampMs<s?!1:e.leaseTimestampMs>f?(error("Persistence owner-lease is in the future. Discarding.",e),!1):e.ownerId!==this.getZombiedOwnerId()},i.prototype.scheduleOwnerLeaseRefreshes=function(){var e=this;this.ownerLeaseRefreshHandle=setInterval(function(){var o=e.runTransaction("Refresh owner timestamp",function(s){var f=s.store(DbOwner.store);return f.put("owner",new DbOwner(e.ownerId,Date.now()))});o.catch(function(s){error(s),e.stopOwnerLeaseRefreshes()})},OWNER_LEASE_REFRESH_INTERVAL_MS)},i.prototype.stopOwnerLeaseRefreshes=function(){this.ownerLeaseRefreshHandle&&(clearInterval(this.ownerLeaseRefreshHandle),this.ownerLeaseRefreshHandle=null)},i.prototype.attachWindowUnloadHook=function(){var e=this;this.windowUnloadHandler=function(){e.setZombiedOwnerId(e.ownerId),e.shutdown()},window.addEventListener("unload",this.windowUnloadHandler)},i.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},i.prototype.getZombiedOwnerId=function(){try{var e=window.localStorage.getItem(this.zombiedOwnerLocalStorageKey());return debug(LOG_TAG$7,"Zombied ownerID from LocalStorage:",e),e}catch(o){return error("Failed to get zombie owner id.",o),null}},i.prototype.setZombiedOwnerId=function(e){try{e===null?window.localStorage.removeItem(this.zombiedOwnerLocalStorageKey()):window.localStorage.setItem(this.zombiedOwnerLocalStorageKey(),e)}catch(o){error("Failed to set zombie owner id.",o)}},i.prototype.zombiedOwnerLocalStorageKey=function(){return this.localStoragePrefix+ZOMBIE_OWNER_LOCALSTORAGE_SUFFIX},i.prototype.generateOwnerId=function(){return AutoId.newId()},i.MAIN_DATABASE="main",i}(),LocalDocumentsView=function(){function i(e,o){this.remoteDocumentCache=e,this.mutationQueue=o}return i.prototype.getDocument=function(e,o){var s=this;return this.remoteDocumentCache.getEntry(e,o).next(function(f){return s.computeLocalDocument(e,o,f)})},i.prototype.getDocuments=function(e,o){var s=this,f=[],d=maybeDocumentMap();return o.forEach(function(m){f.push(s.getDocument(e,m).next(function(_){_||(_=new NoDocument(m,SnapshotVersion.forDeletedDoc())),d=d.insert(m,_)}))}),PersistencePromise.waitFor(f).next(function(){return d})},i.prototype.getDocumentsMatchingQuery=function(e,o){return DocumentKey.isDocumentKey(o.path)?this.getDocumentsMatchingDocumentQuery(e,o.path):this.getDocumentsMatchingCollectionQuery(e,o)},i.prototype.getDocumentsMatchingDocumentQuery=function(e,o){return this.getDocument(e,new DocumentKey(o)).next(function(s){var f=documentMap();return s instanceof Document&&(f=f.insert(s.key,s)),f})},i.prototype.getDocumentsMatchingCollectionQuery=function(e,o){var s=this,f;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,o).next(function(d){return s.computeLocalDocuments(e,d)}).next(function(d){return f=d,s.mutationQueue.getAllMutationBatchesAffectingQuery(e,o)}).next(function(d){for(var m=documentKeySet(),_=0,$=d;_<$.length;_++)for(var G=$[_],Z=0,et=G.mutations;Z<et.length;Z++){var tt=et[Z];f.get(tt.key)||(m=m.add(tt.key))}var nt=[];return m.forEach(function(st){nt.push(s.getDocument(e,st).next(function(rt){rt instanceof Document&&(f=f.insert(rt.key,rt))}))}),PersistencePromise.waitFor(nt)}).next(function(){return f.forEach(function(d,m){o.matches(m)||(f=f.remove(d))}),f})},i.prototype.computeLocalDocument=function(e,o,s){return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,o).next(function(f){for(var d=0,m=f;d<m.length;d++){var _=m[d];s=_.applyToLocalView(o,s)}return s})},i.prototype.computeLocalDocuments=function(e,o){var s=this,f=[];return o.forEach(function(d,m){f.push(s.computeLocalDocument(e,d,m).next(function(_){_ instanceof Document?o=o.insert(_.key,_):_ instanceof NoDocument?o=o.remove(_.key):fail("Unknown MaybeDocument: "+_)}))}),PersistencePromise.waitFor(f).next(function(){return o})},i}(),RemoteDocumentChangeBuffer=function(){function i(e){this.remoteDocumentCache=e,this.changes=maybeDocumentMap()}return i.prototype.addEntry=function(e){var o=this.assertChanges();this.changes=o.insert(e.key,e)},i.prototype.getEntry=function(e,o){var s=this.assertChanges(),f=s.get(o);return f?PersistencePromise.resolve(f):this.remoteDocumentCache.getEntry(e,o)},i.prototype.apply=function(e){var o=this,s=this.assertChanges(),f=[];return s.forEach(function(d,m){f.push(o.remoteDocumentCache.addEntry(e,m))}),this.changes=null,PersistencePromise.waitFor(f)},i.prototype.assertChanges=function(){return assert(this.changes!==null,"Changes have already been applied."),this.changes},i}(),LOG_TAG$6="LocalStore",LocalStore=function(){function i(e,o,s){this.persistence=e,this.garbageCollector=s,this.localViewReferences=new ReferenceSet,this.targetIds={},this.targetIdGenerator=TargetIdGenerator.forLocalStore(),this.heldBatchResults=[],this.mutationQueue=e.getMutationQueue(o),this.remoteDocuments=e.getRemoteDocumentCache(),this.queryCache=e.getQueryCache(),this.localDocuments=new LocalDocumentsView(this.remoteDocuments,this.mutationQueue),this.garbageCollector.addGarbageSource(this.localViewReferences),this.garbageCollector.addGarbageSource(this.queryCache),this.garbageCollector.addGarbageSource(this.mutationQueue)}return i.prototype.start=function(){var e=this;return this.persistence.runTransaction("Start LocalStore",function(o){return e.startMutationQueue(o).next(function(){return e.startQueryCache(o)})})},i.prototype.handleUserChange=function(e){var o=this;return this.persistence.runTransaction("Handle user change",function(s){var f;return o.mutationQueue.getAllMutationBatches(s).next(function(d){return f=d,o.garbageCollector.removeGarbageSource(o.mutationQueue),o.mutationQueue=o.persistence.getMutationQueue(e),o.garbageCollector.addGarbageSource(o.mutationQueue),o.startMutationQueue(s)}).next(function(){return o.localDocuments=new LocalDocumentsView(o.remoteDocuments,o.mutationQueue),o.mutationQueue.getAllMutationBatches(s)}).next(function(d){for(var m=documentKeySet(),_=0,$=[f,d];_<$.length;_++)for(var G=$[_],Z=0,et=G;Z<et.length;Z++)for(var tt=et[Z],nt=0,st=tt.mutations;nt<st.length;nt++){var rt=st[nt];m=m.add(rt.key)}return o.localDocuments.getDocuments(s,m)})})},i.prototype.startQueryCache=function(e){var o=this;return this.queryCache.start(e).next(function(){var s=o.queryCache.getHighestTargetId();o.targetIdGenerator=TargetIdGenerator.forLocalStore(s)})},i.prototype.startMutationQueue=function(e){var o=this;return this.mutationQueue.start(e).next(function(){return o.heldBatchResults=[],o.mutationQueue.getHighestAcknowledgedBatchId(e)}).next(function(s){return s!==BATCHID_UNKNOWN?o.mutationQueue.getAllMutationBatchesThroughBatchId(e,s):PersistencePromise.resolve([])}).next(function(s){return s.length>0?o.mutationQueue.removeMutationBatches(e,s):PersistencePromise.resolve()})},i.prototype.localWrite=function(e){var o=this;return this.persistence.runTransaction("Locally write mutations",function(s){var f,d=Timestamp.now();return o.mutationQueue.addMutationBatch(s,d,e).next(function(m){f=m;var _=f.keys();return o.localDocuments.getDocuments(s,_)}).next(function(m){return{batchId:f.batchId,changes:m}})})},i.prototype.acknowledgeBatch=function(e){var o=this;return this.persistence.runTransaction("Acknowledge batch",function(s){var f;return o.mutationQueue.acknowledgeBatch(s,e.batch,e.streamToken).next(function(){if(o.shouldHoldBatchResult(e.commitVersion))return o.heldBatchResults.push(e),f=documentKeySet(),PersistencePromise.resolve();var d=new RemoteDocumentChangeBuffer(o.remoteDocuments);return o.releaseBatchResults(s,[e],d).next(function(m){return f=m,d.apply(s)})}).next(function(){return o.mutationQueue.performConsistencyCheck(s)}).next(function(){return o.localDocuments.getDocuments(s,f)})})},i.prototype.rejectBatch=function(e){var o=this;return this.persistence.runTransaction("Reject batch",function(s){var f,d;return o.mutationQueue.lookupMutationBatch(s,e).next(function(m){return assert(m!=null,"Attempt to reject nonexistent batch!"),f=m,o.mutationQueue.getHighestAcknowledgedBatchId(s).next(function(_){return assert(e>_,"Acknowledged batches can't be rejected."),f})}).next(function(){return o.removeMutationBatch(s,f)}).next(function(m){return d=m,o.mutationQueue.performConsistencyCheck(s)}).next(function(){return o.localDocuments.getDocuments(s,d)})})},i.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token",function(o){return e.mutationQueue.getLastStreamToken(o)})},i.prototype.setLastStreamToken=function(e){var o=this;return this.persistence.runTransaction("Set last stream token",function(s){return o.mutationQueue.setLastStreamToken(s,e)})},i.prototype.getLastRemoteSnapshotVersion=function(){return this.queryCache.getLastRemoteSnapshotVersion()},i.prototype.applyRemoteEvent=function(e){var o=this,s=new RemoteDocumentChangeBuffer(this.remoteDocuments);return this.persistence.runTransaction("Apply remote event",function(f){var d=[];forEachNumber(e.targetChanges,function(Z,et){var tt=o.targetIds[Z];if(!!tt){var nt=et.mapping;if(nt)if(nt instanceof ResetMapping)d.push(o.queryCache.removeMatchingKeysForTargetId(f,Z).next(function(){return o.queryCache.addMatchingKeys(f,nt.documents,Z)}));else if(nt instanceof UpdateMapping)d.push(o.queryCache.removeMatchingKeys(f,nt.removedDocuments,Z).next(function(){return o.queryCache.addMatchingKeys(f,nt.addedDocuments,Z)}));else return fail("Unknown mapping type: "+JSON.stringify(nt));var st=et.resumeToken;st.length>0&&(tt=tt.update({resumeToken:st,snapshotVersion:et.snapshotVersion}),o.targetIds[Z]=tt,d.push(o.queryCache.updateQueryData(f,tt)))}});var m=documentKeySet();e.documentUpdates.forEach(function(Z,et){m=m.add(Z),d.push(s.getEntry(f,Z).next(function(tt){tt==null||et.version.isEqual(SnapshotVersion.MIN)||et.version.compareTo(tt.version)>=0?s.addEntry(et):debug(LOG_TAG$6,"Ignoring outdated watch update for ",Z,". Current version:",tt.version," Watch version:",et.version),o.garbageCollector.addPotentialGarbageKey(Z)}))});var _=o.queryCache.getLastRemoteSnapshotVersion(),$=e.snapshotVersion;$.isEqual(SnapshotVersion.MIN)||(assert($.compareTo(_)>=0,"Watch stream reverted to previous snapshot?? "+$+" < "+_),d.push(o.queryCache.setLastRemoteSnapshotVersion(f,$)));var G;return PersistencePromise.waitFor(d).next(function(){return o.releaseHeldBatchResults(f,s)}).next(function(Z){return G=Z,s.apply(f)}).next(function(){return o.localDocuments.getDocuments(f,m.unionWith(G))})})},i.prototype.notifyLocalViewChanges=function(e){var o=this;return this.persistence.runTransaction("Notify local view changes",function(s){for(var f=[],d=function(G){f.push(o.queryCache.getQueryData(s,G.query).next(function(Z){assert(Z!==null,"Local view changes contain unallocated query.");var et=Z.targetId;o.localViewReferences.addReferences(G.addedKeys,et),o.localViewReferences.removeReferences(G.removedKeys,et)}))},m=0,_=e;m<_.length;m++){var $=_[m];d($)}return PersistencePromise.waitFor(f)})},i.prototype.nextMutationBatch=function(e){var o=this;return this.persistence.runTransaction("Get next mutation batch",function(s){return e===void 0&&(e=BATCHID_UNKNOWN),o.mutationQueue.getNextMutationBatchAfterBatchId(s,e)})},i.prototype.readDocument=function(e){var o=this;return this.persistence.runTransaction("read document",function(s){return o.localDocuments.getDocument(s,e)})},i.prototype.allocateQuery=function(e){var o=this;return this.persistence.runTransaction("Allocate query",function(s){var f;return o.queryCache.getQueryData(s,e).next(function(d){if(d)return f=d,PersistencePromise.resolve();var m=o.targetIdGenerator.next();return f=new QueryData(e,m,QueryPurpose.Listen),o.queryCache.addQueryData(s,f)}).next(function(){return assert(!o.targetIds[f.targetId],"Tried to allocate an already allocated query: "+e),o.targetIds[f.targetId]=f,f})})},i.prototype.releaseQuery=function(e){var o=this;return this.persistence.runTransaction("Release query",function(s){return o.queryCache.getQueryData(s,e).next(function(f){return assert(f!=null,"Tried to release nonexistent query: "+e),o.localViewReferences.removeReferencesForId(f.targetId),delete o.targetIds[f.targetId],o.garbageCollector.isEager?o.queryCache.removeQueryData(s,f):PersistencePromise.resolve()}).next(function(){if(isEmpty(o.targetIds)){var f=new RemoteDocumentChangeBuffer(o.remoteDocuments);return o.releaseHeldBatchResults(s,f).next(function(){f.apply(s)})}else return PersistencePromise.resolve()})})},i.prototype.executeQuery=function(e){var o=this;return this.persistence.runTransaction("Execute query",function(s){return o.localDocuments.getDocumentsMatchingQuery(s,e)})},i.prototype.remoteDocumentKeys=function(e){var o=this;return this.persistence.runTransaction("Remote document keys",function(s){return o.queryCache.getMatchingKeysForTargetId(s,e)})},i.prototype.collectGarbage=function(){var e=this;return this.persistence.runTransaction("Garbage collection",function(o){return e.garbageCollector.collectGarbage(o).next(function(s){var f=[];return s.forEach(function(d){f.push(e.remoteDocuments.removeEntry(o,d))}),PersistencePromise.waitFor(f)})})},i.prototype.releaseHeldBatchResults=function(e,o){for(var s=[],f=0,d=this.heldBatchResults;f<d.length;f++){var m=d[f];if(!this.isRemoteUpToVersion(m.commitVersion))break;s.push(m)}return s.length===0?PersistencePromise.resolve(documentKeySet()):(this.heldBatchResults.splice(0,s.length),this.releaseBatchResults(e,s,o))},i.prototype.isRemoteUpToVersion=function(e){var o=this.queryCache.getLastRemoteSnapshotVersion();return e.compareTo(o)<=0||isEmpty(this.targetIds)},i.prototype.shouldHoldBatchResult=function(e){return!this.isRemoteUpToVersion(e)||this.heldBatchResults.length>0},i.prototype.releaseBatchResults=function(e,o,s){for(var f=this,d=PersistencePromise.resolve(),m=function(Z){d=d.next(function(){return f.applyWriteToRemoteDocuments(e,Z,s)})},_=0,$=o;_<$.length;_++){var G=$[_];m(G)}return d.next(function(){return f.removeMutationBatches(e,o.map(function(Z){return Z.batch}))})},i.prototype.removeMutationBatch=function(e,o){return this.removeMutationBatches(e,[o])},i.prototype.removeMutationBatches=function(e,o){for(var s=documentKeySet(),f=0,d=o;f<d.length;f++)for(var m=d[f],_=0,$=m.mutations;_<$.length;_++){var G=$[_],Z=G.key;s=s.add(Z)}return this.mutationQueue.removeMutationBatches(e,o).next(function(){return s})},i.prototype.applyWriteToRemoteDocuments=function(e,o,s){var f=o.batch,d=f.keys(),m=PersistencePromise.resolve();return d.forEach(function(_){m=m.next(function(){return s.getEntry(e,_)}).next(function($){var G=$,Z=o.docVersions.get(_);assert(Z!==null,"ackVersions should contain every doc in the write."),(!G||G.version.compareTo(Z)<0)&&(G=f.applyToRemoteDocument(_,G,o),G?s.addEntry(G):assert(!$,"Mutation batch "+f+" applied to document "+$+" resulted in null"))})}),m},i}(),MemoryMutationQueue=function(){function i(){this.mutationQueue=[],this.nextBatchId=1,this.highestAcknowledgedBatchId=BATCHID_UNKNOWN,this.lastStreamToken=emptyByteString(),this.garbageCollector=null,this.batchesByDocumentKey=new SortedSet(DocReference.compareByKey)}return i.prototype.start=function(e){return this.mutationQueue.length===0&&(this.nextBatchId=1,this.highestAcknowledgedBatchId=BATCHID_UNKNOWN),assert(this.highestAcknowledgedBatchId<this.nextBatchId,"highestAcknowledgedBatchId must be less than the nextBatchId"),PersistencePromise.resolve()},i.prototype.checkEmpty=function(e){return PersistencePromise.resolve(this.mutationQueue.length===0)},i.prototype.getNextBatchId=function(e){return PersistencePromise.resolve(this.nextBatchId)},i.prototype.getHighestAcknowledgedBatchId=function(e){return PersistencePromise.resolve(this.highestAcknowledgedBatchId)},i.prototype.acknowledgeBatch=function(e,o,s){var f=o.batchId;assert(f>this.highestAcknowledgedBatchId,"Mutation batchIDs must be acknowledged in order");var d=this.indexOfExistingBatchId(f,"acknowledged"),m=this.mutationQueue[d];return assert(f===m.batchId,"Queue ordering failure: expected batch "+f+", got batch "+m.batchId),assert(!m.isTombstone(),"Can't acknowledge a previously removed batch"),this.highestAcknowledgedBatchId=f,this.lastStreamToken=s,PersistencePromise.resolve()},i.prototype.getLastStreamToken=function(e){return PersistencePromise.resolve(this.lastStreamToken)},i.prototype.setLastStreamToken=function(e,o){return this.lastStreamToken=o,PersistencePromise.resolve()},i.prototype.addMutationBatch=function(e,o,s){assert(s.length!==0,"Mutation batches should not be empty");var f=this.nextBatchId;if(this.nextBatchId++,this.mutationQueue.length>0){var d=this.mutationQueue[this.mutationQueue.length-1];assert(d.batchId<f,"Mutation batchIDs must be monotonically increasing order")}var m=new MutationBatch(f,o,s);this.mutationQueue.push(m);for(var _=0,$=s;_<$.length;_++){var G=$[_];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new DocReference(G.key,f))}return PersistencePromise.resolve(m)},i.prototype.lookupMutationBatch=function(e,o){return PersistencePromise.resolve(this.findMutationBatch(o))},i.prototype.getNextMutationBatchAfterBatchId=function(e,o){for(var s=this.mutationQueue.length,f=Math.max(o,this.highestAcknowledgedBatchId)+1,d=this.indexOfBatchId(f),m=d<0?0:d;m<s;m++){var _=this.mutationQueue[m];if(!_.isTombstone())return PersistencePromise.resolve(_)}return PersistencePromise.resolve(null)},i.prototype.getAllMutationBatches=function(e){return PersistencePromise.resolve(this.getAllLiveMutationBatchesBeforeIndex(this.mutationQueue.length))},i.prototype.getAllMutationBatchesThroughBatchId=function(e,o){var s=this.mutationQueue.length,f=this.indexOfBatchId(o);return f<0?f=0:f>=s?f=s:f++,PersistencePromise.resolve(this.getAllLiveMutationBatchesBeforeIndex(f))},i.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,o){var s=this,f=new DocReference(o,0),d=new DocReference(o,Number.POSITIVE_INFINITY),m=[];return this.batchesByDocumentKey.forEachInRange([f,d],function(_){assert(o.isEqual(_.key),"Should only iterate over a single key's batches");var $=s.findMutationBatch(_.targetOrBatchId);assert($!==null,"Batches in the index must exist in the main table"),m.push($)}),PersistencePromise.resolve(m)},i.prototype.getAllMutationBatchesAffectingQuery=function(e,o){var s=this,f=o.path,d=f.length+1,m=f;DocumentKey.isDocumentKey(m)||(m=m.child(""));var _=new DocReference(new DocumentKey(m),0),$=new SortedSet(primitiveComparator);this.batchesByDocumentKey.forEachWhile(function(Z){var et=Z.key.path;return f.isPrefixOf(et)?(et.length===d&&($=$.add(Z.targetOrBatchId)),!0):!1},_);var G=[];return $.forEach(function(Z){var et=s.findMutationBatch(Z);et!==null&&G.push(et)}),PersistencePromise.resolve(G)},i.prototype.removeMutationBatches=function(e,o){var s=o.length;assert(s>0,"Should not remove mutations when none exist.");var f=o[0].batchId,d=this.mutationQueue.length,m=this.indexOfExistingBatchId(f,"removed");assert(this.mutationQueue[m].batchId===f,"Removed batches must exist in the queue");for(var _=1,$=m+1;_<s&&$<d;){var G=this.mutationQueue[$];if(G.isTombstone()){$++;continue}assert(G.batchId===o[_].batchId,"Removed batches must be contiguous in the queue"),_++,$++}if(m===0){for(;$<d;$++){var G=this.mutationQueue[$];if(!G.isTombstone())break}var Z=$-m;this.mutationQueue.splice(m,Z)}else for(var et=m;et<$;et++)this.mutationQueue[et]=this.mutationQueue[et].toTombstone();for(var tt=this.batchesByDocumentKey,nt=0,st=o;nt<st.length;nt++)for(var G=st[nt],rt=G.batchId,it=0,ot=G.mutations;it<ot.length;it++){var lt=ot[it],ft=lt.key;this.garbageCollector!==null&&this.garbageCollector.addPotentialGarbageKey(ft);var ct=new DocReference(ft,rt);tt=tt.delete(ct)}return this.batchesByDocumentKey=tt,PersistencePromise.resolve()},i.prototype.setGarbageCollector=function(e){this.garbageCollector=e},i.prototype.containsKey=function(e,o){var s=new DocReference(o,0),f=this.batchesByDocumentKey.firstAfterOrEqual(s);return PersistencePromise.resolve(o.isEqual(f&&f.key))},i.prototype.performConsistencyCheck=function(e){return this.mutationQueue.length===0&&assert(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),PersistencePromise.resolve()},i.prototype.getAllLiveMutationBatchesBeforeIndex=function(e){for(var o=[],s=0;s<e;s++){var f=this.mutationQueue[s];f.isTombstone()||o.push(f)}return o},i.prototype.indexOfExistingBatchId=function(e,o){var s=this.indexOfBatchId(e);return assert(s>=0&&s<this.mutationQueue.length,"Batches must exist to be "+o),s},i.prototype.indexOfBatchId=function(e){if(this.mutationQueue.length===0)return 0;var o=this.mutationQueue[0].batchId;return e-o},i.prototype.findMutationBatch=function(e){var o=this.indexOfBatchId(e);if(o<0||o>=this.mutationQueue.length)return null;var s=this.mutationQueue[o];return assert(s.batchId===e,"If found batch must match"),s.isTombstone()?null:s},i}(),MemoryQueryCache=function(){function i(){this.queries=new ObjectMap(function(e){return e.canonicalId()}),this.lastRemoteSnapshotVersion=SnapshotVersion.MIN,this.highestTargetId=0,this.references=new ReferenceSet,this.targetCount=0}return i.prototype.start=function(e){return PersistencePromise.resolve()},i.prototype.getLastRemoteSnapshotVersion=function(){return this.lastRemoteSnapshotVersion},i.prototype.getHighestTargetId=function(){return this.highestTargetId},i.prototype.setLastRemoteSnapshotVersion=function(e,o){return this.lastRemoteSnapshotVersion=o,PersistencePromise.resolve()},i.prototype.saveQueryData=function(e){this.queries.set(e.query,e);var o=e.targetId;o>this.highestTargetId&&(this.highestTargetId=o)},i.prototype.addQueryData=function(e,o){return assert(!this.queries.has(o.query),"Adding a query that already exists"),this.saveQueryData(o),this.targetCount+=1,PersistencePromise.resolve()},i.prototype.updateQueryData=function(e,o){return assert(this.queries.has(o.query),"Updating a non-existent query"),this.saveQueryData(o),PersistencePromise.resolve()},i.prototype.removeQueryData=function(e,o){return assert(this.targetCount>0,"Removing a target from an empty cache"),assert(this.queries.has(o.query),"Removing a non-existent target from the cache"),this.queries.delete(o.query),this.references.removeReferencesForId(o.targetId),this.targetCount-=1,PersistencePromise.resolve()},Object.defineProperty(i.prototype,"count",{get:function(){return this.targetCount},enumerable:!0,configurable:!0}),i.prototype.getQueryData=function(e,o){var s=this.queries.get(o)||null;return PersistencePromise.resolve(s)},i.prototype.addMatchingKeys=function(e,o,s){return this.references.addReferences(o,s),PersistencePromise.resolve()},i.prototype.removeMatchingKeys=function(e,o,s){return this.references.removeReferences(o,s),PersistencePromise.resolve()},i.prototype.removeMatchingKeysForTargetId=function(e,o){return this.references.removeReferencesForId(o),PersistencePromise.resolve()},i.prototype.getMatchingKeysForTargetId=function(e,o){var s=this.references.referencesForId(o);return PersistencePromise.resolve(s)},i.prototype.setGarbageCollector=function(e){this.references.setGarbageCollector(e)},i.prototype.containsKey=function(e,o){return this.references.containsKey(e,o)},i}(),MemoryRemoteDocumentCache=function(){function i(){this.docs=maybeDocumentMap()}return i.prototype.addEntry=function(e,o){return this.docs=this.docs.insert(o.key,o),PersistencePromise.resolve()},i.prototype.removeEntry=function(e,o){return this.docs=this.docs.remove(o),PersistencePromise.resolve()},i.prototype.getEntry=function(e,o){return PersistencePromise.resolve(this.docs.get(o))},i.prototype.getDocumentsMatchingQuery=function(e,o){for(var s=documentMap(),f=new DocumentKey(o.path.child("")),d=this.docs.getIteratorFrom(f);d.hasNext();){var m=d.getNext(),_=m.key,$=m.value;if(!o.path.isPrefixOf(_.path))break;$ instanceof Document&&o.matches($)&&(s=s.insert($.key,$))}return PersistencePromise.resolve(s)},i}(),LOG_TAG$5="MemoryPersistence",MemoryPersistence=function(){function i(){this.mutationQueues={},this.remoteDocumentCache=new MemoryRemoteDocumentCache,this.queryCache=new MemoryQueryCache,this.started=!1}return i.prototype.start=function(){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(e){return assert(!this.started,"MemoryPersistence double-started!"),this.started=!0,[2]})})},i.prototype.shutdown=function(){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(e){return assert(this.started,"MemoryPersistence shutdown without start!"),this.started=!1,[2]})})},i.prototype.getMutationQueue=function(e){var o=this.mutationQueues[e.toKey()];return o||(o=new MemoryMutationQueue,this.mutationQueues[e.toKey()]=o),o},i.prototype.getQueryCache=function(){return this.queryCache},i.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},i.prototype.runTransaction=function(e,o){return debug(LOG_TAG$5,"Starting transaction:",e),o(new MemoryPersistenceTransaction).toPromise()},i}(),MemoryPersistenceTransaction=function(){function i(){}return i}(),NoOpGarbageCollector=function(){function i(){this.isEager=!1}return i.prototype.addGarbageSource=function(e){},i.prototype.removeGarbageSource=function(e){},i.prototype.addPotentialGarbageKey=function(e){},i.prototype.collectGarbage=function(e){return PersistencePromise.resolve(documentKeySet())},i}(),Deferred=function(){function i(){var e=this;this.promise=new Promise(function(o,s){e.resolve=o,e.reject=s})}return i}(),TimerId;(function(i){i.All="all",i.ListenStreamIdle="listen_stream_idle",i.ListenStreamConnectionBackoff="listen_stream_connection_backoff",i.WriteStreamIdle="write_stream_idle",i.WriteStreamConnectionBackoff="write_stream_connection_backoff",i.OnlineStateTimeout="online_state_timeout"})(TimerId||(TimerId={}));var DelayedOperation=function(){function i(e,o,s,f,d){this.asyncQueue=e,this.timerId=o,this.targetTimeMs=s,this.op=f,this.removalCallback=d,this.deferred=new Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(m){})}return i.createAndSchedule=function(e,o,s,f,d){var m=Date.now()+s,_=new i(e,o,m,f,d);return _.start(s),_},i.prototype.start=function(e){var o=this;this.timerHandle=setTimeout(function(){return o.handleDelayElapsed()},e)},i.prototype.skipDelay=function(){return this.handleDelayElapsed()},i.prototype.cancel=function(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(Code.CANCELLED,"Operation cancelled"+(e?": "+e:""))))},i.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueue(function(){return e.timerHandle!==null?(e.clearTimeout(),e.op().then(function(o){return e.deferred.resolve(o)})):Promise.resolve()})},i.prototype.clearTimeout=function(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},i}(),AsyncQueue=function(){function i(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return i.prototype.enqueue=function(e){var o=this;this.verifyNotFailed();var s=this.tail.then(function(){return o.operationInProgress=!0,e().catch(function(f){o.failure=f,o.operationInProgress=!1;var d=f.stack||f.message||"";throw error("INTERNAL UNHANDLED ERROR: ",d),d.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw f},0),f}).then(function(f){return o.operationInProgress=!1,f})});return this.tail=s,s},i.prototype.enqueueAfterDelay=function(e,o,s){var f=this;this.verifyNotFailed(),assert(!this.containsDelayedOperation(e),"Attempted to schedule multiple operations with timer id "+e+".");var d=DelayedOperation.createAndSchedule(this,e,o,s,function(m){return f.removeDelayedOperation(m)});return this.delayedOperations.push(d),d},i.prototype.verifyNotFailed=function(){this.failure&&fail("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},i.prototype.verifyOperationInProgress=function(){assert(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},i.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},i.prototype.containsDelayedOperation=function(e){return this.delayedOperations.findIndex(function(o){return o.timerId===e})>=0},i.prototype.runDelayedOperationsEarly=function(e){var o=this;return this.drain().then(function(){assert(e===TimerId.All||o.containsDelayedOperation(e),"Attempted to drain to missing operation "+e),o.delayedOperations.sort(function(m,_){return m.targetTimeMs-_.targetTimeMs});for(var s=0,f=o.delayedOperations;s<f.length;s++){var d=f[s];if(d.skipDelay(),e!==TimerId.All&&d.timerId===e)break}return o.drain()})},i.prototype.removeDelayedOperation=function(e){var o=this.delayedOperations.indexOf(e);assert(o>=0,"Delayed operation not found."),this.delayedOperations.splice(o,1)},i}(),LOG_TAG$4="ExponentialBackoff",ExponentialBackoff=function(){function i(e,o,s,f,d){this.queue=e,this.timerId=o,this.initialDelayMs=s,this.backoffFactor=f,this.maxDelayMs=d,this.timerPromise=null,this.reset()}return i.prototype.reset=function(){this.currentBaseMs=0},i.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},i.prototype.backoffAndRun=function(e){this.cancel();var o=this.currentBaseMs+this.jitterDelayMs();this.currentBaseMs>0&&debug(LOG_TAG$4,"Backing off for "+o+" ms "+("(base delay: "+this.currentBaseMs+" ms)")),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,o,e),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},i.prototype.cancel=function(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)},i.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},i}(),LOG_TAG$3="PersistentStream",PersistentStreamState;(function(i){i[i.Initial=0]="Initial",i[i.Auth=1]="Auth",i[i.Open=2]="Open",i[i.Error=3]="Error",i[i.Backoff=4]="Backoff",i[i.Stopped=5]="Stopped"})(PersistentStreamState||(PersistentStreamState={}));var BACKOFF_INITIAL_DELAY_MS=1e3,BACKOFF_MAX_DELAY_MS=60*1e3,BACKOFF_FACTOR=1.5,IDLE_TIMEOUT_MS=60*1e3,PersistentStream=function(){function i(e,o,s,f,d){this.queue=e,this.idleTimerId=s,this.connection=f,this.credentialsProvider=d,this.inactivityTimerPromise=null,this.stream=null,this.listener=null,this.backoff=new ExponentialBackoff(e,o,BACKOFF_INITIAL_DELAY_MS,BACKOFF_FACTOR,BACKOFF_MAX_DELAY_MS),this.state=PersistentStreamState.Initial}return i.prototype.isStarted=function(){return this.state===PersistentStreamState.Backoff||this.state===PersistentStreamState.Auth||this.state===PersistentStreamState.Open},i.prototype.isOpen=function(){return this.state===PersistentStreamState.Open},i.prototype.start=function(e){if(this.state===PersistentStreamState.Error){this.performBackoff(e);return}assert(this.state===PersistentStreamState.Initial,"Already started"),this.listener=e,this.auth()},i.prototype.stop=function(){this.isStarted()&&this.close(PersistentStreamState.Stopped)},i.prototype.inhibitBackoff=function(){assert(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=PersistentStreamState.Initial,this.backoff.reset()},i.prototype.markIdle=function(){var e=this;this.isOpen()&&this.inactivityTimerPromise===null&&(this.inactivityTimerPromise=this.queue.enqueueAfterDelay(this.idleTimerId,IDLE_TIMEOUT_MS,function(){return e.handleIdleCloseTimer()}))},i.prototype.sendRequest=function(e){this.cancelIdleCheck(),this.stream.send(e)},i.prototype.handleIdleCloseTimer=function(){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(e){return this.isOpen()?[2,this.close(PersistentStreamState.Initial)]:[2]})})},i.prototype.cancelIdleCheck=function(){this.inactivityTimerPromise&&(this.inactivityTimerPromise.cancel(),this.inactivityTimerPromise=null)},i.prototype.close=function(e,o){return tslib.exports.__awaiter(this,void 0,void 0,function(){var s;return tslib.exports.__generator(this,function(f){return assert(e===PersistentStreamState.Error||isNullOrUndefined(o),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),e!==PersistentStreamState.Error?this.backoff.reset():o&&o.code===Code.RESOURCE_EXHAUSTED&&(error(o.toString()),error("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,s=this.listener,this.listener=null,e!==PersistentStreamState.Stopped?[2,s.onClose(o)]:[2]})})},i.prototype.tearDown=function(){},i.prototype.auth=function(){var e=this;assert(this.state===PersistentStreamState.Initial,"Must be in initial state to auth"),this.state=PersistentStreamState.Auth,this.credentialsProvider.getToken(!1).then(function(o){e.startStream(o)},function(o){e.queue.enqueue(function(){return tslib.exports.__awaiter(e,void 0,void 0,function(){var s;return tslib.exports.__generator(this,function(f){return this.state!==PersistentStreamState.Stopped?(s=new FirestoreError(Code.UNKNOWN,"Fetching auth token failed: "+o.message),[2,this.handleStreamClose(s)]):[2]})})})})},i.prototype.startStream=function(e){var o=this;if(this.state!==PersistentStreamState.Stopped){assert(this.state===PersistentStreamState.Auth,"Trying to start stream in a non-auth state");var s=function(d,m){o.queue.enqueue(function(){return tslib.exports.__awaiter(o,void 0,void 0,function(){return tslib.exports.__generator(this,function(_){return this.stream===d?[2,m()]:[2]})})})};if(this.listener!==null){var f=this.startRpc(e);this.stream=f,this.stream.onOpen(function(){s(f,function(){return assert(o.state===PersistentStreamState.Auth,"Expected stream to be in state auth, but was "+o.state),o.state=PersistentStreamState.Open,o.listener.onOpen()})}),this.stream.onClose(function(d){s(f,function(){return o.handleStreamClose(d)})}),this.stream.onMessage(function(d){s(f,function(){return o.onMessage(d)})})}}},i.prototype.performBackoff=function(e){var o=this;assert(this.state===PersistentStreamState.Error,"Should only perform backoff in an error case"),this.state=PersistentStreamState.Backoff,this.backoff.backoffAndRun(function(){return tslib.exports.__awaiter(o,void 0,void 0,function(){return tslib.exports.__generator(this,function(s){return this.state===PersistentStreamState.Stopped?[2]:(this.state=PersistentStreamState.Initial,this.start(e),assert(this.isStarted(),"PersistentStream should have started"),[2])})})})},i.prototype.handleStreamClose=function(e){return assert(this.isStarted(),"Can't handle server close on non-started stream"),debug(LOG_TAG$3,"close with error: "+e),this.stream=null,this.close(PersistentStreamState.Error,e)},i}(),PersistentListenStream=function(i){tslib.exports.__extends(e,i);function e(o,s,f,d){var m=i.call(this,o,TimerId.ListenStreamConnectionBackoff,TimerId.ListenStreamIdle,s,f)||this;return m.serializer=d,m}return e.prototype.startRpc=function(o){return this.connection.openStream("Listen",o)},e.prototype.onMessage=function(o){this.backoff.reset();var s=this.serializer.fromWatchChange(o),f=this.serializer.versionFromListenResponse(o);return this.listener.onWatchChange(s,f)},e.prototype.watch=function(o){var s={};s.database=this.serializer.encodedDatabaseId,s.addTarget=this.serializer.toTarget(o);var f=this.serializer.toListenRequestLabels(o);f&&(s.labels=f),this.sendRequest(s)},e.prototype.unwatch=function(o){var s={};s.database=this.serializer.encodedDatabaseId,s.removeTarget=o,this.sendRequest(s)},e}(PersistentStream),PersistentWriteStream=function(i){tslib.exports.__extends(e,i);function e(o,s,f,d){var m=i.call(this,o,TimerId.WriteStreamConnectionBackoff,TimerId.WriteStreamIdle,s,f)||this;return m.serializer=d,m.handshakeComplete_=!1,m}return Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(o){this.handshakeComplete_=!1,i.prototype.start.call(this,o)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(o){return this.connection.openStream("Write",o)},e.prototype.onMessage=function(o){if(assert(!!o.streamToken,"Got a write response without a stream token"),this.lastStreamToken=o.streamToken,this.handshakeComplete_){this.backoff.reset();var s=this.serializer.fromWriteResults(o.writeResults),f=this.serializer.fromVersion(o.commitTime);return this.listener.onMutationResult(f,s)}else return assert(!o.writeResults||o.writeResults.length===0,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){assert(this.isOpen(),"Writing handshake requires an opened stream"),assert(!this.handshakeComplete_,"Handshake already completed");var o={};o.database=this.serializer.encodedDatabaseId,this.sendRequest(o)},e.prototype.writeMutations=function(o){var s=this;assert(this.isOpen(),"Writing mutations requires an opened stream"),assert(this.handshakeComplete_,"Handshake must be complete before writing mutations"),assert(this.lastStreamToken.length>0,"Trying to write mutation without a token");var f={streamToken:this.lastStreamToken,writes:o.map(function(d){return s.serializer.toMutation(d)})};this.sendRequest(f)},e}(PersistentStream),Datastore=function(){function i(e,o,s,f){this.queue=e,this.connection=o,this.credentials=s,this.serializer=f}return i.prototype.newPersistentWriteStream=function(){return new PersistentWriteStream(this.queue,this.connection,this.credentials,this.serializer)},i.prototype.newPersistentWatchStream=function(){return new PersistentListenStream(this.queue,this.connection,this.credentials,this.serializer)},i.prototype.commit=function(e){var o=this,s={database:this.serializer.encodedDatabaseId,writes:e.map(function(f){return o.serializer.toMutation(f)})};return this.invokeRPC("Commit",s).then(function(f){return o.serializer.fromWriteResults(f.writeResults)})},i.prototype.lookup=function(e){var o=this,s={database:this.serializer.encodedDatabaseId,documents:e.map(function(f){return o.serializer.toName(f)})};return this.invokeStreamingRPC("BatchGetDocuments",s).then(function(f){var d=maybeDocumentMap();f.forEach(function(_){var $=o.serializer.fromMaybeDocument(_);d=d.insert($.key,$)});var m=[];return e.forEach(function(_){var $=d.get(_);assert(!!$,"Missing entity in write response for "+_),m.push($)}),m})},i.prototype.invokeRPC=function(e,o){var s=this;return this.credentials.getToken(!1).then(function(f){return s.connection.invokeRPC(e,o,f)})},i.prototype.invokeStreamingRPC=function(e,o){var s=this;return this.credentials.getToken(!1).then(function(f){return s.connection.invokeStreamingRPC(e,o,f)})},i}(),Transaction$1=function(){function i(e){this.datastore=e,this.readVersions=documentVersionMap(),this.mutations=[],this.committed=!1}return i.prototype.recordVersion=function(e){var o=e.version;e instanceof NoDocument&&(o=SnapshotVersion.forDeletedDoc());var s=this.readVersions.get(e.key);if(s!==null){if(!o.isEqual(s))throw new FirestoreError(Code.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(e.key,o)},i.prototype.lookup=function(e){var o=this;return this.committed?Promise.reject("Transaction has already completed."):this.mutations.length>0?Promise.reject("Transactions lookups are invalid after writes."):this.datastore.lookup(e).then(function(s){return s.forEach(function(f){return o.recordVersion(f)}),s})},i.prototype.write=function(e){if(this.committed)throw new FirestoreError(Code.FAILED_PRECONDITION,"Transaction has already completed.");this.mutations=this.mutations.concat(e)},i.prototype.precondition=function(e){var o=this.readVersions.get(e);return o?Precondition.updateTime(o):Precondition.NONE},i.prototype.preconditionForUpdate=function(e){var o=this.readVersions.get(e);if(o&&o.isEqual(SnapshotVersion.forDeletedDoc()))throw new FirestoreError(Code.FAILED_PRECONDITION,"Can't update a document that doesn't exist.");return o?Precondition.updateTime(o):Precondition.exists(!0)},i.prototype.set=function(e,o){this.write(o.toMutations(e,this.precondition(e)))},i.prototype.update=function(e,o){this.write(o.toMutations(e,this.preconditionForUpdate(e)))},i.prototype.delete=function(e){this.write([new DeleteMutation(e,this.precondition(e))]),this.readVersions=this.readVersions.insert(e,SnapshotVersion.forDeletedDoc())},i.prototype.commit=function(){var e=this,o=this.readVersions;return this.mutations.forEach(function(s){o=o.remove(s.key)}),o.isEmpty()?this.datastore.commit(this.mutations).then(function(){e.committed=!0}):Promise.reject(Error("Every document read in a transaction must also be written."))},i}(),LOG_TAG$2="OnlineStateTracker",MAX_WATCH_STREAM_FAILURES=2,ONLINE_STATE_TIMEOUT_MS=10*1e3,OnlineStateTracker=function(){function i(e,o){this.asyncQueue=e,this.onlineStateHandler=o,this.state=OnlineState.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return i.prototype.handleWatchStreamStart=function(){var e=this;this.setAndBroadcast(OnlineState.Unknown),this.onlineStateTimer===null&&(this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(TimerId.OnlineStateTimeout,ONLINE_STATE_TIMEOUT_MS,function(){return e.onlineStateTimer=null,assert(e.state===OnlineState.Unknown,"Timer should be canceled if we transitioned to a different state."),debug(LOG_TAG$2,"Watch stream didn't reach online or offline within "+(ONLINE_STATE_TIMEOUT_MS+"ms. Considering client offline.")),e.logClientOfflineWarningIfNecessary(),e.setAndBroadcast(OnlineState.Offline),Promise.resolve()}))},i.prototype.handleWatchStreamFailure=function(){this.state===OnlineState.Online?this.setAndBroadcast(OnlineState.Unknown):(this.watchStreamFailures++,this.watchStreamFailures>=MAX_WATCH_STREAM_FAILURES&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(),this.setAndBroadcast(OnlineState.Offline)))},i.prototype.set=function(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e===OnlineState.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)},i.prototype.setAndBroadcast=function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))},i.prototype.logClientOfflineWarningIfNecessary=function(){this.shouldWarnClientIsOffline&&(error("Could not reach Firestore backend."),this.shouldWarnClientIsOffline=!1)},i.prototype.clearOnlineStateTimer=function(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},i}(),LOG_TAG$1="RemoteStore",MAX_PENDING_WRITES=10,RemoteStore=function(){function i(e,o,s,f){this.localStore=e,this.datastore=o,this.pendingWrites=[],this.lastBatchSeen=BATCHID_UNKNOWN,this.listenTargets={},this.pendingTargetResponses={},this.accumulatedWatchChanges=[],this.watchStream=null,this.writeStream=null,this.onlineStateTracker=new OnlineStateTracker(s,f)}return i.prototype.start=function(){return this.enableNetwork()},i.prototype.isNetworkEnabled=function(){return assert(this.watchStream==null==(this.writeStream==null),"WatchStream and WriteStream should both be null or non-null"),this.watchStream!=null},i.prototype.enableNetwork=function(){var e=this;return this.isNetworkEnabled()?Promise.resolve():(this.watchStream=this.datastore.newPersistentWatchStream(),this.writeStream=this.datastore.newPersistentWriteStream(),this.localStore.getLastStreamToken().then(function(o){return e.writeStream.lastStreamToken=o,e.shouldStartWatchStream()?e.startWatchStream():e.onlineStateTracker.set(OnlineState.Unknown),e.fillWritePipeline()}))},i.prototype.disableNetwork=function(){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(e){return this.disableNetworkInternal(),this.onlineStateTracker.set(OnlineState.Offline),[2]})})},i.prototype.disableNetworkInternal=function(){this.isNetworkEnabled()&&(this.watchStream.stop(),this.writeStream.stop(),this.cleanUpWatchStreamState(),this.cleanUpWriteStreamState(),this.writeStream=null,this.watchStream=null)},i.prototype.shutdown=function(){return debug(LOG_TAG$1,"RemoteStore shutting down."),this.disableNetworkInternal(),this.onlineStateTracker.set(OnlineState.Unknown),Promise.resolve()},i.prototype.listen=function(e){assert(!contains(this.listenTargets,e.targetId),"listen called with duplicate targetId!"),this.listenTargets[e.targetId]=e,this.shouldStartWatchStream()?this.startWatchStream():this.isNetworkEnabled()&&this.watchStream.isOpen()&&this.sendWatchRequest(e)},i.prototype.unlisten=function(e){assert(contains(this.listenTargets,e),"unlisten called without assigned target ID!"),delete this.listenTargets[e],this.isNetworkEnabled()&&this.watchStream.isOpen()&&(this.sendUnwatchRequest(e),isEmpty(this.listenTargets)&&this.watchStream.markIdle())},i.prototype.sendWatchRequest=function(e){this.recordPendingTargetRequest(e.targetId),this.watchStream.watch(e)},i.prototype.sendUnwatchRequest=function(e){this.recordPendingTargetRequest(e),this.watchStream.unwatch(e)},i.prototype.recordPendingTargetRequest=function(e){this.pendingTargetResponses[e]=(this.pendingTargetResponses[e]||0)+1},i.prototype.startWatchStream=function(){assert(this.shouldStartWatchStream(),"startWriteStream() called when shouldStartWatchStream() is false."),this.watchStream.start({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.onlineStateTracker.handleWatchStreamStart()},i.prototype.shouldStartWatchStream=function(){return this.isNetworkEnabled()&&!this.watchStream.isStarted()&&!isEmpty(this.listenTargets)},i.prototype.cleanUpWatchStreamState=function(){this.accumulatedWatchChanges=[],this.pendingTargetResponses={}},i.prototype.onWatchStreamOpen=function(){return tslib.exports.__awaiter(this,void 0,void 0,function(){var e=this;return tslib.exports.__generator(this,function(o){return forEachNumber(this.listenTargets,function(s,f){e.sendWatchRequest(f)}),[2]})})},i.prototype.onWatchStreamClose=function(e){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(o){return assert(this.isNetworkEnabled(),"onWatchStreamClose() should only be called when the network is enabled"),this.cleanUpWatchStreamState(),this.onlineStateTracker.handleWatchStreamFailure(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(OnlineState.Unknown),[2]})})},i.prototype.onWatchStreamChange=function(e,o){return tslib.exports.__awaiter(this,void 0,void 0,function(){var s;return tslib.exports.__generator(this,function(f){return this.onlineStateTracker.set(OnlineState.Online),e instanceof WatchTargetChange&&e.state===WatchTargetChangeState.Removed&&e.cause?[2,this.handleTargetError(e)]:(this.accumulatedWatchChanges.push(e),!o.isEqual(SnapshotVersion.MIN)&&o.compareTo(this.localStore.getLastRemoteSnapshotVersion())>=0?(s=this.accumulatedWatchChanges,this.accumulatedWatchChanges=[],[2,this.handleWatchChangeBatch(o,s)]):[2])})})},i.prototype.handleWatchChangeBatch=function(e,o){var s=this,f=new WatchChangeAggregator(e,this.listenTargets,this.pendingTargetResponses);f.addChanges(o);var d=f.createRemoteEvent();this.pendingTargetResponses=f.pendingTargetResponses;var m=[];return forEachNumber(f.existenceFilters,function(_,$){var G=s.listenTargets[_];if(!!G){var Z=G.query;if(Z.isDocumentQuery())if($.count===0){var et=new DocumentKey(Z.path),tt=new NoDocument(et,e);d.addDocumentUpdate(tt)}else assert($.count===1,"Single document existence filter with count: "+$.count);else{var nt=s.localStore.remoteDocumentKeys(_).then(function(st){if(d.targetChanges[_]){var rt=d.targetChanges[_].mapping;rt!==null&&(rt instanceof UpdateMapping?st=rt.applyToKeySet(st):(assert(rt instanceof ResetMapping,"Expected either reset or update mapping but got something else: "+rt),st=rt.documents))}if(st.size!==$.count){d.handleExistenceFilterMismatch(_);var it=new QueryData(Z,_,G.purpose);s.listenTargets[_]=it,s.sendUnwatchRequest(_);var ot=new QueryData(Z,_,QueryPurpose.ExistenceFilterMismatch);s.sendWatchRequest(ot)}});m.push(nt)}}}),Promise.all(m).then(function(){return forEachNumber(d.targetChanges,function(_,$){if($.resumeToken.length>0){var G=s.listenTargets[_];G&&(s.listenTargets[_]=G.update({resumeToken:$.resumeToken,snapshotVersion:$.snapshotVersion}))}}),s.syncEngine.applyRemoteEvent(d)})},i.prototype.handleTargetError=function(e){var o=this;assert(!!e.cause,"Handling target error without a cause");var s=e.cause,f=Promise.resolve();return e.targetIds.forEach(function(d){f=f.then(function(){return tslib.exports.__awaiter(o,void 0,void 0,function(){return tslib.exports.__generator(this,function(m){return contains(this.listenTargets,d)?(delete this.listenTargets[d],[2,this.syncEngine.rejectListen(d,s)]):[2]})})})}),f},i.prototype.cleanUpWriteStreamState=function(){this.lastBatchSeen=BATCHID_UNKNOWN,debug(LOG_TAG$1,"Stopping write stream with "+this.pendingWrites.length+" pending writes"),this.pendingWrites=[]},i.prototype.fillWritePipeline=function(){return tslib.exports.__awaiter(this,void 0,void 0,function(){var e=this;return tslib.exports.__generator(this,function(o){return this.canWriteMutations()?[2,this.localStore.nextMutationBatch(this.lastBatchSeen).then(function(s){if(s===null)e.pendingWrites.length===0&&e.writeStream.markIdle();else return e.commit(s),e.fillWritePipeline()})]:[2]})})},i.prototype.canWriteMutations=function(){return this.isNetworkEnabled()&&this.pendingWrites.length<MAX_PENDING_WRITES},i.prototype.outstandingWrites=function(){return this.pendingWrites.length},i.prototype.commit=function(e){assert(this.canWriteMutations(),"commit called when batches can't be written"),this.lastBatchSeen=e.batchId,this.pendingWrites.push(e),this.shouldStartWriteStream()?this.startWriteStream():this.isNetworkEnabled()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(e.mutations)},i.prototype.shouldStartWriteStream=function(){return this.isNetworkEnabled()&&!this.writeStream.isStarted()&&this.pendingWrites.length>0},i.prototype.startWriteStream=function(){assert(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})},i.prototype.onWriteStreamOpen=function(){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(e){return this.writeStream.writeHandshake(),[2]})})},i.prototype.onWriteHandshakeComplete=function(){var e=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var o=0,s=e.pendingWrites;o<s.length;o++){var f=s[o];e.writeStream.writeMutations(f.mutations)}})},i.prototype.onMutationResult=function(e,o){var s=this;assert(this.pendingWrites.length>0,"Got result for empty pending writes");var f=this.pendingWrites.shift(),d=MutationBatchResult.from(f,e,o,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(d).then(function(){return s.fillWritePipeline()})},i.prototype.onWriteStreamClose=function(e){return tslib.exports.__awaiter(this,void 0,void 0,function(){var o=this,s;return tslib.exports.__generator(this,function(f){return assert(this.isNetworkEnabled(),"onWriteStreamClose() should only be called when the network is enabled"),e&&this.pendingWrites.length>0?(assert(!!e,"We have pending writes, but the write stream closed without an error"),s=void 0,this.writeStream.handshakeComplete?s=this.handleWriteError(e):s=this.handleHandshakeError(e),[2,s.then(function(){o.shouldStartWriteStream()&&o.startWriteStream()})]):[2]})})},i.prototype.handleHandshakeError=function(e){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(o){return isPermanentError(e.code)||e.code===Code.ABORTED?(debug(LOG_TAG$1,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=emptyByteString(),[2,this.localStore.setLastStreamToken(emptyByteString())]):[2]})})},i.prototype.handleWriteError=function(e){return tslib.exports.__awaiter(this,void 0,void 0,function(){var o=this,s;return tslib.exports.__generator(this,function(f){return isPermanentError(e.code)?(s=this.pendingWrites.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(s.batchId,e).then(function(){return o.fillWritePipeline()})]):[2]})})},i.prototype.createTransaction=function(){return new Transaction$1(this.datastore)},i.prototype.handleUserChange=function(e){if(debug(LOG_TAG$1,"RemoteStore changing users: uid=",e.uid),this.isNetworkEnabled())return this.disableNetworkInternal(),this.onlineStateTracker.set(OnlineState.Unknown),this.enableNetwork()},i}(),LOG_TAG="FirestoreClient",FirestoreClient=function(){function i(e,o,s,f){this.platform=e,this.databaseInfo=o,this.credentials=s,this.asyncQueue=f}return i.prototype.start=function(e){var o=this,s=new Deferred,f=new Deferred,d=!1;return this.credentials.setUserChangeListener(function(m){d?o.asyncQueue.enqueue(function(){return o.handleUserChange(m)}):(d=!0,o.initializePersistence(e,f).then(function(){return o.initializeRest(m)}).then(s.resolve,s.reject))}),this.asyncQueue.enqueue(function(){return s.promise}),f.promise},i.prototype.enableNetwork=function(){var e=this;return this.asyncQueue.enqueue(function(){return e.remoteStore.enableNetwork()})},i.prototype.initializePersistence=function(e,o){var s=this;return e?this.startIndexedDbPersistence().then(o.resolve).catch(function(f){return o.reject(f),s.canFallback(f)?(console.warn("Error enabling offline storage. Falling back to storage disabled: "+f),s.startMemoryPersistence()):Promise.reject(f)}):(o.resolve(),this.startMemoryPersistence())},i.prototype.canFallback=function(e){return e.code===Code.FAILED_PRECONDITION||e.code===Code.UNIMPLEMENTED},i.prototype.startIndexedDbPersistence=function(){this.garbageCollector=new NoOpGarbageCollector;var e=IndexedDbPersistence.buildStoragePrefix(this.databaseInfo),o=new JsonProtoSerializer(this.databaseInfo.databaseId,{useProto3Json:!0});return this.persistence=new IndexedDbPersistence(e,o),this.persistence.start()},i.prototype.startMemoryPersistence=function(){return this.garbageCollector=new EagerGarbageCollector,this.persistence=new MemoryPersistence,this.persistence.start()},i.prototype.initializeRest=function(e){var o=this;return this.platform.loadConnection(this.databaseInfo).then(function(s){o.localStore=new LocalStore(o.persistence,e,o.garbageCollector);var f=o.platform.newSerializer(o.databaseInfo.databaseId),d=new Datastore(o.asyncQueue,s,o.credentials,f),m=function(_){o.syncEngine.applyOnlineStateChange(_),o.eventMgr.applyOnlineStateChange(_)};return o.remoteStore=new RemoteStore(o.localStore,d,o.asyncQueue,m),o.syncEngine=new SyncEngine(o.localStore,o.remoteStore,e),o.remoteStore.syncEngine=o.syncEngine,o.eventMgr=new EventManager(o.syncEngine),o.localStore.start()}).then(function(){return o.remoteStore.start()})},i.prototype.handleUserChange=function(e){return this.asyncQueue.verifyOperationInProgress(),debug(LOG_TAG,"User Changed: "+e.uid),this.syncEngine.handleUserChange(e)},i.prototype.disableNetwork=function(){var e=this;return this.asyncQueue.enqueue(function(){return e.remoteStore.disableNetwork()})},i.prototype.shutdown=function(){var e=this;return this.asyncQueue.enqueue(function(){return e.credentials.removeUserChangeListener(),e.remoteStore.shutdown()}).then(function(){return e.persistence.shutdown()})},i.prototype.listen=function(e,o,s){var f=this,d=new QueryListener(e,o,s);return this.asyncQueue.enqueue(function(){return f.eventMgr.listen(d)}),d},i.prototype.unlisten=function(e){var o=this;this.asyncQueue.enqueue(function(){return o.eventMgr.unlisten(e)})},i.prototype.write=function(e){var o=this,s=new Deferred;return this.asyncQueue.enqueue(function(){return o.syncEngine.write(e,s)}),s.promise},i.prototype.databaseId=function(){return this.databaseInfo.databaseId},i.prototype.transaction=function(e){var o=this;return this.asyncQueue.enqueue(function(){return tslib.exports.__awaiter(o,void 0,void 0,function(){return tslib.exports.__generator(this,function(s){return[2]})})}).then(function(){return o.syncEngine.runTransaction(e)})},i}(),AsyncObserver=function(){function i(e){this.observer=e,this.muted=!1}return i.prototype.next=function(e){this.scheduleEvent(this.observer.next,e)},i.prototype.error=function(e){this.scheduleEvent(this.observer.error,e)},i.prototype.mute=function(){this.muted=!0},i.prototype.scheduleEvent=function(e,o){var s=this;this.muted||setTimeout(function(){s.muted||e(o)},0)},i}(),User=function(){function i(e){this.uid=e}return i.prototype.isAuthenticated=function(){return this.uid!=null},i.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},i.prototype.isEqual=function(e){return e.uid===this.uid},i.UNAUTHENTICATED=new i(null),i.GOOGLE_CREDENTIALS=new i("google-credentials-uid"),i.FIRST_PARTY=new i("first-party-uid"),i}(),OAuthToken=function(){function i(e,o){this.user=o,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+e}}return i}(),EmptyCredentialsProvider=function(){function i(){this.userListener=null}return i.prototype.getToken=function(e){return Promise.resolve(null)},i.prototype.setUserChangeListener=function(e){assert(!this.userListener,"Can only call setUserChangeListener() once."),this.userListener=e,e(User.UNAUTHENTICATED)},i.prototype.removeUserChangeListener=function(){assert(this.userListener!==null,"removeUserChangeListener() when no listener registered"),this.userListener=null},i}(),FirebaseCredentialsProvider=function(){function i(e){var o=this;this.app=e,this.tokenListener=null,this.userCounter=0,this.userListener=null,this.tokenListener=function(){var s=o.getUser();(!o.currentUser||!s.isEqual(o.currentUser))&&(o.currentUser=s,o.userCounter++,o.userListener&&o.userListener(o.currentUser))},this.userCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return i.prototype.getToken=function(e){var o=this;assert(this.tokenListener!=null,"getToken cannot be called after listener removed.");var s=this.userCounter;return this.app.INTERNAL.getToken(e).then(function(f){if(o.userCounter!==s)throw new FirestoreError(Code.ABORTED,"getToken aborted due to uid change.");return f?(assert(typeof f.accessToken=="string","Invalid tokenData returned from getToken():"+f),new OAuthToken(f.accessToken,o.currentUser)):null})},i.prototype.setUserChangeListener=function(e){assert(!this.userListener,"Can only call setUserChangeListener() once."),this.userListener=e,this.currentUser&&e(this.currentUser)},i.prototype.removeUserChangeListener=function(){assert(this.tokenListener!=null,"removeUserChangeListener() called twice"),assert(this.userListener!==null,"removeUserChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.userListener=null},i.prototype.getUser=function(){typeof this.app.INTERNAL.getUid!="function"&&fail("This version of the Firestore SDK requires at least version 3.7.0 of firebase.js.");var e=this.app.INTERNAL.getUid();return assert(e===null||typeof e=="string","Received invalid UID: "+e),new User(e)},i}(),FirstPartyToken=function(){function i(e,o){this.gapi=e,this.sessionIndex=o,this.type="FirstParty",this.user=User.FIRST_PARTY,assert(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")}return Object.defineProperty(i.prototype,"authHeaders",{get:function(){return{Authorization:this.gapi.auth.getAuthHeaderValueForFirstParty([]),"X-Goog-AuthUser":this.sessionIndex}},enumerable:!0,configurable:!0}),i}(),FirstPartyCredentialsProvider=function(){function i(e,o){this.gapi=e,this.sessionIndex=o,assert(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")}return i.prototype.getToken=function(e){return Promise.resolve(new FirstPartyToken(this.gapi,this.sessionIndex))},i.prototype.setUserChangeListener=function(e){e(User.FIRST_PARTY)},i.prototype.removeUserChangeListener=function(){},i}();function makeCredentialsProvider(i){if(!i)return new EmptyCredentialsProvider;switch(i.type){case"gapi":return new FirstPartyCredentialsProvider(i.client,i.sessionIndex||"0");case"provider":return i.client;default:throw new FirestoreError(Code.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}function isPartialObserver(i){return implementsAnyMethods(i,["next","error","complete"])}function implementsAnyMethods(i,e){if(typeof i!="object"||i===null)return!1;for(var o=i,s=0,f=e;s<f.length;s++){var d=f[s];if(d in o&&typeof o[d]=="function")return!0}return!1}var FieldValueImpl=function(){function i(){}return i.delete=function(){return DeleteFieldValueImpl.instance},i.serverTimestamp=function(){return ServerTimestampFieldValueImpl.instance},i.prototype.isEqual=function(e){return this===e},i}(),DeleteFieldValueImpl=function(i){tslib.exports.__extends(e,i);function e(){return i.call(this)||this}return e.instance=new e,e}(FieldValueImpl),ServerTimestampFieldValueImpl=function(i){tslib.exports.__extends(e,i);function e(){return i.call(this)||this}return e.instance=new e,e}(FieldValueImpl),PublicFieldValue=makeConstructorPrivate(FieldValueImpl,"Use FieldValue.<field>() instead."),RESERVED_FIELD_REGEX=/^__.*__$/,ParsedSetData=function(){function i(e,o,s){this.data=e,this.fieldMask=o,this.fieldTransforms=s}return i.prototype.toMutations=function(e,o){var s=[];return this.fieldMask!==null?s.push(new PatchMutation(e,this.data,this.fieldMask,o)):s.push(new SetMutation(e,this.data,o)),this.fieldTransforms.length>0&&s.push(new TransformMutation(e,this.fieldTransforms)),s},i}(),ParsedUpdateData=function(){function i(e,o,s){this.data=e,this.fieldMask=o,this.fieldTransforms=s}return i.prototype.toMutations=function(e,o){var s=[new PatchMutation(e,this.data,this.fieldMask,o)];return this.fieldTransforms.length>0&&s.push(new TransformMutation(e,this.fieldTransforms)),s},i}(),UserDataSource;(function(i){i[i.Set=0]="Set",i[i.Update=1]="Update",i[i.MergeSet=2]="MergeSet",i[i.QueryValue=3]="QueryValue"})(UserDataSource||(UserDataSource={}));function isWrite(i){switch(i){case UserDataSource.Set:case UserDataSource.MergeSet:case UserDataSource.Update:return!0;case UserDataSource.QueryValue:return!1;default:throw fail("Unexpected case for UserDataSource: "+i)}}var ParseContext=function(){function i(e,o,s,f,d,m){this.dataSource=e,this.methodName=o,this.path=s,this.arrayElement=f,d===void 0&&this.validatePath(),this.arrayElement=f!==void 0?f:!1,this.fieldTransforms=d||[],this.fieldMask=m||[]}return i.prototype.childContextForField=function(e){var o=this.path==null?null:this.path.child(e),s=new i(this.dataSource,this.methodName,o,!1,this.fieldTransforms,this.fieldMask);return s.validatePathSegment(e),s},i.prototype.childContextForFieldPath=function(e){var o=this.path==null?null:this.path.child(e),s=new i(this.dataSource,this.methodName,o,!1,this.fieldTransforms,this.fieldMask);return s.validatePath(),s},i.prototype.childContextForArray=function(e){return new i(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},i.prototype.createError=function(e){var o=this.path===null||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new FirestoreError(Code.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+e+o)},i.prototype.validatePath=function(){if(this.path!==null)for(var e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))},i.prototype.validatePathSegment=function(e){if(isWrite(this.dataSource)&&RESERVED_FIELD_REGEX.test(e))throw this.createError("Document fields cannot begin and end with __")},i}(),DocumentKeyReference=function(){function i(e,o){this.databaseId=e,this.key=o}return i}(),UserDataConverter=function(){function i(e){this.preConverter=e}return i.prototype.parseSetData=function(e,o){var s=new ParseContext(UserDataSource.Set,e,FieldPath$1.EMPTY_PATH);validatePlainObject("Data must be an object, but it was:",s,o);var f=this.parseData(o,s);return new ParsedSetData(f,null,s.fieldTransforms)},i.prototype.parseMergeData=function(e,o){var s=new ParseContext(UserDataSource.MergeSet,e,FieldPath$1.EMPTY_PATH);validatePlainObject("Data must be an object, but it was:",s,o);var f=this.parseData(o,s),d=new FieldMask(s.fieldMask);return new ParsedSetData(f,d,s.fieldTransforms)},i.prototype.parseUpdateData=function(e,o){var s=this,f=new ParseContext(UserDataSource.Update,e,FieldPath$1.EMPTY_PATH);validatePlainObject("Data must be an object, but it was:",f,o);var d=[],m=ObjectValue.EMPTY;forEach(o,function($,G){var Z=fieldPathFromDotSeparatedString(e,$),et=f.childContextForFieldPath(Z);if(G=s.runPreConverter(G,et),G instanceof DeleteFieldValueImpl)d.push(Z);else{var tt=s.parseData(G,et);tt!=null&&(d.push(Z),m=m.set(Z,tt))}});var _=new FieldMask(d);return new ParsedUpdateData(m,_,f.fieldTransforms)},i.prototype.parseUpdateVarargs=function(e,o,s,f){var d=new ParseContext(UserDataSource.Update,e,FieldPath$1.EMPTY_PATH),m=[fieldPathFromArgument(e,o)],_=[s];if(f.length%2!==0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var $=0;$<f.length;$+=2)m.push(fieldPathFromArgument(e,f[$])),_.push(f[$+1]);for(var G=[],Z=ObjectValue.EMPTY,$=0;$<m.length;++$){var et=m[$],tt=d.childContextForFieldPath(et),nt=this.runPreConverter(_[$],tt);if(nt instanceof DeleteFieldValueImpl)G.push(et);else{var st=this.parseData(nt,tt);st!=null&&(G.push(et),Z=Z.set(et,st))}}var rt=new FieldMask(G);return new ParsedUpdateData(Z,rt,d.fieldTransforms)},i.prototype.parseQueryValue=function(e,o){var s=new ParseContext(UserDataSource.QueryValue,e,FieldPath$1.EMPTY_PATH),f=this.parseData(o,s);return assert(f!=null,"Parsed data should not be null."),assert(s.fieldTransforms.length===0,"Field transforms should have been disallowed."),f},i.prototype.runPreConverter=function(e,o){try{return this.preConverter(e)}catch(f){var s=errorMessage(f);throw o.createError(s)}},i.prototype.parseData=function(e,o){if(e=this.runPreConverter(e,o),e instanceof Array){if(o.arrayElement)throw o.createError("Nested arrays are not supported");return o.path&&o.fieldMask.push(o.path),this.parseArray(e,o)}else return looksLikeJsonObject(e)?(validatePlainObject("Unsupported field value:",o,e),this.parseObject(e,o)):(o.path&&o.fieldMask.push(o.path),this.parseScalarValue(e,o))},i.prototype.parseArray=function(e,o){for(var s=[],f=0,d=0,m=e;d<m.length;d++){var _=m[d],$=this.parseData(_,o.childContextForArray(f));$==null&&($=NullValue.INSTANCE),s.push($),f++}return new ArrayValue(s)},i.prototype.parseObject=function(e,o){var s=this,f=new SortedMap(primitiveComparator);return forEach(e,function(d,m){var _=s.parseData(m,o.childContextForField(d));_!=null&&(f=f.insert(d,_))}),new ObjectValue(f)},i.prototype.parseScalarValue=function(e,o){if(e===null)return NullValue.INSTANCE;if(typeof e=="number")return isSafeInteger(e)?new IntegerValue(e):new DoubleValue(e);if(typeof e=="boolean")return BooleanValue.of(e);if(typeof e=="string")return new StringValue(e);if(e instanceof Date)return new TimestampValue(Timestamp.fromDate(e));if(e instanceof GeoPoint)return new GeoPointValue(e);if(e instanceof Blob$1)return new BlobValue(e);if(e instanceof DocumentKeyReference)return new RefValue(e.databaseId,e.key);if(e instanceof FieldValueImpl)if(e instanceof DeleteFieldValueImpl){if(o.dataSource===UserDataSource.MergeSet)return null;throw o.dataSource===UserDataSource.Update?(assert(o.path==null||o.path.length>0,"FieldValue.delete() at the top level should have already been handled."),o.createError("FieldValue.delete() can only appear at the top level of your update data")):o.createError("FieldValue.delete() can only be used with update() and set() with {merge:true}")}else if(e instanceof ServerTimestampFieldValueImpl){if(!isWrite(o.dataSource))throw o.createError("FieldValue.serverTimestamp() can only be used with set() and update()");if(o.path===null)throw o.createError("FieldValue.serverTimestamp() is not currently supported inside arrays");return o.fieldTransforms.push(new FieldTransform(o.path,ServerTimestampTransform.instance)),null}else return fail("Unknown FieldValue type: "+e);else throw o.createError("Unsupported field value: "+valueDescription(e))},i}();function looksLikeJsonObject(i){return typeof i=="object"&&i!==null&&!(i instanceof Array)&&!(i instanceof Date)&&!(i instanceof GeoPoint)&&!(i instanceof Blob$1)&&!(i instanceof DocumentKeyReference)&&!(i instanceof FieldValueImpl)}function validatePlainObject(i,e,o){if(!looksLikeJsonObject(o)||!isPlainObject(o)){var s=valueDescription(o);throw s==="an object"?e.createError(i+" a custom object"):e.createError(i+" "+s)}}function fieldPathFromArgument(i,e){if(e instanceof FieldPath)return e._internalPath;if(typeof e=="string")return fieldPathFromDotSeparatedString(i,e);var o="Field path arguments must be of type string or FieldPath.";throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+i+"() called with invalid data. "+o)}function fieldPathFromDotSeparatedString(i,e){try{return fromDotSeparatedString(e)._internalPath}catch(s){var o=errorMessage(s);throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+i+"() called with invalid data. "+o)}}function errorMessage(i){return i instanceof Error?i.message:i.toString()}var DEFAULT_HOST="firestore.googleapis.com",DEFAULT_SSL=!0,FirestoreSettings=function(){function i(e){if(e.host===void 0){if(e.ssl!==void 0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=DEFAULT_HOST,this.ssl=DEFAULT_SSL}else validateNamedType("settings","string","host",e.host),this.host=e.host,validateNamedOptionalType("settings","boolean","ssl",e.ssl),this.ssl=defaulted(e.ssl,DEFAULT_SSL);validateOptionNames("settings",e,["host","ssl","credentials"]),validateNamedOptionalType("settings","object","credentials",e.credentials),this.credentials=e.credentials}return i.prototype.isEqual=function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials},i}(),FirestoreConfig=function(){function i(){}return i}(),Firestore=function(){function i(e){var o=this;this._queue=new AsyncQueue,this.INTERNAL={delete:function(){return tslib.exports.__awaiter(o,void 0,void 0,function(){return tslib.exports.__generator(this,function(m){return this._firestoreClient?[2,this._firestoreClient.shutdown()]:[2]})})}};var s=new FirestoreConfig;if(typeof e.options=="object"){var f=e;s.firebaseApp=f,s.databaseId=i.databaseIdFromApp(f),s.persistenceKey=s.firebaseApp.name,s.credentials=new FirebaseCredentialsProvider(f)}else{var d=e;if(!d.projectId)throw new FirestoreError(Code.INVALID_ARGUMENT,"Must provide projectId");s.databaseId=new DatabaseId(d.projectId,d.database),s.persistenceKey="[DEFAULT]",s.credentials=new EmptyCredentialsProvider}s.settings=new FirestoreSettings({}),this._config=s,this._databaseId=s.databaseId}return i.prototype.settings=function(e){if(validateExactNumberOfArgs("Firestore.settings",arguments,1),validateArgType("Firestore.settings","object",1,e),contains(e,"persistence"))throw new FirestoreError(Code.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var o=new FirestoreSettings(e);if(this._firestoreClient&&!this._config.settings.isEqual(o))throw new FirestoreError(Code.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._config.settings=o,o.credentials!==void 0&&(this._config.credentials=makeCredentialsProvider(o.credentials))},i.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},i.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},i.prototype.enablePersistence=function(){if(this._firestoreClient)throw new FirestoreError(Code.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");return this.configureClient(!0)},i.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(!1),this._firestoreClient},i.prototype.configureClient=function(e){var o=this;assert(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),assert(!this._firestoreClient,"configureClient() called multiple times");var s=new DatabaseInfo(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl),f=function(d){if(d instanceof DocumentReference){var m=o._config.databaseId,_=d.firestore._config.databaseId;if(!_.isEqual(m))throw new FirestoreError(Code.INVALID_ARGUMENT,"Document reference is for database "+(_.projectId+"/"+_.database+" but should be ")+("for database "+m.projectId+"/"+m.database));return new DocumentKeyReference(o._config.databaseId,d._key)}else return d};return this._dataConverter=new UserDataConverter(f),this._firestoreClient=new FirestoreClient(PlatformSupport.getPlatform(),s,this._config.credentials,this._queue),this._firestoreClient.start(e)},i.databaseIdFromApp=function(e){var o=e.options;if(!contains(o,"projectId"))throw contains(o,"firestoreId")?new FirestoreError(Code.INVALID_ARGUMENT,'"firestoreId" is now specified as "projectId" in firebase.initializeApp.'):new FirestoreError(Code.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');if(contains(o,"firestoreOptions"))throw new FirestoreError(Code.INVALID_ARGUMENT,'"firestoreOptions" values are now specified with Firestore.settings()');var s=o.projectId;if(!s||typeof s!="string")throw new FirestoreError(Code.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new DatabaseId(s)},Object.defineProperty(i.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new FirestoreError(Code.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),i.prototype.collection=function(e){if(validateExactNumberOfArgs("Firestore.collection",arguments,1),validateArgType("Firestore.collection","string",1,e),!e)throw new FirestoreError(Code.INVALID_ARGUMENT,"Must provide a non-empty collection path to collection()");return this.ensureClientConfigured(),new CollectionReference(ResourcePath.fromString(e),this)},i.prototype.doc=function(e){if(validateExactNumberOfArgs("Firestore.doc",arguments,1),validateArgType("Firestore.doc","string",1,e),!e)throw new FirestoreError(Code.INVALID_ARGUMENT,"Must provide a non-empty document path to doc()");return this.ensureClientConfigured(),DocumentReference.forPath(ResourcePath.fromString(e),this)},i.prototype.runTransaction=function(e){var o=this;return validateExactNumberOfArgs("Firestore.runTransaction",arguments,1),validateArgType("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(s){return e(new Transaction(o,s))})},i.prototype.batch=function(){return this.ensureClientConfigured(),new WriteBatch(this)},Object.defineProperty(i,"logLevel",{get:function(){switch(getLogLevel()){case LogLevel.DEBUG:return"debug";case LogLevel.ERROR:return"error";case LogLevel.SILENT:return"silent";default:return fail("Unknown log level: "+getLogLevel())}},enumerable:!0,configurable:!0}),i.setLogLevel=function(e){switch(validateExactNumberOfArgs("Firestore.setLogLevel",arguments,1),validateArgType("Firestore.setLogLevel","string",1,e),e){case"debug":setLogLevel(LogLevel.DEBUG);break;case"error":setLogLevel(LogLevel.ERROR);break;case"silent":setLogLevel(LogLevel.SILENT);break;default:throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid log level: "+e)}},i}(),Transaction=function(){function i(e,o){this._firestore=e,this._transaction=o}return i.prototype.get=function(e){var o=this;validateExactNumberOfArgs("Transaction.get",arguments,1);var s=validateReference("Transaction.get",e,this._firestore);return this._transaction.lookup([s._key]).then(function(f){if(!f||f.length!==1)return fail("Mismatch in docs returned from document lookup.");var d=f[0];return d instanceof NoDocument?new DocumentSnapshot(o._firestore,s._key,null,!1):new DocumentSnapshot(o._firestore,s._key,d,!1)})},i.prototype.set=function(e,o,s){validateBetweenNumberOfArgs("Transaction.set",arguments,2,3);var f=validateReference("Transaction.set",e,this._firestore);s=validateSetOptions("Transaction.set",s);var d=s.merge?this._firestore._dataConverter.parseMergeData("Transaction.set",o):this._firestore._dataConverter.parseSetData("Transaction.set",o);return this._transaction.set(f._key,d),this},i.prototype.update=function(e,o,s){for(var f=[],d=3;d<arguments.length;d++)f[d-3]=arguments[d];var m,_;return typeof o=="string"||o instanceof FieldPath?(validateAtLeastNumberOfArgs("Transaction.update",arguments,3),m=validateReference("Transaction.update",e,this._firestore),_=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",o,s,f)):(validateExactNumberOfArgs("Transaction.update",arguments,2),m=validateReference("Transaction.update",e,this._firestore),_=this._firestore._dataConverter.parseUpdateData("Transaction.update",o)),this._transaction.update(m._key,_),this},i.prototype.delete=function(e){validateExactNumberOfArgs("Transaction.delete",arguments,1);var o=validateReference("Transaction.delete",e,this._firestore);return this._transaction.delete(o._key),this},i}(),WriteBatch=function(){function i(e){this._firestore=e,this._mutations=[],this._committed=!1}return i.prototype.set=function(e,o,s){validateBetweenNumberOfArgs("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var f=validateReference("WriteBatch.set",e,this._firestore);s=validateSetOptions("WriteBatch.set",s);var d=s.merge?this._firestore._dataConverter.parseMergeData("WriteBatch.set",o):this._firestore._dataConverter.parseSetData("WriteBatch.set",o);return this._mutations=this._mutations.concat(d.toMutations(f._key,Precondition.NONE)),this},i.prototype.update=function(e,o,s){for(var f=[],d=3;d<arguments.length;d++)f[d-3]=arguments[d];this.verifyNotCommitted();var m,_;return typeof o=="string"||o instanceof FieldPath?(validateAtLeastNumberOfArgs("WriteBatch.update",arguments,3),m=validateReference("WriteBatch.update",e,this._firestore),_=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",o,s,f)):(validateExactNumberOfArgs("WriteBatch.update",arguments,2),m=validateReference("WriteBatch.update",e,this._firestore),_=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",o)),this._mutations=this._mutations.concat(_.toMutations(m._key,Precondition.exists(!0))),this},i.prototype.delete=function(e){validateExactNumberOfArgs("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var o=validateReference("WriteBatch.delete",e,this._firestore);return this._mutations=this._mutations.concat(new DeleteMutation(o._key,Precondition.NONE)),this},i.prototype.commit=function(){return tslib.exports.__awaiter(this,void 0,void 0,function(){return tslib.exports.__generator(this,function(e){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},i.prototype.verifyNotCommitted=function(){if(this._committed)throw new FirestoreError(Code.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},i}(),DocumentReference=function(){function i(e,o){this._key=e,this.firestore=o,this._firestoreClient=this.firestore.ensureClientConfigured()}return i.forPath=function(e,o){if(e.length%2!==0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+(e.canonicalString()+" has "+e.length));return new i(new DocumentKey(e),o)},Object.defineProperty(i.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return new CollectionReference(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),i.prototype.collection=function(e){if(validateExactNumberOfArgs("DocumentReference.collection",arguments,1),validateArgType("DocumentReference.collection","string",1,e),!e)throw new FirestoreError(Code.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var o=ResourcePath.fromString(e);return new CollectionReference(this._key.path.child(o),this.firestore)},i.prototype.isEqual=function(e){if(!(e instanceof i))throw invalidClassError("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)},i.prototype.set=function(e,o){validateBetweenNumberOfArgs("DocumentReference.set",arguments,1,2),o=validateSetOptions("DocumentReference.set",o);var s=o.merge?this.firestore._dataConverter.parseMergeData("DocumentReference.set",e):this.firestore._dataConverter.parseSetData("DocumentReference.set",e);return this._firestoreClient.write(s.toMutations(this._key,Precondition.NONE))},i.prototype.update=function(e,o){for(var s=[],f=2;f<arguments.length;f++)s[f-2]=arguments[f];var d;return typeof e=="string"||e instanceof FieldPath?(validateAtLeastNumberOfArgs("DocumentReference.update",arguments,2),d=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",e,o,s)):(validateExactNumberOfArgs("DocumentReference.update",arguments,1),d=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",e)),this._firestoreClient.write(d.toMutations(this._key,Precondition.exists(!0)))},i.prototype.delete=function(){return validateExactNumberOfArgs("DocumentReference.delete",arguments,0),this._firestoreClient.write([new DeleteMutation(this._key,Precondition.NONE)])},i.prototype.onSnapshot=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];validateBetweenNumberOfArgs("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},f,d=0;typeof e[d]=="object"&&!isPartialObserver(e[d])&&(s=e[d],validateOptionNames("DocumentReference.onSnapshot",s,["includeMetadataChanges"]),validateNamedOptionalType("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),d++);var m={includeDocumentMetadataChanges:s.includeMetadataChanges,includeQueryMetadataChanges:s.includeMetadataChanges};return isPartialObserver(e[d])?f=e[d]:(validateArgType("DocumentReference.onSnapshot","function",d,e[d]),validateOptionalArgType("DocumentReference.onSnapshot","function",d+1,e[d+1]),validateOptionalArgType("DocumentReference.onSnapshot","function",d+2,e[d+2]),f={next:e[d],error:e[d+1],complete:e[d+2]}),this.onSnapshotInternal(m,f)},i.prototype.onSnapshotInternal=function(e,o){var s=this,f=function(_){console.error("Uncaught Error in onSnapshot:",_)};o.error&&(f=o.error.bind(o));var d=new AsyncObserver({next:function(_){if(o.next){assert(_.docs.size<=1,"Too many documents returned on a document query");var $=_.docs.get(s._key);o.next(new DocumentSnapshot(s.firestore,s._key,$,_.fromCache))}},error:f}),m=this._firestoreClient.listen(Query$1.atPath(this._key.path),d,e);return function(){d.mute(),s._firestoreClient.unlisten(m)}},i.prototype.get=function(){var e=this;return validateExactNumberOfArgs("DocumentReference.get",arguments,0),new Promise(function(o,s){var f=e.onSnapshotInternal({includeQueryMetadataChanges:!0,includeDocumentMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(d){f(),!d.exists&&d.metadata.fromCache?s(new FirestoreError(Code.ABORTED,"Failed to get document because the client is offline.")):o(d)},error:s})})},i}(),SnapshotMetadata=function(){function i(e,o){this.hasPendingWrites=e,this.fromCache=o}return i.prototype.isEqual=function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache},i}(),DocumentSnapshot=function(){function i(e,o,s,f){this._firestore=e,this._key=o,this._document=s,this._fromCache=f}return i.prototype.data=function(e){return validateBetweenNumberOfArgs("DocumentSnapshot.data",arguments,0,1),e=validateSnapshotOptions("DocumentSnapshot.data",e),this._document?this.convertObject(this._document.data,FieldValueOptions.fromSnapshotOptions(e)):void 0},i.prototype.get=function(e,o){if(validateBetweenNumberOfArgs("DocumentSnapshot.get",arguments,1,2),o=validateSnapshotOptions("DocumentSnapshot.get",o),this._document){var s=this._document.data.field(fieldPathFromArgument("DocumentSnapshot.get",e));if(s!==void 0)return this.convertValue(s,FieldValueOptions.fromSnapshotOptions(o))}},Object.defineProperty(i.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ref",{get:function(){return new DocumentReference(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"exists",{get:function(){return this._document!==null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"metadata",{get:function(){return new SnapshotMetadata(this._document!==null&&this._document.hasLocalMutations,this._fromCache)},enumerable:!0,configurable:!0}),i.prototype.isEqual=function(e){if(!(e instanceof i))throw invalidClassError("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(this._document===null?e._document===null:this._document.isEqual(e._document))},i.prototype.convertObject=function(e,o){var s=this,f={};return e.forEach(function(d,m){f[d]=s.convertValue(m,o)}),f},i.prototype.convertValue=function(e,o){if(e instanceof ObjectValue)return this.convertObject(e,o);if(e instanceof ArrayValue)return this.convertArray(e,o);if(e instanceof RefValue){var s=e.value(o),f=this._firestore.ensureClientConfigured().databaseId();return e.databaseId.isEqual(f)||error("Document "+this._key.path+" contains a document reference within a different database ("+(e.databaseId.projectId+"/"+e.databaseId.database+") which is not ")+"supported. It will be treated as a reference in the current "+("database ("+f.projectId+"/"+f.database+") ")+"instead."),new DocumentReference(s,this._firestore)}else return e.value(o)},i.prototype.convertArray=function(e,o){var s=this;return e.internalValue.map(function(f){return s.convertValue(f,o)})},i}(),QueryDocumentSnapshot=function(i){tslib.exports.__extends(e,i);function e(o,s,f,d){return i.call(this,o,s,f,d)||this}return e.prototype.data=function(o){var s=i.prototype.data.call(this,o);return assert(typeof s=="object","Document in a QueryDocumentSnapshot should exist"),s},e}(DocumentSnapshot),Query=function(){function i(e,o){this._query=e,this.firestore=o}return i.prototype.where=function(e,o,s){validateExactNumberOfArgs("Query.where",arguments,3),validateArgType("Query.where","string",2,o),validateDefined("Query.where",3,s);var f,d=fieldPathFromArgument("Query.where",e);if(d.isKeyField())if(typeof s=="string"){if(s.indexOf("/")!==-1)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it contains a slash.");if(s==="")throw new FirestoreError(Code.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it was an empty string.");var m=this._query.path.child(new ResourcePath([s]));assert(m.length%2===0,"Path should be a document key"),f=new RefValue(this.firestore._databaseId,new DocumentKey(m))}else if(s instanceof DocumentReference){var _=s;f=new RefValue(this.firestore._databaseId,_._key)}else throw new FirestoreError(Code.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a string or a DocumentReference if the first parameter is FieldPath.documentId(), but it was: "+(valueDescription(s)+"."));else f=this.firestore._dataConverter.parseQueryValue("Query.where",s);var $=fieldFilter(d,RelationOp.fromString(o),f);return this.validateNewFilter($),new i(this._query.addFilter($),this.firestore)},i.prototype.orderBy=function(e,o){validateBetweenNumberOfArgs("Query.orderBy",arguments,1,2),validateOptionalArgType("Query.orderBy","string",2,o);var s;if(o===void 0||o==="asc")s=Direction.ASCENDING;else if(o==="desc")s=Direction.DESCENDING;else throw new FirestoreError(Code.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+o+"', expected 'asc' or 'desc'.");if(this._query.startAt!==null)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(this._query.endAt!==null)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var f=fieldPathFromArgument("Query.orderBy",e),d=new OrderBy(f,s);return this.validateNewOrderBy(d),new i(this._query.addOrderBy(d),this.firestore)},i.prototype.limit=function(e){if(validateExactNumberOfArgs("Query.limit",arguments,1),validateArgType("Query.limit","number",1,e),e<=0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid Query. Query limit ("+e+") is invalid. Limit must be positive.");return new i(this._query.withLimit(e),this.firestore)},i.prototype.startAt=function(e){for(var o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];validateAtLeastNumberOfArgs("Query.startAt",arguments,1);var f=this.boundFromDocOrFields("Query.startAt",e,o,!0);return new i(this._query.withStartAt(f),this.firestore)},i.prototype.startAfter=function(e){for(var o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];validateAtLeastNumberOfArgs("Query.startAfter",arguments,1);var f=this.boundFromDocOrFields("Query.startAfter",e,o,!1);return new i(this._query.withStartAt(f),this.firestore)},i.prototype.endBefore=function(e){for(var o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];validateAtLeastNumberOfArgs("Query.endBefore",arguments,1);var f=this.boundFromDocOrFields("Query.endBefore",e,o,!0);return new i(this._query.withEndAt(f),this.firestore)},i.prototype.endAt=function(e){for(var o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];validateAtLeastNumberOfArgs("Query.endAt",arguments,1);var f=this.boundFromDocOrFields("Query.endAt",e,o,!1);return new i(this._query.withEndAt(f),this.firestore)},i.prototype.isEqual=function(e){if(!(e instanceof i))throw invalidClassError("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},i.prototype.boundFromDocOrFields=function(e,o,s,f){if(validateDefined(e,1,o),o instanceof DocumentSnapshot){if(s.length>0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Too many arguments provided to "+e+"().");var d=o;if(!d.exists)throw new FirestoreError(Code.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+(e+"()."));return this.boundFromDocument(e,d._document,f)}else{var m=[o].concat(s);return this.boundFromFields(e,m,f)}},i.prototype.boundFromDocument=function(e,o,s){for(var f=[],d=0,m=this._query.orderBy;d<m.length;d++){var _=m[d];if(_.field.isKeyField())f.push(new RefValue(this.firestore._databaseId,o.key));else{var $=o.field(_.field);if($!==void 0)f.push($);else{var G=_.field.canonicalString();throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a "+("document for which the field '"+G+"' (used as the ")+"orderBy) does not exist.")}}}return new Bound(f,s)},i.prototype.boundFromFields=function(e,o,s){var f=this._query.explicitOrderBy;if(o.length>f.length)throw new FirestoreError(Code.INVALID_ARGUMENT,"Too many arguments provided to "+e+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var d=[],m=0;m<o.length;m++){var _=o[m],$=f[m];if($.field.isKeyField()){if(typeof _!="string")throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+(e+"(), but got a "+typeof _));if(_.indexOf("/")!==-1)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. Document ID '"+_+"' contains a slash in "+(e+"()"));var G=new DocumentKey(this._query.path.child(_));d.push(new RefValue(this.firestore._databaseId,G))}else{var Z=this.firestore._dataConverter.parseQueryValue(e,_);d.push(Z)}}return new Bound(d,s)},i.prototype.onSnapshot=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];validateBetweenNumberOfArgs("Query.onSnapshot",arguments,1,4);var s={},f,d=0;return typeof e[d]=="object"&&!isPartialObserver(e[d])&&(s=e[d],validateOptionNames("Query.onSnapshot",s,["includeQueryMetadataChanges","includeDocumentMetadataChanges"]),validateNamedOptionalType("Query.onSnapshot","boolean","includeDocumentMetadataChanges",s.includeDocumentMetadataChanges),validateNamedOptionalType("Query.onSnapshot","boolean","includeQueryMetadataChanges",s.includeQueryMetadataChanges),d++),isPartialObserver(e[d])?f=e[d]:(validateArgType("Query.onSnapshot","function",d,e[d]),validateOptionalArgType("Query.onSnapshot","function",d+1,e[d+1]),validateOptionalArgType("Query.onSnapshot","function",d+2,e[d+2]),f={next:e[d],error:e[d+1],complete:e[d+2]}),this.onSnapshotInternal(s,f)},i.prototype.onSnapshotInternal=function(e,o){var s=this,f=function($){console.error("Uncaught Error in onSnapshot:",$)};o.error&&(f=o.error.bind(o));var d=new AsyncObserver({next:function($){o.next&&o.next(new QuerySnapshot(s.firestore,s._query,$))},error:f}),m=this.firestore.ensureClientConfigured(),_=m.listen(this._query,d,e);return function(){d.mute(),m.unlisten(_)}},i.prototype.get=function(){var e=this;return validateExactNumberOfArgs("Query.get",arguments,0),new Promise(function(o,s){var f=e.onSnapshotInternal({includeDocumentMetadataChanges:!1,includeQueryMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(d){f(),o(d)},error:s})})},i.prototype.validateNewFilter=function(e){if(e instanceof RelationFilter&&e.isInequality()){var o=this._query.getInequalityFilterField();if(o!==null&&!o.isEqual(e.field))throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have"+(" inequality filters on '"+o.toString()+"'")+(" and '"+e.field.toString()+"'"));var s=this._query.getFirstOrderByField();s!==null&&this.validateOrderByAndInequalityMatch(e.field,s)}},i.prototype.validateNewOrderBy=function(e){if(this._query.getFirstOrderByField()===null){var o=this._query.getInequalityFilterField();o!==null&&this.validateOrderByAndInequalityMatch(o,e.field)}},i.prototype.validateOrderByAndInequalityMatch=function(e,o){if(!o.isEqual(e))throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality "+("(<, <=, >, or >=) on field '"+e.toString()+"' ")+("and so you must also use '"+e.toString()+"' ")+"as your first Query.orderBy(), but your first Query.orderBy() "+("is on field '"+o.toString()+"' instead."))},i}(),QuerySnapshot=function(){function i(e,o,s){this._firestore=e,this._originalQuery=o,this._snapshot=s,this._cachedChanges=null,this.metadata=new SnapshotMetadata(s.hasPendingWrites,s.fromCache)}return Object.defineProperty(i.prototype,"docs",{get:function(){var e=[];return this.forEach(function(o){return e.push(o)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),i.prototype.forEach=function(e,o){var s=this;validateBetweenNumberOfArgs("QuerySnapshot.forEach",arguments,1,2),validateArgType("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(f){e.call(o,s.convertToDocumentImpl(f))})},Object.defineProperty(i.prototype,"query",{get:function(){return new Query(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"docChanges",{get:function(){return this._cachedChanges||(this._cachedChanges=changesFromSnapshot(this._firestore,this._snapshot)),this._cachedChanges},enumerable:!0,configurable:!0}),i.prototype.isEqual=function(e){if(!(e instanceof i))throw invalidClassError("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)},i.prototype.convertToDocumentImpl=function(e){return new QueryDocumentSnapshot(this._firestore,e.key,e,this.metadata.fromCache)},i}(),CollectionReference=function(i){tslib.exports.__extends(e,i);function e(o,s){var f=i.call(this,Query$1.atPath(o),s)||this;if(o.length%2!==1)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+(o.canonicalString()+" has "+o.length));return f}return Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var o=this._query.path.popLast();return o.isEmpty()?null:new DocumentReference(new DocumentKey(o),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(o){if(validateBetweenNumberOfArgs("CollectionReference.doc",arguments,0,1),arguments.length===0&&(o=AutoId.newId()),validateArgType("CollectionReference.doc","string",1,o),o==="")throw new FirestoreError(Code.INVALID_ARGUMENT,"Document path must be a non-empty string");var s=ResourcePath.fromString(o);return DocumentReference.forPath(this._query.path.child(s),this.firestore)},e.prototype.add=function(o){validateExactNumberOfArgs("CollectionReference.add",arguments,1),validateArgType("CollectionReference.add","object",1,o);var s=this.doc();return s.set(o).then(function(){return s})},e}(Query);function validateSetOptions(i,e){return e===void 0?{merge:!1}:(validateOptionNames(i,e,["merge"]),validateNamedOptionalType(i,"boolean","merge",e.merge),e)}function validateSnapshotOptions(i,e){return e===void 0?{}:(validateOptionNames(i,e,["serverTimestamps"]),validateNamedOptionalPropertyEquals(i,"options","serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function validateReference(i,e,o){if(e instanceof DocumentReference){if(e.firestore!==o)throw new FirestoreError(Code.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}else throw invalidClassError(i,"DocumentReference",1,e)}function changesFromSnapshot(i,e){if(e.oldDocs.isEmpty()){var o,s=0;return e.docChanges.map(function(d){var m=new QueryDocumentSnapshot(i,d.doc.key,d.doc,e.fromCache);return assert(d.type===ChangeType.Added,"Invalid event type for first snapshot"),assert(!o||e.query.docComparator(o,d.doc)<0,"Got added events in wrong order"),o=d.doc,{type:"added",doc:m,oldIndex:-1,newIndex:s++}})}else{var f=e.oldDocs;return e.docChanges.map(function(d){var m=new QueryDocumentSnapshot(i,d.doc.key,d.doc,e.fromCache),_=-1,$=-1;return d.type!==ChangeType.Added&&(_=f.indexOf(d.doc.key),assert(_>=0,"Index for document not found"),f=f.delete(d.doc.key)),d.type!==ChangeType.Removed&&(f=f.add(d.doc),$=f.indexOf(d.doc.key)),{type:resultChangeType(d.type),doc:m,oldIndex:_,newIndex:$}})}}function resultChangeType(i){switch(i){case ChangeType.Added:return"added";case ChangeType.Modified:case ChangeType.Metadata:return"modified";case ChangeType.Removed:return"removed";default:return fail("Unknown change type: "+i)}}var PublicFirestore=makeConstructorPrivate(Firestore,"Use firebase.firestore() instead."),PublicTransaction=makeConstructorPrivate(Transaction,"Use firebase.firestore().runTransaction() instead."),PublicWriteBatch=makeConstructorPrivate(WriteBatch,"Use firebase.firestore().batch() instead."),PublicDocumentReference=makeConstructorPrivate(DocumentReference,"Use firebase.firestore().doc() instead."),PublicDocumentSnapshot=makeConstructorPrivate(DocumentSnapshot),PublicQueryDocumentSnapshot=makeConstructorPrivate(QueryDocumentSnapshot),PublicQuery=makeConstructorPrivate(Query),PublicQuerySnapshot=makeConstructorPrivate(QuerySnapshot),PublicCollectionReference=makeConstructorPrivate(CollectionReference,"Use firebase.firestore().collection() instead."),firestoreNamespace={Firestore:PublicFirestore,GeoPoint,Blob:PublicBlob,Transaction:PublicTransaction,WriteBatch:PublicWriteBatch,DocumentReference:PublicDocumentReference,DocumentSnapshot:PublicDocumentSnapshot,Query:PublicQuery,QueryDocumentSnapshot:PublicQueryDocumentSnapshot,QuerySnapshot:PublicQuerySnapshot,CollectionReference:PublicCollectionReference,FieldPath,FieldValue:PublicFieldValue,setLogLevel:Firestore.setLogLevel};function configureForFirebase(i){i.INTERNAL.registerService("firestore",function(e){return new Firestore(e)},shallowCopy(firestoreNamespace))}function registerFirestore(i){configureForFirebase(i)}registerFirestore(firebase$1);const config={apiKey:"AIzaSyBwR22Q162Mty1nGSnmSmXYK15AdX7SAHM",authDomain:"test-vue-d8bb1.firebaseapp.com",projectId:"test-vue-d8bb1",storageBucket:"test-vue-d8bb1.appspot.com",messagingSenderId:"523151007589",appId:"1:523151007589:web:9f4b61cd7bd1feb3dfcb8c",measurementId:"G-ZSZHLHG1FN"},firebaseApp=firebase_1.initializeApp(config),db=firebaseApp.firestore(),quotesCollection=db.collection("quotes"),createQuote=i=>quotesCollection.add(i),updateQuote=(i,e)=>quotesCollection.doc(i).update(e),deleteQuote=i=>quotesCollection.doc(i).delete(),useLoadQuotes=()=>{const i=ref([]),e=quotesCollection.onSnapshot(o=>{i.value=o.docs.map(s=>({id:s.id,...s.data()}))});return onUnmounted(e),i},UseLoadAuthorsGenre=()=>{const i=ref([]),e=quotesCollection.onSnapshot(o=>{i.value=o.docs.map(s=>({author:s.data().Author,genre:s.data().Genre}))});return onUnmounted(e),i},index$6="",index$5="",_export_sfc=(i,e)=>{const o=i.__vccOpts||i;for(const[s,f]of e)o[s]=f;return o},_sfc_main$7={props:["show","title","description","cancel","confirm","id"]},_hoisted_1$7={class:"overlay"},_hoisted_2$6={class:"dialog"},_hoisted_3$4={class:"dialog__content"},_hoisted_4$4=["textContent"],_hoisted_5$4=["textContent"],_hoisted_6$2=createBaseVNode("hr",null,null,-1),_hoisted_7$2={class:"dialog__footer"};function _sfc_render$5(i,e,o,s,f,d){return withDirectives((openBlock(),createElementBlock("div",_hoisted_1$7,[createBaseVNode("div",_hoisted_2$6,[createBaseVNode("div",_hoisted_3$4,[createBaseVNode("h2",{class:"dialog__title",textContent:toDisplayString(o.title)},null,8,_hoisted_4$4),createBaseVNode("p",{class:"dialog__description",textContent:toDisplayString(o.description)},null,8,_hoisted_5$4)]),_hoisted_6$2,createBaseVNode("div",_hoisted_7$2,[createBaseVNode("button",{onClick:e[0]||(e[0]=(...m)=>o.cancel&&o.cancel(...m)),class:"btn"},"Cancel"),createBaseVNode("button",{onClick:e[1]||(e[1]=m=>o.confirm(o.id)),class:"btn btn-primary"}," Yes, delete it ")])])],512)),[[vShow,o.show]])}const Dialog=_export_sfc(_sfc_main$7,[["render",_sfc_render$5]]),index$4="",_sfc_main$6={name:"card",props:["card","cancel","rebuild"],components:{Dialog},data:function(){return{quote:{Text:this.card.Text,Author:this.card.Author,Genre:this.card.Genre,Create_Time:this.card.Create_Time,Edit_Time:this.card.Edit_Time},id:this.card.id,showDialog:!1,validated:!0,error_text:null,error_author:null,error_genre:null}},methods:{cancel_dialog(){this.showDialog=!1},check(){return!!this.cancel},check_update(){this.check()&&this.rebuild()},confirm(i){deleteQuote(i),this.showDialog=!1},edit(){if(this.error_text=null,this.error_author=null,this.error_genre=null,!this.quote.Text)return this.error_text="Text cant be empty";if(!this.quote.Author)return this.error_author="Author cant be empty";if(/\d/.test(this.quote.Author))return this.error_author="Author line cant contain digits";if(!this.quote.Genre)return this.error_genre="Genre cant be empty";if(/\d/.test(this.quote.Genre))return this.error_genre="Genre line cant contain digits";const i=new Date;var e=i.getHours();e=("0"+e).slice(-2);var o=i.getMinutes();o=("0"+o).slice(-2),this.quote.Edit_Time=`${e}:${o} ${i.getDate()}/${i.getMonth()+1}/${i.getFullYear()}`,updateQuote(this.id,this.quote),this.validated=!this.validated},save(i){this.id=i.id,this.quote.Author=i.Author,this.quote.Text=i.Text,this.quote.Genre=i.Genre,this.quote.Create_Time=i.Create_Time,this.quote.Edit_Time=i.Edit_Time}}},_hoisted_1$6={class:"card_container"},_hoisted_2$5={class:"content"},_hoisted_3$3=createBaseVNode("label",null,"The quote:",-1),_hoisted_4$3=["disabled"],_hoisted_5$3={key:0,class:"error"},_hoisted_6$1=createBaseVNode("label",null,"Author:",-1),_hoisted_7$1=["disabled"],_hoisted_8$1={key:1,class:"error"},_hoisted_9$1=createBaseVNode("label",null,"Genre:",-1),_hoisted_10$2=["disabled"],_hoisted_11$1={key:2,class:"error"},_hoisted_12$1={key:3},_hoisted_13$1={key:5},_hoisted_14$1={key:7},_hoisted_15$1={class:"button_container"};function _sfc_render$4(i,e,o,s,f,d){const m=resolveComponent("Dialog");return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$6,[createBaseVNode("form",_hoisted_2$5,[_hoisted_3$3,withDirectives(createBaseVNode("textarea",{class:normalizeClass(["text_area",!i.validated&&"text_area_active"]),"onUpdate:modelValue":e[0]||(e[0]=_=>i.quote.Text=_),disabled:i.validated?"":i.disabled},`\r
      `,10,_hoisted_4$3),[[vModelText,i.quote.Text]]),i.validated?createCommentVNode("",!0):(openBlock(),createElementBlock("label",_hoisted_5$3,toDisplayString(i.error_text),1)),_hoisted_6$1,withDirectives(createBaseVNode("textarea",{class:normalizeClass(["text_area",!i.validated&&"text_area_active"]),"onUpdate:modelValue":e[1]||(e[1]=_=>i.quote.Author=_),disabled:i.validated?"":i.disabled},`\r
      `,10,_hoisted_7$1),[[vModelText,i.quote.Author]]),i.validated?createCommentVNode("",!0):(openBlock(),createElementBlock("label",_hoisted_8$1,toDisplayString(i.error_author),1)),_hoisted_9$1,withDirectives(createBaseVNode("textarea",{class:normalizeClass(["text_area",!i.validated&&"text_area_active"]),"onUpdate:modelValue":e[2]||(e[2]=_=>i.quote.Genre=_),disabled:i.validated?"":i.disabled},`\r
      `,10,_hoisted_10$2),[[vModelText,i.quote.Genre]]),i.validated?createCommentVNode("",!0):(openBlock(),createElementBlock("label",_hoisted_11$1,toDisplayString(i.error_genre),1)),i.validated?(openBlock(),createElementBlock("label",_hoisted_12$1,"Id:")):createCommentVNode("",!0),i.validated?withDirectives((openBlock(),createElementBlock("textarea",{key:4,class:"text_area_fixed","onUpdate:modelValue":e[3]||(e[3]=_=>i.id=_),readonly:""},`\r
      `,512)),[[vModelText,i.id]]):createCommentVNode("",!0),i.validated?(openBlock(),createElementBlock("label",_hoisted_13$1,"Creation time:")):createCommentVNode("",!0),i.validated?withDirectives((openBlock(),createElementBlock("textarea",{key:6,class:"text_area_fixed","onUpdate:modelValue":e[4]||(e[4]=_=>i.quote.Create_Time=_),readonly:""},`\r
      `,512)),[[vModelText,i.quote.Create_Time]]):createCommentVNode("",!0),i.validated?(openBlock(),createElementBlock("label",_hoisted_14$1,"Last edit:")):createCommentVNode("",!0),i.validated?withDirectives((openBlock(),createElementBlock("textarea",{key:8,class:"text_area_fixed","onUpdate:modelValue":e[5]||(e[5]=_=>i.quote.Edit_Time=_),readonly:""},`\r
      `,512)),[[vModelText,i.quote.Edit_Time]]):createCommentVNode("",!0),createBaseVNode("div",_hoisted_15$1,[d.check()?(openBlock(),createElementBlock("button",{key:0,class:"btn",type:"button",onClick:e[6]||(e[6]=(..._)=>this.cancel&&this.cancel(..._))}," Cancel ")):createCommentVNode("",!0),i.validated?(openBlock(),createElementBlock("button",{key:1,class:"btn",type:"button",onClick:e[7]||(e[7]=_=>i.showDialog=!0)}," Delete ")):createCommentVNode("",!0),i.validated?createCommentVNode("",!0):(openBlock(),createElementBlock("button",{key:2,class:"btn btn-primary",type:"button",onClick:e[8]||(e[8]=_=>(d.edit(i.id),d.check_update()))}," Submit ")),createBaseVNode("button",{class:"btn",type:"button",onClick:e[9]||(e[9]=_=>(i.validated=!i.validated,d.save(o.card)))},toDisplayString(i.validated?"Update":"Stop"),1)])])]),createVNode(m,{show:i.showDialog,cancel:d.cancel_dialog,confirm:d.confirm,id:o.card.id,title:"Delete a quote?",description:"Are you sure you want to delete this quote?"},null,8,["show","cancel","confirm","id"])],64)}const Card=_export_sfc(_sfc_main$6,[["render",_sfc_render$4]]),_hoisted_1$5={class:"card_container"},_hoisted_2$4=createBaseVNode("h3",null,"Create Form",-1),_hoisted_3$2={class:"content"},_hoisted_4$2=createBaseVNode("label",null,"The quote:",-1),_hoisted_5$2={class:"error"},_hoisted_6=createBaseVNode("label",null,"Author:",-1),_hoisted_7={class:"error"},_hoisted_8=createBaseVNode("label",null,"Genre:",-1),_hoisted_9={class:"error"},_hoisted_10$1={class:"button_container"},__default__$1={name:"CardCreation",props:["cancel","rebuild"],data(){return{quote:{Text:null,Author:null,Genre:null,Create_Time:null,Edit_Time:null},error_text:null,error_author:null,error_genre:null}},methods:{getData(){if(this.error_text=null,this.error_author=null,this.error_genre=null,!this.quote.Text)return this.error_text="Text cant be empty";if(!this.quote.Author)return this.error_author="Author cant be empty";if(/\d/.test(this.quote.Author))return this.error_author="Author line cant contain digits";if(!this.quote.Genre)return this.error_genre="Genre cant be empty";if(/\d/.test(this.quote.Genre))return this.error_genre="Genre line cant contain digits";const i=new Date;var e=i.getHours(),o=i.getMinutes();e=("0"+e).slice(-2),o=("0"+o).slice(-2),this.quote.Create_Time=`${e}:${o} ${i.getDate()}/${i.getMonth()+1}/${i.getFullYear()}`,this.quote.Edit_Time=this.quote.Create_Time,this.quote.Create_Time!==null&&this.quote.Edit_Time!==null&&(createQuote(this.quote),this.quote.Author=null,this.quote.Text=null,this.quote.Genre=null,this.quote.Edit_Time=null,this.quote.Create_Time=null,this.rebuild(),this.cancel())}}},_sfc_main$5=Object.assign(__default__$1,{setup(i){return(e,o)=>(openBlock(),createElementBlock("div",_hoisted_1$5,[_hoisted_2$4,createBaseVNode("form",_hoisted_3$2,[_hoisted_4$2,withDirectives(createBaseVNode("textarea",{name:"Text",class:"text_area text_area_active","onUpdate:modelValue":o[0]||(o[0]=s=>e.quote.Text=s)},null,512),[[vModelText,e.quote.Text]]),createBaseVNode("label",_hoisted_5$2,toDisplayString(e.error_text),1),_hoisted_6,withDirectives(createBaseVNode("textarea",{name:"Author",class:"text_area text_area_active","onUpdate:modelValue":o[1]||(o[1]=s=>e.quote.Author=s)},null,512),[[vModelText,e.quote.Author]]),createBaseVNode("label",_hoisted_7,toDisplayString(e.error_author),1),_hoisted_8,withDirectives(createBaseVNode("textarea",{name:"Genre",class:"text_area text_area_active","onUpdate:modelValue":o[2]||(o[2]=s=>e.quote.Genre=s)},null,512),[[vModelText,e.quote.Genre]]),createBaseVNode("label",_hoisted_9,toDisplayString(e.error_genre),1),createBaseVNode("div",_hoisted_10$1,[createBaseVNode("button",{type:"button",class:"btn",onClick:o[3]||(o[3]=(...s)=>i.cancel&&i.cancel(...s))},"Close"),createBaseVNode("button",{type:"button",class:"btn",onClick:o[4]||(o[4]=s=>e.getData())},"Create")])])]))}}),_sfc_main$4={props:["show","cancel","rebuild"],components:{CreateCard:_sfc_main$5}},_hoisted_1$4={class:"overlay_create"},_hoisted_2$3={class:"dialog_create"};function _sfc_render$3(i,e,o,s,f,d){const m=resolveComponent("CreateCard");return withDirectives((openBlock(),createElementBlock("div",_hoisted_1$4,[createBaseVNode("div",_hoisted_2$3,[createVNode(m,{cancel:o.cancel,rebuild:o.rebuild},null,8,["cancel","rebuild"])])],512)),[[vShow,o.show]])}const DialogCreator=_export_sfc(_sfc_main$4,[["render",_sfc_render$3]]),_sfc_main$3={props:["show","cancel","card","rebuild"],components:{Card}},_hoisted_1$3={class:"overlay_create"},_hoisted_2$2={class:"dialog_create"};function _sfc_render$2(i,e,o,s,f,d){const m=resolveComponent("card");return withDirectives((openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$2,[createVNode(m,{card:this.card,cancel:o.cancel,rebuild:o.rebuild},null,8,["card","cancel","rebuild"])])],512)),[[vShow,o.show]])}const DialogCard=_export_sfc(_sfc_main$3,[["render",_sfc_render$2]]),index$3="",_sfc_main$2={props:["show","cancel","author"]},_hoisted_1$2={class:"overlay_create",style:{"overflow-y":"auto"}},_hoisted_2$1={class:"dialog_create"},_hoisted_3$1={class:"author_container"},_hoisted_4$1=createBaseVNode("label",{class:"label"},"Author:",-1),_hoisted_5$1=createBaseVNode("label",{class:"label"},"Genres:",-1);function _sfc_render$1(i,e,o,s,f,d){return withDirectives((openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("button",{class:"btn",onClick:e[0]||(e[0]=(...m)=>o.cancel&&o.cancel(...m))},"Close"),(openBlock(!0),createElementBlock(Fragment,null,renderList(o.author,m=>(openBlock(),createElementBlock("div",{class:"display",key:m.author},[_hoisted_4$1,createBaseVNode("label",null,toDisplayString(m.author),1),_hoisted_5$1,createBaseVNode("label",null,toDisplayString(m.genre),1)]))),128))])])],512)),[[vShow,o.show]])}const AuthorDisplay=_export_sfc(_sfc_main$2,[["render",_sfc_render$1]]),index$2="",_sfc_main$1={name:"CardList",props:["quotes"],components:{Card}},_hoisted_1$1={class:"card_holder"};function _sfc_render(i,e,o,s,f,d){const m=resolveComponent("Card");return openBlock(),createElementBlock("div",_hoisted_1$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.quotes,_=>(openBlock(),createElementBlock("div",{class:"card_in",key:_.id},[createVNode(m,{card:_},null,8,["card"])]))),128))])}const CardList=_export_sfc(_sfc_main$1,[["render",_sfc_render]]),index$1="",_hoisted_1={class:"search"},_hoisted_2={class:"flexer"},_hoisted_3={class:"flexer"},_hoisted_4=["onchange"],_hoisted_5=createStaticVNode('<option value="Filters" selected disabled>Filters</option><option value="e_date">By Edit Date</option><option value="c_date">By Create Date</option><option value="author">By Author</option><option value="genre">By Genre</option>',5),_hoisted_10=[_hoisted_5],_hoisted_11={class:"flexer"},_hoisted_12=["onchange"],_hoisted_13=createBaseVNode("option",{value:"Filters",selected:"",disabled:""},"Range setting",-1),_hoisted_14=createBaseVNode("option",{value:"NewOld"},"From Min To Max",-1),_hoisted_15=createBaseVNode("option",{value:"OldNew"},"From Max to Min",-1),_hoisted_16=[_hoisted_13,_hoisted_14,_hoisted_15],_hoisted_17={class:"image"},_hoisted_18=["hidden"],__default__={name:"HomeView",components:{DialogCreator,CardList,DialogCard,DisplayAuthor:AuthorDisplay},data(){return{showDialog:!1,showRDialog:!1,showAuthor:!1,search:"",quotes:useLoadQuotes(),filter_type:"Filters",range_type:"Filters",author:UseLoadAuthorsGenre(),quotearray:useLoadQuotes(),element:null,order:1}},methods:{cancel(){this.showAuthor=!1,this.showDialog=!1,this.showRDialog=!1,this.element=null},rebuild(){this.quotes=useLoadQuotes()},author_reducer(){return this.author.reduce((e,o)=>{const s=e.find(d=>d.author===o.author),f=e.indexOf(s);if(s){let d=e[f].genre.concat(` ${o.genre}`),m=new Set(d.split(" "));return m=Array.from(m).join(" "),e[f]=new Proxy({author:e[f].author,genre:m},{}),e}else return e.concat([o])},[])},byEdit(i,e){return i.Edit_Time.split(" ")[1]>e.Edit_Time.split(" ")[1]?1*this.order:e.Edit_Time.split(" ")[1]>i.Edit_Time.split(" ")[1]?-1*this.order:i.Edit_Time.split(" ")[0]>e.Edit_Time.split(" ")[0]?1*this.order:e.Edit_Time.split(" ")[0]>i.Edit_Time.split(" ")[0]?-1*this.order:0},byCreate(i,e){return i.Create_Time.split(" ")[1]>e.Create_Time.split(" ")[1]?1*this.order:e.Create_Time.split(" ")[1]>i.Create_Time.split(" ")[1]?-1*this.order:i.Create_Time.split(" ")[0]>e.Create_Time.split(" ")[0]?1:e.Create_Time.split(" ")[0]>i.Create_Time.split(" ")[0]?-1*this.order:0*this.order},byAuthor(i,e){return i.Author<e.Author?-1:i.Author>e.Author?1:0},byGenre(i,e){return i.Genre<e.Genre?-1:i.Genre>e.Genre?1:0},selectCard(){(this.quotearray.length===0||this.quotearray===null)&&(console.log("rebuild"),this.quotearray=useLoadQuotes());let i=Math.round(Math.random()*this.quotearray.length-1);i<0&&i++;let e=this.quotearray[i];return this.quotearray.splice(i,1),(this.quotearray.length===0||this.quotearray===null)&&(console.log("rebuild"),this.quotearray=useLoadQuotes()),e}},$computed:{filteredQuotes(){return this.quotes.filter(i=>{if(i.Text.toLowerCase().includes(this.search.toLowerCase())||i.Author.toLowerCase().includes(this.search.toLowerCase())||i.Genre.toLowerCase().includes(this.search.toLowerCase()))return i})},Change(){this.filter_type==="e_date"?this.quotes.sort(this.byEdit):this.filter_type==="c_date"?this.quotes.sort(this.byCreate):this.filter_type==="author"?this.quotes.sort(this.byAuthor):this.filter_type==="genre"&&this.quotes.sort(this.byGenre)},Range(){this.range_type==="NewOld"?this.order=1:this.range_type==="OldNew"?this.order=-1:this.order=1}}},_sfc_main=Object.assign(__default__,{setup(i){return(e,o)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[withDirectives(createBaseVNode("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>isRef(search)?search.value=s:null),class:"search_input",placeholder:"Search"},null,512),[[vModelText,e.search]]),createBaseVNode("button",{type:"button",class:"btn",onClick:o[1]||(o[1]=s=>this.search="")}," Clear Input ")]),createBaseVNode("div",_hoisted_3,[withDirectives(createBaseVNode("select",{class:"selector","onUpdate:modelValue":o[2]||(o[2]=s=>isRef(filter_type)?filter_type.value=s:null),onchange:e.Change},_hoisted_10,8,_hoisted_4),[[vModelSelect,e.filter_type]]),createBaseVNode("button",{type:"button",class:"btn",onClick:o[3]||(o[3]=s=>e.showDialog=!0)}," Create Card ")]),createBaseVNode("div",_hoisted_11,[withDirectives(createBaseVNode("select",{class:"selector","onUpdate:modelValue":o[4]||(o[4]=s=>isRef(range_type)?range_type.value=s:null),onchange:e.Range},_hoisted_16,8,_hoisted_12),[[vModelSelect,e.range_type]]),createBaseVNode("button",{style:{"align-self":"center"},type:"button",onClick:o[5]||(o[5]=s=>(e.showRDialog=!0,e.element=e.selectCard())),class:"btn"}," \u0421hance card ")]),createBaseVNode("button",{class:"btn",style:{"align-self":"center"},onClick:o[6]||(o[6]=s=>e.showAuthor=!0)},"show authors")]),createBaseVNode("div",_hoisted_17,[createBaseVNode("img",{src:_imports_0,hidden:e.quotes},null,8,_hoisted_18)]),createVNode(CardList,{quotes:e.filteredQuotes},null,8,["quotes"]),createVNode(DialogCreator,{show:e.showDialog,cancel:e.cancel,rebuild:e.rebuild},null,8,["show","cancel","rebuild"]),e.element?(openBlock(),createBlock(DialogCard,{key:0,show:e.showRDialog,cancel:e.cancel,rebuild:e.rebuild,card:e.element},null,8,["show","cancel","rebuild","card"])):createCommentVNode("",!0),createVNode(AuthorDisplay,{show:e.showAuthor,cancel:e.cancel,author:e.author_reducer()},null,8,["show","cancel","author"])],64))}}),router=createRouter({history:createWebHistory("/Vue_Test_Task/"),routes:[{path:"/",name:"home",component:_sfc_main}]}),index="",app=createApp(_sfc_main$8);app.use(router);app.mount("#app");
